(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1e3:function(e,t,i){var n,s;n=[i(7),i(377),i(41),i(73),i(1001)],void 0===(s=function(e,t,i,n,s){return t.extend({template:s,className:"content",fullScreen:!0,regions:{dcl:".dcl"},templateHelpers:function(){return{BL:this.getOption("bl")}},onRender:function(){var e=this.getOption("bl"),t=e in app.config.pucks&&app.config.pucks[e]>10;console.log("sc large",t),app.mobile()||t||(this.$el.find(".left").css("width","25%"),this.$el.find(".right").css("width","73%")),t&&(this.$el.find(".left").removeClass("left"),this.$el.find(".right").removeClass("right")),this.$el.find(".key").show().css("float","none"),this.dcs=new i(null,{running:!1,state:{pageSize:5}}),this.dcl.show(new n({collection:this.dcs,params:{visit:null}})),this.$el.find(".filter, .srch, .dcl .content > h1").hide()}})}.apply(t,n))||(e.exports=s)},1001:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="no_mobile">Sample Changer Status for '+(null==(__t=BL)?"":_.escape(__t))+'</h1>\n\n<div class="left">\n    <div class="handle">\n    </div>\n    \n    <div class="wrap loading-container">\n        <canvas class="sample_changer"></canvas>\n        <div class="ranking">\n            <label>\n                <input type="checkbox" name="components" /> Group By Component\n            </label>\n\n            <label>\n                <input type="checkbox" name="rank" />\n                Rank By\n            </label>:\n            <select name="param">\n                <option value="SCRESOLUTION" data-inverted="1" data-check="SC">AI Resolution</option>\n                <option value="SCCOMPLETENESS" data-check="SC" data-min="0.85">AI Completeness</option>\n                <option value="DCRESOLUTION" data-inverted="1" data-check="DC">AP Resolution</option>\n                <option value="DCCOMPLETENESS" data-check="DC" data-min="0.85">AP Completeness</option>\n            </select>\n        </div>\n        \n        <div class="details form">\n            <ul>\n                <li>\n                    <span class="label">Sample:</span>\n                    <span class="sname"></span>\n                </li>\n                <li><span class="label">Protein:</span> <span class="pname"></span></li>\n                <li><span class="label">Components:</span> <span class="comps"></span></li>\n                \x3c!--<li><span class="label">Container:</span> <span class="cname"></span></li>--\x3e\n                <li><span class="label">Loaded:</span> <span class="loaded"></span></li>\n                <li><span class="label">Screened:</span> <span class="screened"></span></li>\n                <li><span class="label">Data:</span> <span class="data"></span></li>\n            </ul>\n        </div>\n    </div>\n    \n    <div class="key">\n        <p>Inner ring: Protein by colour</p>\n        <p>Outer ring: Sample status</p>\n        <ul>\n            <li>Loaded</li>\n            <li>Screened</li>\n            <li>Auto Indexed</li>\n            <li>Data Collected</li>\n            <li>Auto Integrated</li>\n        </ul>\n    </div>\n</div>\n\n<div class="right">\n    <div class="dcl"></div>\n</div>\n\n<div class="clearfix"></div>\n';return __p}},424:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="image_container border" id="map_model">\n    <div class="image">\n        <div class="controls">\n            <select name="residue"></select> \n            <div class="table peaks"></div>\n        </div>\n        \n        <div id="viewer" style="background: #000"></div>\n        <div id="hud" onmousedown="event.stopPropagation();"\n                   ondblclick="event.stopPropagation();"\n             >This is uglymol not coot. <a href="#"\n                         onclick="V.toggle_help(); return false;"\n                         >H shows help.</a></div>\n        <div id="help"></div>\n    </div>\n</div>\n';return __p}},987:function(e,t,i){var n,s;n=[i(7),i(109),i(233),i(988),i(994),i(995),i(997),i(108),i(41),i(56),i(45),i(106),i(1e3),i(380),i(167)],void 0===(s=function(e,t,i,n,s,a,l,o,c,p,r,d,u,h,m){var f={title:"Data Collections",url:"/dc"},g={dc_list:function(e,i,n,s,a,l,o){console.log("args to dclist",arguments),app.loading(),e?(app.cookie(e.split("-")[0]),model=new r({VISIT:e}),error="The specified visit does not exist"):(model=new d({PROPOSAL:app.prop}),error="The specified proposal does not exist"),model.fetch({success:function(){app.bc.reset(e?[f,{title:model.get("BL")},{title:e}]:[f,{title:app.prop}]),n=n?parseInt(n):1,console.log("page",n);var p=new c(null,{queryParams:{visit:e,s:s,t:a,id:l,dcg:i,PROCESSINGJOBID:o}});p.setPageSize(app.mobile()?5:15),p.state.currentPage=n,p.fetch().done((function(){console.log("DC TYPE",model.get("TYPE")),app.content.show(t.DCView.get(model.get("TYPE"),{collection:p,params:{visit:e,search:s,type:a,id:l,dcg:i},model:model}))}))},error:function(){app.bc.reset([f]),app.message({title:error,message:error})}})},di_viewer:function(e){console.log("di viewer"),new m({field:"DATACOLLECTIONID",value:e}).find({success:function(){var t=new o({ID:e});t.fetch({success:function(){app.bc.reset([f,{title:app.prop+"-"+t.get("VN"),url:"/dc/visit/"+app.prop+"-"+t.get("VN")},{title:"Image Viewer"},{title:t.get("FILETEMPLATE")}]),app.content.show(new i({model:t}))},error:function(){app.bc.reset([f,{title:"Image Viewer"}]),app.message({title:"No such data collection",message:"The specified data collection doesnt exist"})}})},error:function(){app.bc.reset([f,{title:"Image Viewer"}]),app.message({title:"No such data collection",message:"The specified data collection doesnt exist"})}})},mapmodelviewer:function(e,t,i,s){t||(t="dimple"),new m({field:"DATACOLLECTIONID",value:e}).find({success:function(){var a=new o({ID:e});a.fetch({success:function(){app.bc.reset([f,{title:app.prop+"-"+a.get("VN"),url:"/dc/visit/"+app.prop+"-"+a.get("VN")},{title:"Map/Model Viewer"},{title:a.get("FILETEMPLATE")}]),app.content.show(new n({ty:t,dt:i,ppl:s,model:a}))},error:function(){app.bc.reset([f,{title:"Map/Model Viewer"}]),app.message({title:"No such data collection",message:"The specified data collection doesnt exist"})}})},error:function(){app.bc.reset([f,{title:"Map/Model Viewer"}]),app.message({title:"No such data collection",message:"The specified data collection doesnt exist"})}})},rsviewer:function(e){new m({field:"DATACOLLECTIONID",value:e}).find({success:function(){var t=new o({ID:e});t.fetch({success:function(){app.bc.reset([f,{title:app.prop+"-"+t.get("VN"),url:"/dc/visit/"+app.prop+"-"+t.get("VN")},{title:"Reciprocal Space Viewer"},{title:t.get("FILETEMPLATE")}]),app.content.show(new s({model:t}))},error:function(){app.bc.reset([f,{title:"Reciprocal Space Viewer"}]),app.message({title:"No such data collection",message:"The specified data collection doesnt exist"})}})},error:function(){app.bc.reset([f,{title:"Map/Model Viewer"}]),app.message({title:"No such data collection",message:"The specified data collection doesnt exist"})}})},summary:function(e){console.log("summary"),app.loading(),app.cookie(e.split("-")[0]);var t=new r({VISIT:e});t.fetch({success:function(){app.bc.reset([f,{title:"Summary"},{title:e}]);var i=new c(null,{queryParams:{visit:e,t:"fc",pp:app.mobile()?5:15},running:!1});i.fetch().done((function(){app.content.show(new a({collection:i,model:t}))}))},error:function(){app.bc.reset([f,{title:"Error"}]),app.message({title:"No such visit",message:"The specified visit doesnt exist"})}})},apstatussummary:function(e){console.log("apstatussummary"),app.loading(),app.cookie(e.split("-")[0]);var t=new r({VISIT:e});t.fetch({success:function(){app.bc.reset([f,{title:"Autoprocessing Status Summary"},{title:e}]);var i=new c(null,{queryParams:{visit:e,t:"fc",pp:app.mobile()?5:15},running:!1});i.fetch().done((function(){app.content.show(new l({collection:i,model:t}))}))},error:function(){app.bc.reset([f,{title:"Error"}]),app.message({title:"No such visit",message:"The specified visit doesnt exist"})}})},sampleChanger:function(e){app.loading(),app.cookie(e.split("-")[0]);var t=new r({VISIT:e});t.fetch({success:function(){console.log("sc vis",t,t.get("BL")),app.bc.reset([f,{title:"Sample Changer"},{title:e,url:"/dc/visit/"+e}]),app.content.show(new u({visit:e,bl:t.get("BL")}))},error:function(){app.bc.reset([f,{title:"Error"}]),app.message({title:"No such visit",message:"The specified visit doesnt exist"})}})},queue:function(e){app.loading();var t=new r({VISIT:e});t.fetch({success:function(){app.bc.reset([f,{title:"Queue Builder"},{title:e}]),app.content.show(new h({visit:e,bl:t.get("BL")}))},error:function(){app.bc.reset([f,{title:"Error"}]),app.message({title:"No such visit",message:"The specified visit doesnt exist"})}})}};return app.addInitializer((function(){app.on("dclist:show",(function(e){if(e){let t=e.split("-")[1];app.setVisit(t),app.navigate("dc/visit/"+e),g.dc_list(e)}else app.navigate("dc"),g.dc_list()})),app.on("dc:show",(function(e,t,i){if(i){let e=i.substring(i.lastIndexOf("-")+1,i.length);app.setVisit(e)}app.navigate("dc/"+(i?"visit/"+i:"")+"/ty/"+e+"/id/"+t),g.dc_list(i,null,null,null,e,t)}))})),g}.apply(t,n))||(e.exports=s)},988:function(e,t,i){(function(n,s){var a,l;a=[i(7),i(422),i(423),i(369),i(990),i(991),i(424)],void 0===(l=function(e,t,i,a,l,o,c){return e.LayoutView.extend({template:c,className:"content",regions:{peaks:"div.peaks"},events:{"change @ui.res":"gotoResidue"},ui:{viewer:"#viewer",res:"select[name=residue]",hud:"#hud"},loadMaps:function(){var e=this.xhrWithStatus("Downloading Map 1"),t=this;if(e.onload=function(){var e=new i.Zlib.Gunzip(new Uint8Array(this.response)).decompress();if(t.viewer.load_map_from_buffer(e.buffer,{format:"ccp4"}),"dimple"==t.getOption("ty")||"mrbump"==t.getOption("ty")){var n=t.xhrWithStatus("Downloading Map 2");n.onload=function(){var e=new i.Zlib.Gunzip(new Uint8Array(this.response)).decompress();t.viewer.load_map_from_buffer(e.buffer,{format:"ccp4",diff_map:!0}),t.onMapsLoaded()},n.open("GET",app.apiurl+"/download/map/ty/"+t.getOption("ty")+"/id/"+t.model.get("ID")+"/map/2"),app.token&&n.setRequestHeader("Authorization","Bearer "+app.token),n.responseType="arraybuffer",n.send()}else t.onMapsLoaded()},"bigep"==this.getOption("ty"))var n=app.apiurl+"/download/map/ty/"+this.getOption("ty")+"/dt/"+this.getOption("dt")+"/ppl/"+this.getOption("ppl")+"/id/"+this.model.get("ID");else n=app.apiurl+"/download/map/ty/"+this.getOption("ty")+"/id/"+this.model.get("ID");e.open("GET",n),e.responseType="arraybuffer",app.token&&e.setRequestHeader("Authorization","Bearer "+app.token),e.send()},onMapsLoaded:function(){"dimple"==this.getOption("ty")?this.loadPeaks():this.gotoResidue(),this.ui.hud.text("H shows help.")},generateChains:function(){var e=this.viewer.selected.bag.model.get_residues();console.log("res",e),this.ui.res.empty(),n.each(e,(function(e,t){s('<option value="'+t+'">'+t+" "+e[0].resname+"</option>").appendTo(this.ui.res)}),this)},gotoResidue:function(e){var t=this.viewer.selected.bag.model.get_residues();if(this.ui.res.val()in t){var i=t[this.ui.res.val()];this.viewer.select_atom({bag:this.viewer.selected.bag,atom:i[0]},{steps:10}),this.viewer.request_render()}},loadPeaks:function(){var e=new a(null,{id:this.model.get("ID")}),t=this;e.fetch().done((function(){var i=e.findWhere({TYPE:"Dimple"}),n=new l(i.get("PKLIST"),{parse:!0});t.peaktable=new o({collection:n}),t.listenTo(t.peaktable,"peak:show",t.gotoPeak,t),t.peaks.show(t.peaktable),n.length?t.peaks.$el.show():t.gotoResidue()}))},gotoPeak:function(e,t,i){console.log("goto peak!",e,t,i),this.viewer.camera.zoom=70,this.viewer.recenter([e,t,i],[100,0,0],10),this.viewer.request_render()},loadMapModel:function(){if("bigep"==this.getOption("ty"))var e=app.apiurl+"/download/map/pdb/1/ty/"+this.getOption("ty")+"/dt/"+this.getOption("dt")+"/ppl/"+this.getOption("ppl")+"/id/"+this.model.get("ID");else e=app.apiurl+"/download/map/pdb/1/ty/"+this.getOption("ty")+"/id/"+this.model.get("ID");this.viewer.load_pdb(e,null,this.generateChains.bind(this)),this.loadMaps()},onDomRefresh:function(){this.$el.find(".peaks").hide(),this.viewer=new t.Viewer({viewer:"viewer",hud:"hud",help:"help"}),this.viewer.xhr_headers={Authorization:"Bearer "+app.token},this.loadMapModel()},xhrWithStatus:function(e){var t=new window.XMLHttpRequest,i=this;return t.addEventListener("progress",(function(t){i.ui.hud.text(e+" "+(t.loaded/t.total*100).toFixed(0)+"%")})),t}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},990:function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return e.Collection.extend({parse:function(e){var t=[];return n.each(e,(function(e){t.push({X:parseFloat(e[0]),Y:parseFloat(e[1]),Z:parseFloat(e[2]),HEIGHT:parseFloat(e[3])})})),t}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},991:function(e,t,i){var n,s;n=[i(7),i(992),i(993)],void 0===(s=function(e,t,i){var n=e.ItemView.extend({tagName:"tr",template:i,triggers:{"click td":"peak:show"},onRender:function(){0==this.model.collection.indexOf(this.model)&&this.trigger("peak:show")}});return e.CompositeView.extend({template:t,tagName:"table",className:"peaks",childView:n,childViewContainer:"tbody",childEvents:{"peak:show":"showPeak"},showPeak:function(e){console.log("clicked vhild row",this,e),this.trigger("peak:show",e.model.get("X"),e.model.get("Y"),e.model.get("Z"))}})}.apply(t,n))||(e.exports=s)},992:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n    <thead>\n        <tr>\n            <th>X</th>\n            <th>Y</th>\n            <th>Z</th>\n            <th>Height</th>\n        </tr>\n    </thead>\n    <tbody></tbody>\n";return __p}},993:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<td>"+(null==(__t=X)?"":_.escape(__t))+"</td>\n<td>"+(null==(__t=Y)?"":_.escape(__t))+"</td>\n<td>"+(null==(__t=Z)?"":_.escape(__t))+"</td>\n<td>"+(null==(__t=HEIGHT)?"":_.escape(__t))+"</td>\n";return __p}},994:function(e,t,i){var n,s;n=[i(7),i(147),i(422),i(423),i(424)],void 0===(s=function(e,t,i,n,s){return e.LayoutView.extend({template:s,className:"content",regions:{peaks:"div.peaks"},events:{"change @ui.res":"gotoResidue"},ui:{viewer:"#viewer",hud:"#hud",res:"select[name=residue]"},loadData:function(){if(this.attachments.length){var e=this.xhrWithStatus("Downloading Reciprocal Space Data"),t=this;e.onload=function(){var e=new n.Zlib.Gunzip(new Uint8Array(this.response)).decompress(),i=URL.createObjectURL(new Blob([e],{type:"text"}));t.viewer.load_data(i)};var i=this.attachments.at(0);e.open("GET",app.apiurl+"/download/attachment/id/"+this.model.get("ID")+"/aid/"+i.get("DATACOLLECTIONFILEATTACHMENTID")),e.responseType="arraybuffer",app.token&&e.setRequestHeader("Authorization","Bearer "+app.token),e.send()}else this.ui.hud.text("No reciprocal space data for this datacollection")},initialize:function(){this.attachments=new t,this.attachments.queryParams.id=this.model.get("ID"),this.attachments.queryParams.filetype="recip",this.ready=this.attachments.fetch()},onDomRefresh:function(){this.$el.find(".peaks").hide(),this.ui.res.hide(),this.viewer=new i.ReciprocalViewer({viewer:"viewer",hud:"hud",help:"help"}),this.ready.done(this.loadData.bind(this))},xhrWithStatus:function(e){var t=new window.XMLHttpRequest,i=this;return t.addEventListener("progress",(function(t){i.ui.hud.text(e+" "+(t.loaded/t.total*100).toFixed(0)+"%")})),t}})}.apply(t,n))||(e.exports=s)},995:function(e,t,i){(function(n,s){var a,l;a=[i(7),i(16),i(12),i(108),i(197),i(11),i(15),i(996)],void 0===(l=function(e,t,i,a,l,o,c,p){var r=t.Cell.extend({initialize:function(e){r.__super__.initialize.call(this,e),this.listenTo(this.model,"change reset",this.render,this),this.template=e.column.get("template")},render:function(){if(this.$el.empty(),this.model.get("BESTAP")){var e=this.model.get("BESTAP"),t=n.template(n.result(this,"template"));this.$el.html(t(e.toJSON()))}else 1==this.model.get("APLOADED")?this.column.get("first")?0==this.model.get("AUTOINTEGRATIONS").length?this.$el.text("No successful auto processing"):this.$el.text("No best auto processing determined"):this.$el.text(""):this.$el.html('<i class="fa fa-spin fa-spinner"></i>');return this.delegateEvents(),this}}),d=t.Cell.extend({initialize:function(e){d.__super__.initialize.call(this,e),this.listenTo(this.model,"change reset",this.render,this)},render(){return this.model.get("APLOADED")?this.$el.text(this.model.get("AUTOINTEGRATIONS").length):this.$el.text(""),this}});return e.LayoutView.extend({className:"content",template:p,regions:{wrap:".wrapper"},collectionEvents:{"update sync reset":"updateStatus"},events:{"click a[name=update]":"scoreAPS","click a.dll":o.signHandler},ui:{rmerge:'input[name="rmerge"]',res:'input[name="res"]',isigi:'input[name="isigi"]',c:'input[name="comp"]',sg:'input[name="sg"]'},updateStatus:function(){console.log("updating status");var e=this,t=[];this.collection.each((function(e){var i=new l(null,{id:e.get("ID")}),n=i.fetch().then((function(){var t=i.where({PROCESSINGSTATUS:"1"});e.set({AUTOINTEGRATIONS:new l(t,{id:e.get("ID")})},{silent:!0})}));t.push(n)})),s.when.apply(s,t).then((function(){e.collection.each((function(e){e.set({APLOADED:!0},{silent:!!e.get("AUTOINTEGRATIONS").length})})),e.scoreAPS()}))},onRender:function(){var e=[{label:"",cell:c.TemplateCell,editable:!1,template:'<a href="/dc/id/<%-ID%>" class="button button-notext"><i class="fa fa-search"></i> <span>View Data Collection</span></a>'},{name:"FILETEMPLATETRIM",label:"Prefix",cell:"string",editable:!1},{name:"SAMPLE",label:"Sample",cell:"string",editable:!1},{name:"ST",label:"Date",cell:"string",editable:!1},{name:"NUMIMG",label:"# Images",cell:"string",editable:!1},{name:"AXISRANGE",label:"Osc",cell:"string",editable:!1},{name:"EXPOSURETIME",label:"Exposure",cell:"string",editable:!1},{name:"TRANSMISSION",label:"Transmission",cell:"string",editable:!1},{label:"#AP",cell:d,editable:!1},{label:"Spacegroup",cell:r,template:"<%-SG%> <br /><%-TYPE%>",editable:!1,first:!0},{label:"Unit Cell",cell:r,template:"<%-CELL.CELL_A%> (<%-CELL.CELL_AL%>)<br /><%-CELL.CELL_B%> (<%-CELL.CELL_BE%>)<br /><%-CELL.CELL_C%> (<%-CELL.CELL_GA%>)",editable:!1},{label:"Resolution",cell:r,template:"<%-SHELLS.overall.RLOW%> - <%-SHELLS.overall.RHIGH%><br /><%-SHELLS.innerShell.RLOW%> - <%-SHELLS.innerShell.RHIGH%><br /><%-SHELLS.outerShell.RLOW%> - <%-SHELLS.outerShell.RHIGH%>",editable:!1},{label:"Rmeas",cell:r,template:'<span class="<%-CLASS.RMEAS.overall%>"><%-SHELLS.overall.RMEAS%></span><br /><span class="<%-CLASS.RMEAS.innerShell%>"><%-SHELLS.innerShell.RMEAS%></span><br /><span class="<%-CLASS.RMEAS.outerShell%>"><%-SHELLS.outerShell.RMEAS%></span>',editable:!1},{label:"Completeness",cell:r,template:'<span class="<%-CLASS.COMPLETENESS.overall%>"><%-SHELLS.overall.COMPLETENESS%></span><br /><span class="<%-CLASS.COMPLETENESS.innerShell%>"><%-SHELLS.innerShell.COMPLETENESS%></span><br /><span class="<%-CLASS.COMPLETENESS.outerShell%>"><%-SHELLS.outerShell.COMPLETENESS%></span>',editable:!1},{label:"",cell:r,template:'<a href="'+app.apiurl+'/download/id/<%-DCID%>/aid/<%-AID%>" class="button button-notext dll" title="Download MTZ file"><i class="fa fa-download"></i> <span>Download MTZ file</span></a>',editable:!1}];this.wrap.show(new i({collection:this.collection,columns:e,tableClass:"",filter:"s",loading:!0,backgrid:{emptyText:"No data collections found"}})),this.updateStatus()},scoreAPS:function(e){e&&e.preventDefault(),console.log("scoring");var t=this.ui.rmerge.val(),i=this.ui.res.val(),s=this.ui.isigi.val(),a=this.ui.c.val(),l=this.ui.sg.is(":checked"),o={overall:1,innerShell:.5,outerShell:1},c={res:{},isig:{},resm:{},rdiff:{}};return n.each(o,(function(e,t){c.res[t]=0,c.isig[t]=0,c.resm[t]=999,c.rdiff[t]=0})),this.collection.each((function(e){if(e.get("APLOADED")){var p=e.get("AUTOINTEGRATIONS");p.each((function(e){n.each(o,(function(t,i){var n=e.get("SHELLS")[i];parseFloat(n.RHIGH)>c.res[i]&&(c.res[i]=parseFloat(n.RHIGH)),parseFloat(n.RHIGH)<c.resm[i]&&(c.resm[i]=parseFloat(n.RHIGH)),parseFloat(n.ISIGI)>c.isig[i]&&(c.isig[i]=parseFloat(n.ISIGI))}))})),n.each(o,(function(e,t){c.rdiff[t]=c.res[t]-c.resm[t]}));var r=null,d=0;p.each((function(e){if(1==e.get("PROCESSINGSTATUS")){var p=0;n.each(o,(function(n,l){var o=e.get("SHELLS")[l],r=(c.res[l]-parseFloat(o.RHIGH))/c.rdiff[l]*i,d=(1-parseFloat(o.RMERGE))*t,u=parseFloat(o.ISIGI)/c.isig[l]*s,h=parseFloat(o.COMPLETENESS)/100*a;p+=(r+d+u+h)*n})),(p*=l&&this.ui.sg.val()?this.ui.sg.val()==e.get("SG").replace(/\s+/g,""):1)>d&&(d=p,r=e)}}),this),r?e.set("BESTAP",r):1==p.length&&e.set("BESTAP",p.at(0))}}),this),!1}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},996:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="no_mobile">Data Collection Summary</h1>\n\n<p class="ra">\n\t<a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> Data Collections</a>\n</p>\n\n<div class="options data_collection">\n    <div class="r">\n        <a href="#" name="update" class="button"><i class="fa fa-refresh"></i> Update</a>\n    </div>\n    <label>Resolution: <input type="text" name="res" value="1" /></label>\n    <label>Rmerge: <input type="text" name="rmerge" value="0.6" /></label>\n    <label>Completeness: <input type="text" name="comp" value="1" /></label>\n    <label>I/&sigma;(I): <input type="text" name="isigi" value="0.5" /></label>\n    <label>Match Spacegroup: <input type="checkbox" name="sg" value="1" /></label>\n</div>\n\n<div class="srch"></div>\n<div class="page_wrap"></div>\n<div class="wrapper"></div>\n';return __p}},997:function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(307),i(998),i(999)],void 0===(a=function(e,t,i,s,a,l){var o=t.Cell.extend({initialize:function(e){o.__super__.initialize.call(this,e),this.listenTo(this.model,"change reset",this.render,this),this.template=e.column.get("template")},render:function(){if(this.$el.empty(),1==this.model.get("APLOADED")){var e=n.template(this.template);this.$el.html(e(this.model.toJSON()))}return this.delegateEvents(),this}}),c=o.extend({events:{"click a.reprocess":"reprocess"},reprocess:function(e){e.preventDefault(),app.dialog.currentView instanceof a?app.dialog.currentView.collection.add(this.model):app.dialog.show(new a({model:this.model,visit:this.model.get("VISIT")}))}}),p=t.Cell.extend({initialize:function(e){p.__super__.initialize.call(this,e),this.listenTo(this.model,"change reset",this.render,this),this.template='<i class="fa fa-spin fa-spinner"></i>'},render:function(){this.$el.empty();this.model.get("ID");var e=this.model.get("STATES"),t=this.column.get("label");return this.$el.html(n.template(this.template)),1==this.model.get("APLOADED")&&this.$el.html(['<i class="fa icon blue fa-question-circle alt="N/A"></i>','<i class="fa icon grey fa-cog fa-spin alt="Running"></i>','<i class="fa icon green fa-check alt="Completed"></i>','<i class="fa icon red fa-times alt="Failed"></i>'][e[this.column.get("group")][t]]),this.delegateEvents(),this}});return e.LayoutView.extend({className:"content",template:l,regions:{wrap:".wrapper"},collectionEvents:{"update sync reset":"updateStatus"},initialize:function(e){this.statuses=new s,this.columns=[{name:"FILETEMPLATETRIM",label:"Prefix",cell:"string",editable:!1},{label:"Sample",cell:o,template:'<% if (BLSAMPLEID) { %><a href="/samples/sid/<%-BLSAMPLEID%>" class="wrap sample"><%-SAMPLE%></a><% } %>',editable:!1},{name:"ST",label:"Date",cell:"string",editable:!1}];var t=app.options.get("ap_statuses");n.each(["autoproc","downstream"],(function(e){n.each(t[e],(function(t,i){this.columns.push({label:i,cell:p,editable:!1,group:e})}),this)}),this),this.columns.push.apply(this.columns,[{label:"",cell:c,template:'<a href="#" class="reprocess button button-notext" title="Reprocess"><i class="fa fa-cog"></i> <span>Reprocess</span></a>',editable:!1},{label:"",cell:o,template:'<a href="/dc/visit/'+this.model.escape("VISIT")+'/id/<%-ID%>" class="button button-notext dll" title="Open data collection"><i class="fa fa-arrow-right"></i> <span>Open data collection</span></a>',editable:!1}]),console.log(this.columns)},updateStatus:function(){console.log("updating status");var e=this;this.statuses.fetch({type:"POST",data:{ids:this.collection.pluck("ID")}}).done((function(){e.collection.each((function(t){var i=e.statuses.findWhere({ID:t.get("ID")}).get("STATES");t.set({STATES:i,APLOADED:!0})}))}))},onRender:function(){this.updateStatus(),this.wrap.show(new i({collection:this.collection,columns:this.columns,tableClass:"",filter:"s",loading:!0,backgrid:{row:t.Row,emptyText:"No data collections found"}}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},998:function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(27),i(41),i(108),i(227),i(372),i(373)],void 0===(a=function(e,t,i,s,a,l,o,c){var p=a.extend({idAttribute:"CID"}),r=s.extend({model:p}),d=l.extend({template:c,intStatus:!1,className:"data_collection",ui:{cells:".cells",a:".a",b:".bb",c:".c",al:".al",be:".be",ga:".ga",cell:"div.cell",st:"input[name=start]",en:"input[name=end]",ind:"div.ind"},events:{"click .cells":"sendCell","click a.add":"clone","click a.rem":"rem","click a.sg":"toggleSG","change @ui.st":"updateSelection","change @ui.en":"updateSelection","keyup @ui.st":"updateSelection","keyup @ui.en":"updateSelection","click a.all":"selectAll"},selectAll:function(e){e.preventDefault();var t=parseInt(this.model.get("SI")),i=parseInt(this.model.get("NUMIMG"));this.ui.st.val(t),this.ui.en.val(t+i-1),this.updateSelection()},updateSelection:function(){var e=parseInt(this.model.get("SI")),t=parseInt(this.model.get("NUMIMG"));this.ui.st.val()>e+t&&this.ui.st.val(e+t),this.ui.st.val()<e&&this.ui.st.val(e),this.ui.en.val()>e+t&&this.ui.en.val(e+t),this.ui.en.val()<e&&this.ui.en.val(e),this.plotview.setSelection(parseInt(this.ui.st.val()),parseInt(this.ui.en.val()))},initialize:function(e){l.prototype.initialize.apply(this,arguments),this.updateSelection=n.debounce(this.updateSelection,500)},setInd:function(e){e?this.ui.ind.show():this.ui.ind.hide(),e?this.$el.find("ul").removeClass("half"):this.$el.find("ul").addClass("half")},onRender:function(){this.ui.cell.hide(),this.ui.ind.hide(),this.$el.find("ul").addClass("half"),this.$el.find('li input[type="text"]').css("width","25%")},toggleSG:function(e){e.preventDefault(),this.ui.cell.slideToggle()},rem:function(e){e.preventDefault(),this.model.collection.remove(this.model)},clone:function(e){e.preventDefault(),this.trigger("clone:dc",this.model)},setCell:function(){if(this.aps.length){var e=this.aps.at(0).get("CELL");this.ui.a.text(e.CELL_A),this.ui.b.text(e.CELL_B),this.ui.c.text(e.CELL_C),this.ui.al.text(e.CELL_AL),this.ui.be.text(e.CELL_BE),this.ui.ga.text(e.CELL_GA)}},setSelection:function(e,t){l.prototype.setSelection.apply(this,arguments),this.ui.st.val(e),this.ui.en.val(t)},setDeselection:function(){l.prototype.setDeselection.apply(this),this.ui.st.val(""),this.ui.en.val("")}}),u=e.CollectionView.extend({childView:d});return ReprocessView=i.extend({template:o,dialog:!0,title:"Reprocess Data",className:"rp content",regions:{dcr:".dcs"},ui:{cell:"div.cell",opts:"div.options",ind:"input[name=individual]",mul:"span.multi",met:"select[name=method]"},buttons:{Integrate:"integrate",Close:"closeDialog"},events:{"click a.sgm":"toggleCell","click a.opt":"toggleOpts","click @ui.ind":"toggleIndividual"},templateHelpers:function(){return{VISIT:this.getOption("visit")}},toggleIndividual:function(e){var t=this.ui.ind.is(":checked");t?this.ui.mul.hide():this.ui.mul.show(),this.distlview.children.each((function(e){e.setInd(t)}))},toggleCell:function(e){e.preventDefault(),this.ui.cell.slideToggle()},toggleOpts:function(e){e.preventDefault(),this.ui.opts.slideToggle()},integrate:function(e){e.preventDefault();var i=this.collection.where({selected:!0});if(i.length){var s={visit:this.getOption("visit"),multi:1},a=[];n.each(i,(function(e,t){a.push([e.get("ID"),e.get("selection")[0],e.get("selection")[1]])})),s.int=a,s.recipes=this.ui.met.val(),n.each(["a","b","c","alpha","beta","gamma","res","sg"],(function(e,t){s[e]=this.$el.find("input[name="+e+"]").val().replace(/\s/g,"")}),this),t.ajax({url:app.apiurl+"/mc/integrate",data:s,type:"POST",success:function(){app.alert({message:i.length+" job(s) successfully submitted"})},error:function(){app.alert({message:"Something went wrong submitting these jobs, please try again"})}})}else app.alert({message:"Please selected some data sets to integrate"})},initialize:function(e){if(this.collection=new r,e.model){var t=new p(e.model.toJSON());t.set("CID",this.collection.length+1),this.collection.add(t)}},onRender:function(){this.ui.opts.hide(),this.ui.cell.hide(),n.each(["xia2 3dii","xia2 dials"],(function(e,t){this.ui.met.append('<option value="'+(t+1)+'">'+e+"</option>")}),this),this.distlview=new u({collection:this.collection}),this.dcr.show(this.distlview),this.listenTo(this.distlview,"childview:set:cell",this.setCell,this),this.listenTo(this.distlview,"childview:clone:dc",this.cloneDC,this)},cloneDC:function(e,t){var i=t.clone();i.set("CID",this.collection.length+1),this.collection.add(i)},setCell:function(e,t){console.log("set cell main view",e,t),n.each({a:"a",b:"b",c:"c",alpha:"al",beta:"be",gamma:"ga"},(function(e,i){this.$el.find("input[name="+i+"]").val(t.get("CELL")["CELL_"+e.toUpperCase()])}),this),this.$el.find("input[name=sg]").val(t.get("SG"))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},999:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1  class="no_mobile">Auto Processing Status Summary</h1>\n<p class="help">This page shows auto processing status summary for individual datasets</p>\n\n<p class="ra">\n\t<a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> Data Collections</a>\n</p>\n<div class="filter type"></div>\n<div class="filter filter-nohide series"></div>\n\n<div class="wrapper"></div>\n';return __p}}}]);