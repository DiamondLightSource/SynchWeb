(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{100:function(e,t,n){(function(s){var a,i;a=[n(7),n(273),n(12),n(15)],void 0===(i=function(e,t,n,a){var i=a.ClickableRow.extend({event:"fault:show",argument:"FAULTID"});return e.LayoutView.extend({className:"content",template:s.template('<h1>Faults</h1><% if (app.user_can(\'fault_add\')) { %><div class="r"><a class="button add" href="/faults/add"><i class="fa fa-plus"></i> Add Fault Report</a></div><% } %><div class="filters"></div><div class="wrapper"></div>'),regions:{wrap:".wrapper",flts:".filters"},filters:!0,search:!0,initialize:function(e){var l=[{name:"TITLE",label:"Title",cell:a.HTMLCell,editable:!1},{name:"STARTTIME",label:"Time",cell:"string",editable:!1},{name:"BEAMLINE",label:"Beamline",cell:"string",editable:!1},{name:"VISIT",label:"Visit",cell:"string",editable:!1},{name:"SYSTEM",label:"System",cell:"string",editable:!1},{name:"COMPONENT",label:"Component",cell:"string",editable:!1},{name:"RESOLVEDTEXT",label:"Resolved",cell:"string",editable:!1},{name:"BEAMTIMELOSTTEXT",label:"Beamtime Lost",cell:"string",editable:!1},{name:"NAME",label:"Reporter",cell:"string",editable:!1}];app.mobile()&&s.each([3,4,5,6,8],(function(e){l[e].renderable=!1})),this.table=new n({collection:e.collection,columns:l,tableClass:"proposals",filter:!!this.getOption("search")&&"s",loading:!0,backgrid:{row:i,emptyText:"No faults found"}}),this.getOption("filters")&&(this.filters=new t({collection:e.collection,params:this.getOption("params")}))},onRender:function(){this.wrap.show(this.table),this.getOption("filters")&&this.flts.show(this.filters)},onShow:function(){this.table.focusSearch()}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},101:function(e,t,n){(function(s){var a,i;a=[n(10),n(14),n(175)],void 0===(i=function(e,t,n){return e.extend(s.extend({},t,{model:n,url:"/fault/sys",keyAttribute:"NAME",valueAttribute:"SYSTEMID"}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},102:function(e,t,n){(function(s){var a,i;a=[n(10),n(14),n(176)],void 0===(i=function(e,t,n){return e.extend(s.extend({},t,{model:n,url:"/fault/com",keyAttribute:"NAME",valueAttribute:"COMPONENTID"}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},103:function(e,t,n){(function(s){var a,i;a=[n(10),n(14),n(177)],void 0===(i=function(e,t,n){return e.extend(s.extend({},t,{model:n,url:"/fault/scom",keyAttribute:"NAME",valueAttribute:"SUBCOMPONENTID"}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1122:function(e,t,n){var s,a;s=[n(7),n(123),n(99),n(100),n(1123),n(1125),n(1127)],void 0===(a=function(e,t,n,s,a,i,l){var o={title:"Fault Database",url:"/fault"},r={list:function(e,t,a,i,l){app.loading(),l=l?parseInt(l):1;var r=new n(null,{state:{currentPage:l}});r.fetch({success:function(){app.bc.reset([o]),app.content.show(new s({collection:r,params:{beamline:e,system:t,component:a,subcomponent:i}}))},error:function(){app.bc.reset([o,{title:"Error"}]),app.message({title:"Couldn't load fault list",message:"Couldn't load fault list please try again"})}})},view:function(e){var n=new t({FAULTID:e});n.fetch({success:function(){app.bc.reset([o,{title:"View Fault"},{title:n.get("TITLE")}]),app.content.show(new i({model:n}))},error:function(){app.bc.reset([o,{title:"Error"}]),app.message({title:"Couldn't load fault",message:"Couldn't load the specified fault"})}})},add:function(){app.user_can("fault_add")?(app.bc.reset([o,{title:"Add New Fault Report"}]),app.content.show(new a)):app.message({title:"Access Denied",message:"You do not have access to that page"})},edit:function(){app.user_can("fault_admin")?(app.bc.reset([o,{title:"Edit Fault Types"}]),app.content.show(new l)):app.message({title:"Access Denied",message:"You do not have access to that page"})}};return app.addInitializer((function(){app.on("fault:show",(function(e){app.navigate("faults/fid/"+e),r.view(e)}))})),r}.apply(t,s))||(e.exports=a)},1123:function(e,t,n){(function(s){var a,i;a=[n(26),n(123),n(37),n(68),n(70),n(101),n(102),n(103),n(1124),n(8),n(6),n(18)],void 0===(i=function(e,t,n,a,i,l,o,r,p,c,u){return e.extend({template:p,createModel:function(){this.model=new t},ui:{bl:"select[name=BEAMLINE]",visit:"select[name=SESSIONID]",btl:"select[name=BEAMTIMELOST]",res:"select[name=RESOLVED]",system:"select[name=SYSTEMID]",component:"select[name=COMPONENTID]",subcomponent:"select[name=SUBCOMPONENTID]",assignee:"input[name=ASSIGNEEID]"},events:{"change @ui.bl":"updateFromBeamline","change @ui.system":"updateComponents","change @ui.component":"updateSubComponents","change @ui.btl":"toggleLost","change @ui.res":"toggleRes"},updateFromBeamline:function(){this.updateVisits(),this.updateSystems()},toggleLost:function(){1==this.ui.btl.val()?this.$el.find(".beamtime_lost").slideDown():this.$el.find(".beamtime_lost").slideUp(),this.ui.btl.val()&&(this.$el.find("input[name=BEAMTIMELOST_STARTTIME]").val(this.$el.find("input[name=STARTTIME]").val()),this.$el.find("input[name=BEAMTIMELOST_ENDTIME]").val(this.$el.find("input[name=STARTTIME]").val()))},toggleRes:function(){this.ui.res.val()>0?this.$el.find(".resolution").slideDown():this.$el.find(".resolution").slideUp(),this.ui.res.val()&&this.$el.find("input[name=ENDTIME]").val(this.$el.find("input[name=STARTTIME]").val())},onRender:function(e){var t=this;this.beamlines=new i,this.beamlines.fetch().done((function(){t.ui.bl.html(t.beamlines.opts()),t.updateVisits(),t.updateSystems()})),this.visits=new n(null,{queryParams:{started:1,all:1,bl:function(){return t.ui.bl.val()}}}),this.systems=new l(null,{queryParams:{bl:function(){return console.log("getting bl in sys",t.ui.bl.val()),t.ui.bl.val()}}}),this.components=new o(null,{queryParams:{bl:function(){return t.ui.bl.val()},sid:function(){return t.ui.system.val()}}}),this.subcomponents=new r(null,{queryParams:{bl:function(){return t.ui.bl.val()},cid:function(){return t.ui.component.val()}}}),this.$el.find("input[name=STARTTIME],input[name=ENDTIME],input[name=BEAMTIMELOST_STARTTIME],input[name=BEAMTIMELOST_ENDTIME]").datetimepicker({dateFormat:"dd-mm-yy"}),this.$el.find(".beamtime_lost").hide(),this.$el.find(".resolution").hide(),this.ui.btl.html(s.map(this.model.btlOptions,(function(e,t){return'<option value="'+t+'">'+e+"</option>"}))),this.ui.res.html(s.map(this.model.resolvedOptions,(function(e,t){return'<option value="'+t+'">'+e+"</option>"}))),this.allusers=new a,this.ui.assignee.autocomplete({source:this.getUsers.bind(this)})},getUsers:function(e,t){var n=this;this.allusers.queryParams.s=e.term,this.allusers.fetch({success:function(e){t(n.allusers.map((function(e){return{label:e.get("FULLNAME"),value:e.get("PERSONID")}})))}})},updateVisits:function(){this.visits.fetch().done(this.doUpdateVisits.bind(this))},doUpdateVisits:function(){this.ui.visit.html(this.visits.opts())},updateSystems:function(){this.systems.fetch().done(this.doUpdateSystems.bind(this))},doUpdateSystems:function(){this.ui.system.html(this.systems.opts()),this.updateComponents()},updateComponents:function(){console.log("sys val",this.ui.system.val()),this.components.fetch().done(this.doUpdateComponents.bind(this))},doUpdateComponents:function(){this.ui.component.html(this.components.opts()),this.updateSubComponents()},updateSubComponents:function(){this.subcomponents.fetch().done(this.doUpdateSubComponents.bind(this))},doUpdateSubComponents:function(){this.ui.subcomponent.html(this.subcomponents.opts())},success:function(e,t,n){console.log("success from fault add"),app.trigger("fault:show",e.get("FAULTID"))},failure:function(e,t,n){console.log("failure from fault add"),app.alert({message:"Something went wrong registering this fault report, please try again"})}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1124:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <h1>New Fault Report</h1>\n\n    <form method="post" id="add_fault" enctype="multipart/form-data">\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <label>Beamline\n                    <span class="small">Beamline where fault occurred</span>\n                </label>\n                <select name="BEAMLINE"></select>\n            </li>\n\n            <li>\n                <label>Start Date/Time\n                    <span class="small">Time the fault started</span>\n                </label>\n                <input class="half datetime" type="text" name="STARTTIME" />\n            </li>\n\n\n            <li>\n                <label>Visit ID\n                    <span class="small">The visit during which the fault occurred</span>\n                </label>\n                <select name="SESSIONID"></select>\n            </li>\n\n            <li>\n                <label>System\n                    <span class="small">The overreaching system responsible for the fault</span>\n                </label>\n                <select name="SYSTEMID"></select>\n            </li>\n\n            <li>\n                <label>Component\n                    <span class="small">The component and sub-component at fault</span>\n                </label>\n                <select name="COMPONENTID"></select>\n                <select name="SUBCOMPONENTID"></select>\n            </li>\n\n            <li>\n                <label>Beamtime Lost\n                <span class="small">Was beamtime lost as a result?</span>\n                </label>\n                <select name="BEAMTIMELOST"></select>\n            </li>\n\n            <li class="beamtime_lost">\n                <label>Beamtime Lost Between\n                <span class="small">Time and date between which beamtime was lost</span>\n                </label>\n                <input class="half" type="text" name="BEAMTIMELOST_STARTTIME" />\n                <input class="half" type="text" name="BEAMTIMELOST_ENDTIME" />\n            </li>\n\n            <li>\n                <label>Summary\n                    <span class="small">A short summart of the fault</span>\n                </label>\n                <input type="text" name="TITLE" />\n            </li>\n\n            <li>\n                <label>Description\n                    <span class="small">Full description of the fault.<br /><a href="http://daringfireball.net/projects/markdown/">Markdown Supported</a></span>\n                </label>\n                <textarea name="DESCRIPTION"></textarea>\n            </li>\n\n            <li>\n                <label>Attachment\n                    <span class="small">Attachment to add to the report</span>\n                </label>\n                <input type="file" name="userfile1" />\n            </li>\n\n            <li>\n                <label>Assignee\n                    <span class="small">An optional assignee for the fault. Start typing to autocomplete</span>\n                </label>\n                <input class="half" type="text" name="ASSIGNEEID" />\n            </li>\n\n\n            <li>\n                <label>Fault Resolved\n                <span class="small">Has the fault been resolved?</span>\n                </label>\n                <select name="RESOLVED"></select>\n            </li>\n\n            <li class="resolution">\n                <label>End Date/Time\n                    <span class="small">Time the fault was resolved</span>\n                </label>\n                <input class="half" type="text" name="ENDTIME"/>\n            </li>\n\n            <li class="resolution">\n                <label>Resolution / Workaround\n                    <span class="small">How the fault was resolved.<br /><a href="http://daringfireball.net/projects/markdown/">Markdown Supported</a></span>\n                </label>\n                <textarea name="RESOLUTION"></textarea>\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Submit Report</button>\n\n\n        </ul>\n    </div>\n\n    </form>\n\n';return __p}},1125:function(e,t,n){(function(s){var a,i;a=[n(7),n(37),n(70),n(101),n(102),n(103),n(20),n(11),n(29),n(1126),n(6),n(18)],void 0===(i=function(e,t,n,a,i,l,o,r,p,c,u){return e.ItemView.extend({className:"content",template:c,templateHelpers:function(){return{APIURL:app.apiurl}},initialize:function(e){u.Validation.bind(this,{invalid:function(e,t,n){console.log(t,n)}})},modelEvents:{"change:RESOLVED":"toggleRes","change:BEAMTIMELOST":"toggleBTL","change:BEAMTIMELOST_STARTTIME":"calcLost","change:BEAMTIMELOST_ENDTIME":"calcLost"},ui:{btlst:'input[name="BEAMTIMELOST_STARTTIME"]',btlen:'input[name="BEAMTIMELOST_ENDTIME"]',lost:"span.LOST"},events:{"click .fa a":r.signHandler},onRender:function(){if(app.personid==this.model.get("PERSONID")||app.personid==this.model.get("ASSIGNEEID")||app.user_can("fault_global")){var e=this;this.beamlines=new n,this.beamlines.fetch(),this.visits=new t(null,{queryParams:{started:1,all:1,bl:function(){return e.model.get("BEAMLINE")}}}),this.systems=new a(null,{queryParams:{bl:function(){return e.model.get("BEAMLINE")}}}),this.components=new i(null,{queryParams:{bl:function(){return e.model.get("BEAMLINE")},sid:function(){return e.model.get("SYSTEMID")}}}),this.subcomponents=new l(null,{queryParams:{bl:function(){return e.model.get("BEAMLINE")},cid:function(){return e.model.get("COMPONENTID")}}});var r=new o({model:this.model,el:this.$el});r.create("TITLE","text"),r.create("BEAMLINE","select",{data:function(){return e.beamlines.fetch({async:!1}),e.beamlines.kv()}}),r.create("SESSIONID","select",{data:function(){return e.visits.fetch({async:!1}),e.visits.kv()}},!0),r.create("SYSTEMID","select",{data:function(){return e.systems.fetch({async:!1}),e.systems.kv()}}),r.create("COMPONENTID","select",{data:function(){return e.components.fetch({async:!1}),e.components.kv()}}),r.create("SUBCOMPONENTID","select",{data:function(){return e.subcomponents.fetch({async:!1}),e.subcomponents.kv()}}),r.create("STARTTIME","datetime"),r.create("DESCRIPTION","markdown"),r.create("BEAMTIMELOST","select",{data:{0:"No",1:"Yes"}}),r.create("BEAMTIMELOST_STARTTIME","datetime"),r.create("BEAMTIMELOST_ENDTIME","datetime"),r.create("RESOLVED","select",{data:{0:"No",1:"Yes",2:"Partially"}}),r.create("ENDTIME","datetime"),r.create("RESOLUTION","markdown")}if(this.toggleRes(!0),this.toggleBTL(!0),this.model.get("ATTACH_IMAGE")){var c=new p;e=this;c.onload=function(){var t=s('<img alt="'+e.model.get("ATTACHMENT")+'" />');t.attr("src",c.src),e.$el.find(".fa a").append(t)},c.load(app.apiurl+"/image/fa/fid/"+this.model.get("FAULTID"))}},toggleBTL:function(e){1==this.model.get("BEAMTIMELOST")?this.$el.find(".beamtime_lost")[e?"show":"slideDown"]():this.$el.find(".beamtime_lost")[e?"hide":"slideUp"]()},toggleRes:function(){0!=this.model.get("RESOLVED")?this.$el.find(".fresolved").show():this.$el.find(".fresolved").hide()},calcLost:function(){var e=r._date_to_unix(this.ui.btlen.val())-r._date_to_unix(this.ui.btlst.val());this.ui.lost.text(e.toFixed(1))}})}.apply(t,a))||(e.exports=i)}).call(this,n(8))},1126:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1><span class="title">'+(null==(__t=TITLE)?"":_.escape(__t))+'</span></h1>\n\n    <div class="form">\n        <ul class="clearfix">\n\n            <li>\n                <span class="label">Beamline</span>\n                <span class="BEAMLINE">'+(null==(__t=BEAMLINE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Start Date/Time</span>\n                <span class="STARTTIME">'+(null==(__t=STARTTIME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Visit ID</span>\n                <span class="SESSIONID">'+(null==(__t=VISIT)?"":_.escape(__t))+'</span> <a class="button" href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-search"></i> Data Collections</a>  <a class="button" href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-pie-chart"></i> Visit Stats</a>\n            </li>\n\n            <li>\n                <span class="label">System</span>\n                <span class="SYSTEMID">'+(null==(__t=SYSTEM)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Component &amp; Sub Component</span>\n                <span class="COMPONENTID">'+(null==(__t=COMPONENT)?"":_.escape(__t))+"</span>\n                ",SUBCOMPONENT&&(__p+='\n                &raquo; <span class="SUBCOMPONENTID">'+(null==(__t=SUBCOMPONENT)?"":_.escape(__t))+"</span>\n                "),__p+='\n            </li>\n\n            <li>\n                <span class="label">Beamtime Lost</span>\n                <span class="BEAMTIMELOST">'+(null==(__t=BEAMTIMELOSTTEXT)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li class="beamtime_lost">\n                <span class="label">Beamtime Lost Between</span>\n                <span class="BEAMTIMELOST_STARTTIME">'+(null==(__t=BEAMTIMELOST_STARTTIME)?"":_.escape(__t))+'</span> -\n                <span class="BEAMTIMELOST_ENDTIME">'+(null==(__t=BEAMTIMELOST_ENDTIME)?"":_.escape(__t))+'</span>\n                (<span class="LOST">'+(null==(__t=LOST)?"":_.escape(__t))+'</span>hr)\n            </li>\n\n\n\n            <li class="clearfix reorder">\n                <div class="DESCRIPTION text">\n                    '+(null==(__t=DESCRIPTIONMD)?"":__t)+'\n                </div>\n                <span class="label">Description</span>\n\n            </li>\n\n\n            ',ATTACHMENT&&(__p+='\n            <li class="clearfix">\n\n                ',ATTACH_IMAGE?__p+='\n                    <div class="image text fa">\n                        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/fa/fid/"+(null==(__t=FAULTID)?"":_.escape(__t))+'"></a>\n                    </div>\n                ':__p+='\n                    <div class="ATTACHMENT text">\n                        '+(null==(__t=ATTACHMENT)?"":_.escape(__t))+'\n                        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/fa/fid/"+(null==(__t=FAULTID)?"":_.escape(__t))+'">Download</a>\n                    </div>\n                ',__p+='\n                <span class="label">Attachment</span>\n            </li>\n            '),__p+='\n\n            <li>\n                <span class="label">Reported By</span>\n                <span class="OWNER">'+(null==(__t=NAME)?"":_.escape(__t))+"</span>\n            </li>\n\n            ",ASSIGNEEID&&(__p+='\n            <li>\n                <span class="label">Assignee</span>\n                <span class="ASSIGNEEID">'+(null==(__t=ASSIGNEE)?"":_.escape(__t))+"</span>\n            </li>\n            "),__p+='\n\n            <li>\n                <span class="label">Fault Resolved</span>\n                <span class="RESOLVED">'+(null==(__t=RESOLVEDTEXT)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li class="fresolved">\n                <span class="label">End Date/Time</span>\n                <span class="ENDTIME">'+(null==(__t=ENDTIME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li class="fresolved clearfix reorder">\n                <div class="RESOLUTION text">'+(null==(__t=RESOLUTIONMD)?"":__t)+'</div>\n                <span class="label">Resolution</span>\n            </li>\n\n            ',ELOGID&&(__p+='\n            <li>\n                <span class="label">eLog Entry</span>\n                <span class="ELOGID"><a target="_blank" href="https://elog.pri.diamond.ac.uk/php/elog/cs_logentdtlret.php?log_entry_id='+(null==(__t=ELOGID)?"":_.escape(__t))+'">Go to eLog</a></span>\n            </li>\n            '),__p+="\n\n        </ul>\n\n    </div>\n";return __p}},1127:function(e,t,n){(function(s,a){var i,l;i=[n(7),n(6),n(37),n(49),n(20),n(128),n(175),n(176),n(177),n(101),n(102),n(103),n(70),n(1128),n(1129),n(1130),n(1131),n(18)],void 0===(l=function(e,t,n,i,l,o,r,p,c,u,d,m,_,h,f,E,b){var v=i.extend(s.extend({},o,{getTemplate:function(){return this.model.get("new")||this.model.get("edit")?b:E},tagName:"tr",events:{click:"rowClick","click a.cancel":"cancel","click a.edit":"edit"},edit:function(e){console.log("edit"),e.preventDefault(),this.model.set("edit",!0),this.render()},cancel:function(e){e.preventDefault(),this.model.get("new")?this.model.collection.remove(this.model):(this.model.set("edit",!1),this.render())},rowClick:function(e){this.model.get("new")||this.model.get("edit")||(this.trigger("row:click",this.model),this.$el.siblings("tr").removeClass("selected"),this.$el.addClass("selected"))},setData:function(){var e={};s.each(["NAME","DESCRIPTION"],(function(t){e[t]=a("[name="+t+"]").val()})),e.BLS=this.$el.find("input[name=BLS]:checked").map((function(){return a(this).val()})).get()||[],e.BEAMLINES=e.BLS.join(","),this.model.set(e)},success:function(e,t,n){this.model.set("new",!1),this.model.set("edit",!1),this.render()},error:function(e,t,n){app.message("Something went wrong creating this dewar, please try again")},initialize:function(){this.showDewar=s.debounce(this.showDewar,500)},onRender:function(){console.log("rendering row"),t.Validation.unbind(this),t.Validation.bind(this);var e=this;if(this.model.get("edit")||this.model.get("new")){var n=new _;n.fetch().done((function(){var t=e.model.get("BEAMLINES").split(","),a="";n.each((function(e,n){var i=s.indexOf(t,e.get("NAME"))>-1?'checked="checked"':"";a+='<label><input type="checkbox" name="BLS" value="'+e.get("NAME")+'" '+i+" /> "+e.get("NAME")+"</label> "})),e.$el.find("td.bls").html(a)}))}}})),I=e.ItemView.extend({tagName:"tr"}),S=t.Marionette.CompositeView.extend({tagName:"table",template:f,childView:v,childEvents:{"row:click":"rowClick"},rowClick:function(e,t){this.trigger("row:click",t)}}),T=I.extend({template:s.template('<td colspan="6">No systems defined</td>')}),A=S.extend({emptyView:T,className:"systems"}),g=I.extend({template:s.template('<td colspan="6">Select a system to see its components</td>')}),N=S.extend({emptyView:g,className:"components"}),M=I.extend({template:s.template('<td colspan="6">Select a component to see its subcomponents</td>')}),w=S.extend({emptyView:M,className:"subcomponents"});return e.LayoutView.extend({className:"content",template:h,regions:{sys:".systems",comp:".components",scomp:".subcomponents"},events:{"click .add_system":"addSystem","click .add_component":"addComponent","click .add_subcomponent":"addSubcomponent"},addSystem:function(e){e.preventDefault(),this.systems.add(new r({new:!0}))},addComponent:function(e){if(e.preventDefault(),this.sid){var t=this.systems.findWhere({SYSTEMID:this.sid});this.components.add(new p({SYSTEMID:this.sid,BEAMLINES:t?t.get("BEAMLINES"):"",new:!0}))}},addSubcomponent:function(e){if(e.preventDefault(),console.log("cid",this.comid),this.comid){var t=this.components.findWhere({COMPONENTID:this.comid});this.subcomponents.add(new c({COMPONENTID:this.comid,BEAMLINES:t?t.get("BEAMLINES"):"",new:!0}))}},setSystem:function(e){console.log("set sys",e),this.sid=e.get("SYSTEMID"),this.sid&&this.components.fetch()},setComponent:function(e){console.log("set comp",e),this.comid=e.get("COMPONENTID"),this.comid&&this.subcomponents.fetch()},initialize:function(e){this.systems=new u,this.systems.fetch();var t=this;this.components=new d,this.components.queryParams.sid=function(){return t.sid},this.subcomponents=new m,this.subcomponents.queryParams.cid=function(){return t.comid}},onRender:function(){var e=new A({collection:this.systems});this.listenTo(e,"row:click",this.setSystem,this),this.sys.show(e);var t=new N({collection:this.components});this.listenTo(t,"row:click",this.setComponent,this),this.comp.show(t),this.scomp.show(new w({collection:this.subcomponents}))}})}.apply(t,i))||(e.exports=l)}).call(this,n(5),n(8))},1128:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Fault Database Editor</h1>\n\n<a href="#" class="button add_system"><i class="fa fa-plus"></i> Add System</a>\n<div class="table systems"></div>\n\n<a href="#" class="button add_component"><i class="fa fa-plus"></i> Add Component</a>\n<div class="table components"></div>\n\n<a href="#" class="button add_subcomponent"><i class="fa fa-plus"></i> Add Subcomponent</a>\n<div class="table subcomponents"></div>\n';return __p}},1129:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<thead>\n    <tr>\n        <th>ID</th>\n        <th class="span3">Name</th>\n        <th class="span3">Description</th>\n        <th class="span3">Beamlines</th>\n        <th>&nbsp;</th>\n        <th>&nbsp;</th>\n    </tr>\n</thead>\n<tbody></tbody>';return __p}},1130:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n    <td>"+(null==(__t=ID)?"":_.escape(__t))+'</td>\n    <td class="span3">'+(null==(__t=NAME)?"":_.escape(__t))+'</td>\n    <td class="span3">'+(null==(__t=DESCRIPTION)?"":_.escape(__t))+'</td>\n    <td class="span3">'+(null==(__t=BEAMLINES)?"":_.escape(__t))+'</td>\n    <td>\n    \t<a href="#" class="edit button button-notext"><i class="fa fa-pencil"></i> <span>Edit</span></a>\n    </td>\n    <td>\n    \t<a href="#" class="delete button button-notext"><i class="fa fa-times"></i> <span>Delete</span></a>\n    </td>\n';return __p}},1131:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\t<td>"+(null==(__t=ID)?"":_.escape(__t))+'</td>\n    <td class="span3"><input type="text" name="NAME" value="'+(null==(__t=NAME)?"":_.escape(__t))+'" /></td>\n    <td class="span3"><input type="text" name="DESCRIPTION" value="'+(null==(__t=DESCRIPTION)?"":_.escape(__t))+'" /></td>\n    <td class="span3 bls"></td>\n    <td>\n    \t<a href="#" class="save button button-notext"><i class="fa fa-check"></i> <span>Save</span></a>\n    </td>\n    <td>\n    \t<a href="#" class="cancel button button-notext"><i class="fa fa-times"></i> <span>Cancel</span></a>\n    </td>';return __p}},1200:function(e,t,n){var s,a;s=[n(7),n(281),n(1201),n(1210),n(106),n(83),n(1212),n(1213),n(1215),n(45),n(1217),n(1221),n(68),n(151),n(1223),n(1224),n(1226)],void 0===(a=function(e,t,n,s,a,i,l,o,r,p,c,u,d,m,_,h,f){var E={title:"Manage Groups & Permissions",url:"/admin/groups"},b={title:"Manage Proposals & Visits",url:"/admin/proposals"},v={title:"Manage Users",url:"/admin/users"},I={manageGroups:function(e){app.bc.reset([E]),app.content.show(new n)},viewGroup:function(e){app.loading();var n=new t({USERGROUPID:e});n.fetch({success:function(){app.bc.reset([E,{title:n.get("NAME")}]),app.content.show(new s({model:n}))},error:function(){app.bc.reset([E]),app.message({title:"No such group",message:"The specified group could not be found"})}})},manageProposals:function(e,t){if(!app.user_can("manage_proposal"))return app.bc.reset([b]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.bc.reset([b]),t=t?parseInt(t):1;var n=new i(null,{state:{currentPage:t},queryParams:{s:e}});n.fetch(),app.content.show(new l({collection:n,params:{s:e}}))},addProposal:function(){if(!app.user_can("manage_proposal"))return app.bc.reset([b]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.bc.reset([b,{title:"Add Proposal"}]),app.content.show(new r)},viewProposal:function(e){if(!app.user_can("manage_proposal"))return app.bc.reset([b]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.loading();var t=new a({PROPOSAL:e});t.fetch({success:function(){app.bc.reset([b,{title:t.get("PROPOSAL")}]),app.content.show(new o({model:t}))},error:function(){app.bc.reset([b]),app.message({title:"No such proposal",message:"The specified proposal could not be found"})}})},addVisit:function(e){if(!app.user_can("manage_visits"))return app.bc.reset([b]),void app.message({title:"Access Denied",message:"You do not have access to that page"});var t=new a({PROPOSAL:e});t.fetch({success:function(){app.bc.reset([b,{title:e},{title:"Add Visit"}]),app.content.show(new u({proposal:t}))}})},viewVisit:function(e){if(!app.user_can("manage_visits"))return app.bc.reset([b]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.loading();var t=new p({VISIT:e});t.fetch({success:function(){app.bc.reset([b,{title:t.get("PROPOSAL"),url:"/admin/proposals/"+t.get("PROPOSAL")},{title:t.get("VISIT")}]),app.content.show(new c({model:t}))},error:function(){app.bc.reset([b]),app.message({title:"No such visit",message:"The specified visit could not be found"})}})},manageUsers:function(e,t){if(!app.user_can("manage_users"))return app.bc.reset([v]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.bc.reset([v]),t=t?parseInt(t):1;var n=new d(null,{state:{currentPage:t},queryParams:{s:e}});n.fetch(),app.content.show(new _({collection:n,params:{s:e}}))},addUser:function(){if(!app.user_can("manage_users"))return app.bc.reset([v]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.bc.reset([v,{title:"Add User"}]),app.content.show(new f)},viewUser:function(e){if(!app.user_can("manage_users"))return app.bc.reset([v]),void app.message({title:"Access Denied",message:"You do not have access to that page"});app.loading();var t=new m({PERSONID:e});t.fetch({success:function(){app.bc.reset([v,{title:t.get("FULLNAME")}]),app.content.show(new h({model:t}))},error:function(){app.bc.reset([v]),app.message({title:"No such proposal",message:"The specified proposal could not be found"})}})}};return app.addInitializer((function(){app.on("group:show",(function(e){app.navigate("admin/groups/"+e),I.viewGroup(e)})),app.on("proposal:show",(function(e){app.navigate("admin/proposals/"+e),I.viewProposal(e)})),app.on("visit:show",(function(e){app.navigate("admin/proposals/visit/"+e),I.viewVisit(e)})),app.on("useradm:show",(function(e){app.navigate("admin/users/"+e),I.viewUser(e)}))})),I}.apply(t,s))||(e.exports=a)},1201:function(e,t,n){(function(s,a){var i,l;i=[n(7),n(6),n(49),n(20),n(281),n(1202),n(459),n(460),n(1203),n(1204),n(1205),n(1206),n(1207),n(1208),n(1209),n(18)],void 0===(l=function(e,t,n,i,l,o,r,p,c,u,d,m,_,h,f){var E=n.extend({getTemplate:function(){return this.model.get("new")||this.model.get("edit")?m:d},tagName:"tr",events:{click:"rowClick","click a.cancel":"cancel","click a.edit":"edit"},edit:function(e){console.log("edit"),e.preventDefault(),this.model.set("edit",!0),this.render()},cancel:function(e){e.preventDefault(),this.model.get("new")?this.model.collection.remove(this.model):(this.model.set("edit",!1),this.render())},rowClick:function(e){this.model.get("new")||this.model.get("edit")||app.trigger("group:show",this.model.get("USERGROUPID"))},setData:function(){var e={};s.each(["NAME","TYPE","DESCRIPTION"],(function(t){e[t]=a("[name="+t+"]").val()})),this.model.set(e)},success:function(e,t,n){this.model.set("new",!1),this.model.set("edit",!1),this.render()},error:function(e,t,n){app.message("Something went wrong creating this dewar, please try again")},initialize:function(){},onRender:function(){console.log("rendering row"),t.Validation.unbind(this),t.Validation.bind(this)}}),b=e.ItemView.extend({tagName:"tr"}),v=t.Marionette.CompositeView.extend({tagName:"table",template:u,childView:E,childEvents:{"row:click":"rowClick"},rowClick:function(e,t){this.trigger("row:click",t)}}),I=b.extend({template:s.template('<td colspan="6">No groups defined</td>')}),S=v.extend({emptyView:I,className:"groups"}),T=b.extend({template:s.template('<td colspan="6">No permissions defined</td>')}),A=E.extend({getTemplate:function(){return this.model.get("new")||this.model.get("edit")?f:h},rowClick:function(){}}),g=v.extend({emptyView:T,template:_,className:"perms",childView:A});return e.LayoutView.extend({className:"content",template:c,regions:{grps:".groups",prms:".perms"},events:{"click .add_group":"addGroup","click .add_perm":"addPerm"},addGroup:function(e){e.preventDefault(),this.groups.add(new l({new:!0}))},addPerm:function(e){e.preventDefault(),this.perms.add(new r({new:!0}))},initialize:function(e){this.groups=new o,this.groups.fetch(),this.perms=new p,this.perms.fetch()},onRender:function(){var e=new S({collection:this.groups});this.grps.show(e);var t=new g({collection:this.perms});this.prms.show(t)}})}.apply(t,i))||(e.exports=l)}).call(this,n(5),n(8))},1202:function(e,t,n){(function(s){var a,i;a=[n(10),n(14),n(281)],void 0===(i=function(e,t,n){return e.extend(s.extend({},t,{model:n,mode:"client",url:"/users/groups",keyAttribute:"NAME",valueAttribute:"USERGROUPID"}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1203:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Manage Groups</h1>\n\n<a href="#" class="button add_group"><i class="fa fa-plus"></i> Add Group</a>\n<div class="table groups"></div>\n\n\n<h1>Manage Permissions</h1>\n\n<a href="#" class="button add_perm"><i class="fa fa-plus"></i> Add Permission</a>\n<div class="table perms"></div>';return __p}},1204:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<thead>\n    <tr>\n        <th>Name</th>\n        <th>Users</th>\n        <th>&nbsp;</th>\n        <th>&nbsp;</th>\n    </tr>\n</thead>\n<tbody></tbody>";return __p}},1205:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<td>"+(null==(__t=NAME)?"":_.escape(__t))+"</td>\n<td>"+(null==(__t=USERS)?"":_.escape(__t))+'</td>\n<td>\n\t<a href="#" class="edit button button-notext"><i class="fa fa-pencil"></i> <span>Edit</span></a>\n</td>\n<td>\n\t<a href="#" class="delete button button-notext"><i class="fa fa-times"></i> <span>Delete</span></a>\n</td>\n';return __p}},1206:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<td ><input type="text" name="NAME" value="'+(null==(__t=NAME)?"":_.escape(__t))+'" /></td>\n<td >'+(null==(__t=USERS)?"":_.escape(__t))+'</td>\n<td>\n\t<a href="#" class="save button button-notext"><i class="fa fa-check"></i> <span>Save</span></a>\n</td>\n<td>\n\t<a href="#" class="cancel button button-notext"><i class="fa fa-times"></i> <span>Cancel</span></a>\n</td>';return __p}},1207:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<thead>\n    <tr>\n        <th>Type</th>\n        <th>Description</th>\n        <th>&nbsp;</th>\n        <th>&nbsp;</th>\n    </tr>\n</thead>\n<tbody></tbody>";return __p}},1208:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<td>"+(null==(__t=TYPE)?"":_.escape(__t))+"</td>\n<td>"+(null==(__t=DESCRIPTION)?"":_.escape(__t))+'</td>\n<td>\n\t<a href="#" class="edit button button-notext"><i class="fa fa-pencil"></i> <span>Edit</span></a>\n</td>\n<td>\n\t<a href="#" class="delete button button-notext"><i class="fa fa-times"></i> <span>Delete</span></a>\n</td>\n';return __p}},1209:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<td ><input type="text" name="TYPE" value="'+(null==(__t=TYPE)?"":_.escape(__t))+'" /></td>\n<td ><input type="text" name="DESCRIPTION" value="'+(null==(__t=DESCRIPTION)?"":_.escape(__t))+'" /></td>\n<td>\n\t<a href="#" class="save button button-notext"><i class="fa fa-check"></i> <span>Save</span></a>\n</td>\n<td>\n\t<a href="#" class="cancel button button-notext"><i class="fa fa-times"></i> <span>Cancel</span></a>\n</td>';return __p}},1210:function(e,t,n){(function(s,a){var i,l;i=[n(7),n(12),n(15),n(460),n(68),n(1211),n(6),n(16),n(18)],void 0===(l=function(e,t,n,i,l,o,r,p){var c=p.Row.extend({events:{click:"onClick"},onClick:function(e){if(s(e.target).is("i")||s(e.target).is("a")){console.log("click",this.url,this.idcolumn,this.model.get(this.idcolumn));var t=this;r.ajax({url:this.url+"/"+this.model.get(this.idcolumn),type:"DELETE",success:function(){t.model.collection.remove(t.model)}})}}});return e.LayoutView.extend({className:"content",template:o,regions:{usrs:".users",prms:".perms"},ui:{addu:"input[name=user]",addp:"input[name=permission]"},events:{"keypress @ui.addu":"keypressUser","keypress @ui.addp":"keypressPermission"},keypressUser:function(e){if(13==e.which){var t=this;r.ajax({url:app.apiurl+"/users/groups/"+this.model.get("USERGROUPID")+"/users/"+this.ui.addu.val(),type:"POST",success:function(e){t.ui.addu.val(""),t.users.fetch()}})}},keypressPermission:function(e){if(13==e.which){var t=this;r.ajax({url:app.apiurl+"/users/groups/"+this.model.get("USERGROUPID")+"/permission/"+this.ui.addp.val(),type:"POST",success:function(e){t.ui.addp.val(""),t.permissions.fetch()}})}},initialize:function(e){this.permissions=new i,this.permissions.queryParams.gid=this.model.get("USERGROUPID"),this.permissions.fetch(),this.users=new l,this.users.queryParams.gid=this.model.get("USERGROUPID"),this.users.fetch();var s=[{name:"TYPE",label:"Name",cell:"string",editable:!1},{name:"DESCRIPTION",label:"Description",cell:"string",editable:!1},{label:"",cell:n.TemplateCell,editable:!1,template:'<a class="button" href="#"><i class="fa fa-times"></i></a>'}],a=c.extend({url:app.apiurl+"/users/groups/"+this.model.get("USERGROUPID")+"/permission",idcolumn:"PERMISSIONID"});this.permstable=new t({collection:this.permissions,columns:s,tableClass:"permissions",filter:"s",search:e.params&&e.params.s,loading:!0,backgrid:{row:a,emptyText:"No permissions found"}});s=[{name:"GIVENNAME",label:"First Name",cell:"string",editable:!1},{name:"FAMILYNAME",label:"Surname",cell:"string",editable:!1},{name:"LOGIN",label:"Login",cell:"string",editable:!1},{label:"",cell:n.TemplateCell,editable:!1,template:'<a class="button" href="#"><i class="fa fa-times"></i></a>'}],a=c.extend({url:app.apiurl+"/users/groups/"+this.model.get("USERGROUPID")+"/users",idcolumn:"PERSONID"});this.userstable=new t({collection:this.users,columns:s,tableClass:"users",filter:"s",search:e.params&&e.params.s,loading:!0,backgrid:{row:a,emptyText:"No users found"}})},onRender:function(){this.prms.show(this.permstable),this.usrs.show(this.userstable),this.ui.addp.autocomplete({source:function(e,t){r.ajax({url:app.apiurl+"/users/permissions",data:{s:e.term},success:function(e){t(a.map(e.data,(function(e,t){return console.log(e,t),{label:e.TYPE,value:e.PERMISSIONID}})))}})}}),this.ui.addu.autocomplete({source:function(e,t){r.ajax({url:app.apiurl+"/users",data:{s:e.term},success:function(e){t(a.map(e.data,(function(e,t){return console.log(e,t),{label:e.FULLNAME,value:e.PERSONID}})))}})}})}})}.apply(t,i))||(e.exports=l)}).call(this,n(8),n(5))},1211:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Group Details</h1>\n\n<p class="help">This pages shows details for the selected group</p>\n\n<div class="form">\n    <ul>\n        \n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n\n    </ul>\n</div>\n\n\n<h1>Permissions</h1>\nAdd Permission: <input type="text" name="permission" />\n<div class="perms"></div>\n\n<h1>Users</h1>\nAdd User: <input type="text" name="user" />\n<div class="users"></div>\n        ';return __p}},1212:function(e,t,n){(function(s){var a,i;a=[n(7),n(6),n(15),n(83),n(297)],void 0===(i=function(e,t,n,a,i){var l=n.ClickableRow.extend({event:"proposal:show",argument:"PROPOSAL",cookie:!0});return i.extend({clickableRow:l,template:s.template('<h1>Proposals</h1><p class="help">This page lists all proposals. Click on a row to view / edit that proposal</p><div class="ra"><a href="admin/proposals/add" class="button" title="Add anew proposal"><i class="fa fa-plus"></i> Add Proposal</a></div><div class="wrapper"></div>')})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1213:function(e,t,n){var s,a;s=[n(7),n(6),n(20),n(37),n(129),n(15),n(1214)],void 0===(a=function(e,t,n,s,a,i,l){var o=i.ClickableRow.extend({event:"visit:show",argument:"VISIT"}),r=i.TemplateCell.extend({template:""}),p=a.extend({clickableRow:o,linksCell:r,showTitle:!1});return e.LayoutView.extend({className:"content",template:l,regions:{rvisits:".rvisits"},initialize:function(e){this.visits=new s,this.visits.queryParams.prop=this.model.get("PROPOSAL"),this.visits.fetch()},onRender:function(){var e=new n({model:this.model,el:this.$el});e.create("PROPOSALCODE","text"),e.create("PROPOSALNUMBER","text"),e.create("TITLE","text"),e.create("STATE","select",{data:{Open:"Open",Closed:"Closed"}}),this.rvisits.show(new p({params:{},collection:this.visits}))}})}.apply(t,s))||(e.exports=a)},1214:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>View Proposal</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <span class="label">Code</span>\n                <span class="PROPOSALCODE">'+(null==(__t=PROPOSALCODE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Number</span>\n                <span class="PROPOSALNUMBER">'+(null==(__t=PROPOSALNUMBER)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Title</span>\n                <span class="TITLE">'+(null==(__t=TITLE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Primary Investigator</span>\n                <span class="PERSONID">'+(null==(__t=FULLNAME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">State</span>\n                <span class="STATE">'+(null==(__t=STATE)?"":_.escape(__t))+'</span>\n            </li>\n\n        </ul>\n    </div>\n\n    <h2>Visits</h2>\n    <div class="ra">\n        <a href="admin/proposals/visit/add/'+(null==(__t=PROPOSAL)?"":_.escape(__t))+'" class="button" title="Add a visit to this proposal">\n            <i class="fa fa-plus"></i> Add Visit\n        </a>\n    </div>\n    <div class="rvisits"></div>\n\n    </form>\n';return __p}},1215:function(e,t,n){(function(s){var a,i;a=[n(6),n(26),n(106),n(1216)],void 0===(i=function(e,t,n,a){return t.extend({template:a,ui:{pi:"input[name=PERSONID]"},createModel:function(){this.model=new n},onRender:function(){this.ui.pi.autocomplete({source:function(t,n){e.ajax({url:app.apiurl+"/users",data:{s:t.term},success:function(e){n(s.map(e.data,(function(e,t){return{label:e.FULLNAME,value:e.PERSONID}})))}})}})},success:function(e,t,n){app.trigger("proposal:show",e.get("PROPOSAL"))},failure:function(e,t,n){app.alert({message:"Something went wrong creating this proposal, please try again"})}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1216:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>Add New Proposal</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <label>Code\n                    <span class="small">Proposal code usually indicating type of proposal</span>\n                </label>\n                <input type="text" name="PROPOSALCODE" />\n            </li>\n\n            <li>\n                <label>Number\n                    <span class="small">Unique proposal number</span>\n                </label>\n                <input type="text" name="PROPOSALNUMBER" />\n            </li>\n\n\n            <li>\n                <label>Title\n                    <span class="small">The proposal title</span>\n                </label>\n                <input type="text" name="TITLE" />\n            </li>\n\n            <li>\n                <label>Primary Investigator\n                    <span class="small">The proposal PI</span>\n                </label>\n                \x3c!-- <select name="PERSONID"></select> --\x3e\n                <input name="PERSONID" />\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Add Proposal</button>\n\n        </ul>\n    </div>\n\n    </form>\n';return __p}},1217:function(e,t,n){(function(s){var a,i;a=[n(7),n(6),n(16),n(49),n(20),n(68),n(97),n(1218),n(12),n(15),n(14),n(1220)],void 0===(i=function(e,t,n,a,i,l,o,r,p,c,u,d){var m=t.Model.extend({baseUrl:"/proposal/visits/users",idAttribute:"SHPKEY"}),_=l.extend({url:"/proposal/visits/users",model:m}),h=n.SelectCell.extend({optionValues:function(){return[["Yes","1"],["No","0"]]}}),f=new(t.Collection.extend(s.extend({},{keyAttribute:"role",valueAttribute:"role"},u)))(s.map(["Local Contact","Local Contact 2","Staff","Team Leader","Co-Investigator","Principal Investigator","Alternate Contact","Data Access","Team Member"],(function(e){return{role:e}}))),E=n.Cell.extend({events:{"click a.save":"saveUser","click a.cancel":"cancelUser","click a.remove":"removeUser"},saveUser:function(e){e.preventDefault(),this.model.save()},cancelUser:function(e){e.preventDefault(),this.model.isNew()&&this.model.collection.remove(this.model)},removeUser:function(e){e.preventDefault(),this.model.destroy()},render:function(){return this.model.isNew()?this.$el.html('<a href="#" class="button save"><i class="fa fa-check"></i></a> <a href="#" class="button cancel"><i class="fa fa-times"></i></a>'):this.$el.html('<a href="#" class="button remove"><i class="fa fa-times"></i></a>'),this}});return e.LayoutView.extend({className:"content",template:d,regions:{rusers:".rusers"},ui:{addu:"input[name=user]"},events:{"keypress @ui.addu":"keypressUser"},templateHelpers:function(){return{editUsers:app.user_can("manage_vusers")}},keypressUser:function(e){if(13==e.which){var n=this;t.ajax({type:"POST",success:function(e){n.ui.addu.val(""),n.users.fetch()}})}},saveUser:function(e){e.isNew()||(console.log("save user",e),e.save(e.changedAttributes(),{patch:!0}))},getBeamline:function(){return this.model.get("BEAMLINENAME")},getBeamlineSetups:function(){this.beamlinesetups.fetch()},getStartDate:function(){return this.model.get("STARTDATE")},getBeamCalendars:function(){this.beamcalendars.fetch()},initialize:function(e){this.beamlinesetups=new o,this.beamlinesetups.queryParams.bl=this.getBeamline.bind(this),this.getBeamlineSetups(),this.listenTo(this.model,"change:BEAMLINENAME",this.getBeamlineSetups.bind(this)),this.beamcalendars=new r,this.beamcalendars.queryParams.startdate=this.getStartDate.bind(this),this.getBeamCalendars(),this.listenTo(this.model,"change:BEAMCALENDARID",this.getBeamCalendars.bind(this)),this.users=new _(null,{queryParams:{visit:this.model.get("VISIT")}}),this.users.fetch();var t=[{name:"FULLNAME",label:"Full Name",cell:"string",editable:!1},{name:"ROLE",label:"Role",cell:c.SelectInputCell,options:f,editable:app.user_can("manage_vusers")},{name:"REMOTE",label:"Remote",cell:h,editable:app.user_can("manage_vusers")},{name:"",label:"",cell:E,editable:!1}];this.listenTo(this.users,"change",this.saveUser),this.table=new p({collection:this.users,columns:t,tableClass:"vusers",loading:!0,backgrid:{emptyText:"No users found"}})},addUser:function(e,t){e.preventDefault(),this.users.add(new m({SESSIONID:this.model.get("SESSIONID"),FULLNAME:t.item.label,PERSONID:t.item.value,REMOTE:0,new:!0})),this.ui.addu.val("")},onRender:function(){var e=new i({model:this.model,el:this.$el});e.create("STARTDATE","datetime"),e.create("ENDDATE","datetime"),e.create("BEAMLINENAME","text"),e.create("BEAMLINEOPERATOR","text"),e.create("SESSIONTYPE","text"),e.create("SCHEDULED","select",{data:{1:"Yes",0:"No"}}),e.create("ARCHIVED","select",{data:{1:"Yes",0:"No"}}),e.create("COMMENTS","textarea");var n=this;e.create("BEAMLINESETUPID","select",{data:function(){return n.beamlinesetups.fetch({async:!1}),n.beamlinesetups.kv()}}),e.create("BEAMCALENDARID","select",{data:function(){return n.beamcalendars.fetch({async:!1}),n.beamcalendars.kv()}}),this.rusers.show(this.table),app.user_can("manage_vusers")&&this.ui.addu.autocomplete({select:this.addUser.bind(this),source:function(e,n){t.ajax({url:app.apiurl+"/users",data:{s:e.term},success:function(e){n(s.map(e.data,(function(e,t){return{label:e.FULLNAME,value:e.PERSONID}})))}})}})}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1218:function(e,t,n){(function(s){var a,i;a=[n(10),n(1219),n(14)],void 0===(i=function(e,t,n){return e.extend(s.extend({},n,{model:t,mode:"server",url:"/proposal/calendar",keyAttribute:"RUN",valueAttribute:"BEAMLINESETUPID",state:{pageSize:15},parseState:function(e,t,n,s){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1219:function(e,t,n){var s,a;s=[n(6)],void 0===(a=function(e){return e.Model.extend({idAttribute:"BEAMCALENDARID",urlRoot:"/proposal/calendar",validation:{}})}.apply(t,s))||(e.exports=a)},1220:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="    <h1>View Visit: "+(null==(__t=VISIT)?"":_.escape(__t))+'</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <span class="label">Start Date</span>\n                <span class="STARTDATE">'+(null==(__t=STARTDATE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">End Date</span>\n                <span class="ENDDATE">'+(null==(__t=ENDDATE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Beamline Name</span>\n                <span class="BEAMLINENAME">'+(null==(__t=BEAMLINENAME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Beamline Operator</span>\n                <span class="BEAMLINEOPERATOR">'+(null==(__t=BEAMLINEOPERATOR)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Session Type</span>\n                <span class="SESSIONTYPE">'+(null==(__t=SESSIONTYPE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Scheduled</span>\n                <span class="SCHEDULED">'+(null==(__t="1"==SCHEDULED?"Yes":"No")?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Archived</span>\n                <span class="ARCHIVED">'+(null==(__t="1"==ARCHIVED?"Yes":"No")?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Beamline Setup</span>\n                <span class="BEAMLINESETUPID">'+(null==(__t=BEAMLINESETUP)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Beam Calendar</span>\n                <span class="BEAMCALENDARID">'+(null==(__t=BEAMCALENDAR)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li class="clearfix reorder">\n                <div class="COMMENTS text">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</div>\n                <span class="label">Comments</span>\n            </li>\n\n        </ul>\n    </div>\n\n    <h2>Users</h2>\n    ',editUsers&&(__p+='\n    <div>\n        Add User: <input type="text" name="user" />\n    </div>\n    '),__p+='\n    <div class="rusers"></div>\n\n    </form>\n';return __p}},1221:function(e,t,n){(function(s){var a,i;a=[n(26),n(45),n(97),n(1222)],void 0===(i=function(e,t,n,a){return e.extend({template:a,events:{"keyup input[name=BEAMLINENAME]":"refreshSetups"},ui:{bl:"input[name=BEAMLINENAME]",setup:"select[name=BEAMLINESETUPID]"},refreshSetups:function(){this.blsetups.fetch()},getBeamlineName:function(){return this.ui.bl.val()},populateSetups:function(){console.log("populateSetups",this.blsetups.opts()),this.ui.setup.html(this.blsetups.opts())},initialize:function(e){this.refreshSetups=s.debounce(this.refreshSetups,500),console.log("add vis",e),this.blsetups=new n,this.blsetups.queryParams.BEAMLINENAME=this.getBeamlineName.bind(this),this.blsetups.queryParams.ACTIVE=1,this.listenTo(this.blsetups,"sync",this.populateSetups)},onRender:function(){this.$el.find("input[name=STARTDATE]").datetimepicker({dateFormat:"dd-mm-yy"}),this.$el.find("input[name=ENDDATE]").datetimepicker({dateFormat:"dd-mm-yy"})},createModel:function(){this.model=new t({PROPOSAL:this.getOption("proposal").get("PROPOSAL"),PROPOSALID:this.getOption("proposal").get("PROPOSALID")})},success:function(e,t,n){app.trigger("visit:show",e.get("VISIT"))},failure:function(e,t,n){app.alert({message:"Something went wrong creating this visit, please try again"})}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1222:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>Add New Visit</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n            <li class="clearfix">\n                <label>Proposal\n                    <span class="small">The proposal for this visit</span>\n                </label>\n                <div class="floated">\n                    '+(null==(__t=PROPOSAL)?"":_.escape(__t))+'\n                </div>\n            </li>\n\n            <li>\n                <label>Start Date\n                    <span class="small">Start date and time of the visit</span>\n                </label>\n                <input type="text" name="STARTDATE" />\n            </li>\n\n            <li>\n                <label>End Date\n                    <span class="small">End date and time of the visit</span>\n                </label>\n                <input type="text" name="ENDDATE" />\n            </li>\n\n            <li>\n                <label>Beamline\n                    <span class="small">Beamline where the visit will take place</span>\n                </label>\n                <input type="text" name="BEAMLINENAME" />\n            </li>\n\n            <li>\n                <label>Local Contact\n                    <span class="small">The local contact</span>\n                </label>\n                <input type="text" name="BEAMLINEOPERATOR" />\n            </li>\n\n            <li>\n                <label>Scheduled\n                    <span class="small">If the visit is considered a scheduled (not automated or continuously running visit). Unscheduled visits will be excluded from the calendar and overview</span>\n                </label>\n                <select name="SCHEDULED">\n                    <option value="1">Yes</option>\n                    <option value="0">No</option>\n                </select>\n            </li>\n\n            <li>\n                <label>Beamline Setup\n                    <span class="small">The beamline setup to register this visit against</span>\n                </label>\n                <select name="BEAMLINESETUPID"></select>\n            </li>\n\n            <li>\n                <label>Visit Number\n                    <span class="small">Leave blank to auto increment</span>\n                </label>\n                <input type="text" name="VISITNUMBER" />\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Add Visit</button>\n\n        </ul>\n    </div>\n\n    </form>\n';return __p}},1223:function(e,t,n){(function(s){var a,i;a=[n(7),n(16),n(12),n(15)],void 0===(i=function(e,t,n,a){var i=a.ClickableRow.extend({event:"useradm:show",argument:"PERSONID"});return e.LayoutView.extend({clickableRow:i,className:"content",template:s.template('<h1>Users</h1><p class="help">This page lists all users</p><div class="ra"><a href="admin/users/add" class="button" title="Add new user"><i class="fa fa-plus"></i> Add User</a></div><div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(e){this.table=new n({collection:e.collection,columns:[{name:"GIVENNAME",label:"Given Name",cell:"string",editable:!1},{name:"FAMILYNAME",label:"Family Name",cell:"string",editable:!1},{name:"LOGIN",label:"Login",cell:"string",editable:!1}],tableClass:"proposals",filter:"s",search:e.params.s,loading:!0,backgrid:{row:this.getOption("clickableRow"),emptyText:"No proposals found"}})},onRender:function(){this.wrap.show(this.table)},onShow:function(){this.table.focusSearch()}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},1224:function(e,t,n){var s,a;s=[n(7),n(6),n(20),n(1225),n(18)],void 0===(a=function(e,t,n,s){return e.LayoutView.extend({className:"content",template:s,initialize:function(e){t.Validation.bind(this)},onRender:function(){new n({model:this.model,el:this.$el})}})}.apply(t,s))||(e.exports=a)},1225:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>View User</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <span class="label">Login</span>\n                <span class="LOGIN">'+(null==(__t=LOGIN)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">First Name</span>\n                <span class="GIVENNAME">'+(null==(__t=GIVENNAME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Family Name</span>\n                <span class="FAMILYNAME">'+(null==(__t=FAMILYNAME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Email Address</span>\n                <span class="EMAILADDRESS">'+(null==(__t=EMAILADDRESS)?"":_.escape(__t))+"</span>\n            </li>\n\n        </ul>\n    </div>\n\n    </form>\n";return __p}},1226:function(e,t,n){var s,a;s=[n(6),n(26),n(151),n(1227)],void 0===(a=function(e,t,n,s){return t.extend({template:s,createModel:function(){this.model=new n},success:function(e,t,n){app.trigger("useradm:show",e.get("PERSONID"))},failure:function(e,t,n){app.alert({message:"Something went wrong creating this user, please try again"})}})}.apply(t,s))||(e.exports=a)},1227:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>Add New User</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <label>Login\n                    <span class="small">Authentication login</span>\n                </label>\n                <input type="text" name="LOGIN" />\n            </li>\n\n            <li>\n                <label>First Name</label>\n                <input type="text" name="GIVENNAME" />\n            </li>\n\n\n            <li>\n                <label>Family Name</label>\n                <input type="text" name="FAMILYNAME" />\n            </li>\n\n            <li>\n                <label>Email Address</label>\n                <input type="text" name="EMAILADDRESS" />\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Add User</button>\n\n        </ul>\n    </div>\n\n    </form>\n';return __p}},123:function(e,t,n){(function(s){var a,i;a=[n(6),n(72),n(79)],void 0===(i=function(e,t,n){return e.Model.extend(s.extend({},{idAttribute:"FAULTID",urlRoot:"/fault",resolvedOptions:{0:"No",1:"Yes",2:"Partial"},btlOptions:{0:"No",1:"Yes"},events:{"change sync reset":"refreshOptions"},initialize:function(){this.on("change",this.refreshOptions,this),this.refreshOptions()},defaults:{RESOLUTIONMD:"",DESCRIPTIONMD:""},refreshOptions:function(){this.attributes.RESOLVEDTEXT=this.resolvedOptions[this.get("RESOLVED")],this.attributes.BEAMTIMELOSTTEXT=this.btlOptions[this.get("BEAMTIMELOST")],this.get("DESCRIPTION")&&(this.attributes.DESCRIPTIONMD=t.toHTML(this.get("DESCRIPTION"))),this.get("RESOLUTION")&&(this.attributes.RESOLUTIONMD=t.toHTML(this.get("RESOLUTION")))},validation:{TITLE:{required:!0},STARTTIME:{required:!0,pattern:"datetime"},ENDTIME:{required:function(){return 1==this.get("RESOLVED")},pattern:"datetime"},BEAMTIMELOST_STARTTIME:{required:function(){return 1==this.get("BEAMTIMELOST")},pattern:"datetime"},BEAMTIMELOST_ENDTIME:{required:function(){return 1==this.get("BEAMTIMELOST")},pattern:"datetime"},SUBCOMPONENTID:{required:!0,pattern:"word"},BEAMTIMELOST:{required:!0,pattern:"number"},RESOLVED:{required:!0,pattern:"number"},RESOLUTION:{required:!1},DESCRIPTION:{required:!0},SESSIONID:{required:!0,pattern:"number"},ASSIGNEEID:{required:!1,pattern:"number"}}},n))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},174:function(e,t,n){(function(s){var a,i;a=[n(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"BEAMLINESETUPID",urlRoot:"/exp/setup",defaults:[],initialize:function(e,t){s.each(this.validation,(function(e,t){this.defaults[t]="word"==e.pattern||"wwsdash"==e.pattern||"wwdash"==e.pattern?"":null}),this)},map:{REQUIREDRESOLUTION:["DETECTORMAXRESOLUTION","DETECTORMINRESOLUTION"],EXPOSURETIME:["MINEXPOSURETIMEPERIMAGE","MAXEXPOSURETIMEPERIMAGE"],PREFERREDBEAMSIZEX:["BEAMSIZEXMIN","BEAMSIZEXMAX"],PREFERREDBEAMSIZEY:["BEAMSIZEYMIN","BEAMSIZEYMAX"],BOXSIZEX:["BOXSIZEXMIN","BOXSIZEXMAX"],BOXSIZEY:["BOXSIZEYMIN","BOXSIZEYMAX"],AXISRANGE:["GONIOSTATMINOSCILLATIONWIDTH","GONIOSTATMAXOSCILLATIONWIDTH"],AXISSTART:["OMEGAMIN","OMEGAMAX"],AXISEND:["OMEGAMIN","OMEGAMAX"],NUMBEROFIMAGES:["NUMBEROFIMAGESMIN","NUMBEROFIMAGESMAX"],TRANSMISSION:["MINTRANSMISSION","MAXTRANSMISSION"],ENERGY:["ENERGYMIN","ENERGYMAX"],DISTANCE:["DETECTORDISTANCEMIN","DETECTORDISTANCEMAX"],MONOBANDWIDTH:["MONOBANDWIDTHMIN","MONOBANDWIDTHMAX"],ROLL:["DETECTORROLLMIN","DETECTORROLLMAX"]},getRange:function(e){if(e&&e.field&&e.field in this.map){var t=this.map[e.field];if(null!==this.get(t[0])&&null!==this.get(t[1]))return[parseFloat(this.get(t[0])),parseFloat(this.get(t[1]))]}},validation:{BEAMLINENAME:{required:!0,pattern:"wwdash"},DETECTORID:{required:!0,pattern:"digits"},BEAMSIZEXMAX:{required:!1,pattern:"number"},BEAMSIZEXMIN:{required:!1,pattern:"number"},BEAMSIZEYMAX:{required:!1,pattern:"number"},BEAMSIZEYMIN:{required:!1,pattern:"number"},BOXSIZEXMAX:{required:!1,pattern:"number"},BOXSIZEXMIN:{required:!1,pattern:"number"},BOXSIZEYMAX:{required:!1,pattern:"number"},BOXSIZEYMIN:{required:!1,pattern:"number"},CS:{required:!1,pattern:"number"},ENERGYMAX:{required:!1,pattern:"digits"},ENERGYMIN:{required:!1,pattern:"digits"},GONIOSTATMAXOSCILLATIONWIDTH:{required:!1,pattern:"number"},GONIOSTATMINOSCILLATIONWIDTH:{required:!1,pattern:"number"},KAPPAMAX:{required:!1,pattern:"number"},KAPPAMIN:{required:!1,pattern:"number"},MAXEXPOSURETIMEPERIMAGE:{required:!1,pattern:"number"},MINEXPOSURETIMEPERIMAGE:{required:!1,pattern:"number"},MAXTRANSMISSION:{required:!1,pattern:"digits"},MINTRANSMISSION:{required:!1,pattern:"digits"},NUMBEROFIMAGESMAX:{required:!1,pattern:"digits"},NUMBEROFIMAGESMIN:{required:!1,pattern:"digits"},OMEGAMAX:{required:!1,pattern:"number"},OMEGAMIN:{required:!1,pattern:"number"},PHIMAX:{required:!1,pattern:"number"},PHIMIN:{required:!1,pattern:"number"},MONOBANDWIDTHMIN:{required:!1,pattern:"number"},MONOBANDWIDTHMAX:{required:!1,pattern:"number"}}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},175:function(e,t,n){var s,a;s=[n(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:"/fault/sys",idAttribute:"SYSTEMID",defaults:{NAME:"",DESCRIPTION:"",BEAMLINES:""},initialize:function(e){this.on("change",this._add_id,this),this._add_id()},_add_id:function(){this.attributes.ID=this.get("SYSTEMID")}})}.apply(t,s))||(e.exports=a)},176:function(e,t,n){var s,a;s=[n(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:"/fault/com",idAttribute:"COMPONENTID",defaults:{NAME:"",DESCRIPTION:"",BEAMLINES:""},initialize:function(e){this.on("change",this._add_id,this),this._add_id()},_add_id:function(){this.attributes.ID=this.get("COMPONENTID")}})}.apply(t,s))||(e.exports=a)},177:function(e,t,n){var s,a;s=[n(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:"/fault/scom",idAttribute:"SUBCOMPONENTID",defaults:{NAME:"",DESCRIPTION:"",BEAMLINES:""},initialize:function(e){this.on("change",this._add_id,this),this._add_id()},_add_id:function(){this.attributes.ID=this.get("SUBCOMPONENTID")}})}.apply(t,s))||(e.exports=a)},273:function(e,t,n){(function(s){var a,i;a=[n(7),n(70),n(101),n(102),n(103),n(274)],void 0===(i=function(e,t,n,a,i,l){return FilterView=e.ItemView.extend({template:l,className:"filter filter-nohide",ui:{bl:"select[name=BEAMLINE]",system:"select[name=SYSTEMID]",component:"select[name=COMPONENTID]",subcomponent:"select[name=SUBCOMPONENTID]"},events:{"change @ui.bl":"updateSystems","change @ui.system":"updateComponents","change @ui.component":"updateSubComponents","change @ui.subcomponent":"refetch","click a.clear":"clearFilters","change select":"updateUrlFragment"},updateUrlFragment:function(){var e=window.location.pathname;s.each({bl:"bl",sys:"system",com:"component",sub:"subcomponent"},(function(t,n){e=e.replace(new RegExp("\\/"+n+"\\/\\w+"),""),0!=this.ui[t].val()&&(e+="/"+n+"/"+this.ui[t].val())}),this),window.history.pushState({},"",e)},clearFilters:function(e){e.preventDefault(),this.ui.bl.val(""),this.ui.system.val(""),this.ui.component.val(""),this.ui.subcomponent.val(""),this.collection.fetch(),this.updateSystems()},initialize:function(){var e=this;this.collection.queryParams.bl=function(){return e.ui.bl.val()},this.collection.queryParams.sid=function(){if(e.ui.system.val()>0)return e.ui.system.val()},this.collection.queryParams.cid=function(){if(e.ui.component.val()>0)return e.ui.component.val()},this.collection.queryParams.scid=function(){if(e.ui.subcomponent.val()>0)return e.ui.subcomponent.val()},this.firstLoad=!0;var t=s.unique(s.values(this.getOption("params")));t.length&&null==t[0]&&(this.firstLoad=!1)},refetch:function(){this.collection.fetch()},onRender:function(){var e=this;this.beamlines=new t,this.beamlines.fetch().done((function(){e.ui.bl.html('<option value="">-</option><option value="P01">Phase I</option>'+e.beamlines.opts()),e.getOption("params")&&e.ui.bl.val(e.getOption("params").beamline),e.updateSystems()})),this.systems=new n(null,{queryParams:{bl:function(){return console.log("getting bl in sys",e.ui.bl.val()),e.ui.bl.val()}}}),this.components=new a(null,{queryParams:{bl:function(){return e.ui.bl.val()},sid:function(){return e.ui.system.val()}}}),this.subcomponents=new i(null,{queryParams:{bl:function(){return e.ui.bl.val()},cid:function(){return e.ui.component.val()}}})},updateSystems:function(e){this.systems.fetch().done(this.doUpdateSystems.bind(this,e))},doUpdateSystems:function(e){var t=this.ui.system.val();this.ui.system.html('<option value="0">-</option>'+this.systems.opts()).val(t),this.getOption("params")&&this.firstLoad&&this.ui.system.val(this.getOption("params").system),e&&this.collection.fetch(),this.updateComponents()},updateComponents:function(e){this.components.fetch().done(this.doUpdateComponents.bind(this,e))},doUpdateComponents:function(e){var t=this.ui.component.val();this.ui.component.html('<option value="0">-</option>'+this.components.opts()).val(t),this.getOption("params")&&this.firstLoad&&this.ui.component.val(this.getOption("params").component),this.updateSubComponents(),e&&this.collection.fetch()},updateSubComponents:function(e){this.subcomponents.fetch().done(this.doUpdateSubComponents.bind(this,e))},doUpdateSubComponents:function(e){var t=this.ui.subcomponent.val();this.ui.subcomponent.html('<option value="0">-</option>'+this.subcomponents.opts()).val(t),this.getOption("params")&&this.firstLoad&&this.ui.subcomponent.val(this.getOption("params").subcomponent),(e||this.firstLoad)&&this.collection.fetch(),this.firstLoad&&(this.firstLoad=!1)}})}.apply(t,a))||(e.exports=i)}).call(this,n(5))},274:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul>\n    <li>Beamline: <select name="BEAMLINE"></select></li>\n    <li>System: <select name="SYSTEMID"></select></li>\n    <li>Component: <select name="COMPONENTID"></select></li>\n    <li>Subcomponent: <select name="SUBCOMPONENTID"></select></li>\n    <li><a class="button clear" href="#"><i class="fa fa-times"></i></a></li>\n</ul>';return __p}},281:function(e,t,n){var s,a;s=[n(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:"/users/groups",idAttribute:"USERGROUPID",defaults:{NAME:"",USERS:0},validation:{NAME:{required:!0,pattern:"word"}}})}.apply(t,s))||(e.exports=a)},459:function(e,t,n){var s,a;s=[n(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:"/users/permissions",idAttribute:"PERMISSIONID",defaults:{TYPE:"",DESCRIPTION:""}})}.apply(t,s))||(e.exports=a)},460:function(e,t,n){(function(s){var a,i;a=[n(10),n(14),n(459)],void 0===(i=function(e,t,n){return e.extend(s.extend({},t,{model:n,url:"/users/permissions",keyAttribute:"TYPE",valueAttribute:"PERMISSIONID",parseState:function(e,t,n,s){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},70:function(e,t,n){(function(s){var a,i;a=[n(6),n(14)],void 0===(i=function(e,t){var n=e.Model.extend({idAttribute:"NAME"});return e.Collection.extend(s.extend({},t,{model:n,url:"/fault/bls",keyAttribute:"NAME",valueAttribute:"NAME"}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},97:function(e,t,n){(function(s){var a,i;a=[n(10),n(174),n(14)],void 0===(i=function(e,t,n){return e.extend(s.extend({},n,{model:t,mode:"server",url:"/exp/setup",keyAttribute:"SETUPDATE",valueAttribute:"BEAMLINESETUPID",state:{pageSize:15},parseState:function(e,t,n,s){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,a))||(e.exports=i)}).call(this,n(5))},99:function(e,t,n){var s,a;s=[n(10),n(123)],void 0===(a=function(e,t){return e.extend({model:t,mode:"server",url:"/fault",state:{pageSize:20},queryParams:{pageSize:"pp"},parseState:function(e,t,n,s){return{totalRecords:e[0]*this.state.pageSize}},parseRecords:function(e,t){return e[1]}})}.apply(t,s))||(e.exports=a)}}]);