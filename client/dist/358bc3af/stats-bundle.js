(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{100:function(t,e,i){(function(s){var n,a;n=[i(7),i(273),i(12),i(15)],void 0===(a=function(t,e,i,n){var a=n.ClickableRow.extend({event:"fault:show",argument:"FAULTID"});return t.LayoutView.extend({className:"content",template:s.template('<h1>Faults</h1><% if (app.user_can(\'fault_add\')) { %><div class="r"><a class="button add" href="/faults/add"><i class="fa fa-plus"></i> Add Fault Report</a></div><% } %><div class="filters"></div><div class="wrapper"></div>'),regions:{wrap:".wrapper",flts:".filters"},filters:!0,search:!0,initialize:function(t){var l=[{name:"TITLE",label:"Title",cell:n.HTMLCell,editable:!1},{name:"STARTTIME",label:"Time",cell:"string",editable:!1},{name:"BEAMLINE",label:"Beamline",cell:"string",editable:!1},{name:"VISIT",label:"Visit",cell:"string",editable:!1},{name:"SYSTEM",label:"System",cell:"string",editable:!1},{name:"COMPONENT",label:"Component",cell:"string",editable:!1},{name:"RESOLVEDTEXT",label:"Resolved",cell:"string",editable:!1},{name:"BEAMTIMELOSTTEXT",label:"Beamtime Lost",cell:"string",editable:!1},{name:"NAME",label:"Reporter",cell:"string",editable:!1}];app.mobile()&&s.each([3,4,5,6,8],(function(t){l[t].renderable=!1})),this.table=new i({collection:t.collection,columns:l,tableClass:"proposals",filter:!!this.getOption("search")&&"s",loading:!0,backgrid:{row:a,emptyText:"No faults found"}}),this.getOption("filters")&&(this.filters=new e({collection:t.collection,params:this.getOption("params")}))},onRender:function(){this.wrap.show(this.table),this.getOption("filters")&&this.flts.show(this.filters)},onShow:function(){this.table.focusSearch()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},101:function(t,e,i){(function(s){var n,a;n=[i(10),i(14),i(175)],void 0===(a=function(t,e,i){return t.extend(s.extend({},e,{model:i,url:"/fault/sys",keyAttribute:"NAME",valueAttribute:"SYSTEMID"}))}.apply(e,n))||(t.exports=a)}).call(this,i(5))},102:function(t,e,i){(function(s){var n,a;n=[i(10),i(14),i(176)],void 0===(a=function(t,e,i){return t.extend(s.extend({},e,{model:i,url:"/fault/com",keyAttribute:"NAME",valueAttribute:"COMPONENTID"}))}.apply(e,n))||(t.exports=a)}).call(this,i(5))},103:function(t,e,i){(function(s){var n,a;n=[i(10),i(14),i(177)],void 0===(a=function(t,e,i){return t.extend(s.extend({},e,{model:i,url:"/fault/scom",keyAttribute:"NAME",valueAttribute:"SUBCOMPONENTID"}))}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1132:function(t,e,i){var s,n;s=[i(7),i(45),i(237),i(1133),i(1134),i(1140),i(1143),i(1145),i(1148),i(1150),i(1152),i(1154)],void 0===(n=function(t,e,i,s,n,a,l,o,r,c,h,d){var p={title:"Visit Statistics",url:"/stats"},u={visit:function(t,s,a){var r=t.replace(/-\d+/,"");app.cookie(r),app.loading();var c=new e({VISIT:t});c.fetch({success:function(){var e=new i({visit:t});e.fetch({success:function(){var i={mx:n,em:o};c.get("TYPE")in i?view=i[c.get("TYPE")]:view=l,app.bc.reset([p,{title:app.prop,url:"/stats"},{title:t,url:"/dc/visit/"+t}]),app.content.show(new view({model:c,breakdown:e,params:{from:parseInt(s),to:parseInt(a)}}))},error:function(){app.bc.reset([p,{title:"No Data"}]),app.message({title:"No data",message:"No data for this visit yet"})}})},error:function(){app.bc.reset([p,{title:"Error"}]),app.message({title:"No such visit",message:"Couldn't find the specified visit"})}})},proposal:function(t){app.loading(),t||(t=1);var e=new s(null,{state:{pageSize:app.mobile()?5:15,currentPage:parseInt(t)}});e.fetch({success:function(){app.bc.reset([p,{title:"Proposal"},{title:app.prop}]),app.content.show(new a({pies:e}))},error:function(){}})},overview:function(t,e){app.user_can("all_prop_stats")?(e||(e=1),app.bc.reset([p,{title:"BAG Overview"}]),app.content.show(new r({params:{s:t}}))):app.message({title:"Access Denied",message:"You do not have access to that page"})},bls_overview:function(t){app.user_can("all_prop_stats")?(app.bc.reset([p,{title:"Beamlines Overview"}]),app.content.show(new c({params:{s:t}}))):app.message({title:"Access Denied",message:"You do not have access to that page"})},bl_overview:function(t,e,i){app.user_can("all_prop_stats")?(app.bc.reset([p,{title:t+" Overview"}]),app.content.show(new h({bl:t,params:{s:e}}))):app.message({title:"Access Denied",message:"You do not have access to that page"})},beamline:function(t,e,i,s){app.user_can("all_breakdown")?(app.bc.reset([p,{title:"Beamline Run Overview"},{title:t}]),app.content.show(new d({bl:t,params:{run:e,from:parseInt(i),to:parseInt(s)}}))):app.message({title:"Access Denied",message:"You do not have access to that page"})}};return app.addInitializer((function(){app.on("stats:show",(function(t){app.navigate("stats/visit/"+t),u.visit(t)})),app.on("pstats:show",(function(){app.navigate("stats"),u.proposal()})),app.on("bloverview:show",(function(t){app.navigate("stats/overview/bl/"+t),u.bl_overview(t)}))})),u}.apply(e,s))||(t.exports=n)},1133:function(t,e,i){var s,n;s=[i(10),i(149)],void 0===(n=function(t,e){return t.extend({model:e,mode:"client",url:"/vstat/pies",state:{pageSize:15},parseRecords:function(t,e){return this.average=t.AVERAGE,t.VISITS}})}.apply(e,s))||(t.exports=n)},1134:function(t,e,i){var s,n;s=[i(7),i(99),i(100),i(118),i(275),i(178),i(179),i(277),i(455),i(180),i(278),i(456),i(1139)],void 0===(n=function(t,e,i,s,n,a,l,o,r,c,h,d,p){return t.LayoutView.extend({template:p,className:"content",regions:{bd:".breakdown",det:".details",call:".callouts",ehc:".ehclogs",hrs:".hrs",flt:".faults",rbt:".roboterrors"},ui:{rbd:".dewar"},onShow:function(){this.bd.show(new s({model:this.getOption("breakdown"),params:this.getOption("params")})),this.det.show(new n({model:this.getOption("breakdown")})),this.hrs.show(new l({visit:this.model.get("VISIT")})),app.staff&&this.call.show(new o({visit:this.model.get("VISIT")})),app.staff&&this.ehc.show(new r({visit:this.model.get("VISIT")})),this.pie=new a({visit:this.model.get("VISIT"),el:this.$el.find("#visit_pie")}),this.faults=new e(null,{queryParams:{visit:this.model.get("VISIT")}}),this.faults.fetch(),this.flt.show(new i({collection:this.faults,filters:!1,search:!1})),this.roboterrors=new c(null,{queryParams:{visit:this.model.get("VISIT")}}),this.roboterrors.fetch(),this.rbt.show(new h({collection:this.roboterrors})),this.profile=new d({el:this.ui.rbd,visit:this.model.get("VISIT")})}})}.apply(e,s))||(t.exports=n)},1135:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="full clearfix">\n    <li>Started: '+(null==(__t=info.ST)?"":_.escape(__t))+"</li>\n    <li>Ended: "+(null==(__t=info.EN)?"":_.escape(__t))+"</li>\n    <li>Beamline: "+(null==(__t=info.BL)?"":_.escape(__t))+"</li>\n    <li>Length: "+(null==(__t=info.LEN)?"":_.escape(__t))+" hours</li>\n\n    <li>Last Data: "+(null==(__t=info.LAST)?"":_.escape(__t))+"</li>\n\n    <li>Data Collections: "+(null==(__t=info.DC_TOT)?"":_.escape(__t))+' (<span title="Full Data Collections">'+(null==(__t=info.DC_FULL)?"":_.escape(__t))+'</span> / <span title="Screenings">'+(null==(__t=info.DC_SCREEN)?"":_.escape(__t))+'</span> / <span title="Grid Screens">'+(null==(__t=info.DC_GRID)?"":_.escape(__t))+"</span>)</li>\n    <li>Collections Stopped: "+(null==(__t=info.DC_STOPPED)?"":_.escape(__t))+"</li>\n    <li>Energy Scans: "+(null==(__t=info.E_TOT)?"":_.escape(__t))+"</li>\n    <li>MCA Spectra: "+(null==(__t=info.FL_TOT)?"":_.escape(__t))+"</li>\n    <li>Samples Loaded: "+(null==(__t=info.R_TOT)?"":_.escape(__t))+"</li>\n</ul>";return __p}},1136:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"visit",urlRoot:"/vstat/hrs",parse:function(t,e){return{data:t}}})}.apply(e,s))||(t.exports=n)},1137:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Collection.extend({url:function(){return"/vstat/ehc/"+this.visit},initialize:function(t,e){e&&(this.visit=e.visit)}})}.apply(e,s))||(t.exports=n)},1138:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Collection.extend({url:function(){return"/vstat/call/"+this.visit},initialize:function(t,e){e&&(this.visit=e.visit)}})}.apply(e,s))||(t.exports=n)},1139:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="        <h1>Visit Statistics for "+(null==(__t=VISIT)?"":_.escape(__t))+'</h1>\n\n        <p class="help">This page shows statistics for the selected visit. The plots below show each action and when they happened. Drag to zoom in on the plot. Click the refresh icon to reset the zoom level</p>\n\n        <p class="ra">\n            <a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> Data Collections</a>\n        </p>\n\n        <div class="breakdown"></div>\n        <div class="details"></div>\n\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left">\n                <div id="visit_pie"></div>\n                <p>Breakdown of Total Visit Time</p>\n            </div>\n\n            <div class="plot_container right hrs"></div>\n        </div>\n\n        <h1>Robot Dewar Usage</h1>\n        <div class="plot_container">\n            <div class="dewar" id="avg_time"></div>\n        </div>\n        <div class="roboterrors"></div>\n        <div class="faults"></div>\n\n\n        <div class="callouts"></div>\n        <div class="ehclogs"></div>\n';return __p}},1140:function(t,e,i){var s,n;s=[i(7),i(1141),i(179),i(149),i(178),i(181),i(12),i(15),i(1142)],void 0===(n=function(t,e,i,s,n,a,l,o,r){var c=o.ClickableRow.extend({event:"dclist:show",argument:"VISIT"});return t.LayoutView.extend({template:r,className:"content",regions:{ps:".pies",hrs:".hrs",wrap:".wrapper"},templateHelpers:function(){return{PROPOSAL:app.prop}},initialize:function(t){this.collection=new a(null,{queryParams:{group_by:"visit",prop:app.prop}}),this.collection.fetch();var e=[{name:"VISIT",label:"Visit",cell:"string",editable:!1},{name:"LEN",label:"Allocated (hr)",cell:"string",editable:!1},{name:"REM",label:"Remaining (hr)",cell:"string",editable:!1},{name:"USED",label:"Used (%)",cell:"string",editable:!1},{name:"DCH",label:"Data Collections / hr",cell:o.ShadedCell,editable:!1},{name:"MDCH",label:"Max / hr",cell:"string",editable:!1},{name:"MX",label:"M-Axis",cell:"string",editable:!1},{name:"DC",label:"Total",cell:"string",editable:!1},{name:"SCH",label:"Screenings / hr",cell:o.ShadedCell,editable:!1},{name:"MSCH",label:"Max / hr",cell:"string",editable:!1},{name:"SC",label:"Total",cell:"string",editable:!1},{name:"SLH",label:"Samples Loaded / hr",cell:o.ShadedCell,editable:!1},{name:"MSLH",label:"Max / hr",cell:"string",editable:!1},{name:"SL",label:"Total",cell:"string",editable:!1}];this.table=new l({collection:this.collection,columns:e,tableClass:"visits",loading:!0,backgrid:{row:c,emptyText:"No runs found"}})},onShow:function(){this.ps.show(new e({collection:this.getOption("pies")})),this.hrs.show(new i);var t=new s({data:this.getOption("pies").average});this.pie=new n({model:t,el:this.$el.find("#visit_pie")}).render(),this.wrap.show(this.table)}})}.apply(e,s))||(t.exports=n)},1141:function(t,e,i){(function(s){var n,a;n=[i(7),i(61),i(8),i(23),i(150)],void 0===(a=function(t,e,i){return t.LayoutView.extend({template:s.template('<div class="page_wrap"></div><div class="legend clearfix"></div><div class="plot_container"><div id="visit_breakdown"></div></div>'),collectionEvents:{"change sync reset":"doPlot"},regions:{pgs:".page_wrap"},events:{plotclick:"showVisit"},showVisit:function(t,e,i){var s=this.plot.getXAxes();s.length&&i&&(console.log("visit",s[0],i.dataIndex),app.trigger("stats:show",s[0].ticks[i.dataIndex].label))},initialize:function(t){this.paginator=new e({collection:t.collection})},onShow:function(){this.pgs.show(this.paginator),this.doPlot()},doPlot:function(){var t={series:{bars:{show:!0,barWidth:.9,align:"center"},stack:!0},xaxis:{ticks:this.collection.map((function(t,e){return[e,app.prop+"-"+t.get("data").VISIT]}))},yaxis:{min:0,max:24.1,ticks:[0,8,16,24]},grid:{borderWidth:0,hoverable:!0,clickable:!0},legend:{noColumns:10,container:this.$el.find(".legend")},tooltip:!0,tooltipOpts:{content:this.getToolTip.bind(this)}},e={SUP:{color:"yellow",label:"Startup"},DCTIME:{color:"green",label:"Data Collections"},AITIME:{color:"#93db70",label:"Auto Indexing"},CENTTIME:{color:"cyan",label:"Centring"},EDGE:{color:"orange",label:"Edge Scans"},R:{color:"blue",label:"Robot Actions"},FAULT:{color:"grey",label:"Faults"},NOBEAM:{color:"black",label:"No Beam"},T:{color:"purple",label:"Thinking"},REM:{color:"red",label:"Remaining"}};this.collection.each((function(t,i){s.each(e,(function(e,s){e.data||(e.data=[]),e.data.push([i,parseFloat(t.get("data")[s])])}),this)}),this),console.log(e,s.values(e)),this.plot=i.plot(this.$el.find("#visit_breakdown"),s.values(e),t)},getToolTip:function(t,e,i,s){return s.series.label+": "+(s.datapoint[1]-s.datapoint[2]).toFixed(1)+"hrs"},destroy:function(){this.plot.destroy()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1142:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>Visit Statistics for "+(null==(__t=PROPOSAL)?"":_.escape(__t))+'</h1>\n\n<p class="help">This page shows statistics for the currently selected proposal. Click on a particular visit to see statistics for that visit.</p>\n\n<div class="pies"></div>\n<div class="wrapper"></div>\n\n<div class="plot_wrap clearfix">\n    <div class="plot_container left">\n        <div id="visit_pie"></div>\n        <p>Breakdown of Average Visit Time</p>\n    </div>\n    \n    <div class="plot_container right hrs"></div>\n</div>';return __p}},1143:function(t,e,i){var s,n;s=[i(7),i(99),i(100),i(118),i(275),i(178),i(179),i(277),i(455),i(1144)],void 0===(n=function(t,e,i,s,n,a,l,o,r,c){return t.LayoutView.extend({template:c,className:"content",regions:{bd:".breakdown",det:".details",call:".callouts",ehc:".ehclogs",hrs:".hrs",flt:".faults"},onShow:function(){this.bd.show(new s({model:this.getOption("breakdown")})),this.det.show(new n({model:this.getOption("breakdown")})),app.staff&&this.call.show(new o({visit:this.model.get("VISIT")})),app.staff&&this.ehc.show(new r({visit:this.model.get("VISIT")})),this.pie=new a({visit:this.model.get("VISIT"),el:this.$el.find("#visit_pie")}),this.faults=new e(null,{queryParams:{visit:this.model.get("VISIT")}}),this.faults.fetch(),this.flt.show(new i({collection:this.faults,filters:!1,search:!1}))}})}.apply(e,s))||(t.exports=n)},1144:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="        <h1>Visit Statistics for "+(null==(__t=VISIT)?"":_.escape(__t))+'</h1>\n\n        <p class="help">This page shows statistics for the selected visit. The plots below show each action and when they happened. Drag to zoom in on the plot. Click the refresh icon to reset the zoom level</p>\n\n        <p class="ra">\n            <a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> Data Collections</a>\n        </p>\n\n        <div class="breakdown"></div>\n        <div class="details"></div>\n\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left">\n                <div id="visit_pie"></div>\n                <p>Breakdown of Total Visit Time</p>\n            </div>\n\n            <div class="plot_container right hrs"></div>\n        </div>\n\n        <div class="faults"></div>\n\n\n        <div class="callouts"></div>\n        <div class="ehclogs"></div>\n';return __p}},1145:function(t,e,i){var s,n;s=[i(7),i(6),i(99),i(100),i(118),i(275),i(178),i(179),i(277),i(182),i(279),i(1146),i(1147)],void 0===(n=function(t,e,i,s,n,a,l,o,r,c,h,d,p){var u=c.extend({urlRoot:"/em/ctf/histogram"}),f=c.extend({urlRoot:"/em/mc/histogram"});return t.LayoutView.extend({template:p,className:"content",regions:{bd:".breakdown",det:".details",call:".callouts",ehc:".ehclogs",hrs:".hrs",flt:".faults",rdefocus:".defocus",rastimatigm:".astigmatism",rresolution:".resolution",rdrift:".drift"},initialize:function(){this.defocus=new u,this.astigmatism=new u,this.resolution=new u,this.drift=new f,this.defocus.fetch({data:{visit:this.model.get("VISIT")}}),this.astigmatism.fetch({data:{visit:this.model.get("VISIT"),ty:"astigmatism"}}),this.resolution.fetch({data:{visit:this.model.get("VISIT"),ty:"resolution"}}),this.drift.fetch({data:{visit:this.model.get("VISIT")}})},onShow:function(){this.bd.show(new n({model:this.getOption("breakdown"),scatters:!0})),this.det.show(new a({model:this.getOption("breakdown")})),app.staff&&this.ehc.show(new r({visit:this.model.get("VISIT")})),this.pie=new l({visit:this.model.get("VISIT"),el:this.$el.find("#visit_pie")}),this.faults=new i(null,{queryParams:{visit:this.model.get("VISIT")}}),this.faults.fetch(),this.flt.show(new s({collection:this.faults,filters:!1,search:!1})),this.rdefocus.show(new h({collection:new e.Collection([this.defocus]),title:"Defocus Histogram"})),this.rastimatigm.show(new h({collection:new e.Collection([this.astigmatism]),title:"Astigmatism Histogram"})),this.rresolution.show(new h({collection:new e.Collection([this.resolution]),title:"Resolution Histogram"})),this.rdrift.show(new d({collection:new e.Collection([this.drift]),title:"Drift vs. Frame difference"}))}})}.apply(e,s))||(t.exports=n)},1146:function(t,e,i){(function(s){var n,a;n=[i(7),i(11),i(8),i(23),i(42),i(124)],void 0===(a=function(t,e,i){return t.ItemView.extend({template:s.template('<div id="visit_pie"></div><p><%-title%></p>'),events:{plotselected:"zoom",dblclick:"reset"},zoom:function(t,e){var i=this.plot.getOptions();i.xaxes[0].min=e.xaxis.from,i.xaxes[0].max=e.xaxis.to,this.plot.setupGrid(),this.plot.draw(),this.plot.clearSelection()},reset:function(t){this.zoom(t,{xaxis:{from:null,to:null}})},templateHelpers:function(){return{title:this.getOption("title")}},initialize:function(t){this.$el.css("opacity",0),this.listenTo(this.collection,"add remove change:data",this.render)},getToolTip:function(t,e,i,s){this.collection.first().get("data")[0];return(t?t+": ":"")+s.series.type+" - "+s.datapoint[1]},onRender:function(){var t={xaxis:{tickDecimals:0,rotateTicks:45},series:{lines:{show:!1},points:{show:!0}},grid:{borderWidth:0,hoverable:!0},selection:{mode:"x"},tooltipOpts:{content:this.getToolTip.bind(this)},tooltip:!0},n=this.collection.first();if(n&&n.get("data")){t.xaxis.ticks=s.map(n.get("ticks"),(function(t,e){return[e,t]}));var a=0;this.collection.each((function(t){s.each(t.get("data"),(function(t){a++}))}));var l=e.shuffle(e.getColors(a)),o=0,r=[];this.collection.each((function(t){s.each(t.get("data"),(function(t){var e={data:s.map(t.avg,(function(t,e){return[e,t]})),label:t.label,color:l[o],type:"Avg"};r.push(e);e={data:s.map(t.min,(function(t,e){return[e,t]})),points:{radius:1},color:l[o],type:"Min"};r.push(e);e={data:s.map(t.max,(function(t,e){return[e,t]})),points:{radius:1},color:l[o],type:"Max"};r.push(e),o++}),this)})),r.length&&(this.plot=i.plot(this.$el.find("#visit_pie"),r,t),this.$el.css("opacity",1))}}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1147:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="        <h1>Visit Statistics for "+(null==(__t=VISIT)?"":_.escape(__t))+'</h1>\n\n        <p class="help">This page shows statistics for the selected visit. The plots below show each action and when they happened. Drag to zoom in on the plot. Click the refresh icon to reset the zoom level</p>\n\n        <p class="ra">\n            <a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> Data Collections</a>\n        </p>\n\n        <div class="breakdown"></div>\n        <div class="details"></div>\n\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left">\n                <div id="visit_pie"></div>\n                <p>Breakdown of Total Visit Time</p>\n            </div>\n\n            <div class="plot_container right hrs"></div>\n        </div>\n\n        <h1>Histograms</h1>\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left defocus"></div>\n            <div class="plot_container right astigmatism"></div>\n        </div>\n\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left resolution"></div>\n            <div class="plot_container right drift"></div>\n        </div>\n\n        <div class="faults"></div>\n\n        <div class="ehclogs"></div>\n';return __p}},1148:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(16),i(12),i(31),i(280),i(181),i(98),i(11),i(15),i(1149)],void 0===(l=function(t,e,i,a,l,o,r,c,h,d){var p=e.Row.extend({events:{click:"onClick"},onClick:function(){app.cookie(this.model.get("PROP")),app.trigger("pstats:show",this.model.get("SHIPPINGID"))}});return t.LayoutView.extend({className:"content",template:d,regions:{wrap:".wrapper",type:".type",type2:".type2"},ui:{run:"select[name=runid]",sched:"input[name=scheduled]"},events:{"change @ui.run":"changeRun","change @ui.sched":"changeScheduled","click a.download":"downloadData"},downloadData:function(t){t.preventDefault();var e=[];s.each(s.omit(this.collection.queryParams,s.keys(this.collection.__proto__.queryParams)),(function(t,i){(s.isFunction(t)?t():t)&&e.push(i+"="+t)}));var i=app.apiurl+this.collection.url+"?"+e.join("&")+"&download=1";c.sign({url:i,callback:function(t){window.location=i+"&token="+t.token}})},changeScheduled:function(){this.collection.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.collection.fetch()},changeRun:function(){this.collection.queryParams.runid=this.ui.run.val(),this.collection.fetch()},initialize:function(t){this.collection=new o(null),this.runs=new r,this.ready=this.runs.fetch(),this.types=new l,this.ready2=this.types.fetch();var e=[{name:"PROP",label:"Proposal",cell:"string",editable:!1},{name:"VISITS",label:"No. Visits",cell:"string",editable:!1},{name:"LEN",label:"Allocated (hr)",cell:"string",editable:!1},{name:"REM",label:"Remaining (hr)",cell:"string",editable:!1},{name:"USED",label:"Used (%)",cell:h.ShadedCell,editable:!1},{name:"DCH",label:"Data Collections / hr",cell:h.ShadedCell,editable:!1},{name:"MDCH",label:"Max / hr",cell:"string",editable:!1},{name:"MX",label:"M-Axis",cell:"string",editable:!1},{name:"DC",label:"Total",cell:"string",editable:!1},{name:"SCH",label:"Screenings / hr",cell:h.ShadedCell,editable:!1},{name:"MSCH",label:"Max / hr",cell:"string",editable:!1},{name:"SC",label:"Total",cell:"string",editable:!1},{name:"SLH",label:"Samples Loaded / hr",cell:h.ShadedCell,editable:!1},{name:"MSLH",label:"Max / hr",cell:"string",editable:!1},{name:"SL",label:"Total",cell:"string",editable:!1}];this.table=new i({collection:this.collection,columns:e,tableClass:"proposals",filter:"s",search:t.params.s,loading:!0,backgrid:{row:p,emptyText:"No proposals found"}})},onRender:function(){this.wrap.show(this.table),this.showFilter(),n.when(this.ready).done(this.popuateRuns.bind(this)),n.when(this.ready2).done(this.showFilter2.bind(this))},updateFilter:function(t){this.collection.queryParams.ty=t,this.collection.queryParams.runid="yearly"==t?null:this.ui.run.val()},showFilter2:function(){this.ty2=new a({url:!1,collection:this.collection,name:"proposalcode",filters:this.types.map((function(t){return{id:t.get("PROPOSALCODE"),name:t.get("PROPOSALCODE")}}))}),this.listenTo(this.ty2,"selected:change",this.updateFilter2,this),this.type2.show(this.ty2)},popuateRuns:function(){this.ui.run.html(this.runs.opts());var t=this.runs.first();this.ui.run.val(t.get("RUNID")),this.changeRun()},showFilter:function(){this.ty=new a({url:!1,collection:this.collection,name:"ty",filters:[{id:"yearly",name:"Yearly"},{id:"monthly",name:"Monthly"},{id:"weekly",name:"Weekly"}]}),this.listenTo(this.ty,"selected:change",this.updateFilter,this),this.type.show(this.ty)},onShow:function(){this.table.focusSearch()}})}.apply(e,a))||(t.exports=l)}).call(this,i(5),i(8))},1149:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="filter filter-nohide">\n    <ul class="clearfix">\n        <li title="View BAG Overview" class="current"><a href="/stats/overview">BAGs</a></li>\n        <li title="View Beamlines Overview"><a href="/stats/overview/beamlines">Beamlines</a></li>\n    </ul>\n</div>\n\n<h1>BAG Overview</h1>\n<p class="help">This page shows BAG overview statistics for the selected time period</p>\n\n<div class="filter">\n    <ul>\n        <li>Run:\n            <select name="runid"></select>\n        </li>\n        <li>\n            <label>\n                <input type="checkbox" name="scheduled" /> Scheduled Visits Only\n            </label>\n        </li>\n    </ul>\n</div>\n<div class="filter type"></div>\n<div class="filter type2"></div>\n<div class="wrapper"></div>\n<a href="#" class="button download"><i class="fa fa-download"></i> Download</a>\n';return __p}},1150:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(6),i(16),i(12),i(31),i(280),i(181),i(98),i(11),i(15),i(1151),i(23)],void 0===(l=function(t,e,i,a,l,o,r,c,h,d,p){var u=i.Row.extend({events:{click:"onClick"},onClick:function(){app.trigger("bloverview:show",this.model.get("BEAMLINENAME"))}});return t.LayoutView.extend({className:"content",template:p,regions:{wrap2:".wrapper2",wrap3:".wrapper3",wrap4:".wrapper4",type:".type",type2:".type2",rl:".runlist"},ui:{run:"select[name=runid]",sched:"input[name=scheduled]",plot:"#avg_time"},events:{"change @ui.run":"changeRun","change @ui.sched":"changeScheduled","click a.download":"downloadData","change input[name=type]":"plotRuns"},downloadData:function(t){t.preventDefault();var e=s(t.target).attr("class").replace("button","").replace("download","").replace(/\s+/,"");if(e in this){var i=this[e],a=[];n.each(n.omit(i.queryParams,n.keys(i.__proto__.queryParams)),(function(t,e){var i=n.isFunction(t)?t():t;i&&a.push(e+"="+i)}));var l=app.apiurl+i.url+"?"+a.join("&")+"&download=1";h.sign({url:l,callback:function(t){window.location=l+"&token="+t.token}})}},changeScheduled:function(){this.beamlines.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.sessiontypes.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.total.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.beamlines.fetch(),this.sessiontypes.fetch(),this.total.fetch(),this.plotruns.each((function(t){t.get("data").queryParams.scheduled=this.ui.sched.is(":checked")?1:null,t.get("data").fetch().done((function(){t.collection.trigger("reset")}))}),this)},changeRun:function(){this.beamlines.queryParams.runid=this.ui.run.val(),this.sessiontypes.queryParams.runid=this.ui.run.val(),this.total.queryParams.runid=this.ui.run.val(),this.beamlines.fetch(),this.sessiontypes.fetch(),this.total.fetch()},initialize:function(t){this.beamlines=new r(null,{queryParams:{group_by:"beamline"}}),this.sessiontypes=new r(null,{queryParams:{group_by:"type"}}),this.total=new r(null,{queryParams:{group_by:"total"}}),this.runs=new c,this.listenTo(this.runs,"backgrid:selected",this.selectRun,this),this.ready=this.runs.fetch(),this.types=new o,this.ready2=this.types.fetch();var i=[{name:"BEAMLINENAME",label:"Beamline",cell:"string",editable:!1},{name:"VISITS",label:"No. Visits",cell:"string",editable:!1},{name:"LEN",label:"Allocated (hr)",cell:"string",editable:!1},{name:"REM",label:"Remaining (hr)",cell:"string",editable:!1},{name:"USED",label:"Used (%)",cell:"string",editable:!1},{name:"DCH",label:"Data Collections / hr",cell:"string",editable:!1},{name:"MDCH",label:"Max / hr",cell:"string",editable:!1},{name:"MX",label:"M-Axis",cell:"string",editable:!1},{name:"DC",label:"Total",cell:"string",editable:!1},{name:"SCH",label:"Screenings / hr",cell:"string",editable:!1},{name:"MSCH",label:"Max / hr",cell:"string",editable:!1},{name:"SC",label:"Total",cell:"string",editable:!1},{name:"SLH",label:"Samples Loaded / hr",cell:"string",editable:!1},{name:"MSLH",label:"Max / hr",cell:"string",editable:!1},{name:"SL",label:"Total",cell:"string",editable:!1}],s=[{name:"TYPENAME",label:"Type",cell:"string",editable:!1}].concat(i.slice(1));this.table2=new a({collection:this.beamlines,columns:i,tableClass:"proposals",pages:!1,loading:!0,backgrid:{row:u,emptyText:"No beamlines found"}}),this.table4=new a({collection:this.sessiontypes,columns:s,tableClass:"proposals",pages:!1,loading:!0,backgrid:{emptyText:"No session types found"}}),this.table3=new a({collection:this.total,columns:i.slice(1),tableClass:"proposals",pages:!1,loading:!0,backgrid:{emptyText:"No total found"}}),this.runtable=new a({collection:this.runs,columns:[{label:"",cell:"select-row",editable:!1},{name:"RUN",label:"Run",cell:"string",editable:!1}],backgrid:{row:d.BGSelectRow,emptyText:"No runs found"}}),this.plotruns=new e.Collection(null,{comparator:"runid"}),this.listenTo(this.plotruns,"reset add remove",this.plotRuns)},selectRun:function(t,e){if(e){var i=new r(null,{queryParams:{group_by:"beamline",runid:t.get("RUNID")}}),s=this;i.fetch().done((function(){s.plotruns.add({run:t.get("RUN"),runid:t.get("RUNID"),data:i})}))}else{var a=this.plotruns.findWhere({runid:t.get("RUNID")});n.each(a,(function(t){this.plotruns.remove(t)}),this),this.plotruns.trigger("reset")}},plotRuns:function(){var t={},e=n.unique(n.flatten(this.plotruns.map((function(t){return t.get("data").pluck("BEAMLINENAME")})))).sort(),i=h.getColors(e.length);n.each(e,(function(e,s){t[e]={label:e,data:[],color:i[s]}}));var a=this.$el.find("input[name=type]:checked").val(),l=this.plotruns.map((function(t,e){return[e,t.get("run")]}));this.plotruns.each((function(e,i){e.get("data").each((function(e,s){t[e.get("BEAMLINENAME")].data.push([i,e.get(a)])}),this)}),this);var o={xaxis:{rotateTicks:45,ticks:l,max:l.length-.7},grid:{borderWidth:0}};s.plot(this.ui.plot,Object.values(t),o)},onRender:function(){this.wrap2.show(this.table2),this.wrap3.show(this.table4),this.wrap4.show(this.table3),this.showFilter(),this.rl.show(this.runtable),s.when(this.ready).done(this.popuateRuns.bind(this)),s.when(this.ready2).done(this.showFilter2.bind(this))},updateFilter:function(t){this.beamlines.queryParams.ty=t,this.sessiontypes.queryParams.ty=t,this.total.queryParams.ty=t,"yearly"==t?(this.beamlines.queryParams.runid=null,this.sessiontypes.queryParams.runid=null,this.total.queryParams.runid=null):(this.beamlines.queryParams.runid=this.ui.run.val(),this.sessiontypes.queryParams.runid=this.ui.run.val(),this.total.queryParams.runid=this.ui.run.val()),this.sessiontypes.fetch(),this.total.fetch()},updateFilter2:function(t){this.sessiontypes.queryParams.proposalcode=t,this.total.queryParams.proposalcode=t,this.sessiontypes.fetch(),this.total.fetch(),this.plotruns.each((function(e){e.get("data").queryParams.proposalcode=t,e.get("data").fetch().done((function(){e.collection.trigger("reset")}))}),this)},showFilter2:function(){this.ty2=new l({url:!1,collection:this.beamlines,name:"proposalcode",filters:this.types.map((function(t){return{id:t.get("PROPOSALCODE"),name:t.get("PROPOSALCODE")}}))}),this.listenTo(this.ty2,"selected:change",this.updateFilter2,this),this.type2.show(this.ty2)},popuateRuns:function(){this.ui.run.html(this.runs.opts());var t=this.runs.first();this.ui.run.val(t.get("RUNID")),this.changeRun(),n.each([0,1,2],(function(t){t<this.runs.length&&this.runs.at(t).trigger("backgrid:select",this.runs.at(t),!0)}),this)},showFilter:function(){this.ty=new l({url:!1,collection:this.beamlines,name:"ty",filters:[{id:"yearly",name:"Yearly"},{id:"monthly",name:"Monthly"},{id:"weekly",name:"Weekly"}]}),this.listenTo(this.ty,"selected:change",this.updateFilter,this),this.type.show(this.ty)}})}.apply(e,a))||(t.exports=l)}).call(this,i(8),i(5))},1151:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="filter filter-nohide">\n    <ul class="clearfix">\n        <li title="View BAG Overview"><a href="/stats/overview">BAGs</a></li>\n        <li title="View Beamlines Overview" class="current"><a href="/stats/overview/beamlines">Beamlines</a></li>\n    </ul>\n</div>\n\n<h1>Beamlines</h1>\n<p class="help">This page shows beamline overview statistics for the selected time period. Click on a beamline to see overview stats for that particular beamline</p>\n\n<div class="filter">\n    <ul>\n        <li>\n            <label>\n                <input type="checkbox" name="scheduled" /> Scheduled Visits Only\n            </label>\n        </li>\n    </ul>\n</div>\n<div class="filter type2"></div>\n\n\n<div class="right third">\n    <div class="filter">\n        <ul>\n            <li><label><input type="radio" name="type" value="USED" checked="checked" /> Used (%)</label></li>\n            <li><label><input type="radio" name="type" value="DCH" /> DC / hr</label></li>\n            <li><label><input type="radio" name="type" value="SCH" /> SC / hr</label></li>\n            <li><label><input type="radio" name="type" value="SLH" /> Samples / hr</label></li>\n            <li><label title="Data Collections with Multi Axis Goniomtry"><input type="radio" name="type" value="MX" /> M-Axis</label></li>\n        </ul>\n    </div>\n    <div class="runlist"></div>\n</div>\n<div class="left twothird">\n    <div class="plot_container"><div id="avg_time" class="large"></div></div>\n</div>\n\n\n<div class="filter">\n    <ul>\n        <li>Run:\n            <select name="runid"></select>\n        </li>\n    </ul>\n</div>\n<div class="filter type"></div>\n\n<div class="wrapper2"></div>\n<a href="#" class="button download beamlines"><i class="fa fa-download"></i> Download</a>\n\n<h1>Session Types</h1>\n<div class="wrapper3"></div>\n<a href="#" class="button download sessiontypes"><i class="fa fa-download"></i> Download</a>\n\n<h1>Totals</h1>\n<div class="wrapper4"></div>\n<a href="#" class="button download totals"><i class="fa fa-download"></i> Download</a>\n';return __p}},1152:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(6),i(12),i(31),i(280),i(181),i(98),i(182),i(279),i(11),i(15),i(1153),i(16),i(184)],void 0===(l=function(t,e,i,a,l,o,r,c,h,d,p,u,f){return t.LayoutView.extend({className:"content",template:u,regions:{wrap:".wrapper",wrap2:".wrapper2",wrap3:".wrapper3",wrap4:".wrapper4",type:".type",type2:".type2",en:".en",rbsx:".bsx",rbsy:".bsy",ex:".exp"},templateHelpers:function(){return{BL:this.getOption("bl")}},ui:{run:"select[name=runid]",plot:"#avg_time",sched:"input[name=scheduled]"},events:{"change @ui.run":"changeRun","change @ui.sched":"changeScheduled","click a.download":"downloadData"},downloadData:function(t){t.preventDefault();var e=[];s.each(s.omit(this.collection.queryParams,s.keys(this.collection.__proto__.queryParams)),(function(t,i){(s.isFunction(t)?t():t)&&e.push(i+"="+t)}));var i=app.apiurl+this.collection.url+"?"+e.join("&")+"&download=1";d.sign({url:i,callback:function(t){window.location=i+"&token="+t.token}})},changeScheduled:function(){this.collection.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.proposals.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.sessiontypes.queryParams.scheduled=this.ui.sched.is(":checked")?1:null,this.collection.fetch(),this.proposals.fetch(),this.sessiontypes.fetch()},changeRun:function(){this.proposals.queryParams.runid=this.ui.run.val(),this.sessiontypes.queryParams.runid=this.ui.run.val(),this.proposals.fetch(),this.sessiontypes.fetch()},selectFirst:function(){if(this.collection.length){var t=this.collection.filter((function(t){return null!=t.get("REM")}));t.length&&t[0].trigger("backgrid:select",t[0],!0)}},initialize:function(t){this.collection=new o(null,{queryParams:{group_by:"run",bl:this.getOption("bl")}}),this.listenTo(this.collection,"sync reset",this.plotRuns),this.listenTo(this.collection,"backgrid:selected",this.selectRun,this),this.collection.fetch().done(this.selectFirst.bind(this)),this.proposals=new o(null,{queryParams:{bl:this.getOption("bl")}}),this.sessiontypes=new o(null,{queryParams:{group_by:"type",bl:this.getOption("bl")}}),this.runs=new r,this.ready=this.runs.fetch(),this.types=new l,this.ready2=this.types.fetch();var s=[{label:"",cell:"select-row",editable:!1},{name:"RUN",label:"Run",cell:"string",editable:!1},{name:"VISITS",label:"No. Visits",cell:"string",editable:!1},{name:"LEN",label:"Allocated (hr)",cell:"string",editable:!1},{name:"REM",label:"Remaining (hr)",cell:"string",editable:!1},{name:"USED",label:"Used (%)",cell:"string",editable:!1},{name:"DCH",label:"Data Collections / hr",cell:p.ShadedCell,editable:!1},{name:"MDCH",label:"Max / hr",cell:"string",editable:!1},{name:"MX",label:"M-Axis",cell:"string",editable:!1},{name:"DC",label:"Total",cell:"string",editable:!1},{name:"SCH",label:"Screenings / hr",cell:p.ShadedCell,editable:!1},{name:"MSCH",label:"Max / hr",cell:"string",editable:!1},{name:"SC",label:"Total",cell:"string",editable:!1},{name:"SLH",label:"Samples Loaded / hr",cell:p.ShadedCell,editable:!1},{name:"MSLH",label:"Max / hr",cell:"string",editable:!1},{name:"SL",label:"Total",cell:"string",editable:!1}],n=[{name:"PROP",label:"Proposal",cell:"string",editable:!1}].concat(s.slice(2)),a=[{name:"TYPENAME",label:"Type",cell:"string",editable:!1}].concat(s.slice(2));this.table=new i({collection:this.collection,columns:s,tableClass:"proposals",loading:!0,backgrid:{row:p.BGSelectRow,emptyText:"No runs found"}}),this.table2=new i({collection:this.proposals,columns:n,tableClass:"proposals",filter:"s",search:t.params.s,loading:!0,backgrid:{emptyText:"No proposals found"}}),this.table4=new i({collection:this.sessiontypes,columns:a,tableClass:"proposals",pages:!1,loading:!0,backgrid:{emptyText:"No session types found"}}),this.hists=[new e.Collection,new e.Collection,new e.Collection,new e.Collection]},selectRun:function(t,e){e?s.each(["","beamsizex","beamsizey","exposuretime"],(function(e,i){var s=new c({RUNID:t.get("RUNID")}),n=this;s.fetch({data:{bl:this.getOption("bl"),runid:t.get("RUNID"),ty:e}}).done((function(){var e=s.get("histograms");e.length&&(e[0].label=t.get("RUN")+": "+e[0].label),s.set("histograms",e),n.hists[i].add(s)}))}),this):s.each(this.hists,(function(e){var i=e.findWhere({RUNID:t.get("RUNID")});i&&e.remove(i)}))},plotRuns:function(){var t=d.getColors(4),e=[],i=0;s.each({USED:"Used (%)",DCH:"Data Collections / hr ",SCH:"Screenings / hr",SLH:"Samples Loaded / hr"},(function(n,a){var l={label:n,data:[],color:t[i]};"USED"==a&&(l.yaxis=2),this.collection.each((function(t,e){var i=t.get(a);l.data.push([e,i<0?0:i])}),this),e.push(l);var o=this.collection.fullCollection.pluck(a),r=s.reduce(o,(function(t,e){return t+e}),0)/o.length;e.push({color:d.shadeColor(t[i],.5),label:null,legend:!1,lines:{show:!0,lineWidth:1},shadowSize:0,data:[[0,r],[this.collection.length-1,r]],yaxis:"USED"==a?2:1}),i++}),this);var a={xaxis:{tickDecimals:0,rotateTicks:45,ticks:this.collection.map((function(t,e){return[e,t.get("RUN")]}))},grid:{borderWidth:0},yaxes:[{},{position:"right"}]};n.plot(this.ui.plot,e,a)},onRender:function(){this.wrap.show(this.table),this.wrap2.show(this.table2),this.wrap3.show(this.table4),this.showFilter(),n.when(this.ready).done(this.popuateRuns.bind(this)),n.when(this.ready2).done(this.showFilter2.bind(this)),this.en.show(new h({collection:this.hists[0]})),this.ex.show(new h({collection:this.hists[1]})),this.rbsx.show(new h({collection:this.hists[2]})),this.rbsy.show(new h({collection:this.hists[3]}))},updateFilter:function(t){this.beamlines.queryParams.ty=t,this.sessiontypes.queryParams.ty=t,"yearly"==t?(this.beamlines.queryParams.runid=null,this.sessiontypes.queryParams.runid=null):(this.beamlines.queryParams.runid=this.ui.run.val(),this.sessiontypes.queryParams.runid=this.ui.run.val()),this.proposal.fetch(),this.sessiontypes.fetch()},updateFilter2:function(t){this.collection.queryParams.proposalcode=t,this.proposals.queryParams.proposalcode=t,this.sessiontypes.queryParams.proposalcode=t,this.collection.fetch(),this.proposals.fetch(),this.sessiontypes.fetch()},showFilter2:function(){this.ty2=new a({url:!1,collection:this.collection,name:"proposalcode",filters:this.types.map((function(t){return{id:t.get("PROPOSALCODE"),name:t.get("PROPOSALCODE")}}))}),this.listenTo(this.ty2,"selected:change",this.updateFilter2,this),this.type2.show(this.ty2)},popuateRuns:function(){this.ui.run.html(this.runs.opts());var t=this.runs.first();this.ui.run.val(t.get("RUNID")),this.changeRun()},showFilter:function(){this.ty=new a({url:!1,collection:this.collection,name:"ty",filters:[{id:"yearly",name:"Yearly"},{id:"monthly",name:"Monthly"},{id:"weekly",name:"Weekly"}]}),this.listenTo(this.ty,"selected:change",this.updateFilter,this),this.type.show(this.ty)},onShow:function(){this.table.focusSearch()}})}.apply(e,a))||(t.exports=l)}).call(this,i(5),i(8))},1153:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="filter filter-nohide">\n    <ul class="clearfix">\n        <li title="View BAG Overview"><a href="/stats/overview">BAGs</a></li>\n        <li title="View Beamlines Overview"><a href="/stats/overview/beamlines">Beamlines</a></li>\n        <li title="View Beamlines Run Overview"><a href="/stats/bl/'+(null==(__t=BL)?"":_.escape(__t))+'">Beamline Run Overview</a></li>\n    </ul>\n</div>\n\n\n<h1>'+(null==(__t=BL)?"":_.escape(__t))+' Overview</h1>\n\n<p class="help">This page shows beamline overview statistics for the all time</p>\n\n<div class="filter">\n    <ul>\n        <li><label><input type="checkbox" name="scheduled" /> Scheduled Visits Only</label></li>\n    </ul> (Exclude vmxi, lb, and other long running visits)\n</div>\n\n<div class="filter type2"></div>\n<div class="plot_container"><div id="avg_time"></div></div>\n<div class="wrapper"></div>\n<a href="#" class="button download"><i class="fa fa-download"></i> Download</a>\n\n<h1>Histograms</h1>\n<div class="plot_wrap clearfix">\n    <div class="plot_container left en"></div>\n    <div class="plot_container right exp"></div>\n</div>\n\n<div class="plot_wrap clearfix">\n    <div class="plot_container left bsx"></div>\n    <div class="plot_container right bsy"></div>\n</div>\n\n<h1>Per Run Breakdown</h1>\n\n<div class="filter">\n    <ul>\n        <li>Run: <select name="runid"></select></li>\n    </ul>\n</div>\n\n<div class="filter type"></div>\n\n<h1>Proposals</h1>\n<div class="wrapper2"></div>\n\n<h1>Session Types</h1>\n<div class="wrapper3"></div>\n';return __p}},1154:function(t,e,i){(function(s){var n,a;n=[i(7),i(6),i(98),i(99),i(100),i(237),i(118),i(180),i(278),i(457),i(456),i(182),i(279),i(1155)],void 0===(a=function(t,e,i,n,a,l,o,r,c,h,d,p,u,f){return t.LayoutView.extend({template:f,className:"content",regions:{bd:".breakdown",flt:".faults",rbt:".roboterrors",en:".en",rbsx:".bsx",rbsy:".bsy",ex:".exp"},ui:{rbd:".dewar",run:"select[name=runid]",all:"input[name=all]"},events:{"change @ui.run":"changeRun","change @ui.all":"changeRun"},templateHelpers:function(){return{BL:this.getOption("bl")}},initialize:function(t){this.breakdown=new l,this.faults=new n(null,{queryParams:{bl:t.bl}}),this.roboterrors=new r(null,{queryParams:{bl:t.bl}}),this.henergy=new p,this.bsx=new p,this.bsy=new p,this.exp=new p,this.rdewar=new h,this.runs=new i,this.ready=this.runs.fetch()},populateRuns:function(){this.ui.run.html(this.runs.opts());var t=this.getOption("params"),e=t.run?t.run:this.runs.first().get("RUNID");this.ui.run.val(e),this.changeRun()},changeRun:function(){if(!this.first){var t=window.location.pathname.replace(new RegExp("\\/run\\/(\\d)+"),"")+"/run/"+this.ui.run.val();window.history.pushState({},"",t)}this.first=!1,this.ui.run.val(),this.breakdown.fetch({data:{bl:this.getOption("bl"),runid:this.ui.run.val()}}),this.henergy.fetch({data:{bl:this.ui.all.is(":checked")?null:this.getOption("bl"),runid:this.ui.run.val()}}),this.bsx.fetch({data:{bl:this.ui.all.is(":checked")?null:this.getOption("bl"),runid:this.ui.run.val(),ty:"beamsizex"}}),this.bsy.fetch({data:{bl:this.ui.all.is(":checked")?null:this.getOption("bl"),runid:this.ui.run.val(),ty:"beamsizey"}}),this.exp.fetch({data:{bl:this.ui.all.is(":checked")?null:this.getOption("bl"),runid:this.ui.run.val(),ty:"exposuretime"}}),this.rdewar.fetch({data:{bl:this.getOption("bl"),run:this.ui.run.val()}}),this.faults.queryParams.runid=this.ui.run.val(),this.roboterrors.queryParams.runid=this.ui.run.val(),this.faults.fetch(),this.roboterrors.fetch()},onRender:function(){this.first=!0,s.when(this.ready).done(this.populateRuns.bind(this))},onShow:function(){this.bd.show(new o({large:!0,model:this.breakdown,params:this.getOption("params")})),this.en.show(new u({collection:new e.Collection([this.henergy])})),this.ex.show(new u({collection:new e.Collection([this.exp])})),this.rbsx.show(new u({collection:new e.Collection([this.bsx])})),this.rbsy.show(new u({collection:new e.Collection([this.bsy])})),this.flt.show(new a({collection:this.faults,filters:!1,search:!1})),this.rbt.show(new c({collection:this.roboterrors})),this.profile=new d({el:this.ui.rbd,model:this.rdewar})}})}.apply(e,n))||(t.exports=a)}).call(this,i(8))},1155:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="        <h1>Run Breakdown for "+(null==(__t=BL)?"":_.escape(__t))+'</h1>\n\n        <p class="help">This page shows statistics for the selected beamline. The plots below show each action and when they happened. Drag to zoom in on the plot. Click the refresh icon to reset the zoom level</p>\n\n        <div class="filter filter-nohide">\n            <ul>\n                <li>Run: <select name="runid"></select></li>\n            </ul>\n        </div>\n        <div class="filter type"></div>\n        <div class="breakdown"></div>\n\n        <h1>Robot Dewar Usage</h1>\n        <div class="plot_container">\n            <div class="dewar" id="avg_time"></div>\n        </div>\n        <div class="roboterrors"></div>\n        <div class="faults"></div>\n\n        <h1>Histograms</h1>\n        <label><input type="checkbox" name="all" /> Compare All Beamlines</label>\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left en"></div>\n            <div class="plot_container right exp"></div>\n        </div>\n\n        <div class="plot_wrap clearfix">\n            <div class="plot_container left bsx"></div>\n            <div class="plot_container right bsy"></div>\n        </div>\n';return __p}},1156:function(t,e,i){var s,n;s=[i(7),i(1157)],void 0===(n=function(t,e){var i={title:"Usage Stats",url:"/ustats"};return{stats:function(t,s){app.bc.reset([i]),app.content.show(new e({type:t,subtype:s}))}}}.apply(e,s))||(t.exports=n)},1157:function(t,e,i){(function(s){var n,a;n=[i(7),i(31),i(1158),i(1161),i(1163),i(1165),i(1167),i(1169),i(1175)],void 0===(a=function(t,e,i,n,a,l,o,r,c){return t.LayoutView.extend({template:s.template('<div class="filter filter-nohide"></div><div class="wrapper"></div>'),regions:{types:".filter",cont:".wrapper"},onRender:function(){this.typeselector=new e({filters:[{id:"robot",name:"Robot Stats"},{id:"lgon",name:"Logon Stats"},{id:"online",name:"Online Stats"},{id:"bl",name:"Beamline Stats"},{id:"pl",name:"Pipeline Stats"},{id:"pdb",name:"PDB Stats"},{id:"pc",name:"Reprocessing Stats"}],value:this.getOption("type")||"lgon",urlFragment:"statistics"}),this.listenTo(this.typeselector,"selected:change",this.switchType,this),this.types.show(this.typeselector),this.switchType(this.getOption("type")||"lgon")},switchType:function(t){console.log("swtuch",t);var e={lgon:n,online:i,bl:a,pl:l,robot:r,pdb:c,pc:o};e[t]&&this.cont.show(new e[t]({type:this.getOption("subtype")}))}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1158:function(t,e,i){(function(s){var n,a;n=[i(7),i(12),i(1159),i(1160),i(15)],void 0===(a=function(t,e,i,n,a){return t.LayoutView.extend({className:"content",template:s.template('<h1>Online Users</h1><div class="users"></div><div class="activity"></div>'),regions:{onl:".users",act:".activity"},initialize:function(){this.last=new n,this.last.fetch(),this.online=new i,this.online.fetch()},onRender:function(){var t=[{name:"NAME",label:"User",cell:"string",editable:!1},{label:"Location",cell:a.TemplateCell,editable:!1,template:"<a href=\"<%-COMMENTS.replace('ISPyB2: ', '')%>\"><%-COMMENTS%></a>"},{name:"TIME",label:"Time",cell:"string",editable:!1}];this.onl.show(new e({collection:this.online,columns:t,search:!1,tableClass:"users",pages:!0,backgrid:{emptyText:"No users online"}})),this.act.show(new e({collection:this.last,columns:t,search:!1,tableClass:"activity"}))},onDestroy:function(){this.online.stop()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1159:function(t,e,i){var s,n;s=[i(10),i(458)],void 0===(n=function(t,e){return t.extend({model:e,mode:"client",url:"/stats/online",initialize:function(t){this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},poll:function(){clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),5e3))}})}.apply(e,s))||(t.exports=n)},1160:function(t,e,i){var s,n;s=[i(10),i(458)],void 0===(n=function(t,e){return t.extend({model:e,mode:"client",url:"/stats/last"})}.apply(e,s))||(t.exports=n)},1161:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(31),i(1162)],void 0===(l=function(t,e,i){return t.LayoutView.extend({className:"content",template:s.template('<h1>Logon Statistics</h1><div class="filter types"></div><div class="plot_wrap"><div class="plot_container"><div id="logon"></div><p>Logons per <span class="type"></span></p></div></div>'),regions:{types:".types"},ui:{type:"span.type",plot:"#logon"},initialize:function(t){this.plot=null,this.logons=new i,this.listenTo(this.logons,"sync",this.plotLogons,this),this.typeselector=new e({filters:[{id:"hour",name:"Hour"},{id:"wd",name:"Week Day"},{id:"md",name:"Month Day"},{id:"week",name:"Week"}],url:!1}),this.listenTo(this.typeselector,"selected:change",this.switchType,this)},onRender:function(){console.log("render logon"),this.types.show(this.typeselector),this.switchType("hour")},switchType:function(t,e){this.ui.plot.parent().addClass("loading"),this.logons.set({type:t}).fetch(),this.ui.type.text(e)},plotLogons:function(){if(this.logons.get("data")){var t={series:{bars:{show:!0,barWidth:.9,align:"center"}},grid:{hoverable:!0,borderWidth:0},xaxis:{tickDecimals:0},yaxis:{tickDecimals:0}};"wd"==this.logons.get("type")&&(t.xaxis.ticks=[[0,"Mon"],[1,"Tue"],[2,"Wed"],[3,"Thu"],[4,"Fri"],[5,"Sat"],[6,"Sun"]]),this.plot=n.plot(this.ui.plot,this.logons.get("data"),t),this.ui.plot.parent().removeClass("loading")}},onDestroy:function(){console.log("destroying logon view"),this.plot&&this.plot.destroy()}})}.apply(e,a))||(t.exports=l)}).call(this,i(5),i(8))},1162:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"type",urlRoot:"/stats/logon",parse:function(t){return{data:t}}})}.apply(e,s))||(t.exports=n)},1163:function(t,e,i){(function(s){var n,a;n=[i(7),i(6),i(31),i(1164),i(11),i(8),i(23),i(74),i(124)],void 0===(a=function(t,e,i,n,a,l){var o=t.ItemView.extend({tagName:"li",template:s.template('<label><input type="checkbox" name="<%-name%>" checked="checked" /> <%-name%><label>'),events:{"change input":"setStatus"},setStatus:function(t){this.model.set({show:this.$el.find("input").is(":checked")})}}),r=t.CollectionView.extend({tagName:"ul",className:"series",childView:o});return t.LayoutView.extend({className:"content",template:s.template('<h1>Beamline Statistics</h1><div class="filter filter-nohide types"></div><div class="filter filter-nohide series"></div><div class="plot_wrap"><div class="plot_container"><div id="logon"></div><p class="plot_title"></p></div></div><a href="#" class="button download"><i class="fa fa-download"></i> Download</a>'),regions:{types:".types",srs:".series",cont:".wrapper"},ui:{title:".plot_title",plot:"#logon"},events:{"click a.download":"downloadData"},initialize:function(t){this.stats=new n,this.listenTo(this.stats,"sync",this.processData,this),this.series=new e.Collection,this.listenTo(this.series,"reset change",this.plotStats,this)},onRender:function(){this.typeselector=new i({filters:[{id:"dc",name:"Data Collections"},{id:"fc",name:"Full Data Collections"},{id:"sc",name:"Screenings"},{id:"im",name:"Images Collected"},{id:"smp",name:"Samples Loaded"},{id:"dct",name:"Data Collection Times"},{id:"dl",name:"Daily Usage"}],url:!1}),this.listenTo(this.typeselector,"selected:change",this.switchType,this),this.types.show(this.typeselector),this.srs.show(new r({collection:this.series}))},onShow:function(){this.switchType(this.getOption("type")||"dc")},switchType:function(t){this.ui.plot.addClass("loading"),this.stats.set({type:t}).fetch()},downloadData:function(t){t.preventDefault();var e=app.apiurl+this.stats.url()+"?download=1";a.sign({url:e,callback:function(t){window.location=e+"&token="+t.token}})},processData:function(){this.series.reset(s.map(this.stats.get("data"),(function(t,e){return{name:e,show:!0}}))),this.plotStats()},plotStats:function(){if(this.stats.get("data")){var t=[];s.each(this.stats.get("data"),(function(e,i){1==this.series.findWhere({name:i}).get("show")&&s.each(e,(function(e,s){var n={label:i,data:e.data,yaxis:s+1};n[e.series]={show:!0},t.push(n)}))}),this);var e={axisLabels:{show:!0},series:{bars:{barWidth:.09,align:"center"}},grid:{hoverable:!0,borderWidth:0},tooltip:!0,tooltipOpts:{content:"%s: %y.2"},xaxis:{rotateTicks:45},yaxes:[{},{position:"right",transform:function(t){return-t}}],xaxes:[{}]};e.xaxis.ticks=this.stats.get("ticks"),e.xaxes[0].axisLabel=this.stats.get("xaxis"),e.yaxes[0].axisLabel=this.stats.get("yaxis"),l.plot(this.ui.plot,t,e),this.ui.title.text(this.stats.get("title")),this.ui.plot.removeClass("loading")}}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1164:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"type",urlRoot:"/stats/bl"})}.apply(e,s))||(t.exports=n)},1165:function(t,e,i){(function(s){var n,a;n=[i(7),i(6),i(31),i(1166),i(11),i(8),i(23),i(74),i(124)],void 0===(a=function(t,e,i,n,a,l){var o=t.ItemView.extend({tagName:"li",template:s.template('<label><input type="checkbox" name="<%-name%>" checked="checked" /> <%-name%><label>'),events:{"change input":"setStatus"},setStatus:function(t){this.model.set({show:this.$el.find("input").is(":checked")})}}),r=t.CollectionView.extend({tagName:"ul",className:"series",childView:o});return t.LayoutView.extend({className:"content",template:s.template('<h1>Auto Processing Statistics</h1><div class="filter types"></div><div class="filter series"></div><div class="plot_wrap"><div class="plot_container"><div id="logon"></div><p class="plot_title"></p></div></div><a href="#" class="button download"><i class="fa fa-download"></i> Download</a>'),regions:{types:".types",srs:".series",cont:".wrapper"},ui:{title:".plot_title",plot:"#logon"},events:{"click a.download":"downloadData"},downloadData:function(t){t.preventDefault();var e=app.apiurl+this.stats.url()+"?download=1";a.sign({url:e,callback:function(t){window.location=e+"&token="+t.token}})},initialize:function(t){this.stats=new n,this.listenTo(this.stats,"sync",this.processData,this),this.series=new e.Collection,this.listenTo(this.series,"reset change",this.plotStats,this)},onRender:function(){this.typeselector=new i({filters:[{id:"ai",name:"Auto Indexing"},{id:"ap",name:"Auto Processing"}]}),this.listenTo(this.typeselector,"selected:change",this.switchType,this),this.types.show(this.typeselector),this.srs.show(new r({collection:this.series}))},onShow:function(){this.switchType(this.getOption("type")||"ai")},switchType:function(t){this.ui.plot.addClass("loading"),this.stats.set({type:t}).fetch()},processData:function(){this.series.reset(s.map(this.stats.get("data"),(function(t,e){return{name:e,show:!0}}))),this.plotStats()},plotStats:function(){if(this.stats.get("data")){var t=[];s.each(this.stats.get("data"),(function(e,i){1==this.series.findWhere({name:i}).get("show")&&s.each(e,(function(e,s){var n={label:i,data:e.data,yaxis:s+1};n[e.series]={show:!0},t.push(n)}))}),this);var e={axisLabels:{show:!0},series:{bars:{barWidth:.09,align:"center"}},grid:{hoverable:!0,borderWidth:0},tooltip:!0,tooltipOpts:{content:"%s: %y.2"},xaxis:{rotateTicks:45},yaxes:[{},{position:"right",transform:function(t){return-t}}],xaxes:[{}]};e.xaxis.ticks=this.stats.get("ticks"),e.xaxes[0].axisLabel=this.stats.get("xaxis"),e.yaxes[0].axisLabel=this.stats.get("yaxis"),l.plot(this.ui.plot,t,e),this.ui.title.text(this.stats.get("title")),this.ui.plot.removeClass("loading")}}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1166:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"type",urlRoot:"/stats/pl"})}.apply(e,s))||(t.exports=n)},1167:function(t,e,i){(function(s){var n,a;n=[i(7),i(1168),i(11),i(8),i(23),i(74),i(124)],void 0===(a=function(t,e,i,n){return t.LayoutView.extend({className:"content",template:s.template('<h1>Reprocessing Statistics</h1><div class="plot_wrap"><div class="plot_container"><div id="logon"></div><p class="plot_title"></p></div></div><a href="#" class="button download"><i class="fa fa-download"></i> Download</a>'),regions:{cont:".wrapper"},ui:{title:".plot_title",plot:"#logon"},events:{"click a.download":"downloadData"},downloadData:function(t){t.preventDefault();var e=app.apiurl+this.stats.url()+"?download=1";i.sign({url:e,callback:function(t){window.location=e+"&token="+t.token}})},initialize:function(t){this.stats=new e,this.stats.fetch()},onRender:function(){this.listenTo(this.stats,"sync",this.plotStats,this)},onShow:function(){this.plotStats()},plotStats:function(){if(this.stats.get("data")){var t=[];s.each(this.stats.get("data"),(function(e,i){s.each(e,(function(e,i){var s={label:0==i?" Jobs":" Time (min)",data:e.data,yaxis:i+1};1==i&&(e.series="lines"),s[e.series]={show:!0},t.push(s)}))}),this);var e={axisLabels:{show:!0},series:{bars:{align:"center"}},grid:{hoverable:!0,borderWidth:0},tooltip:!0,tooltipOpts:{content:"%s: %y"},xaxis:{rotateTicks:45},yaxes:[{},{position:"right"}],xaxes:[{}]};e.xaxis.ticks=this.stats.get("ticks"),e.xaxes[0].axisLabel=this.stats.get("xaxis"),e.yaxes[0].axisLabel=this.stats.get("yaxis"),n.plot(this.ui.plot,t,e),this.ui.title.text(this.stats.get("title")),this.ui.plot.removeClass("loading")}}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1168:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"type",urlRoot:"/stats/pc"})}.apply(e,s))||(t.exports=n)},1169:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(1170),i(180),i(1172),i(278),i(1173),i(1174),i(11)],void 0===(l=function(t,e,i,a,l,o,r,c){return t.LayoutView.extend({className:"content",template:s.template('<h1>Robot Averages</h1><div class="plot_container"><div id="avg_time"></div></div><a href="#" class="button download"><i class="fa fa-download"></i> Download</a><div class="wrapper"></div><h1>Totals</h1><div class="plot_container"><div id="tots" style="height:250px"></div></div><div class="totals"></div>'),regions:{wrap:".wrapper",tot:".totals"},ui:{plot:"#avg_time",tot:"#tots"},events:{"click .legend table tr":"filterBL","plotclick #avg_time":"filterRun","click a.download":"downloadData"},downloadData:function(t){t.preventDefault();var e=app.apiurl+"/robot/averages?download=1";c.sign({url:e,callback:function(t){window.location=e+"&token="+t.token}})},filterRun:function(t,e,i){var s=i.datapoint[0],n=i.series.xaxis.ticks[s].label,a=this.plot.getrids()[n];this.roboterrors.queryParams.bl=i.series.label,this.roboterrors.fetch(),this.robottotals.queryParams.bl=i.series.label,this.robottotals.queryParams.run=a,this.robottotals.fetch()},filterBL:function(t){var e=n(t.currentTarget).children("td.legendLabel").html();console.log(e,t),this.roboterrors.queryParams.bl=e,this.roboterrors.fetch(),this.robottotals.queryParams.bl=e,this.robottotals.fetch()},initialize:function(t){this.roboterrors=new i,this.roboterrors.fetch(),this.robottotals=new a,this.robottotals.fetch()},onShow:function(){this.plot=new e({el:this.ui.plot}),this.wrap.show(new l({collection:this.roboterrors})),this.plot2=new r({el:this.ui.tot,collection:this.robottotals}),this.plot2.render(),this.tot.show(new o({collection:this.robottotals}))}})}.apply(e,a))||(t.exports=l)}).call(this,i(5),i(8))},1170:function(t,e,i){(function(s){var n,a;n=[i(7),i(1171),i(8),i(23)],void 0===(a=function(t,e,i){return t.LayoutView.extend({template:!1,modelEvents:{change:"render"},initialize:function(t){this.plot=null,this.$el.parent().addClass("loading"),this.model=new e,this.model.fetch()},onRender:function(){if(this.model.get("data")){var t={series:{lines:{show:!0},points:{show:!0}},xaxis:{ticks:this.model.get("ticks")},grid:{borderWidth:0,hoverable:!0,clickable:!0},tooltip:!0,tooltipOpts:{content:this.getToolTip.bind(this)}},e=[];s.each(this.model.get("data"),(function(t,i){e.push({data:t,label:i})})),this.plot=i.plot(this.$el,e,t),this.$el.parent().removeClass("loading")}},getToolTip:function(t,e,i,s){return s.datapoint[1]+"s"},getrids:function(){return this.model.get("rids")},onDestroy:function(){this.plot&&this.plot.destroy()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1171:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:"/robot/averages"})}.apply(e,s))||(t.exports=n)},1172:function(t,e,i){var s,n;s=[i(5),i(6),i(10)],void 0===(n=function(t,e,i){var s=e.Model.extend({idAttribute:"VIS"});return i.extend({model:s,mode:"server",url:"/robot/totals",state:{pageSize:15},parseState:function(t,e,i,s){return{totalRecords:t[1]}},parseRecords:function(t,e){return this.totals=t[0],t[2].push(t[0]),t[2]}})}.apply(e,s))||(t.exports=n)},1173:function(t,e,i){(function(s){var n,a;n=[i(7),i(12),i(15)],void 0===(a=function(t,e,i){return t.LayoutView.extend({className:"content",template:s.template('<div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(t){var n=[{name:"ST",label:"Time",cell:"string",editable:!1},{name:"BL",label:"Beamline",cell:"string",editable:!1},{label:"Visit",cell:i.TemplateCell,editable:!1,template:'<a href="/stats/visit/<%-VIS%>"><%-VIS%></a>'},{name:"NUM",label:"Actions",cell:"string",editable:!1},{name:"SUCCESS",label:"Success",cell:"string",editable:!1},{name:"AVGT",label:"Avg Time",cell:"string",editable:!1},{name:"ERROR",label:"Errors",cell:"string",editable:!1},{name:"CRITICAL",label:"Critical",cell:"string",editable:!1},{name:"WARNING",label:"Warning",cell:"string",editable:!1},{name:"EPICSFAIL",label:"Epics",cell:"string",editable:!1},{name:"COMMANDNOTSENT",label:"Not Sent",cell:"string",editable:!1}];app.mobile()&&s.each([6,7,8,9,10],(function(t){n[t].renderable=!1})),this.table=new e({collection:t.collection,columns:n,tableClass:"robot_actions",filter:"s",loading:!0,backgrid:{emptyText:"No robot errors recorded"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1174:function(t,e,i){var s,n;s=[i(7),i(8),i(23)],void 0===(n=function(t,e){return t.LayoutView.extend({template:!1,collectionEvents:{sync:"render"},initialize:function(t){this.plot=null,this.$el.parent().addClass("loading")},onRender:function(){if(console.log("rendering tplot",this.collection),this.collection.length){var t=[],i=[];this.collection.each((function(e,s){"TOTAL"!=e.get("VIS")&&(i.push([this.collection.length-s,parseFloat(e.get("AVGT"))]),t.push([this.collection.length-s,e.get("VIS")]))}),this);var s={series:{lines:{show:!0},points:{show:!0}},xaxis:{ticks:t},grid:{borderWidth:0,hoverable:!0,clickable:!0},tooltip:!0,tooltipOpts:{content:this.getToolTip.bind(this)}};this.plot=e.plot(this.$el,[i],s),this.$el.parent().removeClass("loading")}},getToolTip:function(t,e,i,s){return s.datapoint[1]+"s"},onDestroy:function(){this.plot&&this.plot.destroy()}})}.apply(e,s))||(t.exports=n)},1175:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(6),i(1176),i(1177),i(1178),i(1179),i(1180),i(1181),i(1182),i(1183),i(1184),i(31),i(12),i(15),i(11),i(1185)],void 0===(l=function(t,e,i,a,l,o,r,c,h,d,p,u,f,v,m,b){return t.LayoutView.extend({template:b,className:"content",regions:{ana:".analysed",ty:".ty"},events:{"click @ui.proc":"processPDBs","click @ui.upd":"updateAPP","change @ui.dist":"updateDiff","click a.download":"downloadData"},ui:{tol:"input[name=tol]",proc:"a.process",state:".processing",app:"#aps",apb:"#apstats",dist:"input[name=dist]",upd:"a.update",sta:"#visit_pie",bl:"#pdbs",bl2:"#pdbs2",cd:".celldiff"},updateDiff:function(t){this.ui.cd.text(Math.sqrt(Math.pow(this.ui.dist.val(),2)/3).toFixed(2)),this.autoproc.fetch()},updateAPP:function(t){t.preventDefault(),this.autoproc.fetch()},downloadData:function(t){t.preventDefault();var e=app.apiurl+this.autoproc.url()+"&download=1";m.sign({url:e,callback:function(t){window.location=e+"&token="+t.token}})},initialize:function(t){this.updateDiff=s.debounce(this.updateDiff,100),this.analysed=new a,this.analysed.fetch(),this.types=new u({url:!1,collection:this.analysed,name:"t",filters:[{id:"match",name:"Matched"},{id:"mismatch",name:"Mismatch"},{id:"noresults",name:"No Results"},{id:"nomatch",name:"No Match"}]});var e=[{name:"CODE",label:"Code",cell:"string",editable:!1},{name:"PDBDATE",label:"Release Date",cell:"string",editable:!1},{name:"PDBBEAMLINENAMESTRIPPED",label:"PDB Bl",cell:"string",editable:!1},{name:"BEAMLINEMATCHTEXT",label:"Bl Match",cell:"string",editable:!1},{name:"AUTHORMATCHTEXT",label:"Author Match",cell:"string",editable:!1},{label:"Nearest",cell:v.TemplateCell,editable:!1,test:"BEAMLINENAME",template:"<%-BEAMLINENAME%> (<%-DISTANCE%>)"},{name:"BEAMLINES",label:"Beamlines",cell:"string",editable:!1},{name:"AUTOPROCCOUNT",label:"Integrations",cell:"string",editable:!1},{name:"STATUS",label:"Status",cell:"string",editable:!1},{label:"",cell:v.TemplateCell,editable:!1,template:'<a href="/cell/pdb/<%-CODE%>" class="button"><i class="fa fa-search"></i></a> <a class="button" href="http://www.rcsb.org/pdb/explore/explore.do?structureId=<%-CODE%>"><i class="fa fa-external-link"></i></a>'}];app.mobile()&&s.each([3,4,5,6,8],(function(t){e[t].renderable=!1})),this.anatable=new f({collection:this.analysed,columns:e,tableClass:"analysed",filter:"s",noPageUrl:!0,noSearchUrl:!0,loading:!0,backgrid:{emptyText:"No analysed PDBs found"}});var i=this;this.autoproc=new l,this.autoproc.dist=function(){return i.ui.dist.val()},this.states=new c,this.states.fetch(),this.beamlines=new d,this.beamlines.fetch()},onRender:function(){this.ana.show(this.anatable),this.ty.show(this.types),this.updateDiff(),this.app=new o({model:this.autoproc,el:this.ui.app}),this.apb=new r({model:this.autoproc,el:this.ui.apb}),this.sta=new h({model:this.states,el:this.ui.sta}),this.bls=new p({model:this.beamlines,el:this.ui.bl,second:!0}),this.bls2=new p({model:this.beamlines,el:this.ui.bl2})},processPDBs:function(t){t.preventDefault(),this.ui.proc.hide(),this.counts={success:0,fail:0},e.ajax({url:app.apiurl+"/cell/rcsb",success:this.getProcessedPDBs.bind(this)})},getProcessedPDBs:function(t){this.pdbs=t.split("\n"),this.processed=new i,this.processed.fetch({success:this.doProcessPDBs.bind(this)})},doProcessPDBs:function(){this.toprocess=s.difference(this.pdbs,this.processed.pluck("CODE")).reverse().slice(1),console.log(this.toprocess.length,this.pdbs.length,this.toprocess[0]),this.processPDB(0)},processPDB:function(t){if(t>this.toprocess.length)this.ui.proc.show();else{this.ui.state.text(t+"/"+this.toprocess.length+" PDB files processed, "+this.counts.success+" successful, "+this.counts.fail+" failures");var i=this.toprocess[t],a=this;e.ajax({url:app.apiurl+"/cell/pdb?pdb="+i,type:"GET",dataType:"xml",timeout:5e3,success:function(l){var o={pdb:i};n(l).find("record").each((function(t,e){s.each({a:"lengthOfUnitCellLatticeA",b:"lengthOfUnitCellLatticeB",c:"lengthOfUnitCellLatticeC",al:"unitCellAngleAlpha",be:"unitCellAngleBeta",ga:"unitCellAngleGamma"},(function(t,i){o[i]=n(e).find("dimStructure\\."+t).text()})),o.title=n(e).find("dimStructure\\.structureTitle").text(),o.res=1.25*n(e).find("dimStructure\\.resolution").text(),"null"!=n(e).find("dimStructure\\.diffractionSource").text()&&(o.bl=n(e).find("dimStructure\\.diffractionSource").text()),"null"!=n(e).find("dimStructure\\.structureAuthor").text()&&(o.author=n(e).find("dimStructure\\.structureAuthor").text()),o.year=n(e).find("dimStructure\\.releaseDate").text()})),e.ajax({url:app.apiurl+"/cell/process",type:"POST",data:o,success:function(e){a.counts.success++,a.processPDB(t+1)},error:function(e,i,s){console.log(e,i,s),a.counts.fail++,a.processPDB(t+1)}})}})}}})}.apply(e,a))||(t.exports=l)}).call(this,i(5),i(8))},1176:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Collection.extend({url:"/cell/pdbs"})}.apply(e,s))||(t.exports=n)},1177:function(t,e,i){var s,n;s=[i(6),i(10)],void 0===(n=function(t,e){var i=t.Model.extend({idAttribute:"PDBENTRYID",initialize:function(t){this.on("change",this.addState,this),this.addState()},addState:function(){var t="";0==this.get("AUTOPROCCOUNT")&&(t="No Results"),this.get("AUTOPROCCOUNT")>0&&1!=this.get("BEAMLINEMATCH")&&(t="No Match"),this.get("AUTOPROCCOUNT")>0&&1!=this.get("BEAMLINEMATCH")&&1==this.get("AUTHORMATCH")&&(t="Mismatch"),1==this.get("BEAMLINEMATCH")&&(t="Matched"),this.get("DISTANCE")&&this.set("DISTANCE",parseFloat(this.get("DISTANCE")).toFixed(1)),this.set("STATUS",t),this.set("BEAMLINEMATCHTEXT",1==this.get("BEAMLINEMATCH")?"Yes":"No"),this.set("AUTHORMATCHTEXT",1==this.get("AUTHORMATCH")?"Yes":"No"),this.set("PDBBEAMLINENAMESTRIPPED",this.get("PDBBEAMLINENAME").replace(/DIAMOND BEAMLINE /,""))}});return e.extend({model:i,mode:"server",url:"/cell/analysed",state:{pageSize:15},queryParams:{pageSize:"pp"},parseState:function(t,e,i,s){return{totalRecords:parseInt(t[0])}},parseRecords:function(t,e){return t[1]}})}.apply(e,s))||(t.exports=n)},1178:function(t,e,i){(function(s){var n,a;n=[i(6)],void 0===(a=function(t){return t.Model.extend({urlRoot:function(){return"/cell/ap"+(this.dist?"?dist="+s.result(this,"dist"):"")},parse:function(t,e){return{tot:t[0],data:t[1]}}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1179:function(t,e,i){var s,n;s=[i(7),i(11),i(8),i(23),i(276)],void 0===(n=function(t,e,i){return t.ItemView.extend({template:!1,modelEvents:{change:"render"},onRender:function(){if(this.model.get("tot")){var t={series:{pie:{show:!0,radius:1,label:{show:!0,radius:.66666,formatter:e.labelFormatterNo}}},legend:{show:!1}},s=[{data:this.model.get("tot").AP,label:"Auto Processed"},{data:this.model.get("tot").MAN,label:"Manual"}];this.plot=i.plot(this.$el,s,t),this.$el.css("opacity",1)}},onDestroy:function(){this.plot&&this.plot.shutdown()}})}.apply(e,s))||(t.exports=n)},1180:function(t,e,i){(function(s){var n,a;n=[i(7),i(11),i(8),i(23),i(150)],void 0===(a=function(t,e,i){return t.ItemView.extend({template:!1,modelEvents:{change:"render"},onRender:function(){if(this.model.get("data")){var t=[],e=[{data:[],label:"Auto Processed"},{data:[],label:"Manual"}];s.each(this.model.get("data"),(function(i,s){t.push([s,i.YEAR]),e[0].data.push([s,i.AP]),e[1].data.push([s,i.MAN])}));var n={series:{bars:{show:!0,barWidth:.9,align:"center"},stack:!0},grid:{hoverable:!0,borderWidth:0},xaxis:{ticks:t}};this.plot=i.plot(this.$el,e,n),this.$el.css("opacity",1)}},onDestroy:function(){this.plot&&this.plot.shutdown()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1181:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:function(){return"/cell/state"},parse:function(t,e){return{data:t}}})}.apply(e,s))||(t.exports=n)},1182:function(t,e,i){(function(s){var n,a;n=[i(7),i(11),i(8),i(23),i(276)],void 0===(a=function(t,e,i){return t.ItemView.extend({template:!1,modelEvents:{change:"render"},onRender:function(){if(this.model.get("data")){var t={series:{pie:{show:!0,radius:1,label:{show:!0,radius:.66666,formatter:e.labelFormatterNo}}},legend:{show:!1}},n=[];s.each(this.model.get("data"),(function(t,e){n.push({label:e,data:t})})),this.plot=i.plot(this.$el,n,t),this.$el.css("opacity",1)}},onDestroy:function(){this.plot&&this.plot.shutdown()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1183:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:function(){return"/cell/bl"},parse:function(t,e){return{data:t}}})}.apply(e,s))||(t.exports=n)},1184:function(t,e,i){(function(s){var n,a;n=[i(7),i(11),i(8),i(23),i(150)],void 0===(a=function(t,e,i){return t.ItemView.extend({template:!1,modelEvents:{change:"render"},onRender:function(){if(this.model.get("data")){var t=this.getOption("second")?1:0,e=[],n={},a={};s.each(this.model.get("data")[t],(function(t,e){n[t.YEAR]=1,a[t.BL]=1}));var l=[],o=[];s.each(n,(function(t,e){o.push(e),l.push({label:e,data:[]})}));var r=[];function c(t,e){return t[0]==e[0]?0:t[0]<e[0]?-1:1}s.each(a,(function(t,i){r.push(i),e.push([r.length-1,i])})),s.each(this.model.get("data")[t],(function(t,e){var i=o.indexOf(t.YEAR),s=r.indexOf(t.BL);l[i].data.push([s,t.COUNT])})),s.each(l,(function(t,e){t.data.sort(c)})),console.log(l);var h={series:{bars:{show:!0,barWidth:.9,align:"center"},stack:!0},grid:{hoverable:!0,borderWidth:0},xaxis:{ticks:e}};this.plot=i.plot(this.$el,l,h),this.$el.css("opacity",1)}},onDestroy:function(){this.plot&&this.plot.shutdown()}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},1185:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>Data Collections for PDB Depositions</h1>\n\n    <div class="ty filter"></div>\n    <div class="analysed"></div>\n\n\n    <h1>Stats</h1>\n    <p>Results prior to 2010-05 are excluded from the calculated statistics</p>\n\n    <div class="plot_wrap clearfix">\n        <div class="plot_container left">\n            <div id="visit_pie"></div>\n            <p>Breakdown of PDB depositions</p>\n        </div>\n\n        <div class="plot_container right">\n            <div id="pdbs"></div>\n            <div id="pdbs2"></div>\n            <p>Depositions by beamline / year (Top: ISPyB, Bottom: PDB)</p>\n        </div>\n    </div>\n\n\n    <h1>Auto Processing Stats</h1>\n    <p>Results prior to 2010-05 are excluded from the calculated statistics</p>\n    Distance Cutoff: <input name="dist" value="0.2" /> (Average difference per unit cell axis: <span class="celldiff"></span>&#8491;) <a href="#" class="button update"><i class="fa fa-refresh"></i> Update</a>\n\n    <div class="plot_wrap clearfix">\n        <div class="plot_container left">\n            <div id="aps"></div>\n            <p>Breakdown of PDB depositions</p>\n        </div>\n\n        <div class="plot_container right">\n            <div id="apstats"></div>\n            <p>Depositions per year</p>\n        </div>\n    </div>\n    <a href="#" class="button download"><i class="fa fa-download"></i> Download</a>\n\n    <h1>Update</h1>\n    <div class="data_collection">\n        <a href="#" class="button process"><i class="fa fa-cog"></i> Process</a>\n        <span class="processing"></span>\n    </div>';return __p}},123:function(t,e,i){(function(s){var n,a;n=[i(6),i(72),i(79)],void 0===(a=function(t,e,i){return t.Model.extend(s.extend({},{idAttribute:"FAULTID",urlRoot:"/fault",resolvedOptions:{0:"No",1:"Yes",2:"Partial"},btlOptions:{0:"No",1:"Yes"},events:{"change sync reset":"refreshOptions"},initialize:function(){this.on("change",this.refreshOptions,this),this.refreshOptions()},defaults:{RESOLUTIONMD:"",DESCRIPTIONMD:""},refreshOptions:function(){this.attributes.RESOLVEDTEXT=this.resolvedOptions[this.get("RESOLVED")],this.attributes.BEAMTIMELOSTTEXT=this.btlOptions[this.get("BEAMTIMELOST")],this.get("DESCRIPTION")&&(this.attributes.DESCRIPTIONMD=e.toHTML(this.get("DESCRIPTION"))),this.get("RESOLUTION")&&(this.attributes.RESOLUTIONMD=e.toHTML(this.get("RESOLUTION")))},validation:{TITLE:{required:!0},STARTTIME:{required:!0,pattern:"datetime"},ENDTIME:{required:function(){return 1==this.get("RESOLVED")},pattern:"datetime"},BEAMTIMELOST_STARTTIME:{required:function(){return 1==this.get("BEAMTIMELOST")},pattern:"datetime"},BEAMTIMELOST_ENDTIME:{required:function(){return 1==this.get("BEAMTIMELOST")},pattern:"datetime"},SUBCOMPONENTID:{required:!0,pattern:"word"},BEAMTIMELOST:{required:!0,pattern:"number"},RESOLVED:{required:!0,pattern:"number"},RESOLUTION:{required:!1},DESCRIPTION:{required:!0},SESSIONID:{required:!0,pattern:"number"},ASSIGNEEID:{required:!1,pattern:"number"}}},i))}.apply(e,n))||(t.exports=a)}).call(this,i(5))},124:function(t,e,i){(function(t){var e;(e=t).plot.plugins.push({init:function(t){var i,s,n,a,l=[],o=!1;t.hooks.draw.push((function(t,r){if(o){if(0==l.length)return;var c,h,d=(w=t.getAxes().xaxis).box;for(y=0;y<l.length;y++)(_=l[y]).label&&(r.save(),r.font=i,s<=90?(c=-Math.ceil(Math.cos(a)*_.height),h=Math.ceil(Math.sin(a)*_.height)/3.14,r.translate(Math.round(t.getPlotOffset().left+w.p2c(_.v))+c,d.top+d.padding+t.getOptions().grid.labelMargin+h),r.rotate(n)):(c=Math.ceil(Math.cos(a)*_.height)-Math.ceil(Math.cos(a)*_.width),h=Math.ceil(Math.sin(a)*_.width)+Math.ceil(Math.sin(a)*_.height),r.translate(Math.round(t.getPlotOffset().left+w.p2c(_.v)+c),d.top+d.padding+t.getOptions().grid.labelMargin+h),r.rotate(-a)),r.fillText(_.label,0,0),r.restore())}else{var p=t.getAxes().xaxis.options;if(void 0===p.rotateTicks)return;if((s=parseInt(p.rotateTicks,10)).toString()!=p.rotateTicks||0==s||s>=180)return;n=s*Math.PI/180,a=s>90?Math.PI-n:Math.PI/2-n,(i=p.rotateTicksFont)||(i=e(".tickLabel").css("font")),i||(i="smaller sans-serif");var u,f,v=0,m=0,b=0,g=0,w=t.getAxes().xaxis;l=t.getAxes().xaxis.ticks,p.ticks=[];for(var y=0;y<l.length;y++){u=e('<span style="font:'+i+'">'+l[y].label+"</div>"),t.getPlaceholder().append(u),l[y].height=u.outerHeight(!0),l[y].width=u.outerWidth(!0),u.remove(),l[y].height>m&&(m=l[y].height),l[y].width>v&&(v=l[y].width);var _=l[y];s>90?(f=Math.round(t.getPlotOffset().left+w.p2c(_.v))-Math.ceil(Math.cos(a)*_.height)-Math.ceil(Math.cos(a)*_.width))<b&&(b=f):(f=Math.round(t.getPlotOffset().left+w.p2c(_.v))+Math.ceil(Math.cos(a)*_.height)+Math.ceil(Math.cos(a)*_.width))>g&&(g=f)}if(s>90){var x=n-Math.PI/2;p.labelHeight=Math.ceil(Math.sin(x)*v)+Math.ceil(Math.sin(x)*m)}else x=Math.PI/2-n,p.labelHeight=Math.ceil(Math.sin(n)*v)+Math.ceil(Math.sin(x)*m);b<0&&(t.getAxes().yaxis.options.labelWidth=-1*b),o=!0,t.setupGrid(),t.draw()}}))},options:{},name:"tickRotor",version:"1.0"})}).call(this,i(8))},175:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:"/fault/sys",idAttribute:"SYSTEMID",defaults:{NAME:"",DESCRIPTION:"",BEAMLINES:""},initialize:function(t){this.on("change",this._add_id,this),this._add_id()},_add_id:function(){this.attributes.ID=this.get("SYSTEMID")}})}.apply(e,s))||(t.exports=n)},176:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:"/fault/com",idAttribute:"COMPONENTID",defaults:{NAME:"",DESCRIPTION:"",BEAMLINES:""},initialize:function(t){this.on("change",this._add_id,this),this._add_id()},_add_id:function(){this.attributes.ID=this.get("COMPONENTID")}})}.apply(e,s))||(t.exports=n)},177:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:"/fault/scom",idAttribute:"SUBCOMPONENTID",defaults:{NAME:"",DESCRIPTION:"",BEAMLINES:""},initialize:function(t){this.on("change",this._add_id,this),this._add_id()},_add_id:function(){this.attributes.ID=this.get("SUBCOMPONENTID")}})}.apply(e,s))||(t.exports=n)},178:function(t,e,i){var s,n;s=[i(7),i(149),i(11),i(8),i(23),i(42),i(276)],void 0===(n=function(t,e,i,s){return t.ItemView.extend({template:!1,modelEvents:{change:"render"},initialize:function(t){t.model||(this.model=new e({visit:t.visit}),this.model.fetch()),this.$el.css("opactiy",0)},onRender:function(){if(this.model.get("data")){var t={series:{pie:{show:!0,radius:1,label:{show:!0,radius:.66666,formatter:i.labelFormatter}}},legend:{show:!1}},e=[{label:"Startup",color:"yellow",data:this.model.get("data").SUP},{label:"Data Collection",color:"green",data:this.model.get("data").DCTIME},{label:"Auto Indexing",color:"#93db70",data:this.model.get("data").AITIME},{label:"Centring",color:"cyan",data:this.model.get("data").CENTTIME},{label:"Energy Scans",color:"orange",data:this.model.get("data").EDGE},{label:"Robot Actions",color:"blue",data:this.model.get("data").R},{label:"Thinking",color:"purple",data:this.model.get("data").T},{label:"Remaining",color:"red",data:this.model.get("data").REM},{label:"Beam Dump",color:"black",data:this.model.get("data").NOBEAM},{label:"Faults",color:"grey",data:this.model.get("data").FAULT}];s.plot(this.$el,e,t),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop()}})}.apply(e,s))||(t.exports=n)},179:function(t,e,i){(function(s,n){var a,l;a=[i(7),i(1136)],void 0===(l=function(t,e){return t.ItemView.extend({template:s.template('<div id="dc_hist"></div><p>Data Collections / Hour</p><div id="dc_hist2"></div><p>Samples Loaded / Hour</p>'),modelEvents:{change:"render"},initialize:function(t){this.model=new e({visit:t&&t.visit}),this.model.fetch()},onRender:function(){if(this.model.get("data")){var t={bars:{show:!0,align:"center"},grid:{borderWidth:0,hoverable:!0},xaxis:{tickSize:1,tickLength:0},tooltip:!0,tooltipOpts:{content:"%y"}};n.plot(this.$el.find("#dc_hist"),[this.model.get("data").dcs],t),n.plot(this.$el.find("#dc_hist2"),[this.model.get("data").samples],t)}}})}.apply(e,a))||(t.exports=l)}).call(this,i(5),i(8))},180:function(t,e,i){var s,n;s=[i(5),i(6),i(10)],void 0===(n=function(t,e,i){var s=e.Model.extend({idAttribute:"ROBOTACTIONID"});return i.extend({model:s,mode:"server",url:"/robot/errors",state:{pageSize:15},parseState:function(t,e,i,s){return{totalRecords:t[0]}},parseRecords:function(t,e){return t[1]}})}.apply(e,s))||(t.exports=n)},181:function(t,e,i){var s,n;s=[i(10)],void 0===(n=function(t){return t.extend({mode:"client",url:"/vstat/overview",state:{pageSize:15}})}.apply(e,s))||(t.exports=n)},182:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({urlRoot:"/vstat/histogram"})}.apply(e,s))||(t.exports=n)},273:function(t,e,i){(function(s){var n,a;n=[i(7),i(70),i(101),i(102),i(103),i(274)],void 0===(a=function(t,e,i,n,a,l){return FilterView=t.ItemView.extend({template:l,className:"filter filter-nohide",ui:{bl:"select[name=BEAMLINE]",system:"select[name=SYSTEMID]",component:"select[name=COMPONENTID]",subcomponent:"select[name=SUBCOMPONENTID]"},events:{"change @ui.bl":"updateSystems","change @ui.system":"updateComponents","change @ui.component":"updateSubComponents","change @ui.subcomponent":"refetch","click a.clear":"clearFilters","change select":"updateUrlFragment"},updateUrlFragment:function(){var t=window.location.pathname;s.each({bl:"bl",sys:"system",com:"component",sub:"subcomponent"},(function(e,i){t=t.replace(new RegExp("\\/"+i+"\\/\\w+"),""),0!=this.ui[e].val()&&(t+="/"+i+"/"+this.ui[e].val())}),this),window.history.pushState({},"",t)},clearFilters:function(t){t.preventDefault(),this.ui.bl.val(""),this.ui.system.val(""),this.ui.component.val(""),this.ui.subcomponent.val(""),this.collection.fetch(),this.updateSystems()},initialize:function(){var t=this;this.collection.queryParams.bl=function(){return t.ui.bl.val()},this.collection.queryParams.sid=function(){if(t.ui.system.val()>0)return t.ui.system.val()},this.collection.queryParams.cid=function(){if(t.ui.component.val()>0)return t.ui.component.val()},this.collection.queryParams.scid=function(){if(t.ui.subcomponent.val()>0)return t.ui.subcomponent.val()},this.firstLoad=!0;var e=s.unique(s.values(this.getOption("params")));e.length&&null==e[0]&&(this.firstLoad=!1)},refetch:function(){this.collection.fetch()},onRender:function(){var t=this;this.beamlines=new e,this.beamlines.fetch().done((function(){t.ui.bl.html('<option value="">-</option><option value="P01">Phase I</option>'+t.beamlines.opts()),t.getOption("params")&&t.ui.bl.val(t.getOption("params").beamline),t.updateSystems()})),this.systems=new i(null,{queryParams:{bl:function(){return console.log("getting bl in sys",t.ui.bl.val()),t.ui.bl.val()}}}),this.components=new n(null,{queryParams:{bl:function(){return t.ui.bl.val()},sid:function(){return t.ui.system.val()}}}),this.subcomponents=new a(null,{queryParams:{bl:function(){return t.ui.bl.val()},cid:function(){return t.ui.component.val()}}})},updateSystems:function(t){this.systems.fetch().done(this.doUpdateSystems.bind(this,t))},doUpdateSystems:function(t){var e=this.ui.system.val();this.ui.system.html('<option value="0">-</option>'+this.systems.opts()).val(e),this.getOption("params")&&this.firstLoad&&this.ui.system.val(this.getOption("params").system),t&&this.collection.fetch(),this.updateComponents()},updateComponents:function(t){this.components.fetch().done(this.doUpdateComponents.bind(this,t))},doUpdateComponents:function(t){var e=this.ui.component.val();this.ui.component.html('<option value="0">-</option>'+this.components.opts()).val(e),this.getOption("params")&&this.firstLoad&&this.ui.component.val(this.getOption("params").component),this.updateSubComponents(),t&&this.collection.fetch()},updateSubComponents:function(t){this.subcomponents.fetch().done(this.doUpdateSubComponents.bind(this,t))},doUpdateSubComponents:function(t){var e=this.ui.subcomponent.val();this.ui.subcomponent.html('<option value="0">-</option>'+this.subcomponents.opts()).val(e),this.getOption("params")&&this.firstLoad&&this.ui.subcomponent.val(this.getOption("params").subcomponent),(t||this.firstLoad)&&this.collection.fetch(),this.firstLoad&&(this.firstLoad=!1)}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},274:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul>\n    <li>Beamline: <select name="BEAMLINE"></select></li>\n    <li>System: <select name="SYSTEMID"></select></li>\n    <li>Component: <select name="COMPONENTID"></select></li>\n    <li>Subcomponent: <select name="SUBCOMPONENTID"></select></li>\n    <li><a class="button clear" href="#"><i class="fa fa-times"></i></a></li>\n</ul>';return __p}},275:function(t,e,i){var s,n;s=[i(7),i(1135)],void 0===(n=function(t,e){return t.ItemView.extend({template:e,className:"data_collection"})}.apply(e,s))||(t.exports=n)},276:function(t,e,i){(function(t){var e,i;i={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(t,e){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+e.color+";'>"+t+"<br/>"+Math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}},(e=t).plot.plugins.push({init:function(t){var i=null,s=null,n=null,a=null,l=null,o=null,r=!1,c=null,h=[];function d(t,a,l){r||(r=!0,i=t.getCanvas(),s=e(i).parent(),n=t.getOptions(),t.setData(function(t){for(var i=0,s=0,a=0,l=n.series.pie.combine.color,o=[],r=0;r<t.length;++r){var c=t[r].data;e.isArray(c)&&1==c.length&&(c=c[0]),e.isArray(c)?!isNaN(parseFloat(c[1]))&&isFinite(c[1])?c[1]=+c[1]:c[1]=0:c=!isNaN(parseFloat(c))&&isFinite(c)?[1,+c]:[1,0],t[r].data=[c]}for(r=0;r<t.length;++r)i+=t[r].data[0][1];for(r=0;r<t.length;++r)(c=t[r].data[0][1])/i<=n.series.pie.combine.threshold&&(s+=c,a++,l||(l=t[r].color));for(r=0;r<t.length;++r)c=t[r].data[0][1],(a<2||c/i>n.series.pie.combine.threshold)&&o.push(e.extend(t[r],{data:[[1,c]],color:t[r].color,label:t[r].label,angle:c*Math.PI*2/i,percent:c/(i/100)}));return a>1&&o.push({data:[[1,s]],color:l,label:n.series.pie.combine.label,angle:s*Math.PI*2/i,percent:s/(i/100)}),o}(t.getData())))}function p(t,i){if(s){var h=t.getPlaceholder().width(),d=t.getPlaceholder().height(),p=s.children().filter(".legend").children().width()||0;c=i,r=!1,a=Math.min(h,d/n.series.pie.tilt)/2,o=d/2+n.series.pie.offset.top,l=h/2,"auto"==n.series.pie.offset.left?(n.legend.position.match("w")?l+=p/2:l-=p/2,l<a?l=a:l>h-a&&(l=h-a)):l+=n.series.pie.offset.left;var f=t.getData(),v=0;do{v>0&&(a*=.95),v+=1,m(),n.series.pie.tilt<=.8&&b()}while(!g()&&v<10);v>=10&&(m(),s.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),t.setSeries&&t.insertLegend&&(t.setSeries(f),t.insertLegend())}function m(){c.clearRect(0,0,h,d),s.children().filter(".pieLabel, .pieLabelBackground").remove()}function b(){var t=n.series.pie.shadow.left,e=n.series.pie.shadow.top,i=n.series.pie.shadow.alpha,s=n.series.pie.radius>1?n.series.pie.radius:a*n.series.pie.radius;if(!(s>=h/2-t||s*n.series.pie.tilt>=d/2-e||s<=10)){c.save(),c.translate(t,e),c.globalAlpha=i,c.fillStyle="#000",c.translate(l,o),c.scale(1,n.series.pie.tilt);for(var r=1;r<=10;r++)c.beginPath(),c.arc(0,0,s,0,2*Math.PI,!1),c.fill(),s-=r;c.restore()}}function g(){var t=Math.PI*n.series.pie.startAngle,i=n.series.pie.radius>1?n.series.pie.radius:a*n.series.pie.radius;c.save(),c.translate(l,o),c.scale(1,n.series.pie.tilt),c.save();for(var r=t,p=0;p<f.length;++p)f[p].startAngle=r,v(f[p].angle,f[p].color,!0);if(c.restore(),n.series.pie.stroke.width>0){for(c.save(),c.lineWidth=n.series.pie.stroke.width,r=t,p=0;p<f.length;++p)v(f[p].angle,n.series.pie.stroke.color,!1);c.restore()}return u(c),c.restore(),!n.series.pie.label.show||function(){for(var i=t,r=n.series.pie.label.radius>1?n.series.pie.label.radius:a*n.series.pie.label.radius,c=0;c<f.length;++c){if(f[c].percent>=100*n.series.pie.label.threshold&&!p(f[c],i,c))return!1;i+=f[c].angle}return!0;function p(t,i,a){if(0==t.data[0][1])return!0;var c,p=n.legend.labelFormatter,u=n.series.pie.label.formatter;c=p?p(t.label,t):t.label,u&&(c=u(c,t));var f=(i+t.angle+i)/2,v=l+Math.round(Math.cos(f)*r),m=o+Math.round(Math.sin(f)*r)*n.series.pie.tilt,b="<span class='pieLabel' id='pieLabel"+a+"' style='position:absolute;top:"+m+"px;left:"+v+"px;'>"+c+"</span>";s.append(b);var g=s.children("#pieLabel"+a),w=m-g.height()/2,y=v-g.width()/2;if(g.css("top",w),g.css("left",y),0-w>0||0-y>0||d-(w+g.height())<0||h-(y+g.width())<0)return!1;if(0!=n.series.pie.label.background.opacity){var _=n.series.pie.label.background.color;null==_&&(_=t.color);var x="top:"+w+"px;left:"+y+"px;";e("<div class='pieLabelBackground' style='position:absolute;width:"+g.width()+"px;height:"+g.height()+"px;"+x+"background-color:"+_+";'></div>").css("opacity",n.series.pie.label.background.opacity).insertBefore(g)}return!0}}();function v(t,e,s){t<=0||isNaN(t)||(s?c.fillStyle=e:(c.strokeStyle=e,c.lineJoin="round"),c.beginPath(),Math.abs(t-2*Math.PI)>1e-9&&c.moveTo(0,0),c.arc(0,0,i,r,r+t/2,!1),c.arc(0,0,i,r+t/2,r+t,!1),c.closePath(),r+=t,s?c.fill():c.stroke())}}}function u(t){if(n.series.pie.innerRadius>0){t.save();var e=n.series.pie.innerRadius>1?n.series.pie.innerRadius:a*n.series.pie.innerRadius;t.globalCompositeOperation="destination-out",t.beginPath(),t.fillStyle=n.series.pie.stroke.color,t.arc(0,0,e,0,2*Math.PI,!1),t.fill(),t.closePath(),t.restore(),t.save(),t.beginPath(),t.strokeStyle=n.series.pie.stroke.color,t.arc(0,0,e,0,2*Math.PI,!1),t.stroke(),t.closePath(),t.restore()}}function f(t,e){for(var i=!1,s=-1,n=t.length,a=n-1;++s<n;a=s)(t[s][1]<=e[1]&&e[1]<t[a][1]||t[a][1]<=e[1]&&e[1]<t[s][1])&&e[0]<(t[a][0]-t[s][0])*(e[1]-t[s][1])/(t[a][1]-t[s][1])+t[s][0]&&(i=!i);return i}function v(t){b("plothover",t)}function m(t){b("plotclick",t)}function b(e,i){var r=t.offset(),d=function(e,i){for(var s,n,r=t.getData(),h=t.getOptions(),d=h.series.pie.radius>1?h.series.pie.radius:a*h.series.pie.radius,p=0;p<r.length;++p){var u=r[p];if(u.pie.show){if(c.save(),c.beginPath(),c.moveTo(0,0),c.arc(0,0,d,u.startAngle,u.startAngle+u.angle/2,!1),c.arc(0,0,d,u.startAngle+u.angle/2,u.startAngle+u.angle,!1),c.closePath(),s=e-l,n=i-o,c.isPointInPath){if(c.isPointInPath(e-l,i-o))return c.restore(),{datapoint:[u.percent,u.data],dataIndex:0,series:u,seriesIndex:p}}else if(f([[0,0],[d*Math.cos(u.startAngle),d*Math.sin(u.startAngle)],[d*Math.cos(u.startAngle+u.angle/4),d*Math.sin(u.startAngle+u.angle/4)],[d*Math.cos(u.startAngle+u.angle/2),d*Math.sin(u.startAngle+u.angle/2)],[d*Math.cos(u.startAngle+u.angle/1.5),d*Math.sin(u.startAngle+u.angle/1.5)],[d*Math.cos(u.startAngle+u.angle),d*Math.sin(u.startAngle+u.angle)]],[s,n]))return c.restore(),{datapoint:[u.percent,u.data],dataIndex:0,series:u,seriesIndex:p};c.restore()}}return null}(parseInt(i.pageX-r.left),parseInt(i.pageY-r.top));if(n.grid.autoHighlight)for(var p=0;p<h.length;++p){var u=h[p];u.auto!=e||d&&u.series==d.series||g(u.series)}d&&function(e,i){var s=w(e);-1==s?(h.push({series:e,auto:i}),t.triggerRedrawOverlay()):i||(h[s].auto=!1)}(d.series,e);var v={pageX:i.pageX,pageY:i.pageY};s.trigger(e,[v,d])}function g(e){null==e&&(h=[],t.triggerRedrawOverlay());var i=w(e);-1!=i&&(h.splice(i,1),t.triggerRedrawOverlay())}function w(t){for(var e=0;e<h.length;++e)if(h[e].series==t)return e;return-1}t.hooks.processOptions.push((function(t,e){e.series.pie.show&&(e.grid.show=!1,"auto"==e.series.pie.label.show&&(e.legend.show?e.series.pie.label.show=!1:e.series.pie.label.show=!0),"auto"==e.series.pie.radius&&(e.series.pie.label.show?e.series.pie.radius=.75:e.series.pie.radius=1),e.series.pie.tilt>1?e.series.pie.tilt=1:e.series.pie.tilt<0&&(e.series.pie.tilt=0))})),t.hooks.bindEvents.push((function(t,e){var i=t.getOptions();i.series.pie.show&&(i.grid.hoverable&&e.unbind("mousemove").mousemove(v),i.grid.clickable&&e.unbind("click").click(m))})),t.hooks.processDatapoints.push((function(t,e,i,s){t.getOptions().series.pie.show&&d(t)})),t.hooks.drawOverlay.push((function(t,e){t.getOptions().series.pie.show&&function(t,e){var i,s=t.getOptions(),n=s.series.pie.radius>1?s.series.pie.radius:a*s.series.pie.radius;e.save(),e.translate(l,o),e.scale(1,s.series.pie.tilt);for(var r=0;r<h.length;++r)(i=h[r].series).angle<=0||isNaN(i.angle)||(e.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",e.beginPath(),Math.abs(i.angle-2*Math.PI)>1e-9&&e.moveTo(0,0),e.arc(0,0,n,i.startAngle,i.startAngle+i.angle/2,!1),e.arc(0,0,n,i.startAngle+i.angle/2,i.startAngle+i.angle,!1),e.closePath(),e.fill());u(e),e.restore()}(t,e)})),t.hooks.draw.push((function(t,e){t.getOptions().series.pie.show&&p(t,e)}))},options:i,name:"pie",version:"1.1"})}).call(this,i(8))},277:function(t,e,i){(function(s){var n,a;n=[i(7),i(1137),i(12),i(15)],void 0===(a=function(t,e,i,n){return t.LayoutView.extend({className:"content",template:s.template('<h1>EHC Log</h1><div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(t){var s=[{name:"title",label:"Title",cell:"string",editable:!1},{name:"posteddate",label:"Date",cell:"string",editable:!1},{name:"postedby",label:"Posted By",cell:"string",editable:!1},{name:"logcontent",label:"Content",cell:n.HTMLCell,editable:!1}];this.collection=new e(null,{visit:t.visit}),this.collection.fetch(),this.table=new i({collection:this.collection,columns:s,tableClass:"ehc reflow",filter:!1,pages:!1,backgrid:{emptyText:"No EHC log found"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},278:function(t,e,i){(function(s){var n,a;n=[i(7),i(180),i(12)],void 0===(a=function(t,e,i){return t.LayoutView.extend({className:"content",template:s.template('<h1>Robot Errors</h1><div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(t){var e=[{name:"ST",label:"Time",cell:"string",editable:!1},{name:"BL",label:"Beamline",cell:"string",editable:!1},{name:"VIS",label:"Visit",cell:"string",editable:!1},{name:"ACTIONTYPE",label:"Action",cell:"string",editable:!1},{name:"TIME",label:"Duration",cell:"string",editable:!1},{name:"DEWARLOCATION",label:"Puck",cell:"string",editable:!1},{name:"CONTAINERLOCATION",label:"Sample",cell:"string",editable:!1},{name:"SAMPLEBARCODE",label:"Barcode",cell:"string",editable:!1},{name:"STATUS",label:"Status",cell:"string",editable:!1},{name:"MESSAGE",label:"Message",cell:"string",editable:!1}];app.mobile()&&s.each([2,3,4,5,6,7,8],(function(t){e[t].renderable=!1})),this.table=new i({collection:t.collection,columns:e,tableClass:"robot_actions",filter:"s",loading:!0,backgrid:{emptyText:"No robot errors recorded"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},279:function(t,e,i){(function(s){var n,a;n=[i(7),i(182),i(11),i(8),i(23),i(42),i(124)],void 0===(a=function(t,e,i,n){return t.ItemView.extend({template:s.template('<div id="visit_pie"></div><p><%-title%></p>'),events:{plotselected:"zoom",dblclick:"reset"},zoom:function(t,e){var i=this.plot.getOptions();i.xaxes[0].min=e.xaxis.from,i.xaxes[0].max=e.xaxis.to,this.plot.setupGrid(),this.plot.draw(),this.plot.clearSelection()},reset:function(t){this.zoom(t,{xaxis:{from:null,to:null}})},templateHelpers:function(){return{title:this.getOption("title")}},initialize:function(t){this.$el.css("opacity",0),this.listenTo(this.collection,"add remove change:histograms",this.render)},getToolTip:function(t,e,i,s){var n=this.collection.first().get("histograms")[0];return t+": "+Object.keys(n.data)[e]},onRender:function(){var t={xaxis:{tickDecimals:0,rotateTicks:45},bars:{show:!0},grid:{borderWidth:0,hoverable:!0},selection:{mode:"x"},tooltipOpts:{content:this.getToolTip.bind(this)},tooltip:!0,yaxes:[{},{position:"right"}]},e=this.collection.first();if(e&&e.get("histograms")&&e.get("histograms").length){var i=e.get("histograms")[0],a=[],l=0,o=Math.floor(Object.keys(i.data).length/15);s.each(i.data,(function(t,e){a.push([l,l%o==0?e:""]),l++})),t.xaxis.ticks=a;var r=[];this.collection.each((function(t){s.each(t.get("histograms"),(function(t){var e={data:[],label:t.label},i=0;s.each(t.data,(function(t,s){e.data.push([i,parseFloat(t)]),i++})),r.push(e)}),this)})),r.length&&(this.plot=n.plot(this.$el.find("#visit_pie"),r,t),this.$el.css("opacity",1))}}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},280:function(t,e,i){var s,n;s=[i(10)],void 0===(n=function(t){return t.extend({mode:"server",url:"/proposal/type"})}.apply(e,s))||(t.exports=n)},455:function(t,e,i){(function(s){var n,a;n=[i(7),i(1138),i(12)],void 0===(a=function(t,e,i){return t.LayoutView.extend({className:"content",template:s.template('<h1>Callouts</h1><div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(t){this.collection=new e(null,{visit:t.visit}),this.collection.fetch(),this.table=new i({collection:this.collection,columns:[{name:"username",label:"User",cell:"string",editable:!1},{name:"logcontent",label:"Description",cell:"string",editable:!1},{name:"intime",label:"In Time",cell:"string",editable:!1},{name:"hometime",label:"Out Time",cell:"string",editable:!1}],tableClass:"ehc",filter:!1,pages:!1,backgrid:{emptyText:"No callouts recorded"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(e,n))||(t.exports=a)}).call(this,i(5))},456:function(t,e,i){var s,n;s=[i(7),i(457),i(11),i(8),i(23),i(42)],void 0===(n=function(t,e,i,s){return t.ItemView.extend({template:!1,modelEvents:{change:"render"},initialize:function(t){t.model||(this.model=new e({visit:t.visit}),this.model.fetch()),this.$el.css("opactiy",0)},onRender:function(){if(this.model.get("data")){console.log(this.model.get("data"));s.plot(this.$el,this.model.get("data"),{xaxis:{tickDecimals:0},bars:{show:!0},grid:{borderWidth:0},yaxes:[{},{position:"right"}]}),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop()}})}.apply(e,s))||(t.exports=n)},457:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"visit",urlRoot:"/robot/profile",parse:function(t,e){return{data:t[0]}}})}.apply(e,s))||(t.exports=n)},458:function(t,e,i){var s,n;s=[i(6)],void 0===(n=function(t){return t.Model.extend({idAttribute:"NAME"})}.apply(e,s))||(t.exports=n)},70:function(t,e,i){(function(s){var n,a;n=[i(6),i(14)],void 0===(a=function(t,e){var i=t.Model.extend({idAttribute:"NAME"});return t.Collection.extend(s.extend({},e,{model:i,url:"/fault/bls",keyAttribute:"NAME",valueAttribute:"NAME"}))}.apply(e,n))||(t.exports=a)}).call(this,i(5))},98:function(t,e,i){(function(s){var n,a;n=[i(10),i(14)],void 0===(a=function(t,e){return t.extend(s.extend({},e,{mode:"client",url:"/vstat/runs",keyAttribute:"RUN",valueAttribute:"RUNID",state:{pageSize:15}}))}.apply(e,n))||(t.exports=a)}).call(this,i(5))},99:function(t,e,i){var s,n;s=[i(10),i(123)],void 0===(n=function(t,e){return t.extend({model:e,mode:"server",url:"/fault",state:{pageSize:20},queryParams:{pageSize:"pp"},parseState:function(t,e,i,s){return{totalRecords:t[0]*this.state.pageSize}},parseRecords:function(t,e){return t[1]}})}.apply(e,s))||(t.exports=n)}}]);