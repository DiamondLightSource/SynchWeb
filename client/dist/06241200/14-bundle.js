(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{105:function(e,t,n){var i,o;i=[n(6)],void 0===(o=function(e){return e.Model.extend({idAttribute:"PROPOSAL",urlRoot:"/proposal",validation:{PROPOSALCODE:{required:!0,pattern:"word"},PROPOSALNUMBER:{required:!0,pattern:"number"},TITLE:{required:!0,pattern:"wwsbdash"}}})}.apply(t,i))||(e.exports=o)},11:function(e,t,n){(function(i){var o,a;o=[n(6),n(7),n(27),n(8),n(478),n(296),n(479)],void 0===(a=function(e,t,n,o){var a={_date_to_unix:function(e){var t=e.trim().split(" "),n=t[0].split("-"),i=t[1].split(":");return new Date(n[2],n[1]-1,n[0],i[0],i[1],i[2],0)},default_plot:{grid:{borderWidth:0},series:{points:{show:!0,radius:1}}},labelFormatter:function(e,t){return"<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>"+e+"<br/>"+Math.round(t.percent)+"%<br />("+t.data[0][1].toFixed(1)+"hr)</div>"},labelFormatterNo:function(e,t){return"<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>"+e+"<br/>"+Math.round(t.percent)+"%<br />("+t.data[0][1]+")</div>"},generic_msg:t.ItemView.extend({className:"content",template:i.template("<h1><%-title%></h1><div><p><%=msg%></p></div>"),templateHelpers:function(){return{msg:this.message,title:this.title}},initialize:function(e){this.message=e.message,this.title=e.title}}),alert:t.ItemView.extend({persist:!1,scrollTo:!0,dismissible:!1,className:function(){return"message "+(this.getOption("notify")?"notify":"alert")},tagName:"p",getTemplate:function(){return this.getOption("dismissible")?i.template('<span class="r"><a href="#" class="dismiss"><i class="fa fa-times"></i></a></span><%=msg%>'):i.template("<%=msg%>")},templateHelpers:function(){return{msg:this.getOption("message")}},events:{"click a.dismiss":"disimss"},disimss:function(e){e.preventDefault(),this.destroy()},onRender:function(){var e=this;this.getOption("scrollTo")&&o("html, body").animate({scrollTop:this.$el.offset().top},500,(function(){e.$el.toggle("highlight")})),this.getOption("persist")&&this.$el.addClass(this.getOption("persist")),this.getOption("persist")||setTimeout((function(){e.$el.fadeOut((function(){e.destroy()}))}),1e4)}}),confirm:function(e){var t=n.extend({title:e.title,template:i.template(e.content),buttons:{Ok:"onOK",Cancel:"closeDialog"},onOK:function(){e.callback(),this.closeDialog()}});app.dialog.show(new t)},get_xy:function(e,t){return null==e.offsetX?[e.pageX-o(t).offset().left,e.pageY-o(t).offset().top]:[e.offsetX,e.offsetY]},rainbow:function(e,t,n){var i=2*e*Math.PI;return void 0===t&&(t=126),void 0===n&&(n=127),"rgb("+Math.floor(Math.sin(i)*t+n)+","+Math.floor(Math.sin(i+2*Math.PI/3)*t+n)+","+Math.floor(Math.sin(i+4*Math.PI/3)*t+n)+")"},getColors:function(e){return i.map(i.range(e),(function(t,n){return o.Color({hue:360*n/e,saturation:.9,lightness:.4,alpha:1}).toHexString()}))},shadeColor:function(e,t){var n=parseInt(e.slice(1),16),i=t<0?0:255,o=t<0?-1*t:t,a=n>>16,s=n>>8&255,r=255&n;return"#"+(16777216+65536*(Math.round((i-a)*o)+a)+256*(Math.round((i-s)*o)+s)+(Math.round((i-r)*o)+r)).toString(16).slice(1)},inView:function(e,t){var n=o(window),i=t||0;if(!e.is(":hidden")){var a=n.scrollTop(),s=a+n.height(),r=e.offset().top;return r+e.height()>=a-i&&r<=s+i}},sign:function(t){e.ajax({url:app.apiurl+"/download/sign",method:"POST",data:{validity:t.url.replace(app.apiurl,"")},success:function(e){t&&t.callback&&t.callback(e)}})},signHandler:function(e){e.preventDefault();var t=o(e.target);(t.is("i")||t.is("img"))&&(t=t.closest("a"));var n=t.attr("href");a.sign({url:n,callback:function(e){window.location=n+"?token="+e.token}})},shuffle:function(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[i-=1],e[i]=e[n],e[n]=t;return e},jsonError:function(e,t,n){var i={};if(t.responseText)try{i=o.parseJSON(t.responseText)}catch(e){}i.message&&app.alert({message:i.message})}};return a}.apply(t,o))||(e.exports=a)}).call(this,n(5))},128:function(e,t,n){var i,o;i=[n(8),n(28),n(292),n(293),n(294)],void 0===(o=function(e){return{date:function(e){this.$el.find(e).datepicker({dateFormat:"dd-mm-yy"})},time:function(e){this.$el.find(e).timepicker()},combobox:function(e){e.selector.combobox({invalid:e.invalid})}}}.apply(t,i))||(e.exports=o)},26:function(e,t,n){(function(i){var o,a;o=[n(7),n(6),n(8),n(128),n(475),n(295)],void 0===(a=function(e,t,n,o){return FormView=e.LayoutView.extend(i.extend({},o,{className:"content",setupOnConstruct:!0,_baseUI:function(){return{submit:"[type=submit]"}},_baseEvents:function(){return{"change form input":"validateField","change form select":"validateField","change form textarea":"validateField","blur form input":"validateField","blur form select":"validateField","blur form textarea":"validateField","keyup form input":"validateField","keyup form select":"validateField","keyup form textarea":"validateField","click @ui.submit":"onSubmit"}},delegateEvents:function(e){return this.ui=i.extend(this._baseUI(),i.result(this,"ui")),this.events=i.extend(this._baseEvents(),i.result(this,"events")),FormView.__super__.delegateEvents.call(this,e)},constructor:function(e){FormView.__super__.constructor.call(this,e),console.log("setup validation",this),this.getOption("setupOnConstruct")&&this.setupValidation()},validateField:function(e){var t=n(e.target).attr("name"),i=e.target.files?e.target.files[0]:n(e.target).val();if(this.getOption("storeOnValidate")){var o={};o[t]=i,this.model.set(o,{silent:!0})}var a=this.model.preValidate(t,i);a?this.invalid(e.target,a):this.valid(e.target)},invalid:function(e,t){n(e).removeClass("fvalid").addClass("ferror"),n(e).siblings("span.errormessage").length?n(e).siblings("span.errormessage").text(t):n(e).after('<span class="errormessage ferror">'+t+"</span>")},valid:function(e){n(e).removeClass("ferror").addClass("fvalid").siblings("span.errormessage").remove()},setupValidation:function(){console.log("setup val"),this.createModel(),t.Validation.unbind(this),t.Validation.bind(this,{selector:"name",valid:function(e,t){e.valid(e.$el.find('[name="'+t+'"]'))},invalid:function(e,t,n){e.invalid(e.$el.find('[name="'+t+'"]'),n)}})},createModel:function(){throw new Error("implement #createModel in your FormView subclass")},success:function(e,t,n){throw new Error("implement #success in your FormView subclass")},failure:function(e,t,n){throw console.log("failure",e,t),new Error("implement #failure in your FormView subclass")},onSubmit:function(e){if(!n(e.target).closest(".editable").length){e.preventDefault();var i=t.Syphon.serialize(this);this.model.set(i),this.prepareModel&&this.prepareModel.call(this),this.model.validate();var o=this.model.isValid(!0);if(app.log("submitted",o,this.model),o){var a=this;this.$el.find("form").addClass("loading"),this.beforeSave&&this.beforeSave.call(this),this.ui.submit.prop("disabled",!0),this.model.save({},{success:function(e,t,n){a.$el.find("form").removeClass("loading"),a.ui.submit.prop("disabled",!1),a.success(e,t,n)},error:function(e,t,n){a.$el.find("form").removeClass("loading"),a.ui.submit.prop("disabled",!1),a.failure(e,t,n)}})}}}}))}.apply(t,o))||(e.exports=a)}).call(this,n(5))},27:function(e,t,n){(function(i,o){var a,s;a=[n(7)],void 0===(s=function(e){return DialogView=e.LayoutView.extend({template:!1,buttons:{Close:"closeDialog"},dOptions:{},dialogOptions:function(){return i.extend({},{title:this.getOption("title"),width:"auto",height:"auto",resizable:!1,buttons:this.generateButtons(this.getOption("buttons"))},this.getOption("dOptions"))},generateButtons:function(e){var t={};return i.each(e,(function(e,n){t[n]=this.getOption(e).bind(this)}),this),t},setButtons:function(e){app.dialog.dialog("option","buttons",this.generateButtons(e))},setTitle:function(e){app.dialog.dialog("option","title",e)},onRender:function(){this.getOption("autoSize")&&(this.$el.css("width",o(window).width()*(app.mobile()?.8:.5)),this.$el.css("height",this.$el.width())),this.getOption("view")&&(this.listenTo(this.getOption("view"),"dialog:close",this.closeDialog),this.getOption("view").$el.find(".no_mobile").hide(),this.getOption("autoSize")&&(this.getOption("view").$el.css("width",this.$el.width()),this.getOption("view").$el.css("height",this.$el.width()))),this.getOption("view")},onDomRefresh:function(){this.getOption("view")&&(this.$el.append(this.getOption("view").render().$el),this.getOption("view").triggerMethod("dom:refresh")),this.$el.find(".no_mobile").hide()},onDestroy:function(){this.getOption("view")&&this.getOption("view").destroy()},closeDialog:function(e){this.getOption("view")&&this.getOption("view").destroy(),this.trigger("close"),app.dialog.hideDialog(),app.dialog.empty()}})}.apply(t,a))||(e.exports=s)}).call(this,n(5),n(8))},294:function(e,t,n){(function(i){var o,a,s;a=[n(8)],void 0===(s="function"==typeof(o=function(e){e.widget("custom.combobox",{_create:function(){this.wrapper=e("<div>").addClass("ui-combobox").insertAfter(this.element),this.element.hide(),this._createAutocomplete(),this._createShowAllButton()},_createAutocomplete:function(){var t=this.element.children(":selected"),n=t.val()?t.text():"";this.input=e("<input>").appendTo(this.wrapper).val(n).attr("title","").addClass("ui-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,source:e.proxy(this,"_source")}),this.input.data("ui-autocomplete")._renderItem=function(t,n){return e("<li>").addClass(n.class).append(e("<a>").html(n.label+"")).appendTo(t)},this._on(this.input,{autocompleteselect:function(e,t){var n=this.input;n.removeClass("ui-input-invalid"),t.item.option.selected=!0,this._trigger("select",e,{item:t.item.option}),setTimeout((function(){n.blur()}),1)},focus:function(){this.input.attr("placeholder",this.input.val()).val(""),this.input.autocomplete("search","")},blur:function(){""===this.input.val()&&this.input.val(this.input.attr("placeholder")),this._removeIfInvalid(),this.element.trigger("change")}})},_createShowAllButton:function(){var t=this.input;e("<span>").addClass("ui-icon ui-icon-triangle-1-s").attr("tabIndex",-1).appendTo(this.wrapper).click((function(){t.focus()}))},_source:function(t,n){var o=new RegExp(e.ui.autocomplete.escapeRegex(t.term),"i");n(this.element.children("option").map((function(){var n=e(this).text();if(this.value&&(!t.term||o.test(n))){var a=[];return i.each(this.className.split(/\s+/),(function(e){a.push(e)})),{label:n,value:n,option:this,class:a.join(" ")}}})))},_removeIfInvalid:function(t,n){if(this.input.removeClass("ui-input-invalid"),!n||!n.item){var i=this.input.val().toLowerCase(),o=!1;this.element.children("option").each((function(){if(e(this).text().toLowerCase()===i)return this.selected=o=!0,!1})),o||(this.element.val(""),this.input.autocomplete("instance").term="",this.input.addClass("ui-input-invalid"))}},value:function(e){var t,n=this.element,i=!1;if(!arguments.length)return(t=n.children(":selected")).length>0?t.val():null;n.prop("selectedIndex",-1),n.children("option").each((function(){if(this.value==e)return this.selected=i=!0,!1})),i?this.input.val(n.children(":selected").text()):(this.input.val(""),this.element.prop("selectedIndex",-1))},_destroy:function(){this.wrapper.remove(),this.element.show()}})})?o.apply(t,a):o)||(e.exports=s)}).call(this,n(5))},295:function(e,t,n){var i,o,a;o=[n(5),n(8),n(6)],void 0===(a="function"==typeof(i=function(e,t,n){return n.Syphon=function(e,t,n){var i={ignoredTypes:["button","submit","reset","fieldset"],serialize:function(e,i){var s={},p=r(i),c=o(e,p);return n.each(c,(function(e){var n=t(e),i=a(n),o=p.keyExtractors.get(i)(n),r=p.inputReaders.get(i)(n);if(p.keyAssignmentValidators.get(i)(n,o,r)){var c=p.keySplitter(o);s=l(s,c,r)}})),s},deserialize:function(e,i,s){var l=r(s),c=o(e,l),u=p(l,i);n.each(c,(function(e){var n=t(e),i=a(n),o=l.keyExtractors.get(i)(n);l.inputWriters.get(i)(n,u[o])}))}},o=function(e,i){var o=s(e).elements;return o=n.reject(o,(function(e){var o=a(e),s=i.keyExtractors.get(o)(t(e)),r=n.include(i.ignoredTypes,o),l=n.include(i.include,s),p=n.include(i.exclude,s);return!l&&(!!i.include||p||r)}))},a=function(e){var n=t(e),i=n[0].tagName,o=i;return"input"===i.toLowerCase()&&(o=n.attr("type")||"text"),o.toLowerCase()},s=function(e){return n.isUndefined(e.$el)&&"form"===e.tagName.toLowerCase()?e:e.$el.is("form")?e.el:e.$("form")[0]},r=function(e){var t=n.clone(e)||{};return t.ignoredTypes=n.clone(i.ignoredTypes),t.inputReaders=t.inputReaders||i.InputReaders,t.inputWriters=t.inputWriters||i.InputWriters,t.keyExtractors=t.keyExtractors||i.KeyExtractors,t.keySplitter=t.keySplitter||i.KeySplitter,t.keyJoiner=t.keyJoiner||i.KeyJoiner,t.keyAssignmentValidators=t.keyAssignmentValidators||i.KeyAssignmentValidators,t},l=function(e,t,i){if(!t)return e;var o=t.shift();return e[o]||(e[o]=n.isArray(o)?[]:{}),0===t.length&&(n.isArray(e[o])?e[o].push(i):e[o]=i),t.length>0&&l(e[o],t,i),e},p=function(e,t,i){var o={};return n.each(t,(function(t,a){var s={};i&&(a=e.keyJoiner(i,a)),n.isArray(t)?s[a+="[]"]=t:n.isObject(t)?s=p(e,t,a):s[a]=t,n.extend(o,s)})),o};return i}(0,t,e),n.Syphon.TypeRegistry=function(){this.registeredTypes={}},n.Syphon.TypeRegistry.extend=n.Model.extend,e.extend(n.Syphon.TypeRegistry.prototype,{get:function(e){var t=this.registeredTypes[e];return t||(t=this.registeredTypes.default),t},register:function(e,t){this.registeredTypes[e]=t},registerDefault:function(e){this.registeredTypes.default=e},unregister:function(e){this.registeredTypes[e]&&delete this.registeredTypes[e]}}),n.Syphon.KeyExtractorSet=n.Syphon.TypeRegistry.extend(),n.Syphon.KeyExtractors=new n.Syphon.KeyExtractorSet,n.Syphon.KeyExtractors.registerDefault((function(e){return e.prop("name")})),n.Syphon.InputReaderSet=n.Syphon.TypeRegistry.extend(),n.Syphon.InputReaders=new n.Syphon.InputReaderSet,n.Syphon.InputReaders.registerDefault((function(e){return e.val()})),n.Syphon.InputReaders.register("checkbox",(function(e){return e.prop("checked")})),n.Syphon.InputWriterSet=n.Syphon.TypeRegistry.extend(),n.Syphon.InputWriters=new n.Syphon.InputWriterSet,n.Syphon.InputWriters.registerDefault((function(e,t){e.val(t)})),n.Syphon.InputWriters.register("checkbox",(function(e,t){e.prop("checked",t)})),n.Syphon.InputWriters.register("radio",(function(e,t){e.prop("checked",e.val()===t)})),n.Syphon.KeyAssignmentValidatorSet=n.Syphon.TypeRegistry.extend(),n.Syphon.KeyAssignmentValidators=new n.Syphon.KeyAssignmentValidatorSet,n.Syphon.KeyAssignmentValidators.registerDefault((function(){return!0})),n.Syphon.KeyAssignmentValidators.register("radio",(function(e,t,n){return e.prop("checked")})),n.Syphon.KeySplitter=function(e){var t=e.match(/[^\[\]]+/g);return e.indexOf("[]")===e.length-2&&(lastKey=t.pop(),t.push([lastKey])),t},n.Syphon.KeyJoiner=function(e,t){return e+"["+t+"]"},n.Syphon})?i.apply(t,o):i)||(e.exports=a)},4:function(e,t,n){var i,o;i=[n(6),n(7),n(5),n(8),n(461),n(463),n(465),n(474),n(105),n(477),n(11),n(0),n(282)],void 0===(o=function(e,t,i,o,a,s,r,l,p,c,u,d){window.app=new t.Application,console.log("CONFIG",d),app.options=new c,app.apiurl=d.apiurl,app.appurl=d.appurl,app.config=d,app.token=sessionStorage.getItem("token"),app.parseQuery=function(){var e=location.search.replace(/\?/,"").split(/&/),t={};i.each(e,(function(e){var n=e.split(/=/);t[n[0]]=n[1]})),console.log("pairs",t),"prop"in t&&sessionStorage.setItem("prop",t.prop)},app.parseQuery(),app.checkForUpdate=function(){e.ajax({url:app.appurl+"/assets/js/config.json?t="+(new Date).getTime(),success:function(e){console.log("old",app.config.build,"new",e.build),e.build!=app.config.build&&(app.alert({message:"An update to SynchWeb is available. This page will automatically refresh in 5 seconds"}),setTimeout((function(){window.location.reload()}),5e3)),setTimeout(app.checkForUpdate,18e5)}})},app.checkForUpdate();var h=e.sync;e.sync=function(e,t,n){var o=i.isFunction(t.url)?t.url():t.url;return n=n||{},o&&(n.url=app.apiurl+o),h.call(this,e,t,n)};var f=e.ajax;function g(){var t={location:window.location.pathname};e.ajax({url:app.apiurl+"/users/log/",type:"POST",data:t})}return e.ajax=function(e){var t=app.prop;if(e.data instanceof FormData)e.data.append("prop",t);else if("application/json"==e.contentType||"DELETE"==e.type){if(e.data)var n=JSON.parse(e.data);else n={};Array.isArray(n)?n[0].prop=t:n.prop||(n.prop=t),e.data=JSON.stringify(n)}else e.data||(e.data={}),e.data.prop||(e.data.prop=t);return app.token&&(e.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer "+app.token)}),f.call(this,e)},e.Router.prototype.execute=function(e,t,n){if(!app.token)return app.login(),!1;e&&e.apply(this,t)},app.addRegions({content:"#container",header:"#header",sidebar:"#sidebar",dialog:r,motd:"#motd"}),o(document).ajaxError(i.debounce((function(e,t,n,i){var a;if(console.log("ajax error","status",t.status,"code",n,i),t.responseText)try{a=o.parseJSON(t.responseText)}catch(e){}var s=a&&(a.error||a.msg)?a.error?a.error:a.msg:i;0==t.readyState&&app.alert({message:"A network request failed",persist:"network"}),401==t.status&&app.login(t),500==t.status&&app.alert({message:"An application error has occurred <pre>"+s+"</pre>",persist:"e500"}),503==t.status&&(a?app.alert({message:"A database error has occurred <pre>"+s+"</pre>",persist:"e503"}):app.alert({message:"A server error has occurred <pre>"+s+"</pre>",persist:"e503"}))}),300)),app.login=function(e){app.bc.reset([{title:"Login"}]),app.content.show(new l)},app.addInitializer((function(t){Promise.all([n.e(11),n.e(12)]).then((function(){var t=[n(480),n(481),n(490),n(491),n(909),n(919),n(925),n(933),n(939),n(947),n(948),n(949),n(950),n(962),n(963),n(964),n(968),n(969),n(970),n(975)];(function(){this.sidebarview=new s,app.sidebar.show(this.sidebarview),app.bc||(app.bc=new e.Collection,this.headerview||(this.headerview=new a({bc:app.bc})),app.header.show(this.headerview)),o.when(app.loadopts()).done((function(){app.token?app.getuser({callback:function(){e.History.started||app.starthistory()}}):e.History.started||app.starthistory()}))}).apply(null,t)})).catch(n.oe)})),app.getuser=function(t){e.ajax({url:app.apiurl+"/users/current",success:function(e){app.user=e.user,app.personid=e.personid,app.givenname=e.givenname,app.staff=e.is_staff,app.defaultType=e.ty,app.type||(app.type=e.ty),app.user_can=function(t){return e.permissions.indexOf(t)>-1},app.cookie(null,(function(){t&&t.callback&&t.callback()})),app.setVisit()},error:function(){t&&t.callback&&t.callback()}})},app.navigate=function(t,n){n||(n={}),e.history.navigate(t,n),g()},app.cookie=function(e,t){if(e?sessionStorage.setItem("prop",e):e=sessionStorage.getItem("prop"),app.prop=e,e){var i=new p({PROPOSAL:e});i.fetch({success:function(){app.type=i.get("TYPE"),n.e(15).then((function(){var o=[n(980)("./"+i.get("TYPE")+"/menu")];(function(n){i.set("MENUS",n),app.prop=e,app.proposal=i,app.trigger("proposal:change",i),t&&t()}).apply(null,o)})).catch(n.oe)},error:function(){app.message({title:"No such proposal",message:"The selected proposal does not exist"}),app.prop=null,sessionStorage.removeItem("prop")}})}else t&&t()},app.clearProposal=function(){sessionStorage.removeItem("prop"),delete app.prop,app.clearVisit(),app.type=app.defaultType,app.type||console.log("Error clearing proposal, no default type for this user"),app.triggerMethod("proposal:change",null)},app.setVisit=function(e){e?sessionStorage.setItem("visit",e):e=sessionStorage.getItem("visit"),app.visit=e},app.clearVisit=function(){sessionStorage.removeItem("visit"),delete app.visit},app.loadopts=function(){return app.options.fetch({data:{t:(new Date).getTime()},success:function(){if(app.options.get("motd")){var e={persist:"motd",dismissible:!0,notify:!0,message:app.options.get("motd")};app.motd.show(new u.alert(e))}}})},app.log=function(){console.log.apply(console,arguments)},app.alert=function(e){e&&e.persist&&app.content.$el.find(".content ."+e.persist).remove(),app.content.$el.find(".content").first().prepend(new u.alert(e).render().$el)},app.message=function(e){app.content.show(new u.generic_msg(e))},app.mobile=function(){return o(window).width()<=600},app.loading=function(){var e=t.ItemView.extend({className:"loading-container",template:'<div><div class="loading">&nbsp;</div></div>'});app.content.show(new e)},o(window).scroll(i.debounce((function(){app.trigger("window:scroll")}),10)),app.starthistory=function(){if(e.history){if(e.history.start({pushState:!0,root:app.appurl}),e.history&&e.history._hasPushState){var t=o(window.document);t.keydown((function(e){(e.ctrlKey||91===e.keyCode)&&!0})),t.keyup((function(e){!1})),t.on("click","a",(function(t){var n=o(this).attr("href");n&&function(t){return console.log("routable",t.indexOf("/")),-1===t.indexOf("#")&&(function(e){return null===e.match(/^\/|(http:|https:|ftp:|mailto:|javascript:)/)}(t)||0==t.indexOf(e.history.root)||0==t.indexOf("/"))&&0!=t.indexOf(app.apiurl)}(n)&&(t.preventDefault(),e.history.navigate(n,!0))}))}e.history.on("route",(function(e,t){console.log("routing",arguments),g()}))}},app}.apply(t,i))||(e.exports=o)},461:function(e,t,n){(function(i,o){var a,s;a=[n(7),n(6),n(462)],void 0===(s=function(e,t,n){var a=e.ItemView.extend({getTemplate:function(e){return this.model.get("url")?i.template('<a href="<%-url%>"><%-title%></a>'):i.template("<%-title%>")},tagName:"li"}),s=e.CollectionView.extend({collectionEvents:{"reset change add remove":"render"},childView:a,tagName:"ul",onRender:function(){this.$el.attr("id","navigation")}});return e.LayoutView.extend({regions:{bread:".bread"},template:n,templateHelpers:function(){return{IS_STAFF:app.staff,PROPOSAL:app.prop,APIURL:app.apiurl,can:app.user_can}},root:null,rootLink:null,events:{"click a.pull":"showMenu","click a.logout":"logOut"},logOut:function(e){e.preventDefault(),sessionStorage.removeItem("token"),delete app.token,app.clearProposal(),app.trigger("sidebar:render"),app.navigate("/"),this.render(),"cas"==app.options.get("authentication_type")&&(window.location.href="https://"+app.options.get("cas_url")+"/cas/logout")},showMenu:function(e){e.preventDefault(),o("body").toggleClass("active")},onRender:function(){this.$el.find("a.pull").addClass("enable"),this.bread.show(new s({collection:this.bc}))},initialize:function(e){this.bc=e.bc,this.listenTo(this.bc,"change add remove reset",this.setTitle.bind(this)),this.listenTo(app,"proposal:change",this.setProposal,this)},setProposal:function(e){e?(this.model=e,console.log("header prop",e,e.get("MENUS"))):this.model=null,this.render()},setTitle:function(){console.log("set title"),document.title="ISPyB » "+this.bc.pluck("title").join(" » ")}})}.apply(t,a))||(e.exports=s)}).call(this,n(5),n(8))},462:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul id="menu">\n    ',IS_STAFF&&PROPOSAL&&(__p+="\n        ",_.each(MENUS.admin,(function(e,t){__p+="\n        \t",(e.permission&&can(e.permission)||!e.permission)&&(__p+='\n            <li><a href="/'+(null==(__t=t)?"":_.escape(__t))+'"><i class="fa fa-2x fa-'+(null==(__t=e.icon)?"":_.escape(__t))+'"></i> <span class="icon-label">'+(null==(__t=e.title)?"":_.escape(__t))+"</span></a></li>\n            "),__p+="\n        "})),__p+="\n    "),__p+='\n</ul>\n\n<a class="icon pull" href="#"><i class="fa fa-bars fa-2x"></i> <span class="icon-label">Menu</span></a>\n\n',(PROPOSAL||IS_STAFF)&&(__p+="\n"),__p+='\n<a class="icon" href="/"><i class="fa fa-home fa-2x"></i> <span class="icon-label">Home</span></a>\n\n',IS_STAFF&&(__p+='\n<a class="icon" href="/cal"><i class="fa fa-calendar fa-2x"></i> <span class="icon-label">Calendar</span></a>\n'),__p+='\n<a href="#" title="Logout" class="icon logout"><i class="fa fa-sign-out fa-2x"></i> <span class="icon-label">Logout</span></a>\n\n\n<span class="search-mobile">\n    <input type="text" class="search-mobile" placeholder="&#xf002;" />\n</span>\n\n<div class="bread"></div>';return __p}},463:function(e,t,n){(function(i){var o,a;o=[n(7),n(464),n(282)],void 0===(a=function(e,t){return e.ItemView.extend({template:t,templateHelpers:function(){return{PROPOSAL:app.prop,VISIT:app.visit,ACTIVE:app.proposal&&app.proposal.get("ACTIVE"),STATE:app.proposal&&app.proposal.get("STATE")}},events:{"click a":"hideMenu","click li.help a":"toggleHelp"},hideMenu:function(){i("body").toggleClass("active")},initialize:function(e){var t=i.cookie("ispyb_help"),n=i(window).width()<=800?0:1;this.help=void 0===t?n:t,this.listenTo(app,"proposal:change",this.setProposal,this),this.listenTo(app,"sidebar:render",this.render,this),this.listenTo(app.content,"show",this.doToggleHelp,this)},onRender:function(){this.doToggleHelp()},setProposal:function(e){this.model=e||null,this.render()},toggleHelp:function(e){e.preventDefault(),this.help=1==this.help?0:1,i.cookie("ispyb_help",this.help),this.doToggleHelp()},doToggleHelp:function(){1==this.help?(i("#sidebar ul li.help").addClass("active"),i("p.help").fadeIn()):(i("#sidebar ul li.help").removeClass("active"),i("p.help").fadeOut())}})}.apply(t,o))||(e.exports=a)}).call(this,n(8))},464:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<ul class="clearfix">\n    <li class="help active"><a href="#" t_old="Click to toggle help on and off">Help</a>\n        <ul>\n            <li><a href="/docs">Tutorials</a></li>\n        </ul>\n    </li>\n    <li class="feedback"><a href="/feedback">Feedback</a></li>\n    \n    <li><a href="/proposal">Proposals</a></li>\n    \n    <li>\n        <span class="current">\n            ',PROPOSAL&&"1"!=ACTIVE&&(__p+=' \n                <i class="fa fa-warning red"></i>\n            '),__p+="\n            "+(null==(__t=PROPOSAL||"No Proposal")?"":_.escape(__t))+' <i class="fa fa-angle-double-down"></i>\n        </span>\n        ',PROPOSAL&&(__p+="\n        <ul>\n            ","1"!=ACTIVE&&(__p+=' \n                <li class="message">\n                    <span>This proposal is '+(null==(__t=STATE)?"":_.escape(__t))+". You cannot create shipments, proteins, or contacts</span>\n                </li>\n            "),__p+="\n\n            ",_.each(MENUS.menu,(function(e,t){__p+='\n                <li><a href="/'+(null==(__t=t)?"":_.escape(__t))+'">'+(null==(__t=e)?"":_.escape(__t))+"</a></li>\n            "})),__p+="\n        </ul>\n        "),__p+="\n    </li>\n\n    ",PROPOSAL&&(__p+="\n        ",_.each(MENUS.extra,(function(e,t){__p+='\n            <li><a href="/'+(null==(__t=t)?"":_.escape(__t))+'">'+(null==(__t=e)?"":_.escape(__t))+"</a></li>\n        "})),__p+="\n    "),__p+="\n    \n</ul>";return __p}},465:function(e,t,n){(function(i,o){var a,s;a=[n(7),n(8),n(466)],void 0===(s=function(e){return e.Region.extend({el:"#dialog",constructor:function(){e.Region.prototype.constructor.apply(this,arguments),this.on("show",this.showDialog,this)},getEl:function(e){return i(e)},showDialog:function(e){e.on("close",this.hideModal,this),this.$el.dialog(o.isFunction(e.dialogOptions)?e.dialogOptions.call(e):e.dialogOptions),this.$el.dialog("open")},hideDialog:function(){this.$el.dialog("close")},dialog:function(){console.log("dargs",arguments),this.$el.dialog.apply(this.$el,arguments)}})}.apply(t,a))||(e.exports=s)}).call(this,n(8),n(5))},474:function(e,t,n){var i,o;i=[n(26),n(476),n(8),n(6),n(18)],void 0===(o=function(e,t,n,i){var o=i.Model.extend({url:"/authenticate",validation:{login:{required:!0,pattern:"wwdash"},password:{required:!0}}});return e.extend({template:t,createModel:function(){this.model=new o},onRender:function(){this.checkExistingSession()},checkExistingSession:function(){app.alert({message:"Checking for an existing session"}),this.$el.find("form").addClass("loading");var e=this,t=n("iframe");t.load((function(){var n=t.contents().text();if(n)try{var i=JSON.parse(n);"jwt"in i&&(app.alert({message:"Found a valid session, auto-logging you in"}),e.$el.find("form").addClass("loading"),setTimeout((function(){e.setToken(i)}),2e3)),"error"in i&&(e.$el.find("form").removeClass("loading"),e.redirect())}catch(t){console.log("catching error"),e.redirect(),e.$el.find("form").removeClass("loading")}})),t.attr("src",app.apiurl+"/authenticate/check")},redirect:function(){"cas"==app.options.get("authentication_type")&&1==app.options.get("cas_sso")&&-1==location.href.indexOf("?ticket=")&&(window.location.href="https://"+app.options.get("cas_url")+"/cas/login?service="+encodeURIComponent(window.location.href))},onShow:function(){app.token&&(console.log("invald token alert"),app.alert({message:"Your session has expired, please log in again",persist:"login"}))},success:function(e,t,n){this.setToken(t)},setToken:function(e){app.token=e.jwt,sessionStorage.setItem("token",app.token),this.$el.find("form").addClass("loading"),app.getuser({callback:function(){var e=window.location.pathname.substr(i.history.root.length);e?(app.navigate("/",{trigger:!1}),app.navigate(e,{trigger:!0})):app.trigger("go:home")}})},failure:function(e,t,n){console.log("failure from login"),app.alert({message:"We couldnt log you in, maybe your password or username were incorrect?"})}})}.apply(t,i))||(e.exports=o)},475:function(e,t,n){(function(i){var o,a;o=[n(6),n(18)],void 0===(a=function(e){i.extend(e.Validation.patterns,{wwsdash:/^(\w|\s|\-)+$/,wwsldash:/^(\w|\s|\-|\/)+$/,wwsbdash:/^(\w|\s|\-|\(|\))+$/,wwdash:/^(\w|\-)+$/,datetime:/^\d\d-\d\d-\d\d\d\d \d\d:\d\d$/,edate:/^\d\d-\d\d-\d\d\d\d$/,word:/^\w+$/,fcode:/^DLS\-(MX|IN|CY|BI)\-\d\d\d\d$/i,time:/^\d\d:\d\d$/,sequence:/^[>;\s\w+\n\(\)\.\|]+$/,address:/^(\w|\s|\-|\n|,)+$/,array:/^[\d+(.\d+)?),]+$/,country:/^(\w|\s|\-|,|\(|\)|')+$/,visit:/^\w+\d+-\d+$/,twopath:/^(\w|-)+\/?(\w|-)+$/}),i.extend(e.Validation.messages,{required:"This field is required",wwsdash:"This field must contain only letters, numbers, spaces, underscores, and dashes",wwdash:"This field must contain only letters, numbers, underscores, and dashes",edate:"Please specify a valid date (european style)",word:"This field must contain only letters and numbers",fcode:"This field must be of the format DLS-XX-XXXX",datetime:"This field must be of the format DD-MM-YYYY HH:MM",time:"This field must be of the format HH:MM",sequence:"This field may only contain word characters and line returns",address:"This field may only contain word character, spaces, and line returns",array:"This field may only contain numbers and commas",country:"This field must contain only letters, numbers, spaces, underscores, dashes, and commas",visit:"This field must be of the format xxx123-123",twopath:"This field can hold a path with two folders"})}.apply(t,o))||(e.exports=a)}).call(this,n(5))},476:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <h1>Login</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n\n            <li>\n                <label>Username (FedID)\n                </label>\n                <input type="text" name="login" />\n            </li>\n\n            <li>\n                <label>Password\n                </label>\n                <input type="password" name="password" />\n            </li>\n\n\n            <button name="submit" value="1" type="submit" class="button submit">Login</button>\n\n\n        </ul>\n    </div>\n\n    </form>\n\n';return __p}},477:function(e,t,n){var i,o;i=[n(6)],void 0===(o=function(e){return e.Model.extend({urlRoot:"/options"})}.apply(t,i))||(e.exports=o)}}]);