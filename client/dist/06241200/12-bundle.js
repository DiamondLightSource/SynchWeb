(window.webpackJsonp=window.webpackJsonp||[]).push([[12],[,,,,,,,,,,,,function(e,t,i){(function(n,s){var a,l;a=[i(7),i(16),i(183),i(62),i(184)],void 0===(l=function(e,t,i,a){return e.LayoutView.extend({template:n.template('<div class="perp"></div><div class="srch clearfix"></div><div class="tbl bg"></div><div class="page_wrap"></div>'),regions:{table:".tbl",pages:".page_wrap:last",search:".srch",pp:".perp"},pages:!0,noTableHolder:!1,initialize:function(e){this.collection=e.collection,e.loading&&(this.listenTo(this.collection,"request",this.displaySpinner),this.listenTo(this.collection,"sync",this.removeSpinner),this.listenTo(this.collection,"error",this.removeSpinner));var n=s.extend({},{columns:this.getOption("columns"),collection:e.collection,className:e.tableClass},this.getOption("backgrid"));this.grid=new t.Grid(n),this.getOption("pages")&&(this.paginator=new a({collection:e.collection,noUrl:e.noPageUrl})),e.filter&&(this.filter=new i({collection:e.collection,name:e.filter,url:!e.noSearchUrl,value:e.search}))},displaySpinner:function(){this.table.$el.addClass("loading")},removeSpinner:function(){this.table.$el.removeClass("loading")},onRender:function(){console.log("render"),this.table.show(this.grid),this.getOption("noTableHolder")||this.table.$el.addClass("table"),this.getOption("pages")?this.pages.show(this.paginator):this.$el.find(".page_wrap").hide(),this.filter&&this.search.show(this.filter)},focusSearch:function(){this.$el.find("input[type=search]").focus()}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return{opts:function(e){return(e&&e.empty?'<option value=""> - </option>':"")+this.map((function(t){var i="";return e&&e.callback instanceof Function?i=e.callback(t):e&&e.addClass&&e.classProperty&&t.get(e.classProperty)==e.classPropertyValue&&(i=e.addClass),'<option class="'+i+'" value="'+t.escape(this.valueAttribute)+'">'+t.escape(this.keyAttribute)+"</option>"}),this).join("\n")},kv:function(e){var t={};return e&&e.empty&&(t[""]=" - "),this.each((function(e){t[e.escape(this.valueAttribute)]=e.escape(this.keyAttribute)}),this),t},array:function(e){var t=[];return e&&e.none&&t.push(["-",""]),this.each((function(e){t.push([e.get(this.keyAttribute),e.get(this.valueAttribute)])}),this),t}}}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(16),i(11),i(106),i(186),i(6),i(18)],void 0===(l=function(e,t,i,a,l,o){var r=t.Cell.extend({fromRaw:function(e,t){return null==e?"":e},toRaw:function(e,t){var i=this.column.get("name"),n=this.model.preValidate(i,e);return console.log(i,n,t.validation[i]),n?this.$el.find("input").addClass("ferror"):this.$el.find("input").removeClass("ferror"),n?void 0:e},initialize:function(e){r.__super__.initialize.call(this,e),this.formatter.toRaw=this.toRaw.bind(this),this.formatter.fromRaw=this.fromRaw.bind(this),n.extend(this.model.__proto__,o.Validation.mixin)}}),c=t.Cell.extend({events:{"change input":"updateModel","blur input":"updateModel","keyup input":"updateModel","change select":"updateModel"},updateModel:function(e){console.log("up mod",s(e.target).attr("name")),this.model.set(s(e.target).attr("name"),s(e.target).val()),this.validate({attr:s(e.target).attr("name"),val:s(e.target).val()}),this.preSave()},preSave:function(){if(this.model.isValid(!0)){var e=this.model.changedAttributes();!e||1==Object.keys(e).length&&("isSelected"in e||"_valid"in e)||(console.log("attrs changed",this.model.changedAttributes()),this.model.save(this.model.attributes,{patch:!0}))}else console.log("model invalid")},validate:function(e){var t=this.model.preValidate(e.attr,e.val),i=this.$el.find("[name="+e.attr+"]");t?this.invalid(i,t):this.valid(i)},invalid:function(e,t){s(e).removeClass("fvalid").addClass("ferror"),s(e).siblings("span.errormessage").length?s(e).siblings("span.errormessage").text(t):s(e).after('<span class="errormessage ferror">'+t+"</span>")},valid:function(e){s(e).removeClass("ferror").addClass("fvalid").siblings("span.errormessage").remove()},initialize:function(e){c.__super__.initialize.call(this,e),this.preSave=n.debounce(this.preSave,1e3),this.updateModel=n.debounce(this.updateModel,100)},bindModel:function(){o.Validation.unbind(this),o.Validation.bind(this,{model:this.model,selector:"name",valid:function(e,t){e.valid(e.$el.find("[name="+t+"]"))},invalid:function(e,t,i){e.invalid(e.$el.find("[name="+t+"]"),i)}})}}),p=t.StringCell.extend({render:function(){p.__super__.render.call(this);var e=l(this.model);return this.$el.html('<span class="badge '+e+'">'+this.$el.html()+"</span>"),this}});return{ValidatedCell:r,ValidatedTemplateCell:c,SafetyCell:p,ClickableRow:t.Row.extend({events:{click:"onClick"},onClick:function(e){s(e.target).is("i")||s(e.target).is("a")||s(e.target).is("input")||s(e.target).hasClass("editable")||(this.cookie&&this.model.get("PROP")&&app.cookie(this.model.get("PROP")),app.trigger(this.event,this.model.get(this.argument)))}}),BGSelectRow:t.Row.extend({events:{click:"onClick"},onClick:function(e){s(e.target).is("input[type=checkbox]")||this.model.trigger("backgrid:select",this.model,!this.$el.find("input[type=checkbox]").is(":checked"))}}),TemplateCell:t.Cell.extend({render:function(){if(this.$el.empty(),!this.column.get("test")||this.column.get("test")&&"[object Array]"!==Object.prototype.toString.call(this.model.get(this.column.get("test")))&&"0"!=this.model.get(this.column.get("test"))||this.column.get("test")&&"[object Array]"===Object.prototype.toString.call(this.model.get(this.column.get("test")))&&this.model.get(this.column.get("test")).length){var e=n.isFunction(this.getTemplate)?n.result(this,"getTemplate"):this.column.get("template"),t=n.isFunction(e)?e:n.template(e),i=n.extend({},this.model.toJSON(),{APIURL:app.apiurl});this.$el.html(t(i))}return this.delegateEvents(),this}}),ProjectCell:t.Cell.extend({events:{"click a.atp":"addToProject"},addToProject:function(e){e.preventDefault(),app.dialog.show(new a({name:this.model.get(this.column.get("itemname")),type:this.column.get("itemtype"),iid:this.model.get(this.column.get("itemid"))}))},render:function(){return this.$el.append('<a class="button button-notext atp"><i class="fa fa-book"></i> <span>Add to Project</span></a>'),this}}),HTMLCell:t.Cell.extend({render:function(e){return this.$el.empty(),this.$el.html(this.model.get(this.column.get("name"))),this.column.get("center")||this.$el.addClass("la"),this.delegateEvents(),this}}),StatusCell:t.Cell.extend({render:function(){this.$el.empty();var e="";return n.each(["R","GR","SC","AI","DC","AP"],(function(t){this.model.get(t)>0&&(e='<li class="'+t+'"></li>')}),this),e&&this.$el.append('<ul class="status">'+e+"</ul>"),this}}),ShadedCell:t.Cell.extend({render:function(){var e=this.model.get(this.column.get("name"));this.$el.text(e);var t=this.model.collection.fullCollection.pluck(this.column.get("name")),s=n.reduce(t,(function(e,t){return e+t}),0)/t.length;return col=null,e>s&&(col=i.shadeColor("#00cc00",1-e/s*.35)),e<s&&(col=i.shadeColor("#cc0000",e/s*.55)),col&&this.$el.css("background-color",col),this}}),SelectInputCell:t.SelectCell.extend({optionValues:function(){return this.column.get("options").array({none:this.column.get("none")})}})}}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(8),i(72),i(28),i(496),i(497),i(292),i(498),i(293),i(294),i(499),i(500)],void 0===(a=function(e,t,i){var s={submit:"Ok",style:"display: inline"},a={date:{type:"datepicker",onblur:"ignore",datepicker:{dateFormat:"dd-mm-yy"}},text:{width:"100px",height:"20px",type:"text"},textlong:{width:"180px",height:"25px",type:"text"},markdown:{type:"textarea",rows:5,onblur:"ignore",callback:function(e,n){t(this).html(i.toHTML(e))},data:function(e,t){return t.model.get(t.attr)}},textarea:{type:"textarea",rows:5,onblur:"ignore"},select:{type:"select",onblur:"ignore",callback:function(e,i){t(this).html(n.result(i,"data")[e])}},autocomplete:{type:"autocomplete",onblur:"ignore"},datetime:{type:"datetime",onblur:"ignore"},time:{type:"time",onblur:"ignore"}};return e.Controller.extend({initialize:function(e){this.model=e.model,this.el=e.el,this.addTypes()},addTypes:function(){t.editable.addInputType("autocomplete",{element:function(e,i){t(this).append('<input type="text"/>');var n=t('<input id="prac" type="hidden"/>');return t(this).append(n),n},plugin:function(e,i){var n=t.extend({select:function(e,i){t("#prac").val(i.item.id)}},e.autocomplete);t("input[type=text]",this).autocomplete(n)},submit:function(e,i){if(!t("input[type=hidden]",this).val())return i.reset(),!1}}),t.editable.addInputType("datetime",{element:function(e,i){e.onblur=function(e){};var n=t('<input value="'+i+'" />');return t(this).append(n),t(this).children("input").datetimepicker({dateFormat:"dd-mm-yy"}),n}}),t.editable.addInputType("time",{element:function(e,i){e.onblur=function(e){};var n=t('<input value="'+i+'" />');return t(this).append(n),t(this).children("input").timepicker(),n}})},create:function(e,i,l,o){this.el.find("."+e).editable(function(t,i){this.model.set(e,t),console.log("valid",this.model.isValid(!0),e,"changed",this.model.changedAttributes());var s=this;return this.model.save(this.model.changedAttributes(),{patch:!0,validate:!1,success:function(){o&&s.model.fetch()},error:function(e,t,i){console.log("editable error",e,"xhr",t,"opts",i)}}),o?"":n.escape(t)}.bind(this),t.extend({},s,a[i],l,{onsubmit:function(i,n){var s=this.model.preValidate(e,t("[name=value]",n).val());return s?(t("input,select",n).addClass("ferror"),t(".errormessage",n).length||t(n).append('<span class="errormessage ferror">'+s+"</span>")):(t("input,select",n).removeClass("ferror"),t(".errormessage",n).remove()),!s}.bind(this),attr:e,model:this.model})).addClass("editable")}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,,,,function(e,t,i){var n,s;n=[i(7)],void 0===(s=function(){var e=Image;return"imagecache"in app||(app.imagecache={}),e.prototype.load=function(e,t){var i=this;this.completedPercentage=0;var n=new XMLHttpRequest;if(e.startsWith("data:image"))return i.src=e,void(t&&t(this));if(e in app.imagecache)return i.src=app.imagecache[e],void(t&&t(this));var s=e+(e.indexOf("?")>-1?"&prop=":"?prop=")+app.prop;n.open("GET",s,!0),app.token&&n.setRequestHeader("Authorization","Bearer "+app.token),n.responseType="arraybuffer",n.onload=function(s){if(0!=n.status&&200==n.status){var a=n.getAllResponseHeaders().match(/^Content-Type\:\s*(.*?)$/im)[1]||"image/png",l=new Blob([this.response],{type:a});i.src=window.URL.createObjectURL(l),app.imagecache[e]=i.src,t&&t(this)}else i.onerror(n.status,s)},n.onprogress=function(e){if(e.lengthComputable){var t=parseInt(e.loaded/e.total*100);t!=i.completedPercentage&&(i.completedPercentage=t,i.onprogress&&i.onprogress(t)),i.completedPercentage=t}},n.onloadstart=function(){i.completedPercentage=0},n.onloadend=function(){i.completedPercentage=100},n.onerror=function(){console.log("img network error")},n.send()},e}.apply(t,n))||(e.exports=s)},,function(e,t,i){(function(n,s){var a,l;a=[i(6),i(7)],void 0===(l=function(e,t){var i=e.Model.extend({isSelected:!1,setSelected:function(e){this.set("isSelected",e)}}),a=e.Collection.extend({model:i,inUpdate:!1,initialize:function(){this.on("change:isSelected",this.onSelectedChanged,this)},onSelectedChanged:function(e){this.inUpdate||(this.inUpdate=!0,this.each((function(e){!0!==e.get("isSelected")||e._changing||e.set({isSelected:!1})})),this.inUpdate=!1,this.trigger("selected:change",e))}}),l=t.ItemView.extend({tagName:"li",template:n.template("<%-name%>"),events:{click:"select"},initialize:function(e){this.model.on("change:isSelected",this.onSelectedChanged.bind(this))},onSelectedChanged:function(){this.model.get("isSelected")?this.$el.addClass("current"):this.$el.removeClass("current")},onRender:function(){this.$el.attr("id",this.model.get("id")),this.model.get("isSelected")&&this.$el.addClass("current")},select:function(e){this.model.get("isSelected")?this.model.set({isSelected:!1}):this.model.set({isSelected:!0})}});return t.CollectionView.extend({childView:l,tagName:"ul",name:"t",mobile:!1,urlFragment:"ty",url:!0,filters:[{id:"dc",name:"Data Collections"},{id:"gr",name:"Grid Scans"},{id:"fc",name:"Full Collections"},{id:"ap",name:"Auto Integrated"},{id:"err",name:"Processing Errors"},{id:"sc",name:"Screenings"},{id:"edge",name:"Edge Scans"},{id:"mca",name:"MCA Spectra"},{id:"rb",name:"Robot Actions"},{id:"ac",name:"Sample Actions"},{id:"flag",name:"Favourites"}],initialize:function(e){if(this.filterablecollection=e.collection,this.collection=new a(e.filters||this.getOption("filters")),e.value){var t=this.collection.findWhere({id:e.value});t&&t.setSelected(!0)}this.listenTo(this.collection,"selected:change",this._filter.bind(this));var i=this;this.filterablecollection&&(this.filterablecollection.queryParams[this.getOption("name")]=function(){return i.selected()})},_filter:function(e){var t=this.selected();if(this.trigger("selected:change",t,this.selectedName()),this.filterablecollection&&this.filterablecollection.getFirstPage({reset:!0,fetch:!0}),this.getOption("url")){if(this.getOption("urlFragment"))var i=window.location.pathname.replace(new RegExp("\\/"+this.getOption("urlFragment")+"(\\/\\w+)?"),"")+(t?"/"+this.getOption("urlFragment")+"/"+t:"");else i=window.location.pathname.replace(/\/\w+$/,"")+(t?"/"+t:"");window.history.pushState({},"",i)}},selected:function(){var e=this.collection.findWhere({isSelected:!0});return e?e.get("id"):null},selectedName:function(){var e=this.collection.findWhere({isSelected:!0});return e?e.get("name"):null},onRender:function(){if(this.getOption("mobile")){var e=this,t='<option value="">- Filter -</option>'+this.collection.map((function(e){return'<option value="'+e.get("id")+'">'+e.get("name")+"</option>"}));s("span.search-mobile").append('<select class="filter-mobile">'+t+"</select>"),s("span.search-mobile").addClass("split"),s("select.filter-mobile").unbind("change").bind("change",(function(t){var i=e.collection.findWhere({id:s("select.filter-mobile").val()});i?i.setSelected(!0):e.collection.findWhere({isSelected:!0}).setSelected(!1)}))}},onDestroy:function(){this.getOption("mobile")&&(s("select.filter-mobile").unbind("change"),s("span.search-mobile").removeClass("split").find("select.filter-mobile").remove())}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},,,,,,function(e,t,i){(function(n){var s,a;s=[i(10),i(45),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({},i,{model:t,mode:"server",url:"/proposal/visits",state:{pageSize:10},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data},keyAttribute:"VISITDETAIL",valueAttribute:"SESSIONID"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,function(e,t,i){var n,s;n=[i(6),i(5),i(10),i(57)],void 0===(s=function(e,t,i,n){return i.extend({model:n,mode:"server",url:"/sample",comparator:function(e){return parseInt(e.get("LOCATION"))},state:{pageSize:15},initialize:function(e,t){this.running=t&&t.poll,this.refresh_thread=null,this.on("change:isSelected",this.onSelectedChanged,this),this.fetched=!1,this.on("sync",this.setFetched,this)},setFetched:function(){this.fetched||(console.log("fetched samples"),this.fetched=!0,this.trigger("reset"))},onSelectedChanged:function(e){this.each((function(e){!0!==e.get("isSelected")||e._changing||e.set({isSelected:!1},{silent:!0})})),console.log("trigger selected change"),this.trigger("selected:change")},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),5e3)),e.data},save:function(i){i=t.extend({},i);var n=this,s=i.success;return i.success=function(e){n.reset(e,{silent:!0}),s&&s(n,e,i)},e.sync("create",this,i)}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(5),i(6),i(10),i(107)],void 0===(s=function(e,t,i,n){return i.extend({model:n,mode:"server",url:"/dc",state:{pageSize:15},initialize:function(e,t){this.running=!0,t&&0==t.running&&(this.running=!1),this.refresh_thread=null,console.log("dc",t,this.running),this.fetched=!1,this.on("sync",this.setFetched,this)},setFetched:function(){this.fetched||(this.fetched=!0,this.trigger("reset"))},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},run:function(){this.running=!0,this.fetch()},parseState:function(e,t,i,n){return{totalRecords:e[0]*i.pageSize}},doFetch:function(){clearTimeout(this.refresh_thread);var e=this;this.running&&(this.refresh_thread=setTimeout((function(){e.fetch({error:function(t){e.doFetch()}})}),5e3))},parseRecords:function(e,t){return this.doFetch(),e[1]}})}.apply(t,n))||(e.exports=s)},,,,function(e,t,i){(function(n){var s,a;s=[i(6),i(18)],void 0===(a=function(e){var t=e.Model.extend({idAttribute:"VISIT",urlRoot:"/proposal/visits",initialize:function(e){this.on("change",this.addDate,this),this.addDate()},validation:{PROPOSALID:{required:!0,pattern:"number"},STARTDATE:{required:!0,pattern:"datetime"},ENDDATE:{required:!0,pattern:"datetime"},BEAMLINENAME:{required:!0,pattern:"wwdash"},BEAMLINEOPERATOR:{required:!1,pattern:"wwsdash"},SCHEDULED:{required:!1,pattern:"number"},BEAMLINESETUPID:{required:!1,pattern:"number"},COMMENTS:{required:!1,pattern:"wwsdash"},VISITNUMBER:{required:!1,pattern:"number"}},addDate:function(){this.attributes.STISO=new Date(this.get("STISO")),this.attributes.ENISO=new Date(this.get("ENISO")),this.attributes.LEN=+((this.attributes.ENISO-this.attributes.STISO)/36e5).toFixed(2),this.attributes.VISITDETAIL=this.get("VISIT")+" ("+this.get("BL")+": "+this.get("ST")+")"}});return n.extend(t.prototype,e.Validation.mixin),t}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6),i(72)],void 0===(s=function(e,t){return e.Model.extend({idAttribute:"PROTEINID",urlRoot:"/sample/proteins",initialize:function(){this.on("change",this.refreshOptions,this),this.refreshOptions()},defaults:{SEQUENCEMD:"",CONCENTRATIONTYPE:""},refreshOptions:function(){this.get("SEQUENCE")&&(this.attributes.SEQUENCEMD=t.toHTML(this.get("SEQUENCE")))},validation:{NAME:{required:!1,pattern:"wwsbdash"},ACRONYM:{required:!0,pattern:"wwdash"},SEQUENCE:{required:!1,pattern:"sequence"},MOLECULARMASS:{required:!1,pattern:"number"},CONCENTRATIONTYPEID:{required:!1,pattern:"number"},COMPONENTTYPEID:{required:!1,pattern:"number"},COMPONENTSUBTYPEID:{required:!1,pattern:"number"},ABUNDANCE:{required:!1,pattern:"number"}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a,l;
/*! Magnific Popup - v1.1.0 - 2016-02-20
* http://dimsemenov.com/plugins/magnific-popup/
* Copyright (c) 2016 Dmitry Semenov; */a=[i(8),i(29)],void 0===(l="function"==typeof(s=function(e,t){var i,s,a,l,o,r,c=function(){},p=!!n,d=e(window),u=function(e,t){i.ev.on("mfp"+e+".mfp",t)},h=function(t,i,n,s){var a=document.createElement("div");return a.className="mfp-"+t,n&&(a.innerHTML=n),s?i&&i.appendChild(a):(a=e(a),i&&a.appendTo(i)),a},m=function(t,n){i.ev.triggerHandler("mfp"+t,n),i.st.callbacks&&(t=t.charAt(0).toLowerCase()+t.slice(1),i.st.callbacks[t]&&i.st.callbacks[t].apply(i,e.isArray(n)?n:[n]))},_=function(t){return t===r&&i.currTemplate.closeBtn||(i.currTemplate.closeBtn=e(i.st.closeMarkup.replace("%title%",i.st.tClose)),r=t),i.currTemplate.closeBtn},f=function(){e.magnificPopup.instance||((i=new c).init(),e.magnificPopup.instance=i)};c.prototype={constructor:c,init:function(){var t=navigator.appVersion;i.isLowIE=i.isIE8=document.all&&!document.addEventListener,i.isAndroid=/android/gi.test(t),i.isIOS=/iphone|ipad|ipod/gi.test(t),i.supportsTransition=function(){var e=document.createElement("p").style,t=["ms","O","Moz","Webkit"];if(void 0!==e.transition)return!0;for(;t.length;)if(t.pop()+"Transition"in e)return!0;return!1}(),i.probablyMobile=i.isAndroid||i.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent),a=e(document),i.popupsCache={}},open:function(t){var n;if(!1===t.isObj){i.items=t.items.toArray(),i.index=0;var s,l=t.items;for(n=0;n<l.length;n++)if((s=l[n]).parsed&&(s=s.el[0]),s===t.el[0]){i.index=n;break}}else i.items=e.isArray(t.items)?t.items:[t.items],i.index=t.index||0;if(!i.isOpen){i.types=[],o="",t.mainEl&&t.mainEl.length?i.ev=t.mainEl.eq(0):i.ev=a,t.key?(i.popupsCache[t.key]||(i.popupsCache[t.key]={}),i.currTemplate=i.popupsCache[t.key]):i.currTemplate={},i.st=e.extend(!0,{},e.magnificPopup.defaults,t),i.fixedContentPos="auto"===i.st.fixedContentPos?!i.probablyMobile:i.st.fixedContentPos,i.st.modal&&(i.st.closeOnContentClick=!1,i.st.closeOnBgClick=!1,i.st.showCloseBtn=!1,i.st.enableEscapeKey=!1),i.bgOverlay||(i.bgOverlay=h("bg").on("click.mfp",(function(){i.close()})),i.wrap=h("wrap").attr("tabindex",-1).on("click.mfp",(function(e){i._checkIfClose(e.target)&&i.close()})),i.container=h("container",i.wrap)),i.contentContainer=h("content"),i.st.preloader&&(i.preloader=h("preloader",i.container,i.st.tLoading));var r=e.magnificPopup.modules;for(n=0;n<r.length;n++){var c=r[n];c=c.charAt(0).toUpperCase()+c.slice(1),i["init"+c].call(i)}m("BeforeOpen"),i.st.showCloseBtn&&(i.st.closeBtnInside?(u("MarkupParse",(function(e,t,i,n){i.close_replaceWith=_(n.type)})),o+=" mfp-close-btn-in"):i.wrap.append(_())),i.st.alignTop&&(o+=" mfp-align-top"),i.fixedContentPos?i.wrap.css({overflow:i.st.overflowY,overflowX:"hidden",overflowY:i.st.overflowY}):i.wrap.css({top:d.scrollTop(),position:"absolute"}),(!1===i.st.fixedBgPos||"auto"===i.st.fixedBgPos&&!i.fixedContentPos)&&i.bgOverlay.css({height:a.height(),position:"absolute"}),i.st.enableEscapeKey&&a.on("keyup.mfp",(function(e){27===e.keyCode&&i.close()})),d.on("resize.mfp",(function(){i.updateSize()})),i.st.closeOnContentClick||(o+=" mfp-auto-cursor"),o&&i.wrap.addClass(o);var p=i.wH=d.height(),f={};if(i.fixedContentPos&&i._hasScrollBar(p)){var g=i._getScrollbarSize();g&&(f.marginRight=g)}i.fixedContentPos&&(i.isIE7?e("body, html").css("overflow","hidden"):f.overflow="hidden");var v=i.st.mainClass;return i.isIE7&&(v+=" mfp-ie7"),v&&i._addClassToMFP(v),i.updateItemHTML(),m("BuildControls"),e("html").css(f),i.bgOverlay.add(i.wrap).prependTo(i.st.prependTo||e(document.body)),i._lastFocusedEl=document.activeElement,setTimeout((function(){i.content?(i._addClassToMFP("mfp-ready"),i._setFocus()):i.bgOverlay.addClass("mfp-ready"),a.on("focusin.mfp",i._onFocusIn)}),16),i.isOpen=!0,i.updateSize(p),m("Open"),t}i.updateItemHTML()},close:function(){i.isOpen&&(m("BeforeClose"),i.isOpen=!1,i.st.removalDelay&&!i.isLowIE&&i.supportsTransition?(i._addClassToMFP("mfp-removing"),setTimeout((function(){i._close()}),i.st.removalDelay)):i._close())},_close:function(){m("Close");var t="mfp-removing mfp-ready ";if(i.bgOverlay.detach(),i.wrap.detach(),i.container.empty(),i.st.mainClass&&(t+=i.st.mainClass+" "),i._removeClassFromMFP(t),i.fixedContentPos){var n={marginRight:""};i.isIE7?e("body, html").css("overflow",""):n.overflow="",e("html").css(n)}a.off("keyup.mfp focusin.mfp"),i.ev.off(".mfp"),i.wrap.attr("class","mfp-wrap").removeAttr("style"),i.bgOverlay.attr("class","mfp-bg"),i.container.attr("class","mfp-container"),!i.st.showCloseBtn||i.st.closeBtnInside&&!0!==i.currTemplate[i.currItem.type]||i.currTemplate.closeBtn&&i.currTemplate.closeBtn.detach(),i.st.autoFocusLast&&i._lastFocusedEl&&e(i._lastFocusedEl).focus(),i.currItem=null,i.content=null,i.currTemplate=null,i.prevHeight=0,m("AfterClose")},updateSize:function(e){if(i.isIOS){var t=document.documentElement.clientWidth/window.innerWidth,n=window.innerHeight*t;i.wrap.css("height",n),i.wH=n}else i.wH=e||d.height();i.fixedContentPos||i.wrap.css("height",i.wH),m("Resize")},updateItemHTML:function(){var t=i.items[i.index];i.contentContainer.detach(),i.content&&i.content.detach(),t.parsed||(t=i.parseEl(i.index));var n=t.type;if(m("BeforeChange",[i.currItem?i.currItem.type:"",n]),i.currItem=t,!i.currTemplate[n]){var s=!!i.st[n]&&i.st[n].markup;m("FirstMarkupParse",s),i.currTemplate[n]=!s||e(s)}l&&l!==t.type&&i.container.removeClass("mfp-"+l+"-holder");var a=i["get"+n.charAt(0).toUpperCase()+n.slice(1)](t,i.currTemplate[n]);i.appendContent(a,n),t.preloaded=!0,m("Change",t),l=t.type,i.container.prepend(i.contentContainer),m("AfterChange")},appendContent:function(e,t){i.content=e,e?i.st.showCloseBtn&&i.st.closeBtnInside&&!0===i.currTemplate[t]?i.content.find(".mfp-close").length||i.content.append(_()):i.content=e:i.content="",m("BeforeAppend"),i.container.addClass("mfp-"+t+"-holder"),i.contentContainer.append(i.content)},parseEl:function(t){var n,s=i.items[t];if(s.tagName?s={el:e(s)}:(n=s.type,s={data:s,src:s.src}),s.el){for(var a=i.types,l=0;l<a.length;l++)if(s.el.hasClass("mfp-"+a[l])){n=a[l];break}s.src=s.el.attr("data-mfp-src"),s.src||(s.src=s.el.attr("href"))}return s.type=n||i.st.type||"inline",s.index=t,s.parsed=!0,i.items[t]=s,m("ElementParse",s),i.items[t]},addGroup:function(e,t){var n=function(n){n.mfpEl=this,i._openClick(n,e,t)};t||(t={});var s="click.magnificPopup";t.mainEl=e,t.items?(t.isObj=!0,e.off(s).on(s,n)):(t.isObj=!1,t.delegate?e.off(s).on(s,t.delegate,n):(t.items=e,e.off(s).on(s,n)))},_openClick:function(t,n,s){if((void 0!==s.midClick?s.midClick:e.magnificPopup.defaults.midClick)||!(2===t.which||t.ctrlKey||t.metaKey||t.altKey||t.shiftKey)){var a=void 0!==s.disableOn?s.disableOn:e.magnificPopup.defaults.disableOn;if(a)if(e.isFunction(a)){if(!a.call(i))return!0}else if(d.width()<a)return!0;t.type&&(t.preventDefault(),i.isOpen&&t.stopPropagation()),s.el=e(t.mfpEl),s.delegate&&(s.items=n.find(s.delegate)),i.open(s)}},updateStatus:function(e,t){if(i.preloader){s!==e&&i.container.removeClass("mfp-s-"+s),t||"loading"!==e||(t=i.st.tLoading);var n={status:e,text:t};m("UpdateStatus",n),e=n.status,t=n.text,i.preloader.html(t),i.preloader.find("a").on("click",(function(e){e.stopImmediatePropagation()})),i.container.addClass("mfp-s-"+e),s=e}},_checkIfClose:function(t){if(!e(t).hasClass("mfp-prevent-close")){var n=i.st.closeOnContentClick,s=i.st.closeOnBgClick;if(n&&s)return!0;if(!i.content||e(t).hasClass("mfp-close")||i.preloader&&t===i.preloader[0])return!0;if(t===i.content[0]||e.contains(i.content[0],t)){if(n)return!0}else if(s&&e.contains(document,t))return!0;return!1}},_addClassToMFP:function(e){i.bgOverlay.addClass(e),i.wrap.addClass(e)},_removeClassFromMFP:function(e){this.bgOverlay.removeClass(e),i.wrap.removeClass(e)},_hasScrollBar:function(e){return(i.isIE7?a.height():document.body.scrollHeight)>(e||d.height())},_setFocus:function(){(i.st.focus?i.content.find(i.st.focus).eq(0):i.wrap).focus()},_onFocusIn:function(t){if(t.target!==i.wrap[0]&&!e.contains(i.wrap[0],t.target))return i._setFocus(),!1},_parseMarkup:function(t,i,n){var s;n.data&&(i=e.extend(n.data,i)),m("MarkupParse",[t,i,n]),e.each(i,(function(i,n){if(void 0===n||!1===n)return!0;if((s=i.split("_")).length>1){var a=t.find(".mfp-"+s[0]);if(a.length>0){var l=s[1];"replaceWith"===l?a[0]!==n[0]&&a.replaceWith(n):"img"===l?a.is("img")?a.attr("src",n):a.replaceWith(e("<img>").attr("src",n).attr("class",a.attr("class"))):a.attr(s[1],n)}}else t.find(".mfp-"+i).html(n)}))},_getScrollbarSize:function(){if(void 0===i.scrollbarSize){var e=document.createElement("div");e.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(e),i.scrollbarSize=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return i.scrollbarSize}},e.magnificPopup={instance:null,proto:c.prototype,modules:[],open:function(t,i){return f(),(t=t?e.extend(!0,{},t):{}).isObj=!0,t.index=i||0,this.instance.open(t)},close:function(){return e.magnificPopup.instance&&e.magnificPopup.instance.close()},registerModule:function(t,i){i.options&&(e.magnificPopup.defaults[t]=i.options),e.extend(this.proto,i.proto),this.modules.push(t)},defaults:{disableOn:0,key:null,midClick:!1,mainClass:"",preloader:!0,focus:"",closeOnContentClick:!1,closeOnBgClick:!0,closeBtnInside:!0,showCloseBtn:!0,enableEscapeKey:!0,modal:!1,alignTop:!1,removalDelay:0,prependTo:null,fixedContentPos:"auto",fixedBgPos:"auto",overflowY:"auto",closeMarkup:'<button title="%title%" type="button" class="mfp-close">&#215;</button>',tClose:"Close (Esc)",tLoading:"Loading...",autoFocusLast:!0}},e.fn.magnificPopup=function(t){f();var n=e(this);if("string"==typeof t)if("open"===t){var s,a=p?n.data("magnificPopup"):n[0].magnificPopup,l=parseInt(arguments[1],10)||0;a.items?s=a.items[l]:(s=n,a.delegate&&(s=s.find(a.delegate)),s=s.eq(l)),i._openClick({mfpEl:s},n,a)}else i.isOpen&&i[t].apply(i,Array.prototype.slice.call(arguments,1));else t=e.extend(!0,{},t),p?n.data("magnificPopup",t):n[0].magnificPopup=t,i.addGroup(n,t);return n};var g,v,b,w=function(){b&&(v.after(b.addClass(g)).detach(),b=null)};e.magnificPopup.registerModule("inline",{options:{hiddenClass:"hide",markup:"",tNotFound:"Content not found"},proto:{initInline:function(){i.types.push("inline"),u("Close.inline",(function(){w()}))},getInline:function(t,n){if(w(),t.src){var s=i.st.inline,a=e(t.src);if(a.length){var l=a[0].parentNode;l&&l.tagName&&(v||(g=s.hiddenClass,v=h(g),g="mfp-"+g),b=a.after(v).detach().removeClass(g)),i.updateStatus("ready")}else i.updateStatus("error",s.tNotFound),a=e("<div>");return t.inlineElement=a,a}return i.updateStatus("ready"),i._parseMarkup(n,{},t),n}}});var E,S=function(){E&&e(document.body).removeClass(E)},I=function(){S(),i.req&&i.req.abort()};e.magnificPopup.registerModule("ajax",{options:{settings:null,cursor:"mfp-ajax-cur",tError:'<a href="%url%">The content</a> could not be loaded.'},proto:{initAjax:function(){i.types.push("ajax"),E=i.st.ajax.cursor,u("Close.ajax",I),u("BeforeChange.ajax",I)},getAjax:function(t){E&&e(document.body).addClass(E),i.updateStatus("loading");var n=e.extend({url:t.src,success:function(n,s,a){var l={data:n,xhr:a};m("ParseAjax",l),i.appendContent(e(l.data),"ajax"),t.finished=!0,S(),i._setFocus(),setTimeout((function(){i.wrap.addClass("mfp-ready")}),16),i.updateStatus("ready"),m("AjaxContentAdded")},error:function(){S(),t.finished=t.loadError=!0,i.updateStatus("error",i.st.ajax.tError.replace("%url%",t.src))}},i.st.ajax.settings);return i.req=e.ajax(n),""}}});var y,C,x=function(t){if(t.data&&void 0!==t.data.title)return t.data.title;var n=i.st.image.titleSrc;if(n){if(e.isFunction(n))return n.call(i,t);if(t.el)return t.el.attr(n)||""}return""};e.magnificPopup.registerModule("image",{options:{markup:'<div class="mfp-figure"><div class="mfp-close"></div><figure><div class="mfp-img"></div><figcaption><div class="mfp-bottom-bar"><div class="mfp-title"></div><div class="mfp-counter"></div></div></figcaption></figure></div>',cursor:"mfp-zoom-out-cur",titleSrc:"title",verticalFit:!0,tError:'<a href="%url%">The image</a> could not be loaded.'},proto:{initImage:function(){var t=i.st.image,n=".image";i.types.push("image"),u("Open"+n,(function(){"image"===i.currItem.type&&t.cursor&&e(document.body).addClass(t.cursor)})),u("Close"+n,(function(){t.cursor&&e(document.body).removeClass(t.cursor),d.off("resize.mfp")})),u("Resize"+n,i.resizeImage),i.isLowIE&&u("AfterChange",i.resizeImage)},resizeImage:function(){var e=i.currItem;if(e&&e.img&&i.st.image.verticalFit){var t=0;i.isLowIE&&(t=parseInt(e.img.css("padding-top"),10)+parseInt(e.img.css("padding-bottom"),10)),e.img.css("max-height",i.wH-t)}},_onImageHasSize:function(e){e.img&&(e.hasSize=!0,y&&clearInterval(y),e.isCheckingImgSize=!1,m("ImageHasSize",e),e.imgHidden&&(i.content&&i.content.removeClass("mfp-loading"),e.imgHidden=!1))},findImageSize:function(e){var t=0,n=e.img[0],s=function(a){y&&clearInterval(y),y=setInterval((function(){n.naturalWidth>0?i._onImageHasSize(e):(t>200&&clearInterval(y),3==++t?s(10):40===t?s(50):100===t&&s(500))}),a)};s(1)},getImage:function(n,s){var a=0,l=function(){n&&(n.img[0].complete?(n.img.off(".mfploader"),n===i.currItem&&(i._onImageHasSize(n),i.updateStatus("ready")),n.hasSize=!0,n.loaded=!0,m("ImageLoadComplete")):++a<200?setTimeout(l,100):o())},o=function(){n&&(n.img.off(".mfploader"),n===i.currItem&&(i._onImageHasSize(n),i.updateStatus("error",r.tError.replace("%url%",n.src))),n.hasSize=!0,n.loaded=!0,n.loadError=!0)},r=i.st.image,c=s.find(".mfp-img");if(c.length){var p=document.createElement("img");p.className="mfp-img",n.el&&n.el.find("img").length&&(p.alt=n.el.find("img").attr("alt")),n.img=e(p).on("load.mfploader",l).on("error.mfploader",o);var d=new t;d.onload=function(){console.log("mp xhr loaded"),p.src=d.src},d.load(n.src),c.is("img")&&(n.img=n.img.clone()),(p=n.img[0]).naturalWidth>0?n.hasSize=!0:p.width||(n.hasSize=!1)}return i._parseMarkup(s,{title:x(n),img_replaceWith:n.img},n),i.resizeImage(),n.hasSize?(y&&clearInterval(y),n.loadError?(s.addClass("mfp-loading"),i.updateStatus("error",r.tError.replace("%url%",n.src))):(s.removeClass("mfp-loading"),i.updateStatus("ready")),s):(i.updateStatus("loading"),n.loading=!0,n.hasSize||(n.imgHidden=!0,s.addClass("mfp-loading"),i.findImageSize(n)),s)}}}),e.magnificPopup.registerModule("zoom",{options:{enabled:!1,easing:"ease-in-out",duration:300,opener:function(e){return e.is("img")?e:e.find("img")}},proto:{initZoom:function(){var e,t=i.st.zoom,n=".zoom";if(t.enabled&&i.supportsTransition){var s,a,l=t.duration,o=function(e){var i=e.clone().removeAttr("style").removeAttr("class").addClass("mfp-animated-image"),n="all "+t.duration/1e3+"s "+t.easing,s={position:"fixed",zIndex:9999,left:0,top:0,"-webkit-backface-visibility":"hidden"},a="transition";return s["-webkit-"+a]=s["-moz-"+a]=s["-o-"+a]=s[a]=n,i.css(s),i},r=function(){i.content.css("visibility","visible")};u("BuildControls"+n,(function(){if(i._allowZoom()){if(clearTimeout(s),i.content.css("visibility","hidden"),!(e=i._getItemToZoom()))return void r();(a=o(e)).css(i._getOffset()),i.wrap.append(a),s=setTimeout((function(){a.css(i._getOffset(!0)),s=setTimeout((function(){r(),setTimeout((function(){a.remove(),e=a=null,m("ZoomAnimationEnded")}),16)}),l)}),16)}})),u("BeforeClose"+n,(function(){if(i._allowZoom()){if(clearTimeout(s),i.st.removalDelay=l,!e){if(!(e=i._getItemToZoom()))return;a=o(e)}a.css(i._getOffset(!0)),i.wrap.append(a),i.content.css("visibility","hidden"),setTimeout((function(){a.css(i._getOffset())}),16)}})),u("Close"+n,(function(){i._allowZoom()&&(r(),a&&a.remove(),e=null)}))}},_allowZoom:function(){return"image"===i.currItem.type},_getItemToZoom:function(){return!!i.currItem.hasSize&&i.currItem.img},_getOffset:function(t){var n,s=(n=t?i.currItem.img:i.st.zoom.opener(i.currItem.el||i.currItem)).offset(),a=parseInt(n.css("padding-top"),10),l=parseInt(n.css("padding-bottom"),10);s.top-=e(window).scrollTop()-a;var o={width:n.width(),height:(p?n.innerHeight():n[0].offsetHeight)-l-a};return void 0===C&&(C=void 0!==document.createElement("p").style.MozTransform),C?o["-moz-transform"]=o.transform="translate("+s.left+"px,"+s.top+"px)":(o.left=s.left,o.top=s.top),o}}});var A=function(e){if(i.currTemplate.iframe){var t=i.currTemplate.iframe.find("iframe");t.length&&(e||(t[0].src="//about:blank"),i.isIE8&&t.css("display",e?"block":"none"))}};e.magnificPopup.registerModule("iframe",{options:{markup:'<div class="mfp-iframe-scaler"><div class="mfp-close"></div><iframe class="mfp-iframe" src="//about:blank" frameborder="0" allowfullscreen></iframe></div>',srcAction:"iframe_src",patterns:{youtube:{index:"youtube.com",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},gmaps:{index:"//maps.google.",src:"%id%&output=embed"}}},proto:{initIframe:function(){i.types.push("iframe"),u("BeforeChange",(function(e,t,i){t!==i&&("iframe"===t?A():"iframe"===i&&A(!0))})),u("Close.iframe",(function(){A()}))},getIframe:function(t,n){var s=t.src,a=i.st.iframe;e.each(a.patterns,(function(){if(s.indexOf(this.index)>-1)return this.id&&(s="string"==typeof this.id?s.substr(s.lastIndexOf(this.id)+this.id.length,s.length):this.id.call(this,s)),s=this.src.replace("%id%",s),!1}));var l={};return a.srcAction&&(l[a.srcAction]=s),i._parseMarkup(n,l,t),i.updateStatus("ready"),n}}});var T=function(e){var t=i.items.length;return e>t-1?e-t:e<0?t+e:e},N=function(e,t,i){return e.replace(/%curr%/gi,t+1).replace(/%total%/gi,i)};e.magnificPopup.registerModule("gallery",{options:{enabled:!1,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',preload:[0,2],navigateByImgClick:!0,arrows:!0,tPrev:"Previous (Left arrow key)",tNext:"Next (Right arrow key)",tCounter:"%curr% of %total%"},proto:{initGallery:function(){var t=i.st.gallery,n=".mfp-gallery";if(i.direction=!0,!t||!t.enabled)return!1;o+=" mfp-gallery",u("Open"+n,(function(){t.navigateByImgClick&&i.wrap.on("click"+n,".mfp-img",(function(){if(i.items.length>1)return i.next(),!1})),a.on("keydown"+n,(function(e){37===e.keyCode?i.prev():39===e.keyCode&&i.next()}))})),u("UpdateStatus"+n,(function(e,t){t.text&&(t.text=N(t.text,i.currItem.index,i.items.length))})),u("MarkupParse"+n,(function(e,n,s,a){var l=i.items.length;s.counter=l>1?N(t.tCounter,a.index,l):""})),u("BuildControls"+n,(function(){if(i.items.length>1&&t.arrows&&!i.arrowLeft){var n=t.arrowMarkup,s=i.arrowLeft=e(n.replace(/%title%/gi,t.tPrev).replace(/%dir%/gi,"left")).addClass("mfp-prevent-close"),a=i.arrowRight=e(n.replace(/%title%/gi,t.tNext).replace(/%dir%/gi,"right")).addClass("mfp-prevent-close");s.click((function(){i.prev()})),a.click((function(){i.next()})),i.container.append(s.add(a))}})),u("Change"+n,(function(){i._preloadTimeout&&clearTimeout(i._preloadTimeout),i._preloadTimeout=setTimeout((function(){i.preloadNearbyImages(),i._preloadTimeout=null}),16)})),u("Close"+n,(function(){a.off(n),i.wrap.off("click"+n),i.arrowRight=i.arrowLeft=null}))},next:function(){i.direction=!0,i.index=T(i.index+1),i.updateItemHTML()},prev:function(){i.direction=!1,i.index=T(i.index-1),i.updateItemHTML()},goTo:function(e){i.direction=e>=i.index,i.index=e,i.updateItemHTML()},preloadNearbyImages:function(){var e,t=i.st.gallery.preload,n=Math.min(t[0],i.items.length),s=Math.min(t[1],i.items.length);for(e=1;e<=(i.direction?s:n);e++)i._preloadItem(i.index+e);for(e=1;e<=(i.direction?n:s);e++)i._preloadItem(i.index-e)},_preloadItem:function(t){if(t=T(t),!i.items[t].preloaded){var n=i.items[t];n.parsed||(n=i.parseEl(t)),m("LazyLoad",n),"image"===n.type&&(n.img=e('<img class="mfp-img" />').on("load.mfploader",(function(){n.hasSize=!0})).on("error.mfploader",(function(){n.hasSize=!0,n.loadError=!0,m("LazyLoadError",n)})).attr("src",n.src)),n.preloaded=!0}}}}),e.magnificPopup.registerModule("retina",{options:{replaceSrc:function(e){return e.src.replace(/\.\w+$/,(function(e){return"@2x"+e}))},ratio:1},proto:{initRetina:function(){if(window.devicePixelRatio>1){var e=i.st.retina,t=e.ratio;(t=isNaN(t)?t():t)>1&&(u("ImageHasSize.retina",(function(e,i){i.img.css({"max-width":i.img[0].naturalWidth/t,width:"100%"})})),u("ElementParse.retina",(function(i,n){n.src=e.replaceSrc(n,t)})))}}}}),f()})?s.apply(t,a):s)||(e.exports=l)}).call(this,i(8))},function(e,t,i){(function(n){var s,a;s=[i(10),i(152),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({},i,{mode:"server",model:t,url:function(){return"/shipment/dewars"+(this.id?"/sid/"+this.id:"")+(this.fc?"/fc/"+this.fc:"")},state:{pageSize:15},keyAttribute:"CODE",valueAttribute:"DEWARID",initialize:function(e,t){t&&(this.id=t.id,this.fc=t.FACILITYCODE)},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(6),i(295)],void 0===(l=function(e,t){return ValidatedRow=t.Marionette.ItemView.extend({tagName:"tr",_baseEvents:{"change td > input":"validateField","change td > select":"validateField","change td > textarea":"validateField","blur td > input":"validateField","blur td > select":"validateField","blur td > textarea":"validateField","keyup td > input":"validateField","keyup td > select":"validateField","keyup td > textarea":"validateField","click a.save":"onSubmit"},delegateEvents:function(e){return this.events=n.extend(this._baseEvents,this.events),ValidatedRow.__super__.delegateEvents.call(this,e)},validateField:function(e){if(!s(e.target).closest(".editable").length){var t=s(e.target).attr("name"),i=s(e.target).val();this.model.set(t,i),this.model.preValidate(t,i)?s(e.target).addClass("ferror"):s(e.target).removeClass("ferror")}},initialize:function(e){t.Validation.bind(this,{selector:"name",valid:function(e,t){e.$el.find("[name="+t+"]").removeClass("ferror")},invalid:function(e,t,i){e.$el.find("[name="+t+"]").addClass("ferror")}})},setData:function(){throw new Error("implement #setData in your ValidatedRow subclass")},onSubmit:function(e){e.preventDefault(),this.setData();var t=this.model.isValid(!0);if(app.log("submitted",t,this.model),t){var i=this;this.$el.addClass("loading"),this.model.save({},{success:function(e,t,n){i.$el.removeClass("loading"),i.success(e,t,n)},error:function(e,t,n){i.$el.removeClass("loading"),i.failure(e,t,n)}})}}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},function(e,t,i){(function(n){var s,a;s=[i(7)],void 0===(a=function(e){return LazyRouter=e.AppRouter.extend({loadEvents:[],loadModule:null,initialize:function(e){LazyRouter.__super__.initialize.apply(this,e),this.lazyloaded=!1,n.each(this.getOption("loadEvents"),(function(e){app.on(e,this.lazyLoad.bind(this,e))}),this)},lazyLoad:function(e){var t=this,i=arguments;this.lazyloaded||"function"!=typeof this.loadModule?console.log("LazyLoader::Error trying to lazy load module "):this.loadModule((function(n){t.lazyloaded=!0,console.log(e,i),app.trigger.apply(app,i)}))},_addAppRoute:function(e,t,i){this.route(t,i,(function(){var e=this,t=arguments;"function"==typeof this.loadModule?this.loadModule((function(n){n[i].apply(n,t),e.lazyloaded=!0})):console.log("Error trying to lazy load module ")}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(27),i(11)],void 0===(a=function(e,t,i){return t.extend({className:"fixedwidth",template:!1,initialize:function(e){this.url=e.url,this.load(),this.iframe=n("<iframe></iframe>")},load:function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.url,!0),t.responseType="arraybuffer",t.onload=function(n){if(0!=t.status&&200==t.status){var s=t.getAllResponseHeaders().match(/^Content-Type\:\s*(.*?)$/im)[1]||"image/png",a=(new Blob([this.response],{type:s}),'<script src="/assets/js/jquery-1.9.1.min.js"><\/script>\n                <script type="text/javascript">\n                    $(document).ready(function() {\n                        var app = { apiurl: "'+app.apiurl+'", prop: "'+app.prop+"\"}\n                        app.token = sessionStorage.getItem('token')\n                        var root = \""+e.url.replace(/\?token=.*/,"")+"\"\n                        var ajax = function(options) {\n                            options.data.prop = app.prop\n                            if (app.token) {\n                                options.beforeSend = function(request){\n                                    request.setRequestHeader('Authorization', 'Bearer ' + app.token);\n                                }\n                            }\n                            return $.ajax.call(this, options)\n                        }\n                        var Backbone = { ajax: ajax }\n                        var sign = "+i.sign.toString()+'\n                        $("a").click(function(e) {\n                            var is_relative_to_page = function(href) {\n                                return href.match(/^\\/|(http:|https:|ftp:|mailto:|javascript:)/) === null;\n                            }\n                            var is_routable = function(href) {\n                                return href.indexOf("#") === -1 && is_relative_to_page(href);\n                            }\n                            var href = $(this).attr("href")\n                            if (!is_routable(href)) return true\n                            e.preventDefault()\n                            var url = root+\'/\'+href\n                            sign({\n                                url: url,\n                                callback: function(resp) {\n                                    window.location = url+\'?token=\'+resp.token\n                                }\n                            })\n                        })\n                    });\n                <\/script>');if("application/pdf"==s||"image/png"==s){var l=URL.createObjectURL(new Blob([this.response],{type:s}));e.iframe[0].src=l}else{var o=e.iframe[0].contentWindow.document,r=new TextDecoder("utf-8").decode(this.response);s.indexOf("text/plain")>-1&&(r="<pre>"+r+"</pre>"),o.open(),o.write(a+r),o.close()}}},t.send()},onRender:function(){this.$el.append(this.iframe),this.$el.find("iframe").css("width",n(window).width()*(app.mobile()?.8:.5)),this.$el.find("iframe").css("height",n(window).width()*(app.mobile()?.8:.5))}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){(function(n){var s,a;s=[i(6),i(378),i(192),i(193)],void 0===(a=function(e,t,i,s){return e.Model.extend({idAttribute:"BLSAMPLEID",urlRoot:"/sample",initialize:function(e,i){var n=i&&i.addPrimary||this.collection&&this.collection.state.addPrimary;this.set("components",new t(null,{pmodel:this,addPrimary:n})),this.listenTo(this,"change:EXPERIMENTKIND",this.updateExpKind),this.updateExpKind(),this.listenTo(this,"change:RADIATIONSENSITIVITY",this.updateRadSen),this.updateRadSen(),this.listenTo(this,"change",this.updateHasData),this.updateHasData()},updateHasData:function(){var e=this.get("DC")>0||this.get("GR")>0||this.get("SC")>0;e!=this.get("HASDATA")&&this.set("HASDATA",e)},updateExpKind:function(){var e=i.key(this.get("EXPERIMENTKIND"));this.set("EXPERIMENTKINDNAME",e)},updateRadSen:function(){var e=s.key(this.get("RADIATIONSENSITIVITY"));this.set("RADIATIONSENSITIVITYNAME",e)},defaults:{NAME:"",CODE:"",COMMENTS:"",SPACEGROUP:"",REQUIREDRESOLUTION:"",ANOMALOUSSCATTERER:"",CELL_A:"",CELL_B:"",CELL_C:"",CELL_ALPHA:"",CELL_BETA:"",CELL_GAMMA:"",VOLUME:"",ABUNDANCE:"",SYMBOL:"",PACKINGFRACTION:"",EXPERIMENTALDENSITY:"",COMPOSITION:"",LOOPTYPE:"",DIMENSION1:"",DIMENSION2:"",DIMENSION3:"",SHAPE:""},validation:{PROTEINID:{required:!0,min:0},NAME:{required:function(){return this.get("PROTEINID")>-1||this.get("CRYSTALID")>-1},pattern:"wwdash"},SPACEGROUP:{required:!1,pattern:"word"},ANOMALOUSSCATTERER:{required:!1,pattern:"word"},CELL_A:{required:!1,pattern:"number"},CELL_B:{required:!1,pattern:"number"},CELL_C:{required:!1,pattern:"number"},CELL_ALPHA:{required:!1,pattern:"number"},CELL_BETA:{required:!1,pattern:"number"},CELL_GAMMA:{required:!1,pattern:"number"},REQUIREDRESOLUTION:{required:!1,pattern:"number"},VOLUME:{required:!1,pattern:"number"},ABUNDANCE:{required:!1,pattern:"number"},PACKINGFRACTION:{required:!1,pattern:"number"},DIMENSION1:{required:!1,pattern:"number"},DIMENSION2:{required:!1,pattern:"number"},DIMENSION3:{required:!1,pattern:"number"},LOOPTYPE:{required:!1,pattern:"word"},USERPATH:{required:!1,pattern:"twopath",maxLength:40},COMPONENTAMOUNTS:function(e,t,i){var s=i.components.pluck("ABUNDANCE"),a=!0;return n.each(s,(function(e){isNaN(e)&&(a=!1)})),a?null:"Invalid amount specified"}}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(i){var n;void 0===(n=function(){var e=function(e){for(var i=new RegExp(/\(/),a=(new RegExp(/\)/),i),l=new RegExp(/\d*\.?\d+/),o=e;-1!=o.search(a);){var r=o.indexOf(")"),c=o.lastIndexOf("(",r),p=1,d=r+1,u=o.substring(d);if(0==u.search(l)){var h=l.exec(u);p=Number.parseFloat(h),d+=h.length}var m=o.substring(c+1,r),_=t(m);_=n(_,p);var f=s(_);console.log(f);var g=o.substring(0,c),v=o.substring(d,o.length);o=g+f+v}return t(o)},t=function(e){var t=new RegExp(/[A-Z][a-z]?\d*\.?\d*/g),n=new RegExp(/\d/),s=new RegExp(/[A-Z][a-z]?/),a=new RegExp(/\d+\.?\d*/),l=e.match(t);return l=i.map(l,(function(e,t,i){return-1==e.search(n)?e+"1":e})),i.reduce(l,(function(e,t,i){var n=s.exec(t)[0],l=a.exec(t)[0];return l>0&&(n in e?e[n]+=Number.parseFloat(l):e[n]=Number.parseFloat(l)),e}),{})},n=function(e,t){return i.reduce(e,(function(e,t,i,n){return e[i]=t*this.multiplier,e}),{},{multiplier:t})},s=function(e){var t="C"in e?Object.keys(e).sort(o):Object.keys(e).sort();return i.reduce(t,(function(t,i,n,s){var l=e[i];return Number.isFinite(l)&&0!=l?t+i+(1!=l?a(l):""):t}),"")},a=function(e){var t=e.toFixed(3);if(-1!=t.indexOf(".")){for(;"0"===t.charAt(t.length-1);)t=t.substring(0,t.length-1);"."===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1))}return t},l=function(e){return i.indexOf(["C","H","Ac","Ag","Al","Am","Ar","As","At","Au","B","Ba","Be","Bi","Bk","Br","Cd","Ce","Cf","Cl","Cm","Co","Cr","Cs","Cu","Dy","Er","Es","Eu","F","Fe","Fm","Fr","Ga","Gd","Ge","He","Hf","Hg","Ho","I","In","Ir","K","La","Li","Lu","Mg","Mn","Mo","N","Na","Nb","Nd","Ne","Ni","Np","O","Os","P","Pa","Pb","Pd","Pm","Po","Pr","Pt","Pu","Ra","Rb","Re","Rh","Rn","Ru","S","Sb","Sc","Se","Si","Sm","Sn","Sr","Ta","Tb","Tc","Te","Th","Ti","Tl","Tm","U","V","W","Xe","Y","Yb","Zn","Zr"],e)},o=function(e,t){return l(e)-l(t)},r={H:1.008,He:4.003,Li:6.94,Be:9.012,B:10.81,C:12.01,N:14.01,O:16,F:19,Ne:20.18,Na:22.99,Mg:24.31,Al:26.98,Si:28.09,P:30.97,S:32.06,Cl:35.45,Ar:39.95,K:39.1,Ca:40.08,Sc:44.96,Ti:47.87,V:50.94,Cr:52,Mn:54.94,Fe:55.85,Co:58.93,Ni:58.69,Cu:63.55,Zn:65.38,Ga:69.72,Ge:72.63,As:74.92,Se:78.97,Br:79.9,Kr:83.8,Rb:84.47,Sr:87.62,Y:88.91,Zr:91.22,Nb:92.91,Mo:95.95,Tc:97.91,Ru:101.07,Rh:102.91,Pd:106.42,Ag:107.87,Cd:112.41,In:114.82,Sn:118.71,Sb:121.76,Te:127.6,I:126.9,Xe:131.29,Cs:132.91,Ba:137.33,La:138.91,Hf:178.49,Ta:180.95,W:183.84,Re:186.21,Os:190.23,Ir:192.22,Pt:195.08,Au:196.97,Hg:200.59,Tl:204.38,Pb:207.2,Bi:208.98,Po:208.98,At:209.99,Rn:222.02,Fr:223.02,Ra:226.03,Ac:227.03,Ce:140.12,Pr:140.91,Nd:144.24,Pm:144.91,Sm:150.36,Eu:151.96,Gd:157.25,Tb:158.93,Dy:162.5,Ho:164.93,Er:167.26,Tm:168.93,Yb:173.05,Lu:174.97,Th:232.04,Pa:231.04,U:238.03,Np:237.05,Pu:244.06,Am:243.06,Cm:247.07,Bk:247.07,Cf:251.08,Es:252.08,Fm:257.1},c=function(e){return mass=i.reduce(e,(function(e,t,i,n){return e+t*r[i]}),0),mass};return{composeDensity:function(t,n){var s=t.pluck("DENSITY"),l=t.pluck("SEQUENCE"),o=i.reduce(l,(function(t,i,a,l){var o=n[a];"string"==typeof o&&(o=Number.parseFloat(o));var r=c(e(i)),p=s[a];"string"==typeof p&&(p=Number.parseFloat(p));var d=o*r;return{fimi:t.fimi+=d,fimi_rhoi:t.fimi_rhoi+=d/p}}),{fimi:0,fimi_rhoi:0}),r=o.fimi/o.fimi_rhoi;return a(r)},composeComposition:function(t,a,l){var o;if(t.length>0){var r=t.pluck("SEQUENCE"),c=i.reduce(r,(function(t,s,l,o){var r=a[l];"string"==typeof r&&(r=Number.parseFloat(r));var c,p,d,u,h,m,_,f,g=(c=t.composition,p=t.abundance,d=e(s),h=p+(u=r),m=n(c,p),_=n(d,u),f=i.reduce(_,(function(e,t,i,n){return i in e?e[i]+=t:e[i]=t,e}),m),{abundance:h,composition:n(f,1/h)});return console.log(g.composition,g.abundance),g}),{abundance:0,composition:{}});o=s(c.composition)}else o=t.at(0).get("SEQUENCE");return l?o.replace(/0/g,"₀").replace(/1/g,"₁").replace(/2/g,"₂").replace(/3/g,"₃").replace(/4/g,"₄").replace(/5/g,"₅").replace(/6/g,"₆").replace(/7/g,"₇").replace(/8/g,"₈").replace(/9/g,"₉"):o},molecularMassFromComposition:function(t){return c(e(t))}}}.apply(t,[]))||(e.exports=n)}).call(this,i(5))},,function(e,t,i){(function(n){var s,a;s=[i(10),i(168),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({},i,{model:t,mode:"server",url:"/contact",state:{pageSize:15},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data},keyAttribute:"CARDNAME",valueAttribute:"LABCONTACTID"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(483)],void 0===(a=function(e,t){return e.ItemView.extend({template:n.template('<div class="per_page"><select name="pp"></select></div>'),events:{"change select":"changePageSize"},ui:{pp:"select[name=pp]"},initialize:function(e){this.paginator=new t.Extension.Paginator({className:"pages pp",collection:e.collection,url:!e.noUrl})},pages:[5,10,15,25,50,100,500],onRender:function(){var e=this.getOption("collection").state.pageSize;this.ui.pp.html(n.map(this.getOption("pages"),(function(e){return'<option value="'+e+'">'+e+"</option>"})).join("")).val(e),this.$el.append(this.paginator.render().$el)},changePageSize:function(){console.log(this.$el.find("select").val()),this.getOption("collection").setPageSize(parseInt(this.ui.pp.val()))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,function(e,t,i){(function(n){var s,a;s=[i(7),i(51)],void 0===(a=function(e,t){return e.ItemView.extend({vueView:null,template:n.template('<div class="vue-container"></div>'),ui:{container:".vue-container"},onRender:function(){let e=this;t.prototype.$getOption=function(t){return e.getOption(t)},this.vue=new this.vueView({el:this.ui.container[0]})},onDestroy:function(){this.vue.$destroy()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,function(e,t,i){(function(n){var s,a;s=[i(10),i(14),i(151)],void 0===(a=function(e,t,i){return e.extend(n.extend({},t,{model:i,url:"/users",keyAttribute:"FULLNAME",valueAttribute:"PERSONID",parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,function(e,t,i){(function(n){var s,a;s=[i(10),i(14),i(46)],void 0===(a=function(e,t,i){return e.extend(n.extend({},t,{mode:"client",state:{pageSize:9999},model:i,idAttribute:"PROTEINID",url:"/sample/proteins/distinct",initialize:function(e){this.on("fetch",this.fetch,this)},keyAttribute:"ACRONYM",valueAttribute:"PROTEINID"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,function(e,t,i){var n,s;n=[i(7),i(62),i(305),i(377),i(717),i(718),i(183),i(31),i(722),i(27),i(380),i(381),i(382),i(383),i(725)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c,p,d,u,h,m){return e.LayoutView.extend({dcListView:i,filters:!0,sampleChanger:!0,className:"content",template:m,regions:{data_collections:".data_collections",pages:".page_wrap.one",pages2:".page_wrap.two",search:".srch",type:".type",sc:".sc",log:".lg",status:".st",use:".usage"},ui:{ar:"input[name=autorefresh]"},events:{"mouseover a.users":"showUsers","mouseout a.users":"hideUsers","mouseover a.dewars":"showDewars","mouseout a.dewars":"hideDewars","click a.refresh":"refreshDCs","click @ui.ar":"setAutoRefresh","click a.rpo":"showReprocess"},setAutoRefresh:function(e){this.ui.ar.is(":checked")?this.collection.run():this.collection.stop()},refreshDCs:function(e){e.preventDefault(),this.collection.fetch()},showDewars:function(e){this.dewars||(this.dewars=new u({visit:this.model.get("VISIT")}),this.$el.find(".dewars").append(this.dewars.render().$el)),this.dewars.$el.show()},hideDewars:function(e){this.dewars&&this.dewars.$el.hide()},showUsers:function(e){console.log("show users"),e.preventDefault(),this.users||(this.users=new d({visit:this.model.get("VISIT")}),this.$el.find(".users").append(this.users.render().$el)),this.users.$el.show()},hideUsers:function(e){this.users&&this.users.$el.hide()},showQueueBuilder:function(e){return e&&e.preventDefault(),app.dialog.show(new c({title:"Generate GDA Queue",view:new p({visit:this.model.get("VISIT"),bl:this.model.get("BL"),dcs:this.collection}),autoSize:1})),!1},showReprocess:function(e){return e&&e.preventDefault(),app.dialog.show(new c({title:"Reprocessing",view:new h({visit:this.model.get("VISIT")}),autoSize:1})),!1},templateHelpers:function(){return{IS_VISIT:!!this.getOption("params").visit,IS_SAMPLE:!!this.getOption("params").sid,IS_SINGLE:!!this.getOption("params").id,IS_DCG:!!this.getOption("params").dcg,IS_PJ:!!this.getOption("params").pjid,IS_STAFF:app.staff}},initialize:function(e){if(this.model&&"1"!=this.model.get("ACTIVE")){var i=this.getOption("params").visit;i?-1==i.search("cm")&&-1==i.search("nt")&&-1==i.search("nr")&&e.collection.stop():e.collection.stop()}this.dclist=new(this.getOption("dcListView"))({collection:e.collection,params:e.params,model:this.model}),this.paginator=new t({collection:e.collection,noUrl:e.noPageUrl}),this.paginator2=new t({collection:e.collection,noUrl:e.noPageUrl}),this.filter=new l({value:e.params.search,collection:e.collection,url:!e.noSearchUrl}),this.getOption("filters")&&(this.ty=new o({value:e.params.type,collection:e.collection,mobile:!0,url:!e.noFilterUrl}))},onRender:function(){this.data_collections.show(this.dclist),this.pages.show(this.paginator),this.pages2.show(this.paginator2),this.search.show(this.filter),this.getOption("filters")&&this.type.show(this.ty),this.options.params.visit&&this.use.show(new r({visit:this.options.params.visit})),this.model&&1==this.model.get("ACTIVE")&&(console.log("get sc",this.getOption("sampleChanger")),this.getOption("sampleChanger")&&this.options.params.visit&&!app.mobile()&&this.sc.show(new n({visit:this.options.params.visit,dcs:this.collection,bl:this.model.get("BL")})),this.log.show(new s({collection:this.collection}))),this.model&&1==this.model.get("CAMS")&&this.status.show(new a({bl:this.model.get("BL")})),app.mobile()&&(this.$el.find("div.links a").addClass("button-notext"),this.$el.find("div.links a i").addClass("fa-2x"))},onDomRefresh:function(){console.log("dom refresh dclist"),this.sc.hasView()&&this.sc.currentView.triggerMethod("dom:refresh"),this.dclist.triggerMethod("dom:refresh")}})}.apply(t,n))||(e.exports=s)},,,,function(e,t,i){var n,s;n=[i(305),i(306),i(92)],void 0===(s=function(e,t,i){return e.extend({imageStatusCollection:t,apStatus:!1,rpStatus:!1,dcViews:{data:i}})}.apply(t,n))||(e.exports=s)},,function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return{sync:function(t,i,s){if("create"==t){var a=new FormData;n.each(i.attributes,(function(e,t){a.append(t,e)})),n.defaults(s||(s={}),{data:a,processData:!1,contentType:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.onprogress=function(e){e.lengthComputable&&i.trigger("progress",e.loaded/e.total*100)},e}})}return e.sync.call(this,t,i,s)}}}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(5),i(10),i(155),i(14)],void 0===(s=function(e,t,i,n){return t.extend(e.extend({},n,{dewarID:null,model:i,mode:"server",url:function(){return"/shipment/containers"+(this.dewarID?"/did/"+this.dewarID:"")},state:{pageSize:15},keyAttribute:"NAME",valueAttribute:"CONTAINERID",parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(10),i(121),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({},i,{model:t,mode:"server",url:"/shipment/shipments",keyAttribute:"SHIPPINGNAME",valueAttribute:"SHIPPINGID",state:{pageSize:15},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,function(e,t,i){var n,s;n=[i(10),i(105)],void 0===(s=function(e,t){return e.extend({model:t,mode:"server",url:"/proposal",state:{pageSize:15},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(8),i(504)],void 0===(a=function(e,t){var i=e.ItemView.extend({tagName:"li",initialize:function(e){var t=this.model.get(this.getOption("tabID")).replace(/\s+/g,"");this.template=n.template('<a href="#tabs-'+t+'"><%='+this.getOption("tabTitle")+"%></a>")}}),s=e.CollectionView.extend({childView:i,tagName:"ul"}),a=e.ItemView.extend({template:!1,initialize:function(e){this.subview=new(n.isFunction(e.tabContentInner)?e.tabContentInner.call(this):e.tabContentInner)(e)},onRender:function(){this.$el.html(this.subview.render().$el),this.$el.attr("id","tabs-"+this.model.get(this.options.tabID).replace(/\s+/g,""))},onShow:function(){this.subview.triggerMethod("show")},onDomRefresh:function(){this.subview.triggerMethod("domRefresh")},onDestroy:function(){this.subview.destroy()}}),l=e.CollectionView.extend({childView:a});return e.LayoutView.extend({template:n.template('<div class="tab-container"><section class="tabs"></section><section class="tab-content"></section></div>'),regions:{tabs:".tabs",content:".tab-content"},tabContentItem:a,tabTitle:"tabName",tabID:"name",initialize:function(e){var i=this.getOption("childViewOptions");n.isFunction(i)&&(i=i.call(this)),this.tabView=new s({collection:e.collection,childViewOptions:{tabID:e.tabID||this.getOption("tabID"),tabTitle:e.tabTitle||this.getOption("tabTitle")}}),this.tabContentView=new l({collection:e.collection,childView:a,childViewOptions:t.extend({},e.childViewOptions,i,this.getOption("childViewOptions"),{tabContentInner:e.tabContentItem||this.getOption("tabContentItem"),tabID:e.tabID||this.getOption("tabID")})})},onRender:function(){this.tabs.show(this.tabView),this.content.show(this.tabContentView),this.$el.find(".tab-container").tabs()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,,function(e,t,i){var n,s;n=[i(5),i(10),i(46)],void 0===(s=function(e,t,i){return t.extend({model:i,mode:"server",url:"/sample/proteins",state:{pageSize:15},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data},initialize:function(e,t){this.fetched=!1,this.on("sync",this.setFetched,this)},setFetched:function(){this.fetched||(this.fetched=!0,this.trigger("reset"))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(194),i(235),i(726),i(385),i(146),i(11),i(728)],void 0===(s=function(e,t,i,n,s,a,l){return e.extend({template:l,plotView:t,imageStatusItem:n,events:{"click .distl":"showPlot","click .diffraction":"showDiff","click a.dl":"showPlot","click a.assoc":"associateSample","click a.dd":a.signHandler},associateSample:function(e){e.preventDefault(),app.dialog.show(new i({model:this.model})),this.listenTo(app.dialog.currentView,"sample:associated",this.updateSample,this)},updateSample:function(){var e=this.$el.find(".sample");(console.log(e.length,this.$el.find("ul")),e.length)?e.eq(0).find("a").text(this.model.get("SAMPLE")).attr("href","/samples/sid/"+this.model.get("BLSAMPLEID")):this.$el.find("ul").prepend('<li class="sample"><span class="wrap">Sample: <a href="/samples/sid/'+this.model.get("BLSAMPLEID")+'">'+this.model.get("SAMPLE")+"</a></span></li>")},showPlot:function(e){e.preventDefault(),app.dialog.show(new DialogView({title:"Dat Plot",view:new t({parent:this.model}),autoSize:!0}))},showDiff:function(e){e.preventDefault(),this.$el.find(".diffraction a").eq(0).trigger("click")}})}.apply(t,n))||(e.exports=s)},,,,,,,,,,,,,,function(e,t,i){var n,s;n=[i(6),i(27),i(298),i(484),i(485)],void 0===(s=function(e,t,i,n,s){return t.extend({template:s,title:"Add To Project",events:{"change @ui.project":"checkItem"},ui:{project:"select[name=project]"},initialize:function(e){this.projects=new i;var t=this;this.projects.fetch().done((function(){t.ui.project.html(t.projects.opts()),t.checkItem()}))},checkItem:function(){var e=this;this.itemState=new n({type:this.getOption("type"),pid:this.ui.project.val(),iid:this.getOption("iid")}),this.itemState.fetch({success:function(t,i,n){var s={};s[1==e.itemState.get("state")?"Remove":"Add"]="processItem",s.Cancel="closeDialog",e.setButtons(s)},error:function(e,t,i){}})},onRender:function(){this.$el.find(".title").text(this.getOption("name"))},processItem:function(){var t=this;e.ajax({url:app.apiurl+"/projects/addto/pid/"+this.ui.project.val()+"/ty/"+this.getOption("type")+"/iid/"+this.getOption("iid")+(this.itemState.get("state")?"/rem/1":""),success:function(){t.closeDialog()},error:function(){}})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"ID",urlRoot:function(){return"/dc/single"+(this.get("TYPE")?"/t/"+this.get("TYPE"):"")},defaults:{STATE:!1,FLAG:!1},initialize:function(){this.on("change",this._add_fields,this),this._add_fields(),this.flag.bind(this)},_add_fields:function(){this.get("RUNSTATUS")?(this.attributes.FLAG=!!this.get("COMMENTS")&&this.get("COMMENTS").indexOf("_FLAG_")>-1,this.attributes.STATE=null==this.get("RUNSTATUS")?1:this.get("RUNSTATUS").indexOf("Successful")>-1):this.attributes.STATE=2,this.get("FILETEMPLATE")&&(this.attributes.FILETEMPLATETRIM=this.get("FILETEMPLATE").replace("_####.cbf",""))},flag:function(){var e=this.get("COMMENTS");this.get("FLAG")?e=e.replace(" _FLAG_",""):e+=" _FLAG_",this.set("COMMENTS",e),this.save(this.changedAttributes(),{patch:!0})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(187),i(73),i(116),i(729),i(732),i(735),i(757),i(762),i(766)],void 0===(s=function(e,t,i,n,s,a,l,o,r){return{DCView:new e({views:{mx:t,sm:n,gen:i,tomo:s,em:a,pow:l,saxs:o,xpdf:r},default:i})}}.apply(t,n))||(e.exports=s)},,,,,,,,function(e,t,i){var n,s;n=[i(73),i(77),i(153)],void 0===(s=function(e,t,i){return e.extend({dcListView:t,template:i,filters:!1,sampleChanger:!1})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(754),i(11),i(124),i(8),i(23),i(755),i(195),i(74)],void 0===(a=function(e,t,i,s,a){return e.ItemView.extend({template:t,modelEvents:{sync:"onDomRefresh"},events:{"plotselected #dc_hist":"zoomTime","plotselected #avg_time":"zoomTime","plotclick #avg_time":"showDC","plotselected #overview":"zoomOverview","click a[name=reset]":"resetPlots","click a.next":"nextTimeSpan","click a.prev":"prevTimeSpan"},ui:{span:".span"},nextTimeSpan:function(e){e.preventDefault(),this.gotoTimeSpan()},prevTimeSpan:function(e){e.preventDefault(),this.gotoTimeSpan(!0)},gotoTimeSpan:function(e){var t=this.main.getOptions(),i=t.xaxes[0].max-t.xaxes[0].min;e&&(i=-i),this.zoomTime(null,{xaxis:{from:t.xaxes[0].min+i,to:t.xaxes[0].max+i}})},initialize:function(e){this.hideOverview=e.hideOverview,this.scatters=e.scatters,this.first=!0,this.params=e.params},onRender:function(){this.getOption("large")&&this.$el.find("#avg_time").addClass("large"),this.hideOverview&&this.$el.find(".overview").hide()},resetPlots:function(e){e.preventDefault(),this.main.setSelection({xaxis:{from:this.model.get("info").start,to:this.model.get("info").end}}),this.overview.clearSelection()},zoomTime:function(e,t){if(n.each([this.main,this.extra],(function(e){var i=e.getOptions();i.xaxes[0].min=t.xaxis.from,i.xaxes[0].max=t.xaxis.to,e.setupGrid(),e.draw(),e.clearSelection()})),this.showSpan(),this.overview.setSelection(t,!0),t.xaxis.from&&t.xaxis.to){var i=window.location.pathname.replace(new RegExp("\\/from\\/(\\w|-)+\\/to\\/(\\w|-)+"),"");t.xaxis.from!=this.model.get("info").start&&(i+="/from/"+parseInt(t.xaxis.from)),t.xaxis.to!=this.model.get("info").end&&(i+="/to/"+parseInt(t.xaxis.to)),window.history.pushState({},"",i)}},showSpan:function(){if(!this.hideOverview){var e=this.main.getOptions(),t=s.default(e.xaxes[0].min,"MMMM do yyyy"),i=s.default(e.xaxes[0].max,"MMMM do yyyy");t!=i?this.ui.span.text(t+" - "+i):this.ui.span.text(t)}},zoomOverview:function(e,t){this.main.setSelection(t)},showDC:function(e,t,i){if(i){i.series.id&&app.trigger("dc:show",{dc:"dc",ed:"edge",mca:"mca"}[i.series.type],i.series.id,i.series.visit),"visit"!=i.series.type&&"visit_ns"!=i.series.type||app.trigger("dclist:show",i.series.visit)}},onDomRefresh:function(e){if(e&&this.model.get("data")){this.options={grid:{borderWidth:0},selection:{mode:"x"},bars:{horizontal:!0,show:!0,lineWidth:.5,barWidth:.8,stack:!0},xaxis:{mode:"time",timezone:app.options.get("timezone"),min:this.model.get("info").start,max:this.model.get("info").end},yaxis:{show:!1}},this.options2=n.extend({},this.options),this.options2.tooltip=!0,this.options2.grid.hoverable=!0,this.options2.grid.clickable=!0,this.options2.tooltipOpts={content:this.getToolTip.bind(this)};var t=n.where(this.model.get("data"),{type:"dc"}),s=n.unique(n.pluck(t,"pid")),l=i.shuffle(i.getColors(s.length));n.each(t,(function(e){e.pid&&(e.color=l[s.indexOf(e.pid)])}));var o=n.where(this.model.get("data"),{type:"visit_ns"}),r=n.unique(n.pluck(o,"visit"));l=i.shuffle(i.getColors(r.length));n.each(o,(function(e){e.color=l[r.indexOf(e.visit)]})),this.hideOverview||(this.main=a.plot(this.$el.find("#avg_time"),this.model.get("data"),this.options2)),this.hideOverview||(this.overview=a.plot(this.$el.find("#overview"),this.model.get("data"),this.options)),this.options3={xaxis:{mode:"time",timezone:app.options.get("timezone"),min:this.model.get("info").start,max:this.model.get("info").end},tooltip:!0,grid:{hoverable:!0,borderWidth:0},yaxes:[{position:"right"},{position:"right"},{position:"right"}]},this.scatters?(this.options3.series={lines:{show:!1},points:{show:!0,radius:1}},this.extra=a.plot(this.$el.find("#dc_hist"),this.model.get("scatters"),this.options3)):this.extra=a.plot(this.$el.find("#dc_hist"),this.model.get("lines"),this.options3),this.showSpan(),console.log("rend bd",this.params,this.first),this.params&&this.first&&(this.first=!1,this.params.from&&this.params.to&&this.zoomTime(null,{xaxis:{from:this.params.from,to:this.params.to}}))}},getToolTip:function(e,t,i,n){var s=(n.datapoint[0]-n.datapoint[2])/1e3;return s>3600?s=(s/3600).toFixed(1)+"hrs":s>60?s=(s/60).toFixed(1)+"mins":s+="s",{ai:"Auto Indexing",dc:"Data Collection",mca:"MCA Spectrum",ed:"Edge Scan",robot:"Robot Action",fault:"Fault",nobeam:"Beam Dump",cent:"Centring",visit:"Visit (Scheduled)",visit_ns:"Visit (Queued)"}[n.series.type]+": "+s+" "+(n.series.status?n.series.status:"")}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(31),i(15),i(11)],void 0===(a=function(e,t,i,s,a,l){var o=t.Cell.extend({events:{"click a.dispose":"disposeContainer"},initialize:function(e){o.__super__.initialize.call(this,e),this.listenTo(this.model,"change",this.render,this)},disposeContainer:function(e){e.preventDefault(),l.confirm({title:"Dispose Container",content:"Are you sure you want to dispose this container? ISPyB will no longer know where this plate is, so it must be removed from the imager",callback:this.doDispose.bind(this)})},doDispose:function(){this.model.set("DISPOSE",1),this.model.save(this.model.changedAttributes(),{patch:!0})},render:function(){return this.$el.empty(),this.model.get("IMAGERID")&&!this.model.get("CONTAINERQUEUEID")&&this.$el.html('<a href="#" class="button dispose" title="Dispose Container"><i class="fa fa-trash-o"></i></a>'),this}}),r=a.ClickableRow.extend({event:"container:show",argument:"CONTAINERID",cookie:!0});return e.LayoutView.extend({className:"content",template:'<div><h1>Containers</h1><div class="filter type"></div><div class="filter"><ul><li><label><input type="checkbox" name="currentuser" /> My Containers</label></li></ul></div><div class="wrapper"></div></div>',regions:{wrap:".wrapper",type:".type"},ui:{cur:"input[name=currentuser]"},events:{"change @ui.cur":"refresh"},hiddenColumns:[1,2,5,6,9,10,11],columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"DEWAR",label:"Dewar",cell:"string",editable:!1},{name:"BARCODE",label:"Barcode",cell:"string",editable:!1},{name:"SHIPMENT",label:"Shipment",cell:"string",editable:!1},{name:"SAMPLES",label:"# Samples",cell:"string",editable:!1},{name:"SUBSAMPLES",label:"# Subsamples",cell:"string",editable:!1},{name:"CONTAINERTYPE",label:"Type",cell:"string",editable:!1},{name:"CONTAINERSTATUS",label:"Status",cell:"string",editable:!1},{name:"LASTQUEUECOMPLETED",label:"Completed",cell:"string",editable:!1},{name:"INSPECTIONS",label:"Inspections",cell:"string",editable:!1},{name:"LASTINSPECTIONDAYS",label:"Last (d)",cell:"string",editable:!1},{name:"AGE",label:"Age (d)",cell:"string",editable:!1}],showFilter:!0,filters:[{id:"plate",name:"Plates"},{id:"puck",name:"Pucks"},{id:"imager",name:"In Imager"},{id:"queued",name:"Queued"},{id:"completed",name:"Completed"},{id:"processing",name:"Processing"},{id:"subsamples",name:"Has Subsamples"}],showImaging:!0,refresh:function(){this.collection.fetch()},getCurrent:function(){return this.ui.cur&&this.ui.cur.is(":checked")?1:null},initialize:function(e){var t=this.getOption("filters").slice(0),l=this.getOption("columns").slice(0);app.user_can("disp_cont")&&!app.mobile()&&this.getOption("showImaging")&&(l.push({name:"VISIT",label:"Visit",cell:"string",editable:!1}),l.push({name:"REQUESTEDIMAGER",label:"Req. Imager",cell:"string",editable:!1}),l.push({name:"IMAGER",label:"Imager",cell:"string",editable:!1}),l.push({label:"",cell:a.TemplateCell,editable:!1,test:"REQUESTEDRETURN",template:'<i class="fa fa-paper-plane-o" title="User requested return"></i>'}),l.push({label:"",cell:o,editable:!1}),t.push({id:"todispose",name:"To Dispose"})),l[2].renderable=!1,e.barcode&&(l[1].renderable=!1,l[2].renderable=!0),app.mobile()&&n.each(this.getOption("hiddenColumns"),(function(e){l[e].renderable=!1})),this.table=new i({collection:e.collection,columns:l,tableClass:"containers",filter:"s",search:e.params.s,loading:!0,backgrid:{row:r,emptyText:"No containers found"}}),this.ty=new s({url:!e.noFilterUrl,collection:e.collection,value:e.params&&e.params.ty,name:"ty",filters:t}),this.listenTo(this.ty,"selected:change",this.updateCols)},updateCols:function(e){var t=null==e||"puck"==e,i=this.table.grid.columns.findWhere({name:"DEWAR"}),n=this.table.grid.columns.findWhere({name:"BARCODE"});i.set("renderable",t),n.set("renderable",!t)},onRender:function(){this.wrap.show(this.table),this.getOption("showFilter")&&this.type.show(this.ty),this.collection.queryParams.currentuser=this.getCurrent.bind(this),this.updateCols(this.ty.selected())}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"SHIPPINGID",urlRoot:"/shipment/shipments",validation:{SHIPPINGNAME:{required:!0,pattern:"wwsdash"},"FCODES[]":{required:!1,pattern:"fcode"},SENDINGLABCONTACTID:{required:!0},RETURNLABCONTACTID:{required:!0},DELIVERYAGENT_AGENTCODE:{required:!1,pattern:"wwdash"},DELIVERYAGENT_AGENTNAME:{required:!1,pattern:"wwsdash"},DELIVERYAGENT_SHIPPINGDATE:{required:!1,pattern:"edate"},READYBYTIME:{required:!1,pattern:"time"},CLOSETIME:{required:!1,pattern:"time"},PHYSICALLOCATION:{required:!1,pattern:"wwsdash",maxLength:35}}})}.apply(t,n))||(e.exports=s)},,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(37),i(15),i(11),i(486),i(299)],void 0===(a=function(e,t,i,s,a,l,o,r){var c=a.ClickableRow.extend({event:"dclist:show",argument:"VISIT"}),p=a.TemplateCell.extend({events:{"click a.dll":l.signHandler},getTemplate:function(){return"saxs"==this.model.get("TYPE")?r:o}}),d=t.Cell.extend({render:function(){return this.$el.empty(),"1"==this.model.get("ARCHIVED")&&this.$el.html('<i class="fa fa-archive r" title="This visit is archived, data is no longer avaialble on disk"></i>'),this}});return e.LayoutView.extend({linksTemplate:o,linksCell:p,clickable:!0,clickableRow:c,showTitle:!0,className:"content",template:n.template('<% if (showTitle) { %><h1>Visit List</h1><% } %><p class="help">This page lists the visits available to the currently selected proposal</p><div class="wrapper"></div>'),regions:{wrap:".wrapper"},templateHelpers:function(){return{showTitle:this.getOption("showTitle")}},initialize:function(e){var t=[{name:"ST",label:"Start",cell:"string",editable:!1},{name:"EN",label:"End",cell:"string",editable:!1},{name:"VIS",label:"Number",cell:"string",editable:!1},{name:"BL",label:"Beamline",cell:"string",editable:!1},{name:"LC",label:"Local Contact",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!0},{name:"DCCOUNT",label:"Data Collections",cell:"string",editable:!1},{name:"SESSIONTYPE",label:"Type",cell:"string",editable:!1},{name:"LINKS",label:"",cell:this.getOption("linksCell"),template:this.getOption("linksTemplate"),test:"DCCOUNT",editable:!1},{name:"ARCHIVED",label:"",cell:d,editable:!1}];app.mobile()&&(console.log("mobile!"),n.each([1,4,5,6],(function(e){t[e].renderable=!1})));var s={emptyText:"No visits found"};this.getOption("clickable")&&(s.row=this.getOption("clickableRow")),this.listenTo(this.collection,"change:COMMENTS",this.saveComment,this),this.table=new i({collection:e.collection,columns:t,filter:"s",search:e.params.s,tableClass:"proposals",loading:!0,backgrid:s})},saveComment:function(e,t){console.log("model changed",arguments),e.save(e.changedAttributes(),{patch:!0})},onRender:function(){this.wrap.show(this.table)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(e,n){var s,a;s=[i(7),i(16),i(12),i(31),i(15),i(29)],void 0===(a=function(t,i,n,s,a,l){var o=a.ClickableRow.extend({event:"samples:view",argument:"BLSAMPLEID",cookie:!0}),r=i.Cell.extend({render:function(){if(this.$el.empty(),this.model.get("DCID")){this.$el.html('<img class="img img1" /> <img class="img img2" />');var e=this,t=new l,i=new l;t.onload=function(){e.$el.find(".img1").attr("src",t.src)},i.onload=function(){e.$el.find(".img2").attr("src",i.src)},t.load(app.apiurl+"/image/id/"+this.model.get("DCID")+"/n/2"),i.load(app.apiurl+"/image/id/"+this.model.get("DCID"))}return this}}),c=t.LayoutView.extend({className:"content",template:'<div><h1>Samples</h1><p class="help">This page shows samples associated with the currently selected proposal</p><div class="filter type"></div><div class="wrapper"></div></div>',regions:{wrap:".wrapper",type:".type"},filters:[{id:"R",name:"Robot Loaded"},{id:"SC",name:"Screened"},{id:"AI",name:"Auto Indexed"},{id:"DC",name:"Data Collected"},{id:"AP",name:"Auto Integrated"}],columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"RECORDTIMESTAMP",label:"Created",cell:"string",editable:!1},{name:"ACRONYM",label:"Protein",cell:"string",editable:!1},{label:"Abundance",cell:a.TemplateCell,editable:!1,template:"<% if (ABUNDANCE) { %><%-ABUNDANCE%><%-SYMBOL%><% } %>"},{name:"COMPONENTACRONYMS",label:"Components",cell:"string",editable:!1},{name:"SPACEGROUP",label:"SG",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1},{name:"SHIPMENT",label:"Shipment",cell:"string",editable:!1},{name:"DEWAR",label:"Dewar",cell:"string",editable:!1},{name:"CONTAINER",label:"Container",cell:"string",editable:!1},{label:"Snapshot",cell:r,editable:!1},{name:"SC",label:"SCs",cell:"string",editable:!1},{name:"SCRESOLUTION",label:"Res",cell:"string",editable:!1},{name:"DC",label:"DCs",cell:"string",editable:!1},{name:"DCRESOLUTION",label:"Res",cell:"string",editable:!1},{label:"Status",cell:a.StatusCell,editable:!1},{label:" ",cell:a.ProjectCell,itemname:"NAME",itemid:"BLSAMPLEID",itemtype:"sample",editable:!1}],hiddenColumns:[1,2,3,4,5,6,7,8,10],initialize:function(t){app.mobile()&&e.each(this.getOption("hiddenColumns"),(function(e){this.getOption("columns")[e].renderable=!1}),this);var i=this;this.table=new n({collection:t.collection,columns:this.getOption("columns"),tableClass:"samples",filter:"s",search:t.params&&t.params.s,loading:!0,backgrid:{row:o,emptyText:function(){return i.collection.fetched?"No samples found":"Retrieving samples"}},noPageUrl:t.noPageUrl,noSearchUrl:t.noSearchUrl}),this.ty=new s({url:!t.noFilterUrl,collection:t.collection,name:"t",filters:this.getOption("filters")})},onRender:function(){this.wrap.show(this.table),this.type.show(this.ty)},onShow:function(){this.table.focusSearch()}});return c.SnapshotCell=r,c.StatusCell=a.StatusCell,c}.apply(t,s))||(n.exports=a)}).call(this,i(5),i(188)(e))},function(e,t,i){var n,s;n=[i(10),i(304)],void 0===(s=function(e,t){return e.extend({model:t,mode:"client",url:"/sample/sub",state:{pageSize:100},initialize:function(e){this.on("change:isSelected",this.onSelectedChanged,this)},onSelectedChanged:function(e){this.each((function(e){!0!==e.get("isSelected")||e._changing||e.set({isSelected:!1})}))}})}.apply(t,n))||(e.exports=s)},,,,,,,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(8)],void 0===(a=function(e,t){return e.ItemView.extend({template:!1,modelEvents:{change:"render"},ui:{holder:".holder h1 span"},initialize:function(e){this.listenTo(e.statuses,"sync",this.getModel,this)},getModel:function(){var e=this.getOption("statuses").findWhere({ID:this.getOption("ID")});e!=this.model&&(this.undelegateEvents(),this.model=e,this.delegateEvents(),this.model&&this.render()),this.trigger("model:change")},getStatus:function(e){var t=this.model.get("STATES");if(e.type in t)return t[e.type]},onRender:function(){this.trigger("status");this.model.get("ID");var e=this.model.get("STATES"),t=['<i class="fa icon blue fa-question-circle alt="N/A"></i>','<i class="fa icon grey fa-cog fa-spin alt="Running"></i>','<i class="fa icon green fa-check alt="Completed"></i>','<i class="fa icon red fa-times alt="Failed"></i>'];this.getOption("XRC")?this.ui.holder.html("Xray Centring: "+t[e.XrayCentring]):this.getOption("SCREEN")?(this.ui.holder.empty(),n.each(e.screening,(function(e,i){this.ui.holder.append(i+": "+t[e]+" ")}),this)):n.each(["autoproc","downstream"],(function(i,s){this.ui.holder.eq(s).empty(),n.each(e[i],(function(e,i){this.ui.holder.eq(s).append(i+": "+t[e]+" ")}),this)}),this)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(27),i(106),i(146),i(375),i(688)],void 0===(a=function(e,t,i,s,a,l){var o=e.LayoutView.extend({template:l,attachments:!0,comments:!0,extraButtons:null,ui:{extra:".extra",batt:".button.attachments",bcom:".button.comments"},onRender(){this.ui.batt&&(this.getOption("attachments")?this.ui.batt.show():this.ui.batt.hide()),this.ui.bcom&&(this.getOption("comments")?this.ui.bcom.show():this.ui.bcom.hide()),this.getOption("extraButtons")&&(this.extraView=new(this.getOption("extraButtons"))({model:this.model,templateHelpers:this.getOption("templateHelpers"),el:this.ui.extra}),this.extraView.render())}}),r=e.LayoutView.extend({titleView:o,fullPath:!1,modelEvents:{change:"updateInPlace"},_baseUI:function(){return{title:"h1.title",ul:"ul"}},_baseEvents:function(){return{"click .atp":"addToProject","click .flag":"flag","click .comments":"showComments","click a.sn":"showSnapshots","click i.expand":"expandPath","click a.attach":"attachments","click li.sample a":"setProposal"}},delegateEvents:function(e){return this.ui=n.extend(this._baseUI(),n.result(this,"ui")),this.events=n.extend(this._baseEvents(),n.result(this,"events")),r.__super__.delegateEvents.call(this,e)},updateDCC:function(e){return console.log("updateDCC",this.ui.dcglink,this.model),this.model.get("DCC")>1?(this.$el.find("li.group").show(),this.$el.find(".dcglink").show(),this.$el.find(".dclink").hide()):(this.$el.find("li.group").hide(),this.$el.find(".dcglink").hide(),this.$el.find(".dclink").show()),e},updateBLSAMPLEID:function(e){return e>0?this.$el.find("li.sample").show():this.$el.find("li.sample").hide(),e},updateFLAG:function(e){return e?this.$el.find(".flag").addClass("button-highlight"):this.$el.find(".flag").removeClass("button-highlight"),e},updateInPlace:function(e){var t=e?this.model.attributes:this.model.changedAttributes();n.each(t,(function(e,t){var i=this.$el.find("."+t),n="update"+t;i&&null!==e&&(this[n]&&(e=this[n](e)),i.text(e))}),this)},flag:function(e){e.preventDefault(),this.model.flag()},showComments:function(e){e.preventDefault(),app.dialog.show(new t({title:"Data Collection Comments",view:new s({model:this.model}),autoSize:!0}))},showSnapshots:function(e){e.preventDefault(),this.$el.find(".snapshots a").eq(0).trigger("click")},addToProject:function(e){console.log("show add to project"),e.preventDefault(),app.dialog.show(new i({name:this.model.get("DIR")+this.model.get("FILETEMPLATE"),type:"dc",iid:this.model.get("DCG")}))},expandPath:function(e){e.preventDefault(),this.$el.find("span.temp").text(this.fullPath?this.model.get("DIR")+this.model.get("FILETEMPLATE"):this.model.get("DIRFULL")+this.model.get("FILETEMPLATE")),this.$el.find("i.expand").toggleClass("fa-caret-right"),this.$el.find("i.expand").toggleClass("fa-caret-left"),this.fullPath=!this.fullPath},setProposal:function(e){console.log("setting proposal",this.model.get("PROP")),this.model.get("PROP")&&app.cookie(this.model.get("PROP"))},attachments:function(e){e.preventDefault();var i=[];this.model.get("DCC")>1?i.dcg=this.model.get("DCG"):i.id=this.model.get("ID"),app.dialog.show(new t({title:"Attachments",view:new a(i)}))},onRender:function(){this.titleView=new(this.getOption("titleView"))({model:this.model,templateHelpers:this.getOption("templateHelpers"),extraButtons:this.getOption("extraButtons"),el:this.ui.title}),this.titleView.render();var e=this.getOption("templateHelpers")().VIS_LINK;this.ui.ul.prepend('<li class="group">Group: <a href="/dc/visit/'+e+"/dcg/"+this.model.escape("DCG")+'"><span class="DCC">'+this.model.escape("DCC")+"</span> Data Collections</a></li>"),this.ui.ul.prepend('<li class="sample"><span class="wrap">Sample: <a href="/samples/sid/'+this.model.escape("BLSAMPLEID")+'">'+this.model.escape("SAMPLE")+"</a></span></li>"),this.updateBLSAMPLEID(),this.updateInPlace(!0)}});return r.TitleView=o,r}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(685),i(374),i(20),i(26),i(686)],void 0===(a=function(e,t,i,s,a,l,o){var r=e.ItemView.extend({tagName:"li",template:n.template('<h1><%-GIVENNAME%> <%-FAMILYNAME%><span class="r"><%-CREATETIME%></h1><div class="COMMENTS"><%=COMMENTSMD%></div>'),onRender:function(){if(this.model.get("PERSONID")==app.personid)new s({model:this.model,el:this.$el})}}),c=e.ItemView.extend({tagName:"li",template:n.template("No comments yet")}),p=e.CollectionView.extend({childView:r,emptyView:c,tagName:"ul",className:"comments"});return a.extend({template:l,regions:{comments:".comments"},ui:{com:"textarea[name=COMMENTS]"},templateHelpers:function(){return{DC:this.dc.toJSON()}},createModel:function(){this.model=new i({DATACOLLECTIONID:this.dc.get("ID"),PERSONID:app.personid})},success:function(e){this.collection.add(this.model),this.setupValidation(),this.ui.com.val(""),this.dc.set("DCCC",parseInt(this.dc.get("DCCC"))+1)},initialize:function(e){this.dc=e.model,this.collection=new t,this.collection.queryParams.id=this.dc.get("ID"),this.collection.fetch()},onRender:function(){this.comments.show(new p({collection:this.collection}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(10),i(687),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({model:t,mode:"client",url:"/download/attachments",keyAttribute:"NAME",valueAttribute:"DATACOLLECTIONFILEATTACHMENTID",state:{pageSize:15}},i))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n;void 0===(n=function(){return{circle:function(e,t,i,n,s){this.ctx.beginPath(),this.ctx.arc(e,t,i,0,2*Math.PI,!1),s?(this.ctx.lineWidth=2,this.ctx.strokeStyle=n,this.ctx.stroke()):(this.ctx.fillStyle=n,this.ctx.fill())},setup:function(){this.canvas=this.$el[0],this.ctx=this.canvas.getContext("2d")}}}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"visit",urlRoot:"/vstat/pies",initialize:function(e){this.active=e&&e.active,this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},parse:function(e,t){return{data:e}},stop:function(){clearTimeout(this.refresh_thread),this.active=!1},poll:function(){clearTimeout(this.refresh_thread),this.active&&(this.refresh_thread=setTimeout(this.fetch.bind(this),18e6))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(e){e.plot.plugins.push({init:function(e){e.hooks.processDatapoints.push((function(e,t,i){if(null!=t.stack&&!1!==t.stack){var n=function(e,t){for(var i=null,n=0;n<t.length&&e!=t[n];++n)t[n].stack==e.stack&&(i=t[n]);return i}(t,e.getData());if(n){for(var s,a,l,o,r,c,p,d,u=i.pointsize,h=i.points,m=n.datapoints.pointsize,_=n.datapoints.points,f=[],g=t.lines.show,v=t.bars.horizontal,b=u>2&&(v?i.format[2].x:i.format[2].y),w=g&&t.lines.steps,E=!0,S=v?1:0,I=v?0:1,y=0,C=0;!(y>=h.length);){if(p=f.length,null==h[y]){for(d=0;d<u;++d)f.push(h[y+d]);y+=u}else if(C>=_.length){if(!g)for(d=0;d<u;++d)f.push(h[y+d]);y+=u}else if(null==_[C]){for(d=0;d<u;++d)f.push(null);E=!0,C+=m}else{if(s=h[y+S],a=h[y+I],o=_[C+S],r=_[C+I],c=0,s==o){for(d=0;d<u;++d)f.push(h[y+d]);f[p+I]+=r,c=r,y+=u,C+=m}else if(s>o){if(g&&y>0&&null!=h[y-u]){for(l=a+(h[y-u+I]-a)*(o-s)/(h[y-u+S]-s),f.push(o),f.push(l+r),d=2;d<u;++d)f.push(h[y+d]);c=r}C+=m}else{if(E&&g){y+=u;continue}for(d=0;d<u;++d)f.push(h[y+d]);g&&C>0&&null!=_[C-m]&&(c=r+(_[C-m+I]-r)*(s-o)/(_[C-m+S]-o)),f[p+I]+=c,y+=u}E=!1,p!=f.length&&b&&(f[p+2]+=c)}if(w&&p!=f.length&&p>0&&null!=f[p]&&f[p]!=f[p-u]&&f[p+1]!=f[p-u+1]){for(d=0;d<u;++d)f[p+u+d]=f[p+d];f[p+1]=f[p-u+1]}}i.points=f}}}))},options:{series:{stack:null}},name:"stack",version:"1.2"})}).call(this,i(8))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/users",idAttribute:"PERSONID",validation:{LOGIN:{required:!0,pattern:"wwdash"},FAMILYNAME:{required:!0,pattern:"wwdash"},GIVENNAME:{required:!0,pattern:"wwdash"},EMAILADDRESS:{pattern:"email",required:!1}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"DEWARID",urlRoot:"/shipment/dewars",validation:{CODE:{required:!0,pattern:"wwdash"},FACILITYCODE:{pattern:"fcode",required:!1},TRACKINGNUMBERTOSYNCHROTRON:{pattern:"word",required:!1},TRACKINGNUMBERFROMSYNCHROTRON:{pattern:"word",required:!1},FIRSTEXPERIMENTID:{pattern:"word",required:!1},WEIGHT:{pattern:"number",required:!0}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <h1 class="no_mobile">\n        <div class="usage r"></div>\n        Data Collections\n        ',IS_VISIT&&(__p+="for "+(null==(__t=VISIT)?"":_.escape(__t))+" on "+(null==(__t=BEAMLINENAME)?"":_.escape(__t))),__p+="\n    </h1>\n\n    ",IS_VISIT&&!IS_SINGLE&&(__p+="\n    ",-1==VISIT.search("cm")&&-1==VISIT.search("nt")&&-1==VISIT.search("nr")&&"1"!=ACTIVE&&(__p+='\n        <p class="message notify">\n            This visit is inactive and will not auto update \n            | Auto Refresh <input type="checkbox" name="autorefresh" value="1" />\n            <a href="#" class="button refresh"><i class="fa fa-refresh"></i> Refresh</a>\n        </p>\n    '),__p+='\n\n    <div class="links">\n        <a class="button"  href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Visit Statistics"><i class="fa fa-pie-chart"></i> <span>Visit Stats</span></a>\n        <a href="#" class="button users"><i class="fa fa-users"></i> <span>Users</span></a>\n        <a href="#" class="button dewars"><i class="fa fa-truck"></i> <span>Parcels</span></a>\n    </div>\n    '),__p+="\n\n    ",(IS_SINGLE||IS_DCG)&&(__p+='\n    <h1 class="message nou"><a class="button" href="/dc',IS_VISIT&&(__p+="/visit/"+(null==(__t=VISIT)?"":_.escape(__t))),__p+='">View All Data\n    Collections</a></h1>\n    '),__p+="\n\n    ",IS_DCG&&(__p+="<h2>Data Collection Group</h2>"),__p+="\n    ",IS_PJ&&(__p+="<h2>Processing Job</h2>"),__p+='\n\n    <div class="st"></div>\n    <div class="lg"></div>\n\n    <div class="srch clearfix"></div>\n    \n    <div class="page_wrap one"></div>    \n    <div class="data_collections"></div>\n    <div class="page_wrap two"></div>\n';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(31),i(242),i(15),i(780)],void 0===(a=function(e,t,i,s,a,l,o){var r=l.ClickableRow.extend({event:"proteins:view",argument:"PROTEINID",cookie:!0});return e.LayoutView.extend({className:"content",template:o,regions:{wrap:".wrapper",type:".type"},clickableRow:r,showFilter:!0,title:"Protein",url:"protein",templateHelpers:function(){var e=app.options.get("valid_components");return{title:this.getOption("title"),url:this.getOption("url"),CAN_CREATE:(e&&app.staff||!e)&&app.proposal&&1==app.proposal.get("ACTIVE")}},columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"ACRONYM",label:"Acronym",cell:"string",editable:!1},{name:"MOLECULARMASS",label:"Mass",cell:"string",editable:!1},{name:"HASSEQ",label:"Sequence",cell:"string",editable:!1},{name:"PDBS",label:"PDBs",cell:"string",editable:!1},{name:"COMPONENTTYPE",label:"Type",cell:"string",editable:!1},{name:"CONCENTRATIONTYPE",label:"Unit",cell:"string",editable:!1},{name:"SCOUNT",label:"Samples",cell:"string",editable:!1},{name:"DCOUNT",label:"Data Collections",cell:"string",editable:!1},{name:"SAFETYLEVEL",label:"Risk Rating",cell:l.SafetyCell,editable:!1},{name:" ",cell:l.ProjectCell,itemname:"ACRONYM",itemid:"PROTEINID",itemtype:"protein",editable:!1}],hiddenColumns:[2,3,5],selectModel:function(e,t){console.log("model seleted in grid"),e.set({isGridSelected:t})},initialize:function(e){app.mobile()&&n.each(this.getOption("hiddenColumns"),(function(e){this.getOption("columns")[e].renderable=!1}),this);var s=this.getOption("columns").slice(0);e.selectable&&(s.unshift({label:"",cell:"select-row",headerCell:"select-all",editable:!1}),this.options.clickableRow=t.Row,this.listenTo(this.collection,"backgrid:selected",this.selectModel,this));var l=this;this.table=new i({collection:e.collection,columns:s,tableClass:"proposals",filter:"s",search:e.params&&e.params.s,loading:!0,backgrid:{row:this.getOption("clickableRow"),emptyText:function(){return l.collection.fetched?"No "+l.getOption("title")+"s found":"Retrieving "+l.getOption("title")+"s"}},noPageUrl:e.noPageUrl,noSearchUrl:e.noSearchUrl}),this.types=new a,this.tr=this.types.fetch()},onRender:function(){this.wrap.show(this.table),this.getOption("showFilter")&&this.tr.done(this.showFilter.bind(this))},showFilter:function(){this.ty=new s({url:!this.getOption("noFilterUrl"),collection:this.getOption("collection"),value:this.getOption("params")&&this.getOption("params").ty,name:"type",filters:this.types.map((function(e){return{id:e.get("COMPONENTTYPEID"),name:e.get("NAME")}}))}),this.type.show(this.ty)},onShow:function(){this.table.focusSearch()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"CONTAINERID",urlRoot:"/shipment/containers",_cache:{},defaults:{BARCODECHECK:null},validation:{NAME:{required:!0,pattern:"wwdash"},CAPACITY:{required:!0,pattern:"number"},CONTAINERTYPE:{required:!0,pattern:"word"},SCHEDULEID:{pattern:"number",required:function(){return""!=this.get("REQUESTEDIMAGERID")&&null!=this.get("REQUESTEDIMAGERID")}},REQUESTEDIMAGERID:{required:!1,pattern:"number"},BARCODE:{pattern:"wwdash",required:function(){return""!=this.get("REQUESTEDIMAGERID")&&null!=this.get("REQUESTEDIMAGERID")||"PCRStrip"==this.get("CONTAINERTYPE")}},BARCODECHECK:function(e,t,i){if(null!==e&&1!=e)return"Barcode check failed"},EXPERIMENTTYPE:{required:!1,pattern:"word"},STORAGETEMPERATURE:{required:!1,pattern:"wwdash"},CONTAINERREGISTRYID:{required:!1,pattern:"number"},AUTOMATED:{required:!1,pattern:"number"},PROCESSINGPIPELINEID:{required:!1,pattern:"number"}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6),i(388)],void 0===(s=function(e,t){return e.Collection.extend({model:t,url:function(){return"/sample/pdbs"+(this.pid?"/pid/"+this.pid:"")},initialize:function(e,t){t&&(this.pid=t.pid)},opts:function(){return'<option value="">N/A</option>'+this.map((function(e){return'<option value="'+e.escape("PDBID")+'">'+e.escape("NAME")+" ("+(e.escape("CODE")?"Code":"File")+")</option>"}))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(10),i(158),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({},i,{model:t,mode:"server",url:"/sample/crystals",keyAttribute:"NAME",valueAttribute:"CRYSTALID",state:{pageSize:15},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data},initialize:function(e,t){this.fetched=!1,this.on("sync",this.setFetched,this)},setFetched:function(){this.fetched||(this.fetched=!0,this.trigger("reset"))}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6),i(378)],void 0===(s=function(e,t){return e.Model.extend({idAttribute:"CRYSTALID",urlRoot:"/sample/crystals",initialize:function(e,i){var n=i&&i.addPrimary||this.collection&&this.collection.state.addPrimary;this.set("components",new t(null,{pmodel:this,addPrimary:n}))},validation:{NAME:{required:!0,pattern:"wwdash"},PROTEINID:{required:!0,pattern:"digits"},SPACEGROUP:{required:!1,pattern:"word"},CELL_A:{required:!1,pattern:"number"},CELL_B:{required:!1,pattern:"number"},CELL_C:{required:!1,pattern:"number"},CELL_ALPHA:{required:!1,pattern:"number"},CELL_BETA:{required:!1,pattern:"number"},CELL_GAMMA:{required:!1,pattern:"number"},ABUNDANCE:{required:!1,pattern:"number"},THEORETICALDENSITY:{required:!1,pattern:"number"}}})}.apply(t,n))||(e.exports=s)},,,,,,,,,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/proposal/lookup",initialize:function(e){this.field=e.field,this.value=e.value},find:function(e){var t={};t[this.field]=this.value;var i=this;this.fetch({data:t,type:"POST",success:function(){app.cookie(i.get("PROP"),(function(){e.success&&e.success()}))},error:function(){e.error&&e.error()}})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return e.Model.extend({idAttribute:"LABCONTACTID",urlRoot:"/contact",validation:{CARDNAME:{required:!0,pattern:"wwsdash"},FAMILYNAME:{required:!0,pattern:"wwdash"},GIVENNAME:{required:!0,pattern:"wwdash"},PHONENUMBER:{required:!0},EMAILADDRESS:{pattern:"email",required:!1},LABNAME:{required:!0,pattern:"wwsdash"},ADDRESS:function(t,i,s){if(!t)return e.Validation.messages.required;if(!e.Validation.patterns.address.test(t))return e.Validation.messages.address;var a=t.split("\n");if(a.length>3)return"Address can only be a maximum of three lines";var l=!1;return n.each(a,(function(e){e.length>35&&(l=!0)})),l?"An address line can only be a maximum of 35 characters":void 0},CITY:{required:!0,pattern:"wwsdash"},COUNTRY:{required:!0,pattern:"country"},POSTCODE:{required:!0,pattern:"wwsdash"},DEFAULTCOURRIERCOMPANY:{pattern:"wwsdash",required:!1},COURIERACCOUNT:{pattern:"wwdash",required:!1},BILLINGREFERENCE:{pattern:"wwsdash",required:!1},DEWARAVGCUSTOMSVALUE:{pattern:"number",required:!1},DEWARAVGTRANSPORTVALUE:{pattern:"number",required:!1}}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(10),i(14)],void 0===(a=function(e,t){return e.extend(n.extend({},t,{mode:"client",url:"/shipment/countries",state:{pageSize:15},comparator:function(e,t){return"United Kingdom"==e.get("TITLE")?-1:"United Kingdom"==t.get("TITLE")?1:e.get("TITLE")==t.get("TITLE")?0:e.get("TITLE")>t.get("TITLE")?1:-1},keyAttribute:"TITLE",valueAttribute:"TITLE"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,,,,,,,,,function(e,t,i){(function(n,s){var a,l;a=[i(6)],void 0===(l=function(e){var t=e.View.extend({tagName:"div",className:"search hide",template:function(e){return'<input type="search" '+(e.placeholder?'placeholder="'+e.placeholder+'"':"")+' name="'+e.name+'" '+(e.value?'value="'+e.value+'"':"")+"/>"},events:{"keyup input[type=search]":"search","click a[data-backgrid-action=clear]":"clear",submit:"search"},name:"s",value:null,placeholder:"Search",url:!0,urlFragment:"s",initialize:function(i){t.__super__.initialize.apply(this,arguments),this.name=i.name||this.name,this.value=i.value||this.value,this.placeholder=i.placeholder||this.placeholder,this.template=i.template||this.template,0==i.url&&(this.url=!1),this.urlFragment=i.urlFragment||this.urlFragment;var s=this.collection,a=this;e.PageableCollection&&s instanceof e.PageableCollection&&"server"==s.mode&&(s.queryParams[this.name]=function(){return a.searchBox().val()||null}),this.search=n.debounce(this.search,400)},clearSearchBox:function(){this.value=null,this.searchBox().val(null),this.showClearButtonMaybe()},showClearButtonMaybe:function(){var e=this.clearButton();this.searchBox().val()?e.show():e.hide()},searchBox:function(){return this.$el.find("input[type=search]")},clearButton:function(){return this.$el.find("a[data-backgrid-action=clear]")},query:function(){return this.value=this.searchBox().val(),this.value},search:function(t){t&&t.preventDefault();var i={},n=this.query();n&&(i[this.name]=n);var s=this.collection;if(e.PageableCollection&&s instanceof e.PageableCollection?s.getFirstPage({data:i,reset:!0,fetch:!0}):s.fetch({data:i,reset:!0}),this.url){if(this.urlFragment)var a=window.location.pathname.replace(new RegExp("\\/"+this.urlFragment+"\\/(\\w|-)+"),"")+(this.value?"/"+this.urlFragment+"/"+this.value:"");else a=window.location.pathname.replace(/\/\w+$/,"")+(this.value?"/"+this.value:"");window.history.pushState({},"",a)}},clear:function(t){t&&t.preventDefault(),this.clearSearchBox();var i=this.collection;e.PageableCollection&&i instanceof e.PageableCollection?i.getFirstPage({reset:!0,fetch:!0}):i.fetch({reset:!0})},render:function(){return s("input.search-mobile").focus().keyup((function(){s("input[type=search]").val(s(this).val()).trigger("keyup")})).parent("span").addClass("enable"),s("#sidebar,.cont_wrap").addClass("searchbox"),this.$el.empty().append(this.template({name:this.name,placeholder:this.placeholder,value:this.value})),this.showClearButtonMaybe(),this.delegateEvents(),this},destroy:function(){s("input.search-mobile").unbind("keyup").parent("span").removeClass("enable"),s("#sidebar,.cont_wrap").removeClass("searchbox")}});return t}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"PROJECTID",urlRoot:"/projects",validation:{TITLE:{required:!0},ACRONYM:{required:!0,pattern:"wwdash"}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n;void 0===(n=function(){return function(e,t){var i=t||{GREEN:"active",YELLOW:"minor",RED:"inactive"},n="",s=e.get("SAFETYLEVEL"),a="1"==e.get("EXTERNAL"),l=!app.options.get("valid_components")||a;return"GREEN"==s&&l&&(n=i.GREEN),"YELLOW"==s&&l&&(n=i.YELLOW),"RED"==s&&l&&(n=i.RED),n}}.apply(t,[]))||(e.exports=n)},function(e,t,i){var n,s;n=[i(7)],void 0===(s=function(e){return e.Object.extend({views:{},default:null,titles:{},default_title:"",get:function(e,arguments){var t=this.getOption("views");return view=e in t?t[e]:this.getOption("default"),console.log("using view",view,e),new view(arguments)},title:function(e){var t=this.getOption("titles");if(e in t)var i=t[e];else i=this.getOption("default_title");return i}})}.apply(t,n))||(e.exports=s)},,,function(e,t,i){(function(i){var n;void 0===(n=function(){return{obj:function(){var e={};return i.each(this.list,(function(t){e[t]=t})),e},opts:function(){return i.map(this.list,(function(e){return'<option value="'+e+'">'+e+"</option>"})).join()},list:["","P1","P2","P21","C2","P23","F23","I23","P213","I213","P222","P2221","P21212","P212121","C222","C2221","F222","I222","I212121","P4","P41","P42","P43","P422","P4212","P4122","P41212","P4222","P42212","P4322","P43212","I4","I41","I422","I4122","P3","P31","P32","R3","P312","P321","P3112","P3121","P3212","P3221","R32","P432","P4232","F432","F4132","I432","P4332","P4132","I4132","P6","P61","P65","P62","P64","P63","P622","P6122","P6522","P6222","P6422","P6322"]}}.apply(t,[]))||(e.exports=n)}).call(this,i(5))},function(e,t,i){(function(i){var n;void 0===(n=function(){return{opts:function(){return i.map(this.list.sort(),(function(e){return'<option value="'+e+'">'+e+"</option>"})).join()},obj:function(){var e={};return i.each(this.list.sort(),(function(t){e[t]=t})),e},list:["","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am"]}}.apply(t,[]))||(e.exports=n)}).call(this,i(5))},function(e,t,i){(function(i){var n;void 0===(n=function(){return{opts:function(){let e=this.getList();return i.map(e,(function(e,t){return'<option value="'+e+'">'+t+"</option>"})).join()},obj:function(){let e=this.getList();return i.invert(e)},key:function(e){let t=this.getList();return i.invert(t)[e]},getList:function(){let e=this.list;return app.staff&&(e=Object.assign(e,this.staff)),e},list:{"":"",native:"OSC",phasing:"SAD",ligand:"Ligand binding",stepped:"Stepped transmission"},staff:{commissioning:"Commissioning"}}}.apply(t,[]))||(e.exports=n)}).call(this,i(5))},function(e,t,i){(function(i){var n;void 0===(n=function(){return{opts:function(){return i.map(this.list,(function(e,t){return'<option value="'+e+'">'+t+"</option>"})).join()},obj:function(){return i.invert(this.list)},key:function(e){return i.invert(this.list)[e]},list:{"":"",low:0,medium:50,high:100}}}.apply(t,[]))||(e.exports=n)}).call(this,i(5))},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(27),i(84),i(309),i(505),i(196),i(671),i(20),i(6),i(370),i(144),i(683),i(368),i(371),i(145),i(689),i(18)],void 0===(l=function(e,t,a,l,o,r,c,p,d,u,h,m,_,f,g,v){return DCView=g.extend({template:v,plotView:l,imageStatusItem:u,apStatusItem:h,apMessageStatusItem:m,extraButtons:e.ItemView.extend({template:n.template('<% if (ARCHIVED == "0") { %>        <a href="#" class="reprocess button button-notext" title="Reprocess"><i class="fa fa-cog"></i> <span>Reprocess</span></a>      <% } %>      <span class="message-holder"></span>')}),initialize:function(e){this.strat=null,this.ap=null,this.dp=null},onShow:function(){var e=.175*s(window).width()*.95,t=s(window).width()>1280?e:s(window).width()>800?1.3*e:1.65*e;this.$el.find(".distl,.diffraction,.snapshots",this.$el).height(.8*t),this.getOption("plotView")&&(this.plotview=new(this.getOption("plotView"))({parent:this.model,el:this.$el.find(".distl")})),d.Validation.unbind(this),d.Validation.bind(this),this.imagestatus=new(this.getOption("imageStatusItem"))({ID:this.model.get("ID"),TYPE:this.model.get("DCT"),statuses:this.getOption("imagestatuses"),el:this.$el}),this.apstatus=new(this.getOption("apStatusItem"))({ID:this.model.get("ID"),SCREEN:0!=this.model.get("OVERLAP")&&this.model.get("AXISRANGE"),statuses:this.getOption("apstatuses"),el:this.$el}),this.listenTo(this.apstatus,"status",this.updateAP,this),this.apmessagestatus=new(this.getOption("apMessageStatusItem"))({ID:this.model.get("ID"),statuses:this.getOption("apmessagestatuses"),el:this.$el}),this.updateInPlace(!0)},updateAP:function(e){setTimeout(this.doUpdateAP.bind(this),1e3)},doUpdateAP:function(){this.ap&&this.ap.fetch(),this.strat&&this.strat.fetch(),this.dp&&this.dp.fetch()},onDestroy:function(){this.getOption("plotView")&&this.plotview.destroy(),this.strat&&this.strat.destroy(),this.ap&&this.ap.destroy(),this.imagestatus.destroy(),this.apstatus.destroy()},events:{"click .holder h1.strat":"loadStrategies","click .holder h1.ap":"loadAP","click .holder h1.dp":"loadDP","click .distl":"showDistl","click .diffraction":"diViewer","click a.dl":"showDistl","click @ui.rp":"reprocess","click a.messages":"showMessages"},ui:{rp:"a.reprocess"},showMessages:function(e){e.preventDefault();var i=[];this.model.get("DCC")>1?i.dcg=this.model.get("DCG"):i.id=this.model.get("ID"),app.dialog.show(new t({title:"Processing Messages",view:new _(i)}))},reprocess:function(e){e.preventDefault(),app.dialog.currentView instanceof f?app.dialog.currentView.collection.add(this.model):app.dialog.show(new f({model:this.model,visit:this.getOption("visit")}))},diViewer:function(){var e=this;return Promise.resolve().then((function(){var n=[i(233)];(function(i){app.dialog.show(new t({title:"Diffraction Image Viewer",view:new i({model:e.model,dialog:!0})}))}).apply(null,n)})).catch(i.oe),!1},showDistl:function(e){e.preventDefault(),app.dialog.show(new t({title:"DISTL Plot",view:new l({parent:this.model}),autoSize:!0}))},loadStrategies:function(e){this.strat?this.strat.$el.slideToggle():(this.strat=new o({id:this.model.get("ID"),el:this.$el.find("div.strategies",this.$el)}),this.strat.render())},loadAP:function(e){this.ap?this.ap.$el.slideToggle():this.ap=new r({id:this.model.get("ID"),el:this.$el.find("div.autoproc")})},loadDP:function(e){this.dp?this.dp.$el.slideToggle():this.dp=new c({id:this.model.get("ID"),el:this.$el.find("div.downstream"),holderWidth:this.$el.find(".holder").width()})}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},function(e,t,i){(function(e){var t;(t=e).plot.plugins.push({init:function(e){var i={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},n={},s=null;function a(t){i.active&&(t.preventDefault(),t.originalEvent.touches&&t.originalEvent.touches.length&&(t=t.originalEvent.touches[0]),d(t),e.getPlaceholder().trigger("plotselecting",[o()]))}function l(a){(1==a.which||a.originalEvent.touches)&&(a.preventDefault(),document.body.focus(),void 0!==document.onselectstart&&null==n.onselectstart&&(n.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==n.ondrag&&(n.ondrag=document.ondrag,document.ondrag=function(){return!1}),a.originalEvent.touches&&a.originalEvent.touches.length&&(a=a.originalEvent.touches[0]),p(i.first,a),i.active=!0,s=function(t){!function(t){t.preventDefault(),s=null,void 0!==document.onselectstart&&(document.onselectstart=n.onselectstart),void 0!==document.ondrag&&(document.ondrag=n.ondrag),i.active=!1,t.originalEvent.changedTouches&&t.originalEvent.changedTouches.length&&(t=t.originalEvent.changedTouches[0]),d(t),m()?r():(e.getPlaceholder().trigger("plotunselected",[]),e.getPlaceholder().trigger("plotselecting",[null]))}(t)},t(document).one("mouseup touchend",s))}function o(){if(!m())return null;if(!i.show)return null;var n={},s=i.first,a=i.second;return t.each(e.getAxes(),(function(e,t){if(t.used){var i=t.c2p(s[t.direction]),l=t.c2p(a[t.direction]);n[e]={from:Math.min(i,l),to:Math.max(i,l)}}})),n}function r(){var t=o();e.getPlaceholder().trigger("plotselected",[t]),t.xaxis&&t.yaxis&&e.getPlaceholder().trigger("selected",[{x1:t.xaxis.from,y1:t.yaxis.from,x2:t.xaxis.to,y2:t.yaxis.to}])}function c(e,t,i){return t<e?e:t>i?i:t}function p(t,n){var s=e.getOptions(),a=e.getPlaceholder().offset(),l=e.getPlotOffset();t.x=c(0,n.pageX-a.left-l.left,e.width()),t.y=c(0,n.pageY-a.top-l.top,e.height()),"y"==s.selection.mode&&(t.x=t==i.first?0:e.width()),"x"==s.selection.mode&&(t.y=t==i.first?0:e.height())}function d(t){null!=t.pageX&&(p(i.second,t),m()?(i.show=!0,e.triggerRedrawOverlay()):u(!0))}function u(t){i.show&&(i.show=!1,e.triggerRedrawOverlay(),t||e.getPlaceholder().trigger("plotunselected",[]))}function h(t,i){var n,s,a,l,o=e.getAxes();for(var r in o)if((n=o[r]).direction==i&&(t[l=i+n.n+"axis"]||1!=n.n||(l=i+"axis"),t[l])){s=t[l].from,a=t[l].to;break}if(t[l]||(n="x"==i?e.getXAxes()[0]:e.getYAxes()[0],s=t[i+"1"],a=t[i+"2"]),null!=s&&null!=a&&s>a){var c=s;s=a,a=c}return{from:s,to:a,axis:n}}function m(){var t=e.getOptions().selection.minSize;return Math.abs(i.second.x-i.first.x)>=t&&Math.abs(i.second.y-i.first.y)>=t}e.clearSelection=u,e.setSelection=function(t,n){var s,a=e.getOptions();"y"==a.selection.mode?(i.first.x=0,i.second.x=e.width()):(s=h(t,"x"),i.first.x=s.axis.p2c(s.from),i.second.x=s.axis.p2c(s.to)),"x"==a.selection.mode?(i.first.y=0,i.second.y=e.height()):(s=h(t,"y"),i.first.y=s.axis.p2c(s.from),i.second.y=s.axis.p2c(s.to)),i.show=!0,e.triggerRedrawOverlay(),!n&&m()&&r()},e.getSelection=o,e.hooks.bindEvents.push((function(e,t){null!=e.getOptions().selection.mode&&(t.bind("mousemove touchmove",a),t.bind("mousedown touchstart",l))})),e.hooks.drawOverlay.push((function(e,n){if(i.show&&m()){var s=e.getPlotOffset(),a=e.getOptions();n.save(),n.translate(s.left,s.top);var l=t.color.parse(a.selection.color);n.strokeStyle=l.scale("a",.8).toString(),n.lineWidth=1,n.lineJoin=a.selection.shape,n.fillStyle=l.scale("a",.4).toString();var o=Math.min(i.first.x,i.second.x)+.5,r=Math.min(i.first.y,i.second.y)+.5,c=Math.abs(i.second.x-i.first.x)-1,p=Math.abs(i.second.y-i.first.y)-1;n.fillRect(o,r,c,p),n.strokeRect(o,r,c,p),n.restore()}})),e.hooks.shutdown.push((function(e,i){i.unbind("mousemove",a),i.unbind("mousedown",l),s&&t(document).unbind("mouseup",s)}))},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}).call(this,i(8))},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(6),i(16),i(84),i(311),i(197),i(512),i(312),i(198),i(368),i(56),i(12),i(15),i(11),i(670)],void 0===(l=function(e,t,i,a,l,o,r,c,p,d,u,h,m,_,f){var g=e.LayoutView.extend({template:f,modelEvents:{change:"render"},events:{"click .logf":"showLog","click .rd":"showRD","click .plot":"showPlots","click a.apattach":"showAttachments","click .dll":_.signHandler},regions:{messages:".messages"},onRender:function(){this.messages.show(new d({messages:new t.Collection(this.model.get("MESSAGES")),embed:!0}))},showAttachments:function(e){e.preventDefault(),this.attachments=new l,this.attachments.queryParams.AUTOPROCPROGRAMID=this.model.get("AID"),this.attachments.fetch(),app.dialog.show(new DialogView({title:"Auto Processing Attachments: "+this.model.escape("TYPE"),view:new p({collection:this.attachments}),autosize:!0}))},showLog:function(e){e.preventDefault();var t=n(e.target).attr("href"),i=this;return _.sign({url:t,callback:function(e){app.dialog.show(new u({title:i.model.get("TYPE")+" Log File",url:t+"?token="+e.token}))}}),!1},showRD:function(e){e.preventDefault(),app.dialog.show(new DialogView({title:"RD Plot",view:new r({aid:this.model.get("AID"),id:this.getOption("templateHelpers").DCID}),autoSize:!0}))},showPlots:function(e){e.preventDefault(),app.dialog.show(new DialogView({title:"Integration Statistic Plots",view:new c({aid:this.model.get("AID"),id:this.getOption("templateHelpers").DCID}),autoSize:!0}))}}),v=a.extend({tabContentItem:function(){return g},tabTitle:"TYPEICON",tabID:"AID",childViewOptions:function(){return{templateHelpers:{DCID:this.getOption("id"),APIURL:app.apiurl,PROPOSAL_TYPE:app.type}}}}),b=i.Row.extend({events:{click:"selectTab"},selectTab:function(e){e.preventDefault(),console.log("click row",this.model.get("AID"),this.$el.closest(".sw")),this.$el.closest(".summary").siblings(".sw").find('a[href="#tabs-'+this.model.get("AID")+'"]').trigger("click")}});return e.LayoutView.extend({template:s.template('<div class="ui-tabs summary"></div><div class="sw"></div><div class="res"></div>'),regions:{wrap:".sw",summary:".summary"},initialize:function(e){this.collection=new o(null,{id:e.id}),this.collection.fetch().done(this.render.bind(this))},fetch:function(){this.collection.fetch()},onRender:function(){this.update(),this.listenTo(this.collection,"sync",this.update,this),this.summary.show(new h({className:"ui-tabs-panel ui-widget-content",tableClass:"reflow procsummary",noTableHolder:!0,collection:this.collection,columns:[{name:"TYPE",label:"Type",cell:"string",editable:!1},{label:"Resolution",cell:m.TemplateCell,editable:!1,template:"<%-SHELLS.overall.RLOW%> - <%-SHELLS.overall.RHIGH%>",test:"SHELLS"},{name:"SG",label:"Spacegroup",cell:"string",editable:!1},{label:"Mn<I/sig(i)>",cell:m.TemplateCell,editable:!1,template:"<%-SHELLS.overall.ISIGI%>",test:"SHELLS"},{label:"Rmeas Inner",cell:m.TemplateCell,editable:!1,template:"<%-SHELLS.innerShell.RMEAS%>",test:"SHELLS"},{label:"Rmeas Outer",cell:m.TemplateCell,editable:!1,template:"<%-SHELLS.outerShell.RMEAS%>",test:"SHELLS"},{label:"Completeness",cell:m.TemplateCell,editable:!1,template:"<%-SHELLS.overall.COMPLETENESS%>",test:"SHELLS"},{label:"Cell",cell:m.TemplateCell,editable:!1,template:"<%-CELL.CELL_A%> <%-CELL.CELL_B%> <%-CELL.CELL_C%> <%-CELL.CELL_AL%> <%-CELL.CELL_BE%> <%-CELL.CELL_GA%>",test:"SHELLS"},{label:"Status",cell:m.TemplateCell,editable:!1,template:"<%-PROCESSINGMESSAGE%>"}],pages:!1,backgrid:{row:b,emptyText:"No auto processing available for this data collection"}}))},update:function(){this.collection.length&&(this.$el.removeClass("ui-tabs"),this.wrap.show(new v({collection:this.collection,id:this.getOption("id"),el:this.$el.find(".res")}))),this.$el.slideDown()}})}.apply(t,a))||(e.exports=l)}).call(this,i(8),i(5))},function(e,t,i){var n,s;n=[i(5),i(6),i(511)],void 0===(s=function(e,t,i){return t.Collection.extend({model:i,url:function(){return"/dc/ap/"+this.id},initialize:function(e,t){this.id=t.id},parse:function(t,i){var n=[];return e.each(t[1],(function(e,t){e.DCID=this.id,n.push(e)}),this),n}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(16),i(312),i(518),i(56),i(12),i(11)],void 0===(a=function(e,t,i,s,a,l,o,r){var c=i.Cell.extend({events:{"click a.dl":r.signHandler,"click a.vaplog":"showLog","click a.vapplot":"showPlots"},render:function(){return null!=this.model.get("ZOCALO")?this.$el.html('<a href="'+app.apiurl+"/download/zocalo/"+this.column.escape("urlRoot")+"/attachments/"+this.model.escape(this.column.get("idParam"))+'/dl/1" class="button dl"><i class="fa fa-download"></i> Download</a>'):this.$el.html('<a href="'+app.apiurl+"/download/"+this.column.escape("urlRoot")+"/attachments/"+this.model.escape(this.column.get("idParam"))+'/dl/1" class="button dl"><i class="fa fa-download"></i> Download</a>'),"Log"!=this.model.get("FILETYPE")&&"Logfile"!=this.model.get("FILETYPE")||(null!=this.model.get("ZOCALO")?this.$el.append('<a class="vaplog button" href="'+app.apiurl+"/download/zocalo/"+this.column.escape("urlRoot")+"/attachments/"+this.model.escape(this.column.get("idParam"))+'/dl/1"><i class="fa fa-search"></i> View</a>'):this.$el.append('<a class="vaplog button" href="'+app.apiurl+"/download/"+this.column.escape("urlRoot")+"/attachments/"+this.model.escape(this.column.get("idParam"))+'/dl/1"><i class="fa fa-search"></i> View</a>')),"Graph"==this.model.get("FILETYPE")&&this.$el.append('<a class="vapplot button" href="#"><i class="fa fa-line-chart"></i> View</a>'),this},showPlots:function(e){e.preventDefault(),this.appaid=this.model.get("AUTOPROCPROGRAMATTACHMENTID");let i=this;t.ajax({url:app.apiurl+"/download/plots",method:"get",data:{id:i.model.get("DATACOLLECTIONID"),aid:i.model.get("AUTOPROCPROGRAMATTACHMENTID")},success:function(e){for(var t,n=0;n<e.length;n++)e[n].AUTOPROCPROGRAMATTACHMENTID==i.appaid&&(t=e[n]);1==t.PLOTLY?app.dialog.show(new DialogView({title:"Plotly Chart",view:new a({data:t.PLOTS}),autoSize:!0})):app.dialog.show(new DialogView({title:"Integration Statistic Plots",view:new s({aid:i.model.get("AUTOPROCPROGRAMID"),id:i.model.get("DATACOLLECTIONID")}),autoSize:!0}))},error:function(e){console.log(e)}})},showLog:function(e){e.preventDefault();var t=n(e.target).attr("href"),i=this;r.sign({url:t,callback:function(e){app.dialog.show(new l({title:i.model.get("FILENAME")+" Log File",url:t+"?token="+e.token}))}})}});return e.LayoutView.extend({className:"content",template:'<div><h1>Attachments</h1><p class="help">This page lists all attachments for the selected autoprocessing</p><div class="wrapper"></div></div>',regions:{wrap:".wrapper"},urlRoot:"ap",idParam:"AUTOPROCPROGRAMATTACHMENTID",initialize:function(e){var t=[{name:"FILENAME",label:"File",cell:"string",editable:!1},{name:"FILETYPE",label:"Type",cell:"string",editable:!1},{label:"",cell:c,editable:!1,urlRoot:this.getOption("urlRoot"),idParam:this.getOption("idParam")}];this.table=new o({collection:this.collection,columns:t,tableClass:"attachments",loading:!0,noPageUrl:!0,backgrid:{emptyText:"No attachments found"}})},onRender:function(){this.wrap.show(this.table)},onShow:function(){this.table.focusSearch()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(197),i(309),i(684)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({template:s,className:"dc",modelEvents:{change:"setSelected"},ui:{cells:".cells"},events:{"click .cells":"sendCell"},sendCell:function(e){this.aps.length&&this.trigger("set:cell",this.aps.at(0))},onShow:function(){var e=.175*n(window).width()*.95,s=n(window).width()>1280?e:n(window).width()>800?1.3*e:1.65*e;n(".distl",this.$el).height(s*(n(window).width()>800?.4:1.2)),this.plotview=new i({selection:!0,parent:this.model,el:this.$el.find(".distl")}),this.aps=new t(null,{id:this.model.get("ID")}),this.listenTo(this.aps,"sync",this.setCell,this),this.aps.fetch(),this.listenTo(this.plotview,"plot:select",this.setSelection,this),this.listenTo(this.plotview,"plot:deselect",this.setDeselection,this)},setCell:function(){if(this.aps.length){var e=this.aps.at(0).get("CELL");this.ui.cells.text(e.CELL_A+","+e.CELL_B+","+e.CELL_C+","+e.CELL_AL+","+e.CELL_BE+","+e.CELL_GA)}else this.ui.cells.text("N/A")},setSelected:function(){this.model.get("selected")?this.$el.addClass("selected"):this.$el.removeClass("selected")},setSelection:function(e,t){this.model.set("selected",!0),this.model.set("selection",[e,t]),console.log("sel from distl",e,t)},setDeselection:function(e){this.model.set("selected",!1),this.model.set("selection",[]),console.log("desel from distl")},onDestroy:function(){this.plotview.destroy()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"PROCESSINGJOBID",urlRoot:"/process",validation:{DATACOLLECTIONID:{required:!0,pattern:"digits"},COMMENTS:{required:!1,pattern:"wwsdash"},DISPLAYNAME:{required:!1,pattern:"wwdash"}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"PROCESSINGJOBPARAMETERID",urlRoot:"/shipment/dewars",validation:{PROCESSINGJOBID:{pattern:"digits",required:!0},PARAMETERKEY:{pattern:"wwdash",required:!0},PARAMETERVALUE:{pattern:"wwdash",required:!0}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(10),i(229)],void 0===(a=function(e,t,i){return t.extend({model:i,mode:"client",url:"/process/params",state:{pageSize:15},save:function(t){t=n.extend({},t);var i=this,s=t.success;return t.success=function(e){i.reset(e,{silent:!0}),s&&s(i,e,t)},e.sync("create",this,t)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"PROCESSINGJOBIMAGESWEEPID",urlRoot:"/process/sweeps",validation:{PROCESSINGJOBID:{required:!0,pattern:"digits"},DATACOLLECTIONID:{required:!0,pattern:"digits"},STARTIMAGE:{required:!0,pattern:"digits"},ENDIMAGE:{required:!0,pattern:"digits"}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(10),i(231)],void 0===(a=function(e,t,i){return t.extend({model:i,mode:"client",url:"/process/sweeps",state:{pageSize:15},save:function(t){t=n.extend({},t);var i=this,s=t.success;return t.success=function(e){i.reset(e,{silent:!0}),s&&s(i,e,t)},e.sync("create",this,t)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(8),i(7),i(148),i(691),i(692),i(693),i(11),i(29),i(376)],void 0===(a=function(e,t,i,s,a,l,o,r){return t.ItemView.extend(n.extend({},i,{className:function(){return"content"+(this.getOption("embed")?" embed":"")},getTemplate:function(){return this.getOption("embed")?a:s},templateHelpers:function(){return{VIS_LINK:app.prop+"-"+this.model.get("VN")}},resizeThread:null,ui:{canvas:".img",holder:".image_container .image",zoom:".zoom",brightness:".brightness",bval:".bval",contrast:".contrast",cval:".cval",progress:".im_progress",invert:"input[name=invert]",threshold:"input[name=threshold]",num:"input[name=num]",res:"input[name=res]",ice:"input[name=ice]",resc:".res",imz:".im_zoomc",zval:".zval",high:".im_highlight",xp:".xprofile",yp:".yprofile",loadprog:"span.progress"},events:{"click button[name=reset]":"resetImage","resize document":"onResize","click @ui.imz":"imZoomClick","touchstart @ui.canvas":"mouseDown","mousedown @ui.canvas":"mouseDown","mousemove @ui.canvas":"mouseMove","mouseup @ui.canvas":"mouseUp","mousewheel @ui.canvas":"mouseWheel","DOMMouseScroll @ui.canvas":"mouseWheel","touchmove @ui.canvas":"touchMove","touchend @ui.canvas":"touchEnd","slidechange @ui.brightness":"slideChangeBrightness","slidechange @ui.contrast":"slideChangeContrast","slidechange @ui.zoom":"slideChangeZoom","keypress @ui.num":"keyPressNum","click @ui.res":"_dra","click @ui.ice":"_dra","click @ui.invert":"doInvert","click @ui.threshold":"doThreshold","click button[name=next]":"next","click button[name=prev]":"prev"},initialize:function(e){this.onResize=n.debounce(this.onResize,200),this.draw=n.debounce(this.draw,10),this.readjust=n.debounce(this.readjust,200),this.n=e.n||1,this.img=new r,this.img.onload=this._onload.bind(this),this.img.onprogress=this.onImageProgress.bind(this),this.cache=new Image,this.width=0,this.height=0,this.offsetx=0,this.offsety=0,this.brightness=0,this.contrast=0,this.scalef=1,this.record=0,this.startx=0,this.starty=0,this.lastx=0,this.lasty=0,this.lastv=0,this.imscale=1,this.moved=!1,this.blocks=0,this.invert_change=!1,this.ps=parseFloat(this.model.get("DETECTORPIXELSIZEHORIZONTAL"))/1e3||.172,this.diwidth=parseInt(this.model.get("DETECTORNUMBEROFPIXELSX"))||2527},onDomRefresh:function(){this.canvas=this.ui.canvas[0],this.ctx=this.canvas.getContext("2d"),this.ui.zoom.slider({min:0,max:200,step:5}),this.ui.brightness.slider({min:-100,max:100,step:5}),this.ui.contrast.slider({min:-100,max:100,step:5}),this.ui.progress.progressbar({value:0}),this.c=Caman(this.canvas);var t=this;Caman.Event.listen(this.c,"blockFinished",(function(e){t.blocks++;var i=t.ui.invert.is(":checked")?12:8;t.ui.progress.progressbar("value",t.blocks/i*100)})),Caman.Event.listen(this.c,"renderStart",(function(e){t.blocks=0,t.ui.progress.progressbar("value",0),t.ui.progress.fadeIn(100)})),this.getOption("embed")?this.getOption("readyText")&&(this.ui.loadprog.text(this.getOption("readyText")),this.ui.loadprog.show()):this.load(1),this.onResize(),e(document).unbind("keypress.diviewer").bind("keypress.diviewer",this.keyPress.bind(this))},keyPress:function(e){switch(e.which){case 44:this.prev();break;case 46:this.next();break;case 105:this.ui.invert.prop("checked",!this.ui.invert.is(":checked")),this.doInvert();break;case 119:this.ui.ice.prop("checked",!this.ui.ice.is(":checked")),this._dra();break;case 114:this.ui.res.prop("checked",!this.ui.res.is(":checked")),this._dra();break;case 122:this.ui.zoom.slider("value",this.ui.zoom.slider("value")+5),this._clamp_offset(),this._dra();break;case 90:this.ui.zoom.slider("value",this.ui.zoom.slider("value")-5),this._clamp_offset(),this._dra();break;case 99:this.ui.contrast.slider("value",this.ui.contrast.slider("value")+5);break;case 67:this.ui.contrast.slider("value",this.ui.contrast.slider("value")-5);break;case 98:this.ui.brightness.slider("value",this.ui.brightness.slider("value")+5);break;case 66:this.ui.brightness.slider("value",this.ui.brightness.slider("value")-5);break;default:return}},onDestroy:function(){clearTimeout(this.cache_thread),e(document).unbind("keypress.diviewer")},resetImage:function(e){e.preventDefault(),this.ui.brightness.slider("value",0),this.ui.contrast.slider("value",0),this.ui.zoom.slider("value",0),this.ui.invert.prop("checked",!1);var t=this;setTimeout((function(){t._clamp_offset(),t.draw(),t._recache(),t.adjust()}),300)},onResize:function(){var t=this.getOption("embed")?this.$el.parent().height()-5:this.getOption("dialog")?.45*e(window).height():.65*e(window).height();this.ui.holder.height(t),this.canvas.width=this.ui.holder.width(),this.canvas.height=this.ui.holder.height()-3;var i=this.ui.holder.offset().left+this.ui.canvas.width()/2-125,n=this.ui.canvas.offset().top+this.ui.canvas.height()/2-10;this.ui.progress.offset({left:0,top:0}).show(),this.ui.progress.offset({left:i,top:n}).hide(),this._calc_zoom(),this.draw(),this._recache()},load:function(e){this.n=e,this.showProgressBar(),this.img.onerror=this._onerror.bind(this,e),this.img.load(app.apiurl+"/image/"+(this.low?"diff":"di")+"/id/"+this.model.get("ID")+(this.low?"/f/1":"")+(this.ui.threshold.is(":checked")?"/thresh/1":"")+"/n/"+e)},onImageProgress:function(e){this.ui.loadprog.text(e+"% loaded")},showProgressBar:function(){this.ui.loadprog.text("0% loaded"),this.ui.loadprog.show()},hideProgressBar:function(){this.ui.loadprog.hide()},_onload:function(){0!=this.img.width&&(this.width=this.img.width,this.height=this.img.height,this.imscale=this.width/this.diwidth,this._calc_zoom(),this.width*this.scalef>this.canvas.width&&(this.offsetx=-(this.width*this.scalef-this.canvas.width)/2),this.height*this.scalef>this.canvas.height&&(this.offsety=-(this.height*this.scalef-this.canvas.height)/2),this.draw(),this._recache(),this.ui.canvas.fadeIn(100),this._plot_profiles(20,10),this.hideProgressBar(),this.ci=this.n+1,this.cistart=this.ci,this.precache())},_onerror:function(e,t){if(this.getOption("embed"))this.ui.loadprog.text("These images dont look to be on disk any more.");else if(this.$el.find(".message_box").html('<p class="message alert">These images dont look to be on disk any more. Using low resolution jpegs instead</p>'),this.low){this.ui.loadprog.text("This image is not available.");var i=this.detectVerticalSquash(this.img);this.ctx.clearRect(0,0,this.width,this.height/i)}else{this.low=1,this.img.src="";var n=this;setTimeout((function(){n.load(e)}),500)}},change:function(e){var t=this;this.ui.canvas.fadeOut(100,(function(){t.load(e)}))},prev:function(){val=parseInt(this.ui.num.val()),val>1&&(val>parseInt(this.model.get("NUMIMG"))&&(val=ni),val--,this.change(val),this.ui.num.val(val))},next:function(){val=parseInt(this.ui.num.val()),val<parseInt(this.model.get("NUMIMG"))&&(val++,this.change(val),this.ui.num.val(val))},precache:function(){clearTimeout(this.cache_thread)},draw:function(e){this.ctx.setTransform(this.scalef,0,0,this.scalef,this.offsetx,this.offsety);var t=this.detectVerticalSquash(this.img);this.ctx.drawImage(this.img,0,0,this.width,this.height/t),this.ui.res.is(":checked")&&this._draw_res_rings(),this.ui.ice.is(":checked")&&this._draw_ice_rings()},detectVerticalSquash:function(e){var t=this.img.naturalHeight;if(0==t)return 1;var i=document.createElement("canvas");i.width=1,i.height=t;var n=i.getContext("2d");n.drawImage(e,0,0);for(var s=n.getImageData(0,0,1,t).data,a=0,l=t,o=t;o>a;){0===s[4*(o-1)+3]?l=o:a=o,o=l+a>>1}var r=o/t;return 0===r?1:r},adjust:function(){if(0!=this.brightness||0!=this.contrast||this.invert_change||this.ui.invert.is(":checked")){this.c.revert(),this.ui.invert.is(":checked")&&this.c.invert(),this.invert_change=!1;var e=this;this.c.brightness(this.brightness).contrast(this.contrast).render((function(){e.ui.progress.fadeOut(100)}))}},_calc_zoom:function(){this.ui.zoom.slider("option","min",100*this.ui.canvas.width()/this.width),this.scalef=this.ui.zoom.slider("value")/100,this.ui.zval.text((100*this.scalef).toFixed(0))},_recache:function(){this.c.reloadCanvasData(),this.c.resetOriginalPixelData()},_draw_ice_rings:function(){var e=[3.897,3.669,3.441,2.671,2.249,2.07,1.95,1.92,1.88,1.72];this.ctx.strokeStyle="blue";for(var t=0;t<e.length;t++){this.ctx.beginPath();var i=this._res_to_dist(e[t])/this.ps*this.imscale;this.ctx.arc(this.model.get("XBEAM")/this.ps*this.imscale,this.model.get("YBEAM")/this.ps*this.imscale,i,0,2*Math.PI),this.ctx.stroke()}},_draw_res_rings:function(){this.ctx.strokeStyle="black",this.ctx.font=this.imscale<1?"10px Arial":"30px Arial";for(var e=0;e<5;e++){var t=(this.height-10)/2/5*(e+1);this.ctx.beginPath(),this.ctx.arc(this.model.get("XBEAM")/this.ps*this.imscale,this.model.get("YBEAM")/this.ps*this.imscale,t,0,2*Math.PI),this.ctx.stroke(),this.ctx.fillText(this._dist_to_res(t*this.ps/this.imscale).toFixed(2)+"A",this.model.get("XBEAM")/this.ps*this.imscale-(this.low?10:40),this.model.get("YBEAM")/this.ps*this.imscale-t+(this.low?10:40))}},_plot_profiles:function(t,i){t<20&&(t=20),i<10&&(i=10),this.lastx=t,this.lasty=i;var n=e(window).width()<=600||this.getOption("embed")?20:40,s=20;this.ui.high.offset({left:this.ui.canvas.offset().left+t-n/2,top:this.ui.canvas.offset().top+i-10});for(var a=this.ctx.getImageData(t-n/2,i,n,1).data,l=this.ctx.getImageData(t,i-10,1,s).data,o=[],r=0;r<n;r++){var c=a[4*r]+a[4*r+1]+a[4*r+2];this.ui.invert.is(":checked")||(c=765-c),o.push([r,c])}var p=[];for(r=0;r<s;r++){c=l[4*r]+l[4*r+1]+l[4*r+2];this.ui.invert.is(":checked")||(c=765-c),p.push([c,19-r])}var d={yaxis:{ticks:[]},xaxis:{ticks:[]},grid:{borderWidth:0}};e.plot(this.ui.xp,[o],d),e.plot(this.ui.yp,[p],d);var u=this.ui.imz[0].getContext("2d");u.drawImage(this.ctx.canvas,t-n/2,i-10,n,s,0,0,this.ui.imz[0].width,this.ui.imz[0].height),u.strokeStyle="blue",u.beginPath(),u.moveTo(95,50),u.lineTo(105,50),u.stroke(),u.beginPath(),u.moveTo(100,45),u.lineTo(100,55),u.stroke()},imZoomClick:function(e){var t=o.get_xy(e,this.ui.imz),i=Math.round((100-t[0])/5),n=Math.round((50-t[1])/5);this._plot_profiles(this.lastx-i,this.lasty-n-1)},mouseDown:function(e){e.preventDefault(),e.originalEvent.touches&&e.originalEvent.touches.length&&(e=e.originalEvent.touches[0]),this.record=1,this.startx=e.clientX,this.starty=e.clientY},mouseMove:function(e){if(e.preventDefault(),!(e.originalEvent.touches&&e.originalEvent.touches.length>1)){e.originalEvent.touches&&e.originalEvent.touches.length&&(e=e.originalEvent.touches[0]);var t=o.get_xy(e,this.ui.canvas);this._cursor(t[0],t[1]),this.record&&(this.moved=!0,this.offsetx+=e.clientX-this.startx,this.offsety+=e.clientY-this.starty,this._clamp_offset(),this.draw(),this.startx=e.clientX,this.starty=e.clientY)}},mouseUp:function(e){if(e.preventDefault(),this.moved)this.draw(),this.readjust(),this.moved=!1;else{e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length&&(e=e.originalEvent.changedTouches[0]);var t=this._clamp_z_box(o.get_xy(e,this.ui.canvas));this._plot_profiles(t[0],t[1]-2)}this.record=0},readjust:function(){this._recache(),this.adjust(),this._plot_profiles(this.lastx,this.lasty)},touchMove:function(e){if(this.mouseMove(e),e.originalEvent.touches&&2==e.originalEvent.touches.length){var t=e.originalEvent.touches[0],i=e.originalEvent.touches[1],n=Math.sqrt(Math.pow(t.pageX-i.pageX,2)+Math.pow(t.pageY-i.pageY,2)),s=[];s.push((t.pageX<i.pageX?t.pageX:i.pageX)+Math.abs(t.pageX-i.pageX)/2),s.push((t.pageY<i.pageY?t.pageY:i.pageY)+Math.abs(t.pageY-i.pageY)/2),n&&this.lastv&&this.zoom(s,n>this.lastv?1:-1),this.lastv=n}},touchEnd:function(e){this.mouseUp(e),this.lastv=0},mouseWheel:function(e){e.preventDefault();var t=e.originalEvent,i=t.wheelDelta?t.wheelDelta:-t.detail;this.zoom(o.get_xy(t,this.ui.canvas),i)},zoom:function(e,t){var i=this.scalef;this.scalef+=t>0?.1:-.1,this.scalef<this.ui.canvas.width()/this.width&&(this.scalef=this.ui.canvas.width()/this.width),this.scalef<this.ui.canvas.height()/this.height&&(this.scalef=this.ui.canvas.height()/this.height);var n=(s=-this.offsetx+e[0])*(this.scalef/i);this.offsetx-=n-s;var s;n=(s=-this.offsety+e[1])*(this.scalef/i);this.offsety-=n-s,this._clamp_offset(),this.scalef<2&&this.ui.zoom.slider("value",100*this.scalef),this.ui.zval.text((100*this.scalef).toFixed(0)),this.draw(),this.readjust()},_clamp_z_box:function(e){return e[0]+20>this.ui.canvas.width()&&(e[0]=this.ui.canvas.width()-20),e[1]+10>this.ui.canvas.height()&&(e[1]=this.ui.canvas.height()-10),e},_clamp_offset:function(){this.offsety>0&&(this.offsety=0),this.offsety<this.ui.canvas.height()-this.scalef*this.height&&(this.offsety=this.ui.canvas.height()-this.scalef*this.height),this.offsetx>0&&(this.offsetx=0),this.offsetx<this.ui.canvas.width()-this.scalef*this.width&&(this.offsetx=this.ui.canvas.width()-this.scalef*this.width)},_dist_to_res:function(e){return this.model.get("WAVELENGTH")/(2*Math.sin(Math.atan(e/this.model.get("DET"))/2))},_res_to_dist:function(e){return Math.tan(2*Math.asin(this.model.get("WAVELENGTH")/(2*e)))*this.model.get("DET")},_xy_to_dist:function(e,t){return Math.sqrt(Math.pow(Math.abs(e*this.ps/this.imscale-this.model.get("XBEAM")),2)+Math.pow(Math.abs(t*this.ps/this.imscale-this.model.get("YBEAM")),2))},_cursor:function(e,t){var i=e/this.scalef-this.offsetx/this.scalef,n=t/this.scalef-this.offsety/this.scalef,s=this._dist_to_res(this._xy_to_dist(i,n));this.ui.resc.text(s.toFixed(2))},keyPressNum:function(e){var t=parseInt(this.ui.num.val());13==e.which&&(t<this.model.get("NUMIMG")?this.change(t):this.ui.num.val(this.model.get("NUMIMG")))},_dra:function(){this.draw(),this._recache(),this.adjust()},slideChangeContrast:function(e,t){this.contrast=this.ui.contrast.slider("value"),this.ui.cval.text(this.contrast),this._dra()},slideChangeBrightness:function(e,t){this.brightness=this.ui.brightness.slider("value"),this.ui.bval.text(this.brightness),this._dra()},slideChangeZoom:function(e,t){this.scalef=this.ui.zoom.slider("value")/100,this.ui.zval.text((100*this.scalef).toFixed(0)),e.originalEvent&&(this._clamp_offset(),this.draw())},doInvert:function(){this.invert_change=!0,this._dra()},doThreshold:function(){this.load(this.n)}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s,a;a=function(){var e,t={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},i=function(){var e=function(e){this._coordinator={},this._data=[],this._radi=[],this._min=0,this._max=1,this._xField=e.xField||e.defaultXField,this._yField=e.yField||e.defaultYField,this._valueField=e.valueField||e.defaultValueField,e.radius&&(this._cfgRadius=e.radius)},i=t.defaultRadius;return e.prototype={_organiseData:function(e,t){var n=e[this._xField],s=e[this._yField],a=this._radi,l=this._data,o=this._max,r=this._min,c=e[this._valueField]||1,p=e.radius||this._cfgRadius||i;return l[n]||(l[n]=[],a[n]=[]),l[n][s]?l[n][s]+=c:(l[n][s]=c,a[n][s]=p),l[n][s]>o?(t?this.setDataMax(l[n][s]):this._max=l[n][s],!1):{x:n,y:s,value:c,radius:p,min:r,max:o}},_unOrganizeData:function(){var e=[],t=this._data,i=this._radi;for(var n in t)for(var s in t[n])e.push({x:n,y:s,radius:i[n][s],value:t[n][s]});return{min:this._min,max:this._max,data:e}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var e=arguments[0],t=e.length;t--;)this.addData.call(this,e[t]);else{var i=this._organiseData(arguments[0],!0);i&&this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]})}return this},setData:function(e){var t=e.data,i=t.length;this._data=[],this._radi=[];for(var n=0;n<i;n++)this._organiseData(t[n],!1);return this._max=e.max,this._min=e.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(e){return this._max=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(e){return this._min=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(e){this._coordinator=e},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e}(),n=function(){var e=function(e){var t=e.gradient||e.defaultGradient,i=document.createElement("canvas"),n=i.getContext("2d");i.width=256,i.height=1;var s=n.createLinearGradient(0,0,256,1);for(var a in t)s.addColorStop(a,t[a]);return n.fillStyle=s,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},t=function(e,t){var i=document.createElement("canvas"),n=i.getContext("2d"),s=e,a=e;if(i.width=i.height=2*e,1==t)n.beginPath(),n.arc(s,a,e,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var l=n.createRadialGradient(s,a,e*t,s,a,e);l.addColorStop(0,"rgba(0,0,0,1)"),l.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=l,n.fillRect(0,0,2*e,2*e)}return i};function i(t){var i=t.container,n=this.shadowCanvas=document.createElement("canvas"),s=this.canvas=t.canvas||document.createElement("canvas"),a=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(t.container)||{});s.className="heatmap-canvas",this._width=s.width=n.width=+a.width.replace(/px/,""),this._height=s.height=n.height=+a.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=s.getContext("2d"),s.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",i.style.position="relative",i.appendChild(s),this._palette=e(t),this._templates={},this._setStyles(t)}return i.prototype={renderPartial:function(e){this._drawAlpha(e),this._colorize()},renderAll:function(e){this._clear(),this._drawAlpha(function(e){for(var t=[],i=e.min,n=e.max,s=e.radi,a=(e=e.data,Object.keys(e)),l=a.length;l--;)for(var o=a[l],r=Object.keys(e[o]),c=r.length;c--;){var p=r[c],d=e[o][p],u=s[o][p];t.push({x:o,y:p,value:d,radius:u})}return{min:i,max:n,data:t}}(e)),this._colorize()},_updateGradient:function(t){this._palette=e(t)},updateConfig:function(e){e.gradient&&this._updateGradient(e),this._setStyles(e)},setDimensions:function(e,t){this._width=e,this._height=t,this.canvas.width=this.shadowCanvas.width=e,this.canvas.height=this.shadowCanvas.height=t},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(e){this._blur=0==e.blur?0:e.blur||e.defaultBlur,e.backgroundColor&&(this.canvas.style.backgroundColor=e.backgroundColor),this._opacity=255*(e.opacity||0),this._maxOpacity=255*(e.maxOpacity||e.defaultMaxOpacity),this._minOpacity=255*(e.minOpacity||e.defaultMinOpacity),this._useGradientOpacity=!!e.useGradientOpacity},_drawAlpha:function(e){for(var i=this._min=e.min,n=this._max=e.max,s=(e=e.data||[]).length,a=1-this._blur;s--;){var l,o=e[s],r=o.x,c=o.y,p=o.radius,d=Math.min(o.value,n),u=r-p,h=c-p,m=this.shadowCtx;this._templates[p]?l=this._templates[p]:this._templates[p]=l=t(p,a),m.globalAlpha=(d-i)/(n-i),m.drawImage(l,u,h),u<this._renderBoundaries[0]&&(this._renderBoundaries[0]=u),h<this._renderBoundaries[1]&&(this._renderBoundaries[1]=h),u+2*p>this._renderBoundaries[2]&&(this._renderBoundaries[2]=u+2*p),h+2*p>this._renderBoundaries[3]&&(this._renderBoundaries[3]=h+2*p)}},_colorize:function(){var e=this._renderBoundaries[0],t=this._renderBoundaries[1],i=this._renderBoundaries[2]-e,n=this._renderBoundaries[3]-t,s=this._width,a=this._height,l=this._opacity,o=this._maxOpacity,r=this._minOpacity,c=this._useGradientOpacity;e<0&&(e=0),t<0&&(t=0),e+i>s&&(i=s-e),t+n>a&&(n=a-t);for(var p=this.shadowCtx.getImageData(e,t,i,n),d=p.data,u=d.length,h=this._palette,m=3;m<u;m+=4){var _,f=d[m],g=4*f;g&&(_=l>0?l:f<o?f<r?r:f:o,d[m-3]=h[g],d[m-2]=h[g+1],d[m-1]=h[g+2],d[m]=c?h[g+3]:_)}p.data=d,this.ctx.putImageData(p,e,t),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(e){var t=this.shadowCtx.getImageData(e.x,e.y,1,1).data[3],i=this._max,n=this._min;return Math.abs(i-n)*(t/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},i}(),s=(e=!1,"canvas2d"===t.defaultRenderer&&(e=n),e),a=function(){for(var e={},t=arguments.length,i=0;i<t;i++){var n=arguments[i];for(var s in n)e[s]=n[s]}return e},l=function(){var e=function(){function e(){this.cStore={}}return e.prototype={on:function(e,t,i){var n=this.cStore;n[e]||(n[e]=[]),n[e].push((function(e){return t.call(i,e)}))},emit:function(e,t){var i=this.cStore;if(i[e])for(var n=i[e].length,s=0;s<n;s++)(0,i[e][s])(t)}},e}(),n=function(e){var t=e._renderer,i=e._coordinator,n=e._store;i.on("renderpartial",t.renderPartial,t),i.on("renderall",t.renderAll,t),i.on("extremachange",(function(t){e._config.onExtremaChange&&e._config.onExtremaChange({min:t.min,max:t.max,gradient:e._config.gradient||e._config.defaultGradient})})),n.setCoordinator(i)};function l(){var l=this._config=a(t,arguments[0]||{});if(this._coordinator=new e,l.plugin){var o=l.plugin;if(!t.plugins[o])throw new Error("Plugin '"+o+"' not found. Maybe it was not registered.");var r=t.plugins[o];this._renderer=new r.renderer(l),this._store=new r.store(l)}else this._renderer=new s(l),this._store=new i(l);n(this)}return l.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(e){return this._config=a(this._config,e),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(e){return this._store.getValueAt?this._store.getValueAt(e):this._renderer.getValueAt?this._renderer.getValueAt(e):null}},l}();return{create:function(e){return new l(e)},register:function(e,i){t.plugins[e]=i}}},e.exports?e.exports=a():void 0===(s="function"==typeof(n=a)?n.call(t,i,t,e):n)||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(236),i(11),i(8),i(23),i(42)],void 0===(s=function(e,t,i,n){return e.ItemView.extend({template:!1,model:t,modelEvents:{change:"render"},initialize:function(e){var i=e.parent;this.model=new t({id:i.get("ID"),pm:i}),this.model.fetch(),this.$el.css("opacity",0)},onRender:function(){if(this.model.get("data")){var e=n.extend({},i.default_plot,{series:{lines:{show:!0},points:{show:!1}}});this.plot=n.plot(this.$el,this.model.get("data"),e),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop(),this.plot&&this.plot.shutdown()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/dc/dat",initialize:function(e){this.pm=e.pm,this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},parse:function(e,t){return{data:e}},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},poll:function(){if(clearTimeout(this.refresh_thread),this.running){var e=!0,t=this.get("data");t&&t[0].length>0&&this.pm.get("AGE")>15&&(e=!1),e&&(this.refresh_thread=setTimeout(this.fetch.bind(this),1e4))}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"visit",urlRoot:"/vstat/breakdown"})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(6),i(20)],void 0===(l=function(e,t){var i=e.ItemView.extend({tagName:"li",getTemplate:function(){return this.getOption("editable")?n.template('<%-ACRONYM%>: <input type="text" name="ABUNDANCE" /> <%-CONCENTRATIONTYPE%> <a href="#" class="delete button"><i class="fa fa-times"></i></a>'):this.getOption("viewLink")&&!this.model.get("new")?n.template('<%-ACRONYM%>: <%-ABUNDANCE%> <%-CONCENTRATIONTYPE%> <a href="#" class="delete button"><i class="fa fa-times"></i></a> <% if(GLOBAL==0) { %><a href="/proteins/pid/<%-PROTEINID%>" class="button r"><i class="fa fa-search"></i> View All</a><% } %>'):this.getOption("editinline")&&this.model.get("new")?n.template('<%-ACRONYM%>: <input type="text" name="ABUNDANCE" /> <%-CONCENTRATIONTYPE%> <a href="#" class="save button"><i class="fa fa-check"></i></a> <a href="#" class="delete button"><i class="fa fa-times"></i></a>'):this.getOption("editinline")?n.template('<%-ACRONYM%>: <%-ABUNDANCE%> <%-CONCENTRATIONTYPE%> <a href="#" class="delete button"><i class="fa fa-times"></i></a>'):n.template("<%-ACRONYM%>: <%-ABUNDANCE%> <%-CONCENTRATIONTYPE%>")},ui:{ab:"input[name=ABUNDANCE]"},events:{"click a.delete":"remComp","click a.save":"addComp","change input":"validateField","blur input":"validateField","keyup input":"validateField"},validateField:function(e){if(!s(e.target).closest(".editable").length){var t=s(e.target).attr("name"),i=s(e.target).val();console.log("update component",this),this.model.set(t,i),this.model.preValidate(t,i)?s(e.target).addClass("ferror"):s(e.target).removeClass("ferror")}},updateAbundance:function(e){this.model.set({ABUNDANCE:this.ui.ab.val()})},addComp:function(e){e.preventDefault(),t.ajax({url:app.apiurl+"/sample/components",type:"POST",data:{BLSAMPLETYPEID:this.getOption("CRYSTALID"),COMPONENTID:this.model.get("PROTEINID"),ABUNDANCE:this.model.get("ABUNDANCE")},success:this.compAdded.bind(this)})},compAdded:function(e){this.model.set("new",!1),this.render()},remComp:function(e){if(e.preventDefault(),this.getOption("editinline")&&!this.model.get("new")){var i=this;t.ajax({url:app.apiurl+"/sample/components/"+this.getOption("CRYSTALID")+"-"+this.model.get("PROTEINID"),type:"DELETE",dataType:"json",success:function(e){i.model.collection.remove(i.model)}})}else this.model.collection.remove(this.model)},initialize:function(e){t.Validation.bind(this)},onRender:function(){this.ui.ab.val(this.model.get("ABUNDANCE"))}}),a=e.ItemView.extend({tagName:"li",template:n.template("No Components")});return ComponentsView=e.CollectionView.extend({tagName:"ul",childView:i,className:function(){if(this.getOption("viewLink"))return"visits"},initialize:function(e){},getEmptyView:function(){return this.getOption("showEmpty")?a:null},childViewOptions:function(){return{editable:this.getOption("editable"),editinline:this.getOption("editinline"),viewLink:this.getOption("viewLink"),CRYSTALID:this.getOption("CRYSTALID")}}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},function(e,t,i){var n,s;n=[i(10),i(240)],void 0===(s=function(e,t){return e.extend({model:t,mode:"client",url:"/imaging/inspection/images",state:{pageSize:9999},initialize:function(e){this.on("change:isSelected",this.onSelectedChanged,this)},onSelectedChanged:function(e){this.each((function(e){!0!==e.get("isSelected")||e._changing||e.set({isSelected:!1})}))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(79)],void 0===(a=function(e,t){return e.Model.extend(n.extend({},{idAttribute:"BLSAMPLEIMAGEID",urlRoot:"/imaging/inspection/images",validation:{CONTAINERINSPECTIONID:{required:!0,pattern:"number"},BLSAMPLEID:{required:!0,pattern:"number"}},urlFor:function(e){return app.apiurl+"/imaging/inspection/image/"+this.get("BLSAMPLEIMAGEID")+(e?"?f=1":"")}},t))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(29),i(773),i(774)],void 0===(a=function(e,t,i,s){var a=e.ItemView.extend({tagName:"figure",template:n.template('<a href="/containers/cid/<%-CONTAINERID%>/iid/<%-CONTAINERINSPECTIONID%>/sid/<%-BLSAMPLEID%>"><img /></a><figcaption>+<%-DELTA%>d</figcaption>'),events:{mouseover:"hover"},hover:function(e){console.log("hover"),this.model.set({isSelected:!0}),this.model.collection.trigger("selected:change",this.model)},initialize:function(e){this.model.on("change:isSelected",this.onSelectedChanged.bind(this));var i=this;this.img=new t,this.img.onload=function(){i.$el.find("img").attr("src",i.img.src).css("visibility","visible").hide().fadeIn()},this.getOption("autoLoad")&&this.loadImage()},loadImage:function(){var e=this.model.collection.indexOf(this.model),t=this.model.collection.length==e+1;setTimeout(this.doLoadImage.bind(this),t?0:500*e)},doLoadImage:function(){this.img.load(this.model.urlFor())},onSelectedChanged:function(){this.model.get("isSelected")?this.$el.addClass("selected"):this.$el.removeClass("selected")},onRender:function(){this.$el.width(125),this.$el.find("img").css("visibility","hidden"),this.model.get("isSelected")&&this.$el.addClass("selected")}}),l=e.CollectionView.extend({childView:a,childViewOptions:function(){return{autoLoad:this.getOption("autoLoad")}},load:function(){this.children.each((function(e){e.loadImage()}))}});return e.LayoutView.extend({getTemplate:function(){return this.getOption("embed")?s:i},className:function(){return"img_history"+(this.getOption("embed")?" embed":"")},regions:{thm:".columns"},initialize:function(e){this.caching=!0,this.images=e.historyimages,this.autoLoad=e&&e.embed},onRender:function(){this.thumbs=new l({collection:this.images,autoLoad:this.getOption("autoLoad")}),this.thm.show(this.thumbs)},load:function(){this.thumbs.load()},preCache:function(e){clearTimeout(this.cachethread);var i=this,n=this.images.at(e);if(this.caching&&n){var s=new t;console.log("caching history",n.urlFor("hd")),s.load(n.urlFor("full"),(function(){i.cachethread=setTimeout((function(){i.preCache(++e)}),500)}))}},onDestroy:function(){clearTimeout(this.cachethread),this.caching=!1}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(779),i(14)],void 0===(a=function(e,t,i){return e.Collection.extend(n.extend({},i,{model:t,url:"/sample/componenttypes",keyAttribute:"NAME",valueAttribute:"COMPONENTTYPEID"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(10),i(395)],void 0===(a=function(e,t,i){var s=e.Model.extend({idAttribute:"BLSAMPLEGROUPID"}),a=e.Collection.extend({model:s}),l=e.Collection.extend({comparator:function(e){return parseInt(e.get("GROUPORDER"))}});return t.extend({model:i,url:"/sample/groups",mode:"server",state:{pageSize:100},initialize:function(e){this._groups=new a,this._groups.parent=this,this.listenTo(this,"sync update",this.generateGroups,this),this.generateGroups()},generateGroups:function(e){console.log("generating groups",e);var t=[],s=n.unique(this.pluck("BLSAMPLEGROUPID"));n.each(s,(function(e){var n=this.where({BLSAMPLEGROUPID:e}),s=new i({BLSAMPLEGROUPID:e,GROUPORDER:n.length+1,TYPE:"container"});s.parent=this,n.push(s),t.push({BLSAMPLEGROUPID:e,MEMBERS:new l(n)})}),this),this._groups.reset(t)},groups:function(){return this._groups},parseRecords:function(e,t){return e.data},parseState:function(e,t,i,n){return{totalRecords:e.total}}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(15),i(12),i(27),i(91),i(392),i(415),i(903)],void 0===(a=function(e,t,i,s,a,l,o,r){var c=t.TemplateCell.extend({events:{"click a.rem":"doRemove"},doRemove:function(e){e.preventDefault(),this.model.collection.remove(this.model)},render:function(){return this.$el.html('<a class="button rem" title="Remove Phase" href="#"><i class="fa fa-times"></i></a>'),this}}),p=s.extend({title:"Add Phase",className:"content",autoSize:!0,buttons:{Add:"onAdd",Cancel:"closeDialog"},onAdd:function(){this.closeDialog()}});return e.LayoutView.extend({template:r,regions:{table:".table"},events:{"click a.addphase":"addPhase","click a.newphase":"addNewPhase"},ui:{buttons:".buttons"},editable:!0,initialize:function(){this.allphases=new a,this.allphases.queryParams.seq=1,this.allphases.fetch()},onRender:function(){var e=[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"SEQUENCE",label:"Composition",cell:"string",editable:!1},{name:"ABUNDANCE",label:"Fraction",cell:t.ValidatedCell,editable:this.getOption("editable")},{label:"",cell:t.TemplateCell,editable:!1,template:'<a class="button" title="View Phase" href="/phases/pid/<%-PROTEINID%>"><i class="fa fa-search"></i></a>'}];this.getOption("editable")&&e.push({label:"",cell:c,editable:!1}),this.table.show(new i({collection:this.collection,columns:e,pages:!1,backgrid:{emptyText:"No phases found"}})),this.getOption("editable")||this.ui.buttons.hide()},addPhase:function(e){e.preventDefault();var t=new l({collection:this.allphases,selectable:!0});app.dialog.show(new p({view:t})),this.listenTo(app.dialog.currentView,"close",this.doAddPhases,this)},doAddPhases:function(){var e=this.allphases.where({isGridSelected:!0}),t=(Math.max(0,1-this.collection.totalAbundance())/e.length).toFixed(3);n.each(e,(function(e){e.set({isGridSelected:!1});var i=e.clone();i.set("ABUNDANCE",t),this.collection.add(i)}),this)},addNewPhase:function(e){e.preventDefault();var t=new o({dialog:!0});this.listenTo(t,"phase:added",this.doAddNewPhase),app.dialog.show(new s({title:"Add New Phase",className:"content",view:t,autoSize:!0}))},doAddNewPhase:function(e){this.allphases.add(e);var t=e.clone();t.set("ABUNDANCE",Math.max(0,1-this.collection.totalAbundance()).toFixed(3)),this.collection.add(t)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(40),i(418),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({},i,{model:t,keyAttribute:"NAME",valueAttribute:"BLSAMPLEID"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(14)],void 0===(a=function(e,t){return e.Collection.extend(n.extend({},{url:function(){return"/proposal/bls/"+this.ty},initialize:function(e,t){this.ty=t.ty},parse:function(e){var t=[];return n.each(e,(function(e,i){t.push({BEAMLINE:e})})),t},keyAttribute:"BEAMLINE",valueAttribute:"BEAMLINE"},t))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(26),i(168),i(169),i(930),i(8),i(6),i(18)],void 0===(a=function(e,t,i,s,a,l){return e.extend({template:s,ui:{country:"select[name=COUNTRY]"},initialize:function(){this.countries=new i,this.countries.state.pageSize=9999,this.ready=this.countries.fetch()},createModel:function(){this.model=new t},onRender:function(){n.when(this.ready).done(this.populateCountries.bind(this))},populateCountries:function(){this.ui.country.html(this.countries.opts())},success:function(e,t,i){console.log("success from contact add"),this.getOption("dialog")?(app.alert({message:"New Lab Contact Registered"}),app.dialog.currentView&&app.dialog.currentView.closeDialog()):app.trigger("contact:show",e.get("LABCONTACTID"))},failure:function(e,t,i){console.log("failure from shipadd"),app.alert({message:"Something went wrong registering this lab contact, please try again"})}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12)],void 0===(a=function(e,t,i){var s=t.Row.extend({events:{click:"onClick"},onClick:function(){var e=app.prop;app.cookie(this.model.get("PROPOSALCODE")+this.model.get("PROPOSALNUMBER")),app.type=this.model.get("TYPE"),e||app.staff?app.trigger("visits:show"):app.trigger("current:show")}});return e.LayoutView.extend({clickableRow:s,className:"content",template:n.template('<h1>Proposals</h1><p class="help">This page lists all proposals available to you. Click on a row to select that proposal</p><div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(e){this.table=new i({collection:e.collection,columns:[{name:"PROPOSALCODE",label:"Code",cell:"string",editable:!1},{name:"PROPOSALNUMBER",label:"Number",cell:"string",editable:!1},{name:"VCOUNT",label:"Visits",cell:"string",editable:!1},{name:"TITLE",label:"Title",cell:"string",editable:!1}],tableClass:"proposals",filter:"s",search:e.params.s,loading:!0,backgrid:{row:this.getOption("clickableRow"),emptyText:"No proposals found"}})},onRender:function(){this.wrap.show(this.table)},onShow:function(){this.table.focusSearch()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(10),i(185),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({model:t,mode:"server",url:"/projects",state:{pageSize:15},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data},keyAttribute:"ACRONYM",valueAttribute:"PROJECTID"},i))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",DCCOUNT>0&&(__p+='\n<a class="button button-notext dll" title="Download Processed Data" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/data/visit/"+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-download"></i> <span>Download Data</span></a>\n\x3c!-- <a class="button button-notext dll" title="View Log" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/log/visit/"+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-search"></i> <span>View Log File</span></a> --\x3e\n'),__p+="";return __p}},function(e,t,i){var n,s;n=[i(187),i(130),i(301),i(776),i(777),i(154),i(387),i(391),i(786),i(787),i(789),i(392),i(791),i(415),i(393),i(902),i(905),i(416),i(907)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c,p,d,u,h,m,_,f,g,v){var b={xpdf:"Instance"},w={mx:"Protein",gen:"Component",xpdf:"Phase"},E={xpdf:"Sample"};return{SampleList:new e({views:{mx:t,saxs:t,gen:n,xpdf:g},default:n,titles:b,default_title:"Sample"}),SampleView:new e({views:{mx:i,saxs:i,gen:s,xpdf:v},default:s,titles:b,default_title:"Sample"}),ProteinList:new e({views:{mx:a,saxs:a,gen:r,xpdf:d},default:r,titles:w,default_title:"Component"}),ProteinAdd:new e({views:{mx:o,saxs:o,gen:c,xpdf:h},default:c,titles:w,default_title:"Component"}),ProteinView:new e({views:{mx:l,saxs:l,gen:p,xpdf:u},default:p,titles:w,default_title:"Component"}),CrystalList:new e({views:{xpdf:m},titles:E,default_title:"Crystal"}),CrystalView:new e({views:{xpdf:_},titles:E,default_title:"Crystal"}),CrystalAdd:new e({views:{xpdf:f},titles:E,default_title:"Crystal"})}}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(16),i(71),i(190),i(191),i(302),i(192),i(193),i(20),i(12),i(15),i(131),i(41),i(108),i(238),i(239),i(241),i(775),i(6),i(18)],void 0===(l=function(e,t,i,a,l,o,r,c,p,d,u,h,m,_,f,g,v,b,w){var E=t.Row.extend({events:{click:"onClick"},onClick:function(e){n(e.target).is("i")||n(e.target).is("a")||n(e.target).is("input")||n(e.target).hasClass("editable")||this.model.set("isSelected",!0)}});return e.LayoutView.extend({className:"content",template:b,regions:{rsubsamples:".subsamples",history:".history",imh:".im_history",comps:".components"},ui:{comp:"input[name=COMPONENTID]"},initialize:function(e){w.Validation.bind(this),this.dcs=new m(null,{queryParams:{sid:this.model.get("BLSAMPLEID"),pp:5}}),this.dcs.fetch(),this.model.get("INSPECTIONS")>0&&(this.inspectionimages=new g,this.inspectionimages.queryParams.sid=this.model.get("BLSAMPLEID"),this.inspectionimages.fetch()),this.gproteins=new i,this.subsamples=new h,this.subsamples.queryParams.sid=this.model.get("BLSAMPLEID"),this.subsamples.fetch(),this.listenTo(this.subsamples,"change:isSelected",this.selectSubsample)},selectSubsample:function(e){var t=this.subsamples.findWhere({isSelected:!0});t?(this.dcs.queryParams.ssid=t.get("BLSUBSAMPLEID"),this.dcs.fetch()):this.dcs.queryParams.ssid=null},onRender:function(){var e=new p({model:this.model,el:this.$el});e.create("SPACEGROUP","select",{data:a.obj()}),e.create("ANOMALOUSSCATTERER","select",{data:l.obj()}),e.create("COMMENTS","text"),e.create("VOLUME","text"),e.create("ABUNDANCE","text"),e.create("CENTRINGMETHOD","select",{data:o.obj()}),e.create("EXPERIMENTKIND","select",{data:r.obj()}),e.create("RADIATIONSENSITIVITY","select",{data:c.obj()}),e.create("ENERGY","text"),this.model.get("HASDATA")||(e.create("CODE","text"),e.create("NAME","text"),e.create("USERPATH","text")),s.each(["CELL_A","CELL_B","CELL_C","CELL_ALPHA","CELL_BETA","CELL_GAMMA","REQUIREDRESOLUTION"],(function(t,i){e.create(t,"text")})),this.distinct=new i;var t=this;this.distinct.fetch().done((function(){var i=s.map(t.distinct.kv(),(function(e,t){return{value:e,id:t}}));e.create("PROTEINID","autocomplete",{autocomplete:{source:i}})})),this.history.show(_.DCView.get(app.type,{model:this.model,collection:this.dcs,params:{visit:null},noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0})),console.log("sample",this.model),this.comps.show(new f({showEmpty:!0,collection:this.model.get("components"),viewLink:!0,editinline:!0,CRYSTALID:this.model.get("CRYSTALID")})),this.model.get("INSPECTIONS")>0&&this.imh.show(new v({historyimages:this.inspectionimages,embed:!0})),this.ui.comp.autocomplete({source:this.getGlobalProteins.bind(this),select:this.selectGlobalProtein.bind(this)});var n=[{label:"#",cell:u.TemplateCell,editable:!1,template:"<%-(RID+1)%>"},{label:"Type",cell:u.TemplateCell,editable:!1,template:'<%-(X2 ? "Region" : "Point")%>'},{name:"X",label:"X",cell:"string",editable:!1},{name:"Y",label:"Y",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!0},{name:"GR",label:"Grid Scans",cell:"string",editable:!0},{name:"SC",label:"SCs",cell:"string",editable:!0},{name:"DC",label:"DCs",cell:"string",editable:!0},{name:"DCRESOLUTION",label:"Res",cell:"string",editable:!0},{label:"Status",cell:u.StatusCell,editable:!1}];this.subtable=new d({collection:this.subsamples,columns:n,tableClass:"subsamples",loading:!1,pages:!1,backgrid:{emptyText:"No subsamples found",row:E}}),this.rsubsamples.show(this.subtable)},selectGlobalProtein:function(e,t){e.preventDefault();var i=this.gproteins.findWhere({PROTEINID:t.item.value});if(i){console.log("add comp",i);var n=i.clone(),s=this.model.get("components");n.collection=s,n.set("new",!0),s.add(n)}this.ui.comp.val("")},getGlobalProteins:function(e,t){var i=this;this.gproteins.fetch({data:{term:e.term,global:1},success:function(e){t(i.gproteins.map((function(e){return{label:e.get("ACRONYM"),value:e.get("PROTEINID")}})))}})}})}.apply(t,a))||(e.exports=l)}).call(this,i(8),i(5))},function(e,t,i){(function(i){var n;void 0===(n=function(){return{opts:function(){return i.map(this.list.sort(),(function(e){return'<option value="'+e+'">'+e+"</option>"})).join()},obj:function(){var e={};return i.each(this.list.sort(),(function(t){e[t]=t})),e},list:["","optical","diffraction"]}}.apply(t,[]))||(e.exports=n)}).call(this,i(5))},,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"BLSUBSAMPLEID",urlRoot:"/sample/sub",defaults:{WAVELENGTH:"",TRANSMISSION:"",BOXSIZEX:"",BOXSIZEY:"",NUMBEROFIMAGES:"",AXISSTART:"",AXISRANGE:"",KAPPASTART:""},validation:{BLSAMPLEID:{required:!0,pattern:"number"},COMMENTS:{required:!1},X:{required:!0,pattern:"number"},Y:{required:!0,pattern:"number"},Z:{required:!1}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(306),i(307),i(502),i(194),i(690),i(704),i(706),i(710),i(714)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c){var p=e.ItemView.extend({className:"data_collection",template:"<div><h1>No data collections yet</h1></div>"}),d=e.ItemView.extend({className:"data_collection",template:'<div><h1><i class="fa fa-spin fa-cog"></i> Retrieving data collections</h1></div>'}),u=e.ItemView.extend({className:"data_collection",template:"<div><h1>No data collections found</h1></div>"});return e.CollectionView.extend({apStatus:!0,apMessageStatus:!0,rpStatus:!0,imageStatusCollection:t,apStatusCollection:i,apMessageStatusCollection:n,dcViews:{data:s,grid:a,load:l,mca:r,edge:o,action:c},childViewOptions:function(e){var t=!!this.getOption("params").visit,i=t?this.getOption("params").visit:e?e.get("VIS")?e.get("VIS"):app.prop+"-"+e.get("VN"):"";return{imagestatuses:this.imagestatuses,apstatuses:this.apstatuses,apmessagestatuses:this.apmessagestatuses,templateHelpers:function(){return{IS_VISIT:t,VIS_LINK:i,APIURL:app.apiurl}},visit:i}},initialize:function(e){this.imagestatuses=new(this.getOption("imageStatusCollection")),this.apstatuses=new(this.getOption("apStatusCollection")),this.apmessagestatuses=new(this.getOption("apMessageStatusCollection")),this.listenTo(this.collection,"sync",this._onSync,this),this._onSync()},_onSync:function(){var e=this.collection.pluck("ID");this.imagestatuses.fetch({data:{ids:e},type:"POST"}),this.getOption("apStatus")&&this.apstatuses.fetch({data:{ids:e},type:"POST"}),this.getOption("apMessageStatus")&&this.apmessagestatuses.fetch({data:{ids:e},type:"POST"})},getChildView:function(e){var t=e.get("TYPE");return t in this.getOption("dcViews")?this.getOption("dcViews")[t]:this.getOption("dcViews").data},getEmptyView:function(){return this.collection.queryParams.s()?u:this.collection.fetched?p:d},onDestroy:function(){this.collection.stop()},onDomRefresh:function(){this.children.each((function(e){e.triggerMethod("dom:refresh")}))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(501)],void 0===(a=function(e,t){return e.Collection.extend({model:t,url:"/dc/chi",parse:function(e,t){var i=[];return n.each(e,(function(e){i.push({ID:e[0],DI:e[1][0],SN:e[1][2],SNS:e[1][1]})})),i}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(308)],void 0===(a=function(e,t){return e.Collection.extend({model:t,url:"/dc/aps",parse:function(e,t){var i=[];return n.each(e,(function(e){i.push({ID:e[0],STATES:e[1]})})),i}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"ID"})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(310),i(11),i(8),i(23),i(42),i(195)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({template:!1,model:t,modelEvents:{change:"render"},events:{plotselected:"plotSelected",plotunselected:"plotUnselected",plotclick:"plotClick"},numimg:!0,clickable:!1,hidden:["Total"],plotClick:function(e,t,i){i&&i.datapoint.length&&this.trigger("plot:click",i.datapoint[0],i.datapoint[1])},plotSelected:function(e,t){this.trigger("plot:select",Math.floor(t.xaxis.from),Math.ceil(t.xaxis.to))},plotUnselected:function(e){this.trigger("plot:deselect")},setSelection:function(e,t){this.plot.setSelection({xaxis:{from:e,to:t}})},initialize:function(e){var i=e.parent;this.model=new t({id:i.get("ID"),nimg:i.get("NUMIMG"),pm:i}),this.model.fetch(),this.$el.css("opacity",0)},lazyLoad:function(){i.inView(this.$el)&&!this.$el.hasClass("enabled")&&(this.model.fetch(),this.$el.addClass("enabled"))},onRender:function(){var e=this.getOption("parent");if(this.model.get("data")){var t=s.extend({},i.default_plot,{xaxis:{minTickSize:1,tickDecimals:0},yaxes:[{},{position:"right",transform:function(e){return-e}},{ticks:[]}],grid:{borderWidth:0,clickable:this.getOption("clickable"),hoverable:this.getOption("clickable")}}),a=[];if(n.each({Spots:[0,1],Bragg:[1,1],Res:[2,2],Total:[3,4]},(function(e,t){this.model.get("data")[e[0]].length&&null!==this.model.get("data")[e[0]][0][1]&&-1==this.getOption("hidden").indexOf(t)&&a.push({data:this.model.get("data")[e[0]],label:t,yaxis:e[1]})}),this),this.getOption("numimg")){t.xaxes=[{max:parseInt(e.get("NUMIMG"))+parseInt(e.get("SI"))-1},{position:"top"}];var l=[];n.each(this.model.get("data")[0],(function(t,i){l.push([(t[0]-parseFloat(e.get("SI")))*parseFloat(e.get("AXISRANGE"))+parseFloat(e.get("AXISSTART")),0])})),a.push({data:l,yaxis:3,xaxis:2,points:{show:!1},lines:{show:!1}})}console.log("sel",this.getOption("selection")),this.getOption("selection")&&(t.selection={mode:"x"}),this.plot=s.plot(this.$el,a,t),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop(),this.plot&&this.plot.shutdown()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:"/dc/imq",initialize:function(e){this.nimg=e.nimg,this.pm=e.pm,this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},parse:function(e,t){return{data:e}},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},poll:function(){if(clearTimeout(this.refresh_thread),this.running){var e=!0,t=this.get("data");t&&t[0].length>0&&this.nimg==n.last(t[0])[0]&&(e=!1),this.pm.get("AGE")>15&&(e=!1),e&&(this.refresh_thread=setTimeout(this.fetch.bind(this),1e4))}}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(10),i(510),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({model:t,mode:"client",url:"/download/ap/attachments",keyAttribute:"FILENAME",valueAttribute:"AUTOPROCPROGRAMATTACHMENTID",state:{pageSize:15}},i))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(515),i(11),i(517),i(8),i(23),i(42),i(74)],void 0===(a=function(e,t,i,s,a,l){var o=e.ItemView.extend({template:n.template('<label><input type="checkbox"> <%-TYPE%></label>'),tagName:"li",ui:{check:"input[type=checkbox]"},events:{"click @ui.check":"select"},select:function(){var e=this.ui.check.is(":checked");this.model.set("isSelected",e)},onRender:function(){this.model.get("isSelected")&&this.ui.check.prop("checked",!0)}}),r=e.CollectionView.extend({childView:o,tagName:"ul",className:"clearfix"});return e.LayoutView.extend({template:a,regions:{rprogs:".programs",rplots:".plots"},initialize:function(e){this.plots=new i,this.plots.queryParams.id=e.id,this.ready=this.plots.fetch(),this.availplots=new t.Collection,this.listenTo(this.availplots,"change:isSelected",this.plot),this.listenTo(this.plots,"change:isSelected",this.plot)},onRender:function(){this.$el.find(".plot").height(.85*this.$el.height()),this.ready.done(this.populateSeries.bind(this))},populateSeries:function(){var e=this.plots.findWhere({AUTOPROCPROGRAMID:this.getOption("aid")});e&&e.set("isSelected",!0),this.rprogs.show(new r({collection:this.plots})),this.plots.length?(this.availplots.reset(n.map(n.filter(Object.keys(this.plots.at(0).get("PLOTS")),(function(e){return-1==["d_star_sq_min","d_star_sq_max"].indexOf(e)})),(function(e){var t={TYPE:e};return["completeness","r_merge","i_over_sigma_mean"].indexOf(e)>-1&&(t.isSelected=!0),t}))),this.rplots.show(new r({collection:this.availplots})),this.plot()):this.$el.find(".plot").text("No plots available for this datacollection")},plot:function(){var e={series:{lines:{show:!0},points:{show:!1}},xaxis:{tickFormatter:function(e,t){return(1/Math.sqrt(e)).toFixed(t.tickDecimals)}},grid:{borderWidth:0,hoverable:!0,clickable:!0},tooltip:!0,tooltipOpts:{content:"%s: %y.2"}},t=[],i=this.plots.where({isSelected:!0}),a=n.map(this.availplots.where({isSelected:!0}),(function(e){return e.get("TYPE")})),o=s.getColors(i.length);n.each(i,(function(e,i){var l=e.get("PLOTS").d_star_sq_min,r=e.get("PLOTS").d_star_sq_max,c=n.map(l,(function(e,t){return r[t]+(e-r[t])/2})),p=0;n.each(e.get("PLOTS"),(function(l,r){if(-1!=a.indexOf(r)){var d=n.map(l,(function(e,t){return[c[t],e]}));t.push({label:e.get("TYPE")+": "+r,data:d,yaxis:p+1,color:s.shadeColor(o[i],.3*p)}),p++}}))}),this),this._plot=l.plot(this.$el.find(".plot"),t,e)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(6),i(7),i(668),i(84),i(11)],void 0===(a=function(e,t,i,s,a){var l={ERROR:['<i class="fa fa-exclamation-circle icon red"></i>',"serious warning(s)",'<i class="fa fa-times icon red"></i>'],WARNING:['<i class="fa fa-exclamation-triangle icon orange"></i>',"alert(s)",'<i class="fa fa-exclamation icon orange"></i>'],INFO:['<i class="fa fa-info-circle icon green"></i>',"check(s) passed",'<i class="fa fa-check icon green"></i>']},o=e.Collection.extend({comparator:"order"}),r=e.Collection.extend({}),c=t.ItemView.extend({template:n.template('<h3><%=icons[SEVERITY][2]%> <%-MESSAGE%></h3><div class="expand"><pre><%-DESCRIPTION%></pre></div>'),templateHelpers:function(){return{icons:l}},ui:{expand:".expand"},events:{"click h3":"expand"},tagName:"li",className:function(){return this.model.get("SEVERITY")},expand:function(){this.ui.expand.slideToggle()},onRender:function(){this.ui.expand.hide()}}),p=t.CollectionView.extend({childView:c,tagName:"ul",className:"messages"}),d=t.LayoutView.extend({template:n.template('<h3 class="title"><%=icons[SEVERITY][0]%> <%-count%> <%-icons[SEVERITY][1]%></h3><div class="wrap"></div>'),templateHelpers:function(){return{icons:l,count:this.getOption("messages").where({SEVERITY:this.model.get("SEVERITY")}).length}},tagName:"li",className:function(){return this.model.get("SEVERITY")},regions:{wrap:".wrap"},events:{"click h3.title":"expand"},expand:function(){this.wrap.$el.slideToggle()},onRender:function(){var e=new i(this.getOption("messages").where({SEVERITY:this.model.get("SEVERITY")}));this.wrap.show(new p({collection:e})),this.wrap.$el.hide()}}),u=t.CollectionView.extend({childView:d,childViewOptions:function(){return{messages:this.getOption("messages")}},tagName:"ul",className:"messages",createGroups:function(){var e={ERROR:0,WARNING:1,INFO:2},t=n.map(n.unique(this.getOption("messages").pluck("SEVERITY")),(function(t){return{SEVERITY:t,ORDER:e[t]}}));this.collection.reset(t)},initialize:function(e){this.collection=new o,this.createGroups()}}),h=s.extend({tabTitle:"PROCESSINGPROGRAMS",tabID:"PROCESSINGPROGRAMS",tabContentItem:function(){return m},childViewOptions:function(){return{messages:this.getOption("messages")}},createGroups:function(){var e=n.map(n.unique(this.getOption("messages").pluck("PROCESSINGPROGRAMS")),(function(e){return{PROCESSINGPROGRAMS:e}}));this.collection.reset(e)},initialize:function(e){this.collection=e.collection=new r,this.createGroups(),h.__super__.initialize.call(this,e)}}),m=t.LayoutView.extend({template:n.template('<div class="wrap"></div>'),regions:{wrap:".wrap"},onRender:function(){var e=new i(this.getOption("messages").where({PROCESSINGPROGRAMS:this.model.get("PROCESSINGPROGRAMS")}));this.wrap.show(new u({messages:e}))}}),_=t.CollectionView.extend({childView:m,childViewOptions:function(){return{messages:this.getOption("messages")}},createGroups:function(){var e=n.map(n.unique(this.getOption("messages").pluck("PROCESSINGPROGRAMS")),(function(e){return{PROCESSINGPROGRAMS:e}}));this.collection.reset(e)},initialize:function(e){this.collection=new r,this.createGroups()}});return t.LayoutView.extend({template:n.template('<div class="wrapper"></div>'),className:"content",regions:{wrap:".wrapper"},initialize:function(e){e&&e.messages?this.messages=e.messages:(this.messages=new i,this.messages.queryParams.id=this.getOption("id"),this.messages.queryParams.dcg=this.getOption("dcg"),this.messages.state.pageSize=9999,this.ready=this.messages.fetch())},closeDialog:function(){this.trigger("dialog:close")},onRender:function(){this.getOption("embed")?this.wrap.show(new _({messages:this.messages})):this.ready.done(this.doOnRender.bind(this))},doOnRender:function(){this.wrap.show(new h({messages:this.messages}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6),i(672)],void 0===(s=function(e,t){return e.Collection.extend({model:t,url:function(){return"/dc/dp/"+this.id},initialize:function(e,t){this.id=t.id}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(11),i(29),i(8),i(47)],void 0===(s=function(e,t,i,n){return e.ItemView.extend({modelEvents:{change:"render"},template:!1,ui:{di:".diffraction img",sn:".snapshots img",sns:".snapshots"},initialize:function(e){this.listenTo(e.statuses,"sync",this.getModel,this),this.listenTo(app,"window:scroll",this.lazyLoad,this)},lazyLoad:function(){inview=this.$el.find(".lazy").not(".enabled").filter((function(){return t.inView(n(this))})),inview.each((function(e,t){var s=new i;s.onload=function(){n(t).attr("src",this.src),setTimeout((function(){n(t).addClass("show")}),100)},n(t).addClass("enabled"),s.load(n(t).attr("data-src"))}))},getModel:function(){var e=this.getOption("statuses").findWhere({ID:this.getOption("ID")});e!=this.model&&(this.undelegateEvents(),this.model=e,this.delegateEvents(),this.model&&this.render())},onRender:function(){console.log("render im status",this.getOption("TYPE"));var e=this.model.get("ID");if(this.model.get("DI")&&this.ui.di.attr("data-src",app.apiurl+"/image/diff/id/"+e).addClass("lazy"),this.model.get("SNS").length){this.model.get("SN")&&this.ui.sn.attr("data-src",app.apiurl+"/image/id/"+e).addClass("lazy");for(var t="",i=1;i<this.model.get("SNS").length;i++)this.model.get("SNS")[i]&&(t+='<a href="'+app.apiurl+"/image/id/"+e+"/f/1/n/"+(i+1)+'" title="Crystal Snapshot '+(i+1)+'"></a>');1==this.ui.sns.find("a").length&&this.ui.sns.append(t),this.ui.sns.magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0,navigateByImgClick:!0}})}this.lazyLoad(n(window))},onDestroy:function(){console.log("destroying image status vuew")}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(6),i(7),i(27),i(41),i(107),i(227),i(228),i(229),i(230),i(231),i(232),i(14),i(372),i(373)],void 0===(l=function(e,t,i,a,l,o,r,c,p,d,u,h,m,_){var f=l.extend({idAttribute:"CID"}),g=a.extend({model:f}),v=o.extend({template:_,intStatus:!1,className:"data_collection",ui:{cells:".cells",a:"input[name=CELL_A]",b:"input[name=CELL_B]",c:"input[name=CELL_C]",al:"input[name=CELL_ALPHA]",be:"input[name=CELL_BETA]",ga:"input[name=CELL_GAMMA]",cell:"div.cell",st:"input[name=start]",en:"input[name=end]",ind:"div.ind",method:"select[name=method]",res:"input[name=res]",sg:"input[name=SG]"},events:{"click .cells":"sendCell","click a.add":"clone","click a.rem":"rem","click a.sg":"toggleSG","change @ui.st":"updateSelection","change @ui.en":"updateSelection","keyup @ui.st":"updateSelection","keyup @ui.en":"updateSelection","click a.all":"selectAll","click a.apcell":"_setCell","change @ui.a":"updateCell","change @ui.b":"updateCell","change @ui.c":"updateCell","change @ui.al":"updateCell","change @ui.be":"updateCell","change @ui.ga":"updateCell","change @ui.sg":"updateCell","change @ui.method":"updateMethod","change @ui.res":"updateRes"},updateRes:function(){this.model.set("RES",this.ui.res.val())},updateMethod:function(){this.model.set("METHOD",this.ui.method.val())},updateCell:function(e){var t=n(e.target).attr("name"),i=n(e.target).val();this.model.set(t,i)},selectAll:function(e){e.preventDefault();var t=parseInt(this.model.get("SI")),i=parseInt(this.model.get("NUMIMG"));this.ui.st.val(t),this.ui.en.val(t+i-1),this.updateSelection()},updateSelection:function(){var e=parseInt(this.model.get("SI")),t=parseInt(this.model.get("NUMIMG"));this.ui.st.val()>e+t-1&&this.ui.st.val(e+t-1),this.ui.st.val()<e&&this.ui.st.val(e),this.ui.en.val()>e+t-1&&this.ui.en.val(e+t-1),this.ui.en.val()<e&&this.ui.en.val(e),this.plotview.setSelection(parseInt(this.ui.st.val()),parseInt(this.ui.en.val()))},initialize:function(e){o.prototype.initialize.apply(this,arguments),this.updateSelection=s.debounce(this.updateSelection,500)},setInd:function(e){e?this.ui.ind.show():this.ui.ind.hide()},onRender:function(){this.ui.cell.hide(),this.ui.ind.hide(),this.$el.find("ul").addClass("half"),this.$el.find('li input[type="text"]').css("width","25%"),this.ui.method.html(this.getOption("pipelines").opts()),this.model.set("METHOD",this.ui.method.val())},toggleSG:function(e){e.preventDefault(),this.ui.cell.slideToggle()},rem:function(e){e.preventDefault(),this.model.collection.remove(this.model)},clone:function(e){e.preventDefault(),this.trigger("clone:dc",this.model)},_setCell:function(e){if(e&&e.preventDefault(),this.aps.length){var t=(e=this.aps.at(0)).get("CELL");this.ui.a.val(t.CELL_A).trigger("change"),this.ui.b.val(t.CELL_B).trigger("change"),this.ui.c.val(t.CELL_C).trigger("change"),this.ui.al.val(t.CELL_AL).trigger("change"),this.ui.be.val(t.CELL_BE).trigger("change"),this.ui.ga.val(t.CELL_GA).trigger("change"),this.ui.sg.val(e.SG).trigger("change")}},setSelection:function(e,t){o.prototype.setSelection.apply(this,arguments),this.ui.st.val(e),this.ui.en.val(t)},setDeselection:function(){o.prototype.setDeselection.apply(this),this.ui.st.val(""),this.ui.en.val("")}}),b=t.CollectionView.extend({childView:v,childViewOptions:function(){return{pipelines:this.getOption("pipelines")}}}),w=e.Collection.extend(s.extend({keyAttribute:"NAME",valueAttribute:"VALUE"},h));return ReprocessView=i.extend({template:m,dialog:!0,title:"Reprocess Data",className:"rp content",regions:{dcr:".dcs"},ui:{cell:"div.cell",opts:"div.options",ind:"input[name=individual]",mul:"span.multi",met:"select[name=method]",com:"input[type=comments]"},buttons:{Integrate:"integrate",Close:"closeDialog"},events:{"click a.sgm":"toggleCell","click a.opt":"toggleOpts","click @ui.ind":"toggleIndividual"},templateHelpers:function(){return{VISIT:this.getOption("visit")}},toggleIndividual:function(e){var t=this.ui.ind.is(":checked");t?this.ui.mul.hide():this.ui.mul.show(),this.distlview.children.each((function(e){e.setInd(t)}))},toggleCell:function(e){e.preventDefault(),this.ui.cell.slideToggle()},toggleOpts:function(e){e.preventDefault(),this.ui.opts.slideToggle()},integrate:function(e){e.preventDefault();var t=this.collection.where({selected:!0});if(t.length){var i=this;if(this.ui.ind.is(":checked")){var a=0,l=[],o=[];s.each(t,(function(e){var t=this.pipelines.findWhere({VALUE:e.get("METHOD")}),n=new r({DATACOLLECTIONID:e.get("ID"),DISPLAYNAME:t.get("NAME"),RECIPE:e.get("METHOD")});o.push(n),l.push(n.save({},{success:function(){var t=new p;e.get("RES")&&t.add(new c({PROCESSINGJOBID:n.get("PROCESSINGJOBID"),PARAMETERKEY:"d_min",PARAMETERVALUE:e.get("RES")}));var o=!0,r=[];s.each(["CELL_A","CELL_B","CELL_C","CELL_ALPHA","CELL_BETA","CELL_GAMMA"],(function(e,t){var n=i.$el.find("input[name="+e+"]").val().replace(/\s/g,"");n?r.push(n):o=!1})),o&&t.add(new c({PROCESSINGJOBID:n.get("PROCESSINGJOBID"),PARAMETERKEY:"unit_cell",PARAMETERVALUE:r.join(",")})),e.get("SG")&&t.add(new c({PROCESSINGJOBID:n.get("PROCESSINGJOBID"),PARAMETERKEY:"spacegroup",PARAMETERVALUE:e.get("SG")})),i.$el.find("input[name=sm]").is(":checked")&&t.add(new c({PROCESSINGJOBID:n.get("PROCESSINGJOBID"),PARAMETERKEY:"small_molecule",PARAMETERVALUE:"true"})),t.length&&l.push(t.save());var u=new d({PROCESSINGJOBID:n.get("PROCESSINGJOBID"),DATACOLLECTIONID:e.get("ID"),STARTIMAGE:e.get("selection")[0],ENDIMAGE:e.get("selection")[1]});l.push(u.save()),a++},error:function(){app.alert({message:"Something went wrong starting that reprocessing run"})}}))})),n.when.apply(n,l).done((function(){app.alert({message:a+" reprocessing job(s) successfully submitted"}),s.each(o,(function(e){i.enqueue({PROCESSINGJOBID:e.get("PROCESSINGJOBID")})}))}))}else{var h=this.pipelines.findWhere({VALUE:i.ui.met.val()}),m=new r({DATACOLLECTIONID:t[0].get("ID"),COMMENTS:this.ui.com.val(),DISPLAYNAME:h.get("NAME"),RECIPE:i.ui.met.val()});if(t.length>1&&"fast_dp"==i.ui.met.val())return void app.alert({message:"Fast DP can only integrate a single sweep"});(l=[]).push(m.save({},{success:function(){var e=new p,a=i.$el.find("input[name=res]").val();a&&e.add(new c({PROCESSINGJOBID:m.get("PROCESSINGJOBID"),PARAMETERKEY:"d_min",PARAMETERVALUE:a}));var o=!0,r=[];s.each(["a","b","c","alpha","beta","gamma"],(function(e,t){var n=i.$el.find("input[name="+e+"]").val().replace(/\s/g,"");n?r.push(n):o=!1})),o&&e.add(new c({PROCESSINGJOBID:m.get("PROCESSINGJOBID"),PARAMETERKEY:"unit_cell",PARAMETERVALUE:r.join(",")}));var d=i.$el.find("input[name=sg]").val().replace(/\s/g,"");d&&e.add(new c({PROCESSINGJOBID:m.get("PROCESSINGJOBID"),PARAMETERKEY:"spacegroup",PARAMETERVALUE:d})),i.$el.find("input[name=sm]").is(":checked")&&e.add(new c({PROCESSINGJOBID:m.get("PROCESSINGJOBID"),PARAMETERKEY:"small_molecule",PARAMETERVALUE:"true"})),e.length&&l.push(e.save());var h=[];s.each(t,(function(e){h.push({PROCESSINGJOBID:m.get("PROCESSINGJOBID"),DATACOLLECTIONID:e.get("ID"),STARTIMAGE:e.get("selection")[0],ENDIMAGE:e.get("selection")[1]})}));var _=new u(h);l.push(_.save()),n.when.apply(n,l).done((function(){app.alert({message:"1 reprocessing job successfully submitted"}),i._enqueue({PROCESSINGJOBID:m.get("PROCESSINGJOBID")})}))},error:function(){app.alert({message:"Something went wrong starting that reprocessing run"})}}))}}else app.alert({message:"Please selected some data sets to integrate"})},_enqueue:function(t){e.ajax({url:app.apiurl+"/process/enqueue",method:"POST",data:{PROCESSINGJOBID:t.PROCESSINGJOBID}})},initialize:function(e){if(this.collection=new g,e.model){var t=new f(e.model.toJSON());t.set("CID",this.collection.length+1),this.collection.add(t)}},onRender:function(){this.ui.opts.hide(),this.ui.cell.hide(),this.pipelines=new w([{NAME:"Xia2 DIALS",VALUE:"xia2-dials"},{NAME:"Xia2 3dii",VALUE:"xia2-3dii"},{NAME:"Fast DP",VALUE:"fast_dp"}]),this.ui.met.html(this.pipelines.opts()),this.distlview=new b({collection:this.collection,pipelines:this.pipelines}),this.dcr.show(this.distlview),this.listenTo(this.distlview,"childview:clone:dc",this.cloneDC,this),"sm"==app.type&&this.$el.find("input[name=sm]").prop("checked",!0)},cloneDC:function(e,t){var i=t.clone();i.set("CID",this.collection.length+1),this.collection.add(i)},setCell:function(e,t){console.log("set cell main view",e,t),s.each({a:"a",b:"b",c:"c",alpha:"al",beta:"be",gamma:"ga"},(function(e,i){this.$el.find("input[name="+i+"]").val(t.get("CELL")["CELL_"+e.toUpperCase()])}),this),this.$el.find("input[name=sg]").val(t.get("SG"))}})}.apply(t,a))||(e.exports=l)}).call(this,i(8),i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\t<p class="help">\n\t\tSelect data sets to reintegrate by selecting a number of images in the DISTL plot. Provide unit cell parameters, space group, and high resolution cut off as needed.\n\t</p>\n\n    <div class="ra">\n        <a href="/mc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button" title="Multicrystal Integrator"><i class="fa fa-diamond"></i> <span>Multi Crystal</span></a>\n    </div>\n\t<div class="data_collection">\n        <label><input type="checkbox" name="individual" /> Process Individually</label>\n\n        <span class="multi form">\n            | \n            Pipeline :<select name="method"></select>\n            High Res :<input type="text" name="res" /> &#197; |\n            <a href="#" class="button sgm">Space Group / Cell</a> \n            <a href="#" class="button opt">Options</a>\n            <br />\n            \x3c!-- Comments: <input type="text" name="comments" class="full" /> --\x3e\n        </span>\n    </div>\n\n    <div class="cell data_collection">\n        <label>Spacegroup: <input type="text" name="sg" /></label> | \n        <label>a <input type="text" name="a" /></label>\n        <label>b <input type="text" name="b" /></label>\n        <label>c <input type="text" name="c" /></label>\n        <label>&alpha; <input type="text" name="alpha" /></label>\n        <label>&beta; <input type="text" name="beta" /></label>\n        <label>&gamma; <input type="text" name="gamma" /></label>\n    </div>\n\n\n    <div class="options data_collection">\n        <label><input type="checkbox" name="sm" value="1" /> Small Molecule</label>\n    </div>\n\n\n    <div class="dcs"></div>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="clearfix">\n    <a href="#" class="button button-notext rem r"><i class="fa fa-times"></i> <span>Remove</span></a> \n    <a href="#" class="button button-notext add r"><i class="fa fa-plus"></i> <span>Add</span></a>\n\n    '+(null==(__t=IMP)?"":_.escape(__t))+"_"+(null==(__t=RUN)?"":_.escape(__t))+" - "+(null==(__t=DIR)?"":_.escape(__t))+'\n</h1>\n\n<div class="ind data_collection">\n    Pipeline <select name="method"></select>\n    High Res <input type="text" name="res" /> &#197; | \n    <a href="#" class="button sg">Space Group / Cell</a> <br />\n</div>\n\n<div class="distl" title="Per Image Analysis: Number of spots detected for each image. Select which images to integrate by dragging across the graph"></div>\n\n<ul class="clearfix reproc">\n    ',BLSAMPLEID&&(__p+='<li class="sample"><span class="wrap">Sample: <a href="/samples/sid/'+(null==(__t=BLSAMPLEID)?"":_.escape(__t))+'">'+(null==(__t=SAMPLE)?"":_.escape(__t))+"</a></span></li>"),__p+="\n    <li>&"+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Start: "+(null==(__t=AXISSTART)?"":_.escape(__t))+"&deg;, Osc: "+(null==(__t=AXISRANGE)?"":_.escape(__t))+"&deg;</li>\n    ",1!=SI&&(__p+=" <li>First Image: "+(null==(__t=SI)?"":_.escape(__t))+"</li>"),__p+="\n    <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n    <li>Wavelength: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+'&#197;</li>\n    <li>\n        Start <input type="text" name="start" /> \n        End <input type="text" name="end" /> \n        <a href="#" class="button button-notext all r"><i class="fa fa-arrows"></i> <span>All</span></a>\n    </li>\n</ul>\n\n<div class="cell data_collection">\n    <a href="#" class="button apcell"><i class="fa"></i> Use AP Cell</a> | \n    <label>Spacegroup: <input type="text" name="SG" /></label> | \n    <label>a <input type="text" name="CELL_A" /></label>\n    <label>b <input type="text" name="CELL_B" /></label>\n    <label>c <input type="text" name="CELL_C" /></label>\n    <label>&alpha; <input type="text" name="CELL_ALPHA" /></label>\n    <label>&beta; <input type="text" name="CELL_BETA" /></label>\n    <label>&gamma; <input type="text" name="CELL_GAMMA" /></label>\n</div>\n';return __p}},function(e,t,i){var n,s;n=[i(6),i(72)],void 0===(s=function(e,t){return e.Model.extend({idAttribute:"DATACOLLECTIONCOMMENTID",urlRoot:"/dc/comments",validation:{DATACOLLECTIONID:{pattern:"number",required:!0},PERSONID:{required:!0,pattern:"number"},COMMENTS:{required:!0}},initialize:function(e,t){this.on("change",this.addDate,this),this.addDate()},addDate:function(){this.attributes.CREATETIMEISO=new Date(this.get("CREATETIME")),this.attributes.MODTIMEISO=new Date(this.get("MODTIME")),this.get("COMMENTS")&&(this.attributes.COMMENTSMD=t.toHTML(this.get("COMMENTS")))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(147),i(56),i(11)],void 0===(a=function(e,t,i,s,a,l){var o=t.Cell.extend({events:{"click a.dl":l.signHandler,"click a.rsv":"closeDialog","click a.vatlog":"showLog"},closeDialog:function(){this.model.set("clicked",!0)},showLog:function(e){e.preventDefault();var t=n(e.target).attr("href"),i=this;l.sign({url:t,callback:function(e){app.dialog.show(new a({title:i.model.get("FILENAME")+" Log File",url:t+"?token="+e.token}))}})},render:function(){var e=this.model.escape("DATACOLLECTIONID");return this.$el.append('<a href="'+app.apiurl+"/download/attachment/id/"+e+"/aid/"+this.model.escape("DATACOLLECTIONFILEATTACHMENTID")+'" class="button dl"><i class="fa fa-download"></i> Download</a>'),"log"==this.model.get("FILETYPE")&&this.$el.append('<a href="'+app.apiurl+"/download/attachment/id/"+e+"/aid/"+this.model.escape("DATACOLLECTIONFILEATTACHMENTID")+'" class="button vatlog"><i class="fa fa-search"></i> View</a>'),"recip"==this.model.get("FILETYPE")&&this.$el.append('<a href="/dc/rsv/id/'+e+'" class="button rsv"><i class="fa fa-search"></i> Reciprocal Space Viewer</a>'),this}});return e.LayoutView.extend({className:"content",template:'<div><h1>Attachments</h1><p class="help">This page lists all attachments for the selected datacollection</p><div class="wrapper"></div></div>',regions:{wrap:".wrapper"},initialize:function(e){this.attachments=new s,this.listenTo(this.attachments,"change:clicked",this.closeDialog),this.attachments.queryParams.id=this.getOption("id"),this.attachments.queryParams.dcg=this.getOption("dcg"),this.attachments.fetch();var t=[{name:"FILEFULLPATH",label:"File",cell:"string",editable:!1},{name:"FILETYPE",label:"Type",cell:"string",editable:!1},{label:"",cell:o,editable:!1}];this.table=new i({collection:this.attachments,columns:t,tableClass:"attachments",loading:!0,noPageUrl:!0,backgrid:{emptyText:"No attachments found"}})},closeDialog:function(){this.trigger("dialog:close")},onRender:function(){this.wrap.show(this.table)},onShow:function(){this.table.focusSearch()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},,function(e,t,i){(function(n,s){var a,l;a=[i(7),i(148),i(11),i(40),i(716)],void 0===(l=function(e,t,i,a,l){return e.LayoutView.extend({className:"sample_status",template:l,fullScreen:!1,events:{"click .handle":"toggle","click @ui.clear":"clearFilter","mousemove canvas.sample_changer":"mouseMoveCanvas","click canvas.sample_changer":"clickCanvas","click @ui.gbc":"drawStatus"},ui:{clear:".clearf",canvas:"canvas.sample_changer",param:"select[name=param]",rank:"input[name=rank]",wrap:".wrap",gbc:"input[name=components]"},toggle:function(e){n(e.target).is("a")||this.$el.toggleClass("in")},clearFilter:function(e){e.preventDefault(),this.dcs.queryParams.sid=null,this.dcs.queryParams.visit=this.getOption("visit"),this.dcs.fetch({reset:!0}),this.ui.clear.css("visibility","hidden")},clickCanvas:function(e){this.dcs&&(this.dcs.queryParams.sid=this.current_sample.get("BLSAMPLEID"),this.dcs.queryParams.visit=null,this.dcs.fetch({reset:!0}),this.ui.clear.css("visibility","visible"))},initialize:function(e){this.dcs=e.dcs,this.collection=new a(null,{poll:!0,state:{pageSize:9999},queryParams:{visit:e.visit}}),this.listenTo(this.collection,"change",this.drawStatus,this),this.ready=this.collection.fetch(),e.bl in app.config.pucks?this.positions=app.config.pucks[e.bl]:this.positions=10,this.sc=16,this.tpad=30,this.pad=30,this.rpad=0;this.aspectratio=18/this.positions-(this.positions<=10?.3:0),this.contwidth=18*this.positions+this.pad+this.rpad+15,console.log("sc width",this.contwidth,this.aspectratio),this.getOption("fullScreen")||(this.$el.css("width",this.contwidth),this.$el.css("right",15-this.contwidth)),this.current_sample=null,this.selected_protein=-1},onDestroy:function(){this.collection.stop()},onRender:function(){this.ui.wrap.addClass("loading")},onDomRefresh:function(){this.$el.show(),this.canvas=this.$el.find("canvas")[0],this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.ui.wrap.width()-(this.getOption("fullScreen")?0:this.$el.find(".handle").width()),this.canvas.height=this.ui.wrap.width()*this.aspectratio,this.sw=(this.canvas.width-this.pad-this.rpad)/this.positions,this.sh=(this.canvas.height-this.tpad-15)/(this.sc-1),this.getOption("fullScreen")||this.$el.find(".handle").height(this.$el.height()),this.ready.done(this.drawStatus.bind(this))},mouseMoveCanvas:function(e){var t=i.get_xy(e,this.ui.canvas),n=Math.floor((t[0]-this.pad+this.sw/2)/this.sw),s=Math.floor((t[1]-this.tpad+this.sh/2)/this.sh),a=this.collection.findWhere({SCLOCATION:(n+1).toString(),LOCATION:(s+1).toString()});a!=this.current_sample&&(this.selected_protein=a?a.get("PROTEINID"):-1,this.current_sample=a,this.showSample(),this.drawStatus())},showSample:function(){if(this.current_sample){var e=this.current_sample;this.$el.find(".details .sname").html('<a href="/samples/sid/'+e.escape("BLSAMPLEID")+'">'+e.escape("NAME")+"</a>"),this.$el.find(".details .pname").html('<a href="/proteins/pid/'+e.escape("PROTEINID")+'">'+e.escape("ACRONYM")+"</a>"),this.$el.find(".details .comps").html(e.get("COMPONENTACRONYMS")?e.get("COMPONENTACRONYMS").join(","):"No Components"),this.$el.find(".details .cname").html('<a href="/shipment/cid/'+e.escape("CONTAINERID")+'">'+e.escape("CONTAINER")+"</a>"),this.$el.find(".details .loaded").html(e.get("R")>0?"Yes":"No"),this.$el.find(".details .screened").html((e.get("SC")>0?"Yes":"No")+(e.get("AI")>0?" (Indexed: "+e.escape("SCRESOLUTION")+"&#8491;)":"")),this.$el.find(".details .data").html((e.get("DC")>0?"Yes":"No")+(e.get("AP")>0?" (Integrated: "+e.escape("DCRESOLUTION")+"&#8491;)":""))}},drawStatus:function(){this.ui.wrap.removeClass("loading"),console.log("drawing sc");var e=s.uniq(this.ui.gbc.is(":checked")?this.collection.map((function(e){return e.get("COMPONENTIDS")?e.get("COMPONENTIDS").join(","):null})):this.collection.pluck("PROTEINID"));if(this.ui.rank.is(":checked"))var t=this.ui.param.val(),a=n(this.ui.param.find("option:selected")),l=s.map(this.collection.where({PROTEINID:this.selected_protein.toString()}),(function(e){if(e.get(t))return e.get(t)})),o=[s.min(l),s.max(l)];var r={R:"#ff6961",SC:"#fdfd96",AI:"#ffb347",DC:"#87ceeb",AP:"#77dd77"};this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var c=0;c<this.sc;c++)this.ctx.fillStyle="#000",this.ctx.font="11px Arial",this.ctx.lineWidth=1,this.ctx.fillText(c+1,10,this.sh*c+this.tpad+4);for(var p=0;p<this.positions;p++){this.ctx.fillStyle="#000",this.ctx.textAlign="center",this.ctx.font="11px Arial",this.ctx.lineWidth=1,this.ctx.fillText(p+1,this.sw*p+this.pad,12);for(c=0;c<this.sc;c++){var d=this.collection.findWhere({SCLOCATION:(p+1).toString(),LOCATION:(c+1).toString()});if(d){var u="#dfdfdf";for(k in r)d.get(k)>0&&(u=r[k]);if(this.ui.rank.is(":checked")&&this.selected_protein==d.get("PROTEINID")){var h=(d.get(t)-o[0])/(o[1]-o[0]);a.data("min")&&o[0]>a.data("min")&&(o[0]=a.data("min")),a.data("inverted")||(h=1-h),u=d.get(t)?i.rainbow(h/4):d.get(a.data("check"))>0?"yellow":"#dfdfdf"}this.ctx.beginPath(),this.ctx.strokeStyle="#000",this.ctx.arc(p*this.sw+this.pad,c*this.sh+this.tpad,this.sh/2-1,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.fillStyle=-1==this.selected_protein||this.selected_protein==d.get("PROTEINID")?u:"#fff",this.ctx.fill();var m=this.ui.gbc.is(":checked")?d.get("COMPONENTIDS")?d.get("COMPONENTIDS").join(","):null:d.get("PROTEINID"),_=i.rainbow(e.indexOf(m)/e.length);-1!=this.selected_protein&&this.selected_protein!=d.get("PROTEINID")||(this.ctx.beginPath(),this.ctx.strokeStyle="#000",this.ctx.arc(p*this.sw+this.pad,c*this.sh+this.tpad,this.sh/4,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.fillStyle=d==this.current_sample?"#bcbcbc":"#fff",this.ctx.fill()),this.ctx.beginPath(),this.ctx.arc(p*this.sw+this.pad,c*this.sh+this.tpad,this.sh/8,0,2*Math.PI,!1),this.ctx.fillStyle=_,this.ctx.fill()}}}}})}.apply(t,a))||(e.exports=l)}).call(this,i(8),i(5))},function(e,t,i){(function(n){var s,a;s=[i(91)],void 0===(a=function(e){return e.extend({initialize:function(e,t){this.pmodel=t.pmodel,this.addPrimary=t&&t.addPrimary,this.listenTo(this,"change add remove",this._update_component_ids),this.listenTo(this.pmodel,"sync",this._add_components),this._add_components()},totalAbundance:function(){return n.reduce(this.pluck("ABUNDANCE"),(function(e,t){return e+parseFloat(t)}),0)},_update_component_ids:function(){var e=this.slice(this.addPrimary?1:0),t={COMPONENTIDS:n.map(e,(function(e){return e.get("PROTEINID")})),COMPONENTAMOUNTS:n.map(e,(function(e){return e.get("ABUNDANCE")})),COMPONENTNAMES:n.map(e,(function(e){return e.get("NAME")})),COMPONENTSEQUENCES:n.map(e,(function(e){return e.get("SEQUENCE")})),COMPONENTDENSITIES:n.map(e,(function(e){return e.get("DENSITY")}))};if(this.addPrimary){var i=this.at(0);n.each(["PROTEINID","ACRONYM","ABUNDANCE","SEQUENCE","DENSITY"],(function(e){i.get(e)!=this.pmodel.get(e)&&(t[e]=i.get(e))}),this)}this.pmodel.set(t),console.log("update components",this.pmodel)},_add_components:function(){var e=this.pmodel.get("COMPONENTIDS")||[],t=this.pmodel.get("COMPONENTACRONYMS")||[],i=this.pmodel.get("COMPONENTNAMES")||[],s=this.pmodel.get("COMPONENTSEQUENCES")||[],a=this.pmodel.get("COMPONENTDENSITIES")||[],l=this.pmodel.get("COMPONENTTYPESYMBOLS")||[],o=this.pmodel.get("COMPONENTAMOUNTS")||[],r=this.pmodel.get("COMPONENTGLOBALS")||[],c=n.map(e,(function(e,n){return{PROTEINID:e,NAME:i[n],ACRONYM:t[n],SEQUENCE:n<s.length?s[n]:"",DENSITY:n<a.length?a[n]:"",ABUNDANCE:n<o.length?o[n]:0,CONCENTRATIONTYPE:n<l.length?l[n]:"",GLOBAL:n<r.length?parseInt(r[n]):0}}));this.addPrimary&&this.pmodel.get("PROTEINID")>-1&&c.unshift({PROTEINID:this.pmodel.get("PROTEINID"),NAME:this.pmodel.get("PROTEIN"),SEQUENCE:this.pmodel.get("SEQUENCE"),DENSITY:this.pmodel.get("DENSITY"),ACRONYM:this.pmodel.get("ACRONYM"),ABUNDANCE:this.pmodel.get("ABUNDANCE"),CONCENTRATIONTYPE:this.pmodel.get("SYMBOL")}),this.reset(c)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(719)],void 0===(a=function(e,t){var i=e.ItemView.extend({template:n.template("<h1><%-NAME%></h1><p><%-VALUE%></p>"),className:function(){return"pv "+this.model.get("CLASS")},modelEvents:{change:"render"}});return e.CollectionView.extend({childView:i,initialize:function(e){this.collection=new t(null,{bl:e.bl}),this.collection.fetch()},onDestroy:function(){this.collection.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(16),i(7),i(41),i(40),i(12),i(15),i(10),i(723),i(724)],void 0===(a=function(e,t,i,s,a,l,o,r,c,p){var d=e.Model.extend({initialize:function(e,t){this.on("change",this.addDist.bind(this)),this.addDist()},defaults:{COMMENTS:""},addDist:function(){this.set({DELTA:0!=this.get("OVERLAP")?parseFloat(this.get("AXISRANGE"))-parseFloat(this.get("OVERLAP")):0},{silent:!0}),this.set({AP:null},{silent:!0})}}),u=r.extend({model:d,mode:"client",state:{pageSize:10}}),h=t.Cell.extend({render:function(){this.$el.empty();var e="";return n.each(["R","SC","AI","DC","AP"],(function(t){this.model.get(t)>0&&(e='<li class="'+t+'"></li>')}),this),e&&this.$el.append('<ul class="status">'+e+"</ul>"),this}}),m=t.Cell.extend({events:{"click a":"queueSample"},initialize:function(e){this.listenTo(this.model,"queue:remove",this.render,this),m.__super__.initialize.call(this,e)},queueSample:function(e){e.preventDefault();var t=this.dc();if(t)t.collection.remove(t),this.render();else{this.last=new s(null,{running:!1,queryParams:{t:"dc",sid:this.model.get("BLSAMPLEID")}}),this.last.fetch().done(this.addToQueue.bind(this))}},addToQueue:function(){var e={BLSAMPLEID:this.model.get("BLSAMPLEID"),ACRONYM:this.model.get("ACRONYM"),SAMPLE:this.model.get("NAME"),CPOS:this.model.get("SCLOCATION"),SPOS:this.model.get("LOCATION")},t=this.last.at(0)?this.last.at(0).toJSON():{};this.column.get("queue").add(new d(n.extend({},t,e))),this.render()},render:function(){return this.$el.empty(),this.$el.append('<a href="#" class="button '+(this.dc()?"button-highlight":"")+'"><i class="fa fa-'+(this.dc()?"times":"plus")+'"></i></a>'),this},dc:function(){return this.column.get("queue").findWhere({BLSAMPLEID:this.model.get("BLSAMPLEID")})}}),_=t.Cell.extend({events:{"click a":"removeSample"},removeSample:function(e){e.preventDefault(),this.model.collection.remove(this.model),this.model.trigger("queue:remove")},render:function(){return this.$el.empty(),this.$el.append('<a href="#" class="button"><i class="fa fa-times"></i></a>'),this}});t.Cell.extend({events:{"keyup input":"updateModel","blur input":"updateModel"},updateModel:function(){var e={};e[this.column.get("name")]=this.$el.find("input").val(),this.model.set(e,{silent:!0})},render:function(){return this.$el.empty(),this.$el.append('<input type="text" name="'+this.column.get("name")+'" value="'+this.model.get(this.column.get("name"))+'" />'),this}});return i.LayoutView.extend({title:"Build GDA Queue",template:c,className:"content",regions:{smps:".smpls",que:".queue"},templateHelpers:function(){return{BL:this.getOption("bl"),VISIT:this.getOption("visit")}},events:{"dragstart .drag":"doDrag"},doDrag:function(e){e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.setData("text",this.generateXML())},initialize:function(e){this.path="/dls/"+this.getOption("bl")+"/data/"+(new Date).getFullYear()+"/"+this.getOption("visit"),this.dcs=e.dcs,this.collection=new a(null,{state:{pageSize:10},queryParams:{visit:e.visit}}),this.listenTo(this.collection,"change",this.drawStatus,this);this.collection.fetch(),this.queue=new u;var t=[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"ACRONYM",label:"Protein",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1},{label:"Container",cell:o.TemplateCell,template:"<%-CONTAINER%> <%-LOCATION%>",editable:!1},{label:"Snapshot",cell:o.TemplateCell,test:"DCID",editable:!1,template:'<img class="img" src="'+app.apiurl+'/image/id/<%-DCID%>" /> <img class="img" src="'+app.apiurl+'/image/n/2/id/<%-DCID%>" />'},{name:"SC",label:"# Screens",cell:"string",editable:!1},{name:"SCRESOLUTION",label:"Res",cell:"string",editable:!1},{name:"DC",label:"# DCs",cell:"string",editable:!1},{name:"DCRESOLUTION",label:"Res",cell:"string",editable:!1},{label:"Status",cell:h,editable:!1},{label:"",cell:m,queue:this.queue,editable:!1}];app.mobile()&&n.each([],(function(e){t[e].renderable=!1})),this.table=new l({collection:this.collection,columns:t,tableClass:"samples",filter:"sSearch",loading:!0,backgrid:{emptyText:"No samples assigned"}});t=[{name:"SAMPLE",label:"Sample",cell:"string",editable:!1},{name:"ACRONYM",label:"Protein",cell:"string",editable:!1},{name:"AXISSTART",label:"Start",cell:"string",editable:!1},{name:"AXISRANGE",label:"Osc",cell:"string",editable:!1},{name:"DELTA",label:"Delta",cell:"string",editable:!1},{name:"NUMIMG",label:"# Images",cell:"string",editable:!1},{name:"EXPOSURETIME",label:"Exposure",cell:"string",editable:!1},{name:"TRANSMISSION",label:"Transmission",cell:"string",editable:!1},{name:"WAVELENGTH",label:"Wavelength",cell:"string",editable:!1},{name:"RESOLUTION",label:"Resolution",cell:"string",editable:!1},{label:"",cell:_,editable:!1}];this.queuetable=new l({collection:this.queue,columns:t,tableClass:"queue",backgrid:{emptyText:"No samples queued"}})},onRender:function(){this.smps.show(this.table),this.que.show(this.queuetable)},generateXML:function(){return'<?xml version="1.0" ?><ExtendedCollectRequests><usingDna>false</usingDna>'+this.queue.map((function(e){return e.set("VISITPATH",this.path),p(e.toJSON())}),this).join("")+"</ExtendedCollectRequests>"}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(68)],void 0===(a=function(e,t){var i=e.ItemView.extend({tagName:"li",template:n.template("<%-FULLNAME%> - <% if (LAST) { %><%-VISITS%> Visits (Last Visit: <%-LAST%>)<% } else { %>*NEW*<% } %> [<%-REMOTE=='1' ? 'Remote' : 'On-site'%>] [<%-ROLE%>]"),className:function(){return 0==this.model.get("VISITS")?"new":""}}),s=e.ItemView.extend({tagName:"li",template:n.template('<i class="fa fa-spin fa-spinner"></i>')}),a=e.ItemView.extend({tagName:"li",template:n.template("No users registered yet")});return e.CollectionView.extend({tagName:"ul",childView:i,emptyView:s,className:"visit_users",getEmptyView:function(e){return this.collection.fetched?a:s},initialize:function(e){this.collection=new t,this.collection.queryParams.visit=e.visit;var i=this;this.collection.fetch().done((function(){i.collection.fetched=!0,i.collection.trigger("reset")}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(48)],void 0===(a=function(e,t){var i=e.ItemView.extend({tagName:"li",template:n.template('<a class="show" href="#"><%-SHIPPINGNAME%></a>: <%-CODE%> <%-FACILITYCODE%> - <%-DEWARSTATUS%>'),className:function(){return 0==this.model.get("VISITS")?"new":""},events:{"click a.show":"showShipment"},showShipment:function(e){e.preventDefault(),app.cookie(this.model.get("PROP")),app.trigger("shipment:show",this.model.get("SHIPPINGID"))}}),s=e.ItemView.extend({tagName:"li",template:n.template('<i class="fa fa-spin fa-spinner"></i>')}),a=e.ItemView.extend({tagName:"li",template:n.template("No dewars registered yet")});return e.CollectionView.extend({tagName:"ul",childView:i,emptyView:s,className:"visit_users",getEmptyView:function(e){return this.collection.fetched?a:s},initialize:function(e){this.collection=new t,this.collection.queryParams.all=1,this.collection.queryParams.visit=e.visit;var i=this;this.collection.fetch().done((function(){i.collection.fetched=!0,i.collection.trigger("reset")}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(16),i(384),i(230),i(232),i(12),i(15)],void 0===(a=function(e,t,i,s,a,l,o,r){var c=i.Cell.extend({render:function(){var e={2:'<i class="fa icon grey fa-pause alt="Waiting" title="Waiting"></i>',null:'<i class="fa icon grey fa-cog fa-spin alt="Running" title="Running"></i>',1:'<i class="fa icon green fa-check alt="Completed" title="Completed"></i>',0:'<i class="fa icon red fa-times alt="Failed" title="Failed"></i>'};return this.model.get("STATUS")in e&&this.$el.append(e[this.model.get("STATUS")]),this}}),p=i.Cell.extend({initialize:function(e){p.__super__.initialize.call(this,e),this.params=new a,console.log("col",this.column,"opts",e),this.listenTo(this.column.get("params"),"sync reset",this.syncParams),this.syncParams(),this.sweeps=new l,this.listenTo(this.column.get("sweeps"),"sync reset",this.syncSweeps),this.syncSweeps()},syncParams:function(){var e=this.column.get("params").where({PROCESSINGJOBID:this.model.get("PROCESSINGJOBID")});this.params.reset(e)},syncSweeps:function(){var e=this.column.get("sweeps").where({PROCESSINGJOBID:this.model.get("PROCESSINGJOBID")});this.sweeps.reset(e)},render:function(){var e=[{name:"PARAMETERKEY",label:"Key",cell:"string",editable:!1},{name:"PARAMETERVALUE",label:"Value",cell:"string",editable:!1}],t=new o({collection:this.params,columns:e,loading:!1,pages:!1,backgrid:{emptyText:"No parameters found"}});this.$el.html(t.render().$el);e=[{label:"Files",cell:r.TemplateCell,editable:!1,template:'<a href="/dc/visit/<%-VISIT%>/id/<%-DATACOLLECTIONID%>"><%-IMAGEDIRECTORY%><%-IMAGEPREFIX%>_<%-DATACOLLECTIONNUMBER%></a>'},{label:"Image #",cell:r.TemplateCell,editable:!1,template:"<%-STARTIMAGE%> - <%-ENDIMAGE%>"}];var i=new o({collection:this.sweeps,columns:e,loading:!1,pages:!1,backgrid:{emptyText:"No image sweeps found"}});return this.$el.append(i.render().$el),this}}),d=i.Cell.extend({render:function(){if(this.model.get("RLOW")){var e=[];n.each({"Low Resolution":"RLOW","High Resolution":"RHIGH","Total Observations":"NTOBS",Multiplicity:"MULTIPLICITY",Rmerge:"RMERGE","I/sig(I)":"ISIGI",Completeness:"COMPLETENESS"},(function(t,i){e.push({KEY:i,VALUE:this.model.get(t)})}),this),this.results=new t.Collection(e),console.log("results",this.results);var i=new o({collection:this.results,columns:[{name:"KEY",label:"",cell:"string",editable:!1},{name:"VALUE",label:"Overall",cell:"string",editable:!1}],loading:!1,pages:!1,backgrid:{emptyText:"No results found"}});this.$el.html(i.render().$el)}return this}});return e.LayoutView.extend({template:n.template('<% if (!EMBED) { %><h1>Reprocessing</h1><p class="help">Here you can find all reprocessing jobs and their statuses</p><% } %><div class="filter"></div><div class="wrapper"></div>'),className:"content",regions:{rwrap:".wrapper",rflt:".filter"},templateHelpers:function(){return{EMBED:this.getOption("embed")}},initialize:function(e){e.collection||(this.collection=new s,this.collection.queryParams.visit=e.visit,this.collection.fetch()),this.parameters=new a,this.parameters.queryParams.visit=e.visit,this.parameters.state.pageSize=9999,this.sweeps=new l,this.sweeps.queryParams.visit=e.visit,this.sweeps.state.pageSize=9999,this.listenTo(this.collection,"sync",this.refreshArgs)},refreshArgs:function(){var e=this.collection.pluck("PROCESSINGJOBID");this.sweeps.fetch({data:{ids:e}}),this.parameters.fetch({data:{ids:e}})},onRender:function(){var e=[{label:"Status",cell:c,editable:!1},{label:"Sample",cell:r.TemplateCell,editable:!1,template:'<a href="/samples/sid/<%-BLSAMPLEID%>"><%-SAMPLE%></a> - <a href="/proteins/pid/<%-PROTEINID%>"><%-PROTEIN%></a>'},{label:"DC",cell:r.TemplateCell,editable:!1,template:'<a href="/dc/visit/<%-VISIT%>/id/<%-DATACOLLECTIONID%>"><%-IMAGEPREFIX%></a>'},{name:"DISPLAYNAME",label:"Process",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1},{name:"LASTUPDATETIMESTAMP",label:"Last Updated",cell:"string",editable:!1},{name:"PROCESSINGMESSAGE",label:"Last Message",cell:"string",editable:!1},{label:"Arguments",cell:p,editable:!1,sweeps:this.sweeps,params:this.parameters}];this.getOption("results")&&e.push({label:"Results",cell:d,editable:!1}),this.rwrap.show(new o({columns:e,collection:this.collection,backgrid:{emptyText:"No reprocessings found"}}))},onDestroy:function(){this.collection.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(10),i(228)],void 0===(s=function(e,t){return e.extend({model:t,mode:"server",url:"/process",state:{pageSize:15},initialize:function(e){this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},poll:function(){clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),5e3))},parseState:function(e,t,i,n){return this.running=e.running,this.waiting=e.waiting,{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(370),i(47)],void 0===(a=function(e){return e.extend({onRender:function(){var e=this.model.get("ID");if(this.model.get("SNS")[3]&&(this.ui.di.attr("data-src",app.apiurl+"/image/id/"+e+"/n/4").addClass("lazy"),this.$el.find(".diffraction").magnificPopup({delegate:"a",type:"image"})),this.model.get("SNS")[0]){this.ui.sn.attr("data-src",app.apiurl+"/image/id/"+e).addClass("lazy");for(var t="",i=1;i<this.model.get("SNS").length-1;i++)this.model.get("SNS")[i]&&(t+='<a href="'+app.apiurl+"/image/id/"+e+"/f/1/n/"+(i+1)+'" title="Crystal Snapshot '+(i+1)+'"></a>');1==this.ui.sns.find("a").length&&this.ui.sns.append(t),this.ui.sns.magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0,navigateByImgClick:!0}})}this.lazyLoad(n(window))}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},,function(e,t,i){var n,s;n=[i(7),i(20),i(41),i(73),i(40),i(130),i(80),i(118),i(156),i(781),i(389),i(242),i(390),i(108),i(784),i(6),i(18)],void 0===(s=function(e,t,n,s,a,l,o,r,c,p,d,u,h,m,_,f){return e.LayoutView.extend({className:"content",template:_,showContainers:!0,regions:{pdb:".pdb",smp:".samples",dc:".datacollections",cont:".conts"},events:{"click a.add":"addPDB"},addPDB:function(){var e=new d({pid:this.model.get("PROTEINID")});this.listenTo(e,"pdb:success",this.getPDBs),app.dialog.show(e)},getPDBs:function(){this.pdbs.fetch()},initialize:function(e){f.Validation.bind(this),this.types=new u,this.tr=this.types.fetch(),this.concs=new h,this.cr=this.concs.fetch(),this.samples=new a,this.samples.state.pageSize=5,this.samples.queryParams.pid=this.model.get("PROTEINID"),this.samples.fetch(),this.dcs=new n(null,{queryParams:{pid:this.model.get("PROTEINID"),pp:5}}),this.dcs.fetch(),this.pdbs=new c(null,{pid:this.model.get("PROTEINID")}),this.getPDBs(),this.getOption("showContainers")&&(this.containers=new o,this.containers.queryParams.pid=this.model.get("PROTEINID"),this.containers.fetch())},onRender:function(){var e=this,n=new t({model:this.model,el:this.$el});0==this.model.get("EXTERNAL")&&n.create("NAME","text"),n.create("ACRONYM","text"),n.create("SEQUENCE","markdown"),n.create("MOLECULARMASS","text"),app.staff&&n.create("GLOBAL","select",{data:{1:"Yes",0:"No"}}),this.tr.done((function(){n.create("COMPONENTTYPEID","select",{data:e.types.kv({empty:!0})})})),this.cr.done((function(){n.create("CONCENTRATIONTYPEID","select",{data:e.concs.kv({empty:!0})})}));var s=i(300);this.pdb.show(new p({collection:this.pdbs})),this.smp.show(s.SampleList.get(app.type,{collection:this.samples,noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0})),this.dc.show(m.DCView.get(app.type,{model:this.model,collection:this.dcs,params:{visit:null},noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0})),this.getOption("showContainers")&&this.cont.show(new r({collection:this.containers,params:{}}))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(79)],void 0===(a=function(e,t){return e.Model.extend(n.extend({},{idAttribute:"PROTEINHASPDBID",urlRoot:"/sample/pdbs",validation:{pdb_code:function(e){if(e&&!e.match(/^\w\w\w\w$/))return"Invalid PDB Code"},pdb_file:function(e){if(e){var t=e.name.split("."),i=t[t.length-1];if(console.log("pdb val",t,i),"pdb"!=i&&"PDB"!=i)return"This file must be a PDB file"}}},initialize:function(e){this.pid=e.pid}},t))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(27),i(388),i(156),i(782),i(18),i(28)],void 0===(a=function(e,t,i,s,a){return t.extend({template:a,className:"form",title:"Add PDB to Protein",ui:{exist:"select[name=existing_pdb]",type:"select[name=type]",prog:".progress"},events:{"change @ui.type":"showType","change @ui.exist":"validateField","change input":"validateField","keyup @ui.exist":"validateField","keyup input":"validateField"},showType:function(){this.$el.find(".ty").hide(),this.$el.find("."+this.ui.type.val()).show()},buttons:{Add:"addPDB",Cancel:"closeDialog"},addPDB:function(){this.ui.prog.show();var e={};"pdb_file"==this.ui.type.val()?e.pdb_file=this.$el.find("input[name=pdb_file]")[0].files[0]:e[this.ui.type.val()]=this.$el.find('[name="'+this.ui.type.val()+'"]').val(),this.model.set(e);var t=this;this.model.isValid(!0)&&this.model.save({},{success:function(e,i,n){t.ui.prog.hide(),t.closeDialog(),t.trigger("pdb:success")},error:function(e,i,n){t.trigger("error",e,i,n)}})},updateProgress:function(e){this.ui.prog.progressbar({value:e})},createModel:function(e){this.model=new i({PROTEINID:e.pid})},initialize:function(e){this.createModel(e),this.setupValidation(),this.listenTo(this.model,"model:progress",this.updateProgress,this),this.pdbs=new s;var t=this;this.pdbs.fetch().done((function(){t.ui.exist.html(t.pdbs.opts())}))},onRender:function(){this.showType(),this.ui.prog.progressbar({value:0}),this.ui.prog.hide()},validateField:function(e){var t=n(e.target).attr("name"),i=e.target.files?e.target.files[0]:n(e.target).val();console.log("validating",t,i);var s=this.model.preValidate(t,i);s?this.invalid(e.target,s):this.valid(e.target)},invalid:function(e,t){n(e).removeClass("fvalid").addClass("ferror"),n(e).siblings("span.errormessage").length?n(e).siblings("span.errormessage").text(t):n(e).after('<span class="errormessage ferror">'+t+"</span>")},valid:function(e){n(e).removeClass("ferror").addClass("fvalid").siblings("span.errormessage").remove()},setupValidation:function(){e.Validation.unbind(this),e.Validation.bind(this,{selector:"name",valid:function(e,t){e.valid(e.$el.find("[name="+t+"]"))},invalid:function(e,t,i){e.invalid(e.$el.find("[name="+t+"]"),i)}})}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){(function(n){var s,a;s=[i(6),i(783),i(14)],void 0===(a=function(e,t,i){return e.Collection.extend(n.extend({},i,{model:t,url:"/sample/concentrationtypes",keyAttribute:"SYMBOL",valueAttribute:"CONCENTRATIONTYPEID"}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(26),i(46),i(242),i(390),i(156),i(785)],void 0===(a=function(e,t,i,s,a,l,o){return FormView.extend({template:o,templateHelpers:function(){return{IS_STAFF:app.staff,IS_CLONE:this.clone}},createModel:function(){this.model?(console.log("Passed protein to clone"),this.model.set("PROTEINID",null)):this.model=new i},ui:{name:"input[name=NAME]",acronym:"input[name=ACRONYM]",sequence:"textarea[name=SEQUENCE]",mass:"input[name=MOLECULARMASS]",exist:"select[name^=existing_pdb]",pdbf:"input[name=new_pdb]",type:"select[name=COMPONENTTYPEID]",conc:"select[name=CONCENTRATIONTYPEID]"},initialize:function(e){this.model&&(this.clone=!0),this.types=new s,this.types.fetch().done(this.updateTypes.bind(this)),this.concs=new a,this.concs.fetch().done(this.updateConcs.bind(this)),this.clone?this.pdbs=new l(null,{pid:this.model.get("PROTEINID")}):this.pdbs=new l,this.pdbs.fetch().done(this.updatePDBs.bind(this))},updatePDBs:function(){this.ui.exist.html(this.pdbs.opts())},updateTypes:function(){this.ui.type.html(this.types.opts({empty:!0})),this.model.get("COMPONENTTYPEID")&&this.ui.type.val(this.model.get("COMPONENTTYPEID"))},updateConcs:function(){this.ui.conc.html(this.concs.opts({empty:!0})),this.model.get("CONCENTRATIONTYPEID")&&this.ui.conc.val(this.model.get("CONCENTRATIONTYPEID"))},success:function(e,t,i){console.log("success from protadd",this.model);let n=this.model;this.clone&&this.pdbs.each((function(e,t,i){e.set("PROTEINID",n.get("PROTEINID")),e.set("PROTEINHASPDBID",null),e.set("existing_pdb",e.get("PDBID")),e.set("PDBID",null),e.save(e.changedAttributes())})),app.trigger("proteins:view",e.get("PROTEINID"))},failure:function(e,t,i){if(console.log(arguments),json=null,t.responseText)try{json=n.parseJSON(t.responseText)}catch(e){}json.message?app.alert({message:json.message}):app.alert({message:"Something went wrong registering that protein"})},onRender:function(){console.log(this.ui.pdbf),this.ui.name.val(this.model.get("NAME")),this.ui.acronym.val(this.model.get("ACRONYM")),this.ui.sequence.val(this.model.get("SEQUENCE")),this.ui.mass.val(this.model.get("MOLECULARMASS"))}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){var n,s;n=[i(7),i(15),i(154)],void 0===(s=function(e,t,i){var n=t.ClickableRow.extend({event:"phases:view",argument:"PROTEINID",cookie:!0});return i.extend({clickableRow:n,showFilter:!1,title:"Phase",url:"phase",columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"MOLECULARMASS",label:"Molecular Mass",cell:"string",editable:!1},{name:"SEQUENCE",label:"Composition",cell:"string",editable:!1},{name:"DENSITY",label:"Crystallographic Density",cell:"string",editable:!1},{name:"PDBS",label:"Has CIF",cell:t.TemplateCell,editable:!1,template:'<%-(PDBS > 0 ? "Yes" : "No")%>'}],hiddenColumns:[]})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(16),i(12),i(27),i(796),i(895),i(15),i(58),i(899)],void 0===(s=function(e,t,i,n,s,a,l,o,r){var c=l.ClickableRow.extend({event:"xsamples:view",argument:"CRYSTALID",cookie:!0}),p=t.Cell.extend({initialize:function(e){p.__super__.initialize.call(this,e),this.listenTo(this.model.get("components"),"reset add remove",this.render)},render:function(){if(this.model.get("components").length){var e=o.composeComposition(this.model.get("components"),this.model.get("components").pluck("ABUNDANCE"),!0);this.$el.text(e)}return this}});return e.LayoutView.extend({template:r,className:"content",events:{"click a.addSimpleSample":"addSimpleSample","click a.addAdvancedSample":"addAdvancedSample"},row:c,templateHelpers:function(){return{TYPE:this.collection.queryParams.pid?"phase":"proposal"}},regions:{wrap:".samples"},ui:{new:"a.new"},onRender:function(){this.getOption("hideButton")&&this.ui.new.hide(),this.wrap.show(new i({tableClass:"proteins",collection:this.collection,columns:[{name:"NAME",label:"Name",cell:l.TemplateCell,editable:!1,template:'<% if (NAME) { %><%-NAME.replace(/__/g, " ") %><% } %>'},{name:"COMPOSITION",label:"Composition",cell:p,editable:!1},{name:"THEORETICALDENSITY",label:"Density",cell:"string",editable:!1},{name:"NPHASES",label:"# Phases",cell:l.TemplateCell,editable:!1,template:"<%-((COMPONENTIDS||[]).length+1)%>"}],backgrid:{row:this.getOption("row"),emptyText:"No samples found"}}))},addSimpleSample:function(e){e.preventDefault();var t=new s({dialog:!0});this.listenTo(app,"sample:reloadSampleTable",this.refreshSampleTable),app.dialog.show(new n({title:"Add New Simple Sample",className:"content",view:t,autoSize:!0}))},refreshSampleTable:function(){this.collection.fetch()},addAdvancedSample:function(e){e.preventDefault();var t=new a({dialog:!0});this.listenTo(t,"phase:added",this.doAddNewSample),app.dialog.show(new n({title:"Add New Advanced Sample",className:"content",view:t,autoSize:!0}))},doAddNewAdvancedSample:function(e){}})}.apply(t,n))||(e.exports=s)},,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"BLSAMPLEGROUPSAMPLEID",urlRoot:"/sample/groups",defaults:{THEORETICALDENSITY:"",PACKINGFRACTION:"",BLSAMPLEID:"",SAMPLE:"",CRYSTAL:"",DIMENSION1:"",DIMENSION2:"",DIMENSION3:""},validation:{BLSAMPLEID:{required:!0,pattern:"digits"},GROUPORDER:{required:!1,pattern:"digits"},TYPE:{required:!1,pattern:"word"}}})}.apply(t,n))||(e.exports=s)},,,,,,,,,,,,,,,,,,,,function(e,t,i){var n,s;n=[i(7),i(26),i(46),i(58),i(901)],void 0===(s=function(e,t,i,n,s){return t.extend({template:s,ui:{acronym:"input[name=ACRONYM]",seq:"input[name=SEQUENCE]",mass:"input[name=MOLECULARMASS]"},events:{"change @ui.seq":"updateMolecularMass"},updateMolecularMass:function(){this.model.set("MOLECULARMASS",n.molecularMassFromComposition(this.ui.seq.val())),this.ui.mass.val(this.model.get("MOLECULARMASS"))},createModel:function(){this.model=new i},success:function(e,t,i){this.getOption("dialog")?(this.trigger("phase:added",this.model),app.dialog.currentView&&app.dialog.currentView.closeDialog()):app.trigger("phases:view",this.model.get("PROTEINID"))},initialize:function(e){},onRender:function(e){var t=(new Date).getTime();this.ui.acronym.val("xpdf"+t.toString())}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(15)],void 0===(a=function(e,t,i,s){var a=s.ClickableRow.extend({event:"instances:view",argument:"BLSAMPLEID",cookie:!0});return e.LayoutView.extend({className:"content",template:n.template('<h1>Instances</h1><p class="help">This page shows the instances associated with the current <%-TYPE%></p><div class="instances"></div>'),regions:{wrap:".instances"},templateHelpers:function(){return{TYPE:this.collection.queryParams.crid?"sample":"proposal"}},row:a,onRender:function(e){this.wrap.show(new i({tableClass:"samples",collection:this.collection,columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"CRYSTAL",label:"Sample",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1},{name:"THEORETICALDENSITY",label:"Crystallographic Density",cell:"string",editable:!1},{name:"PACKINGFRACTION",label:"Packing Fraction",cell:"string",editable:!1}],backgrid:{row:this.getOption("row"),emptyText:"No instances available"}}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(16),i(12),i(15),i(395),i(243),i(253)],void 0===(a=function(e,t,i,s,a,l,o){var r=t.Cell.extend({events:{"change select[name=BLSAMPLEID]":"updateSample"},updateSample:function(){console.log("update sample");var e=this.column.get("containers").findWhere({BLSAMPLEID:this.$el.find("select[name=BLSAMPLEID]").val()});e&&this.model.set({BLSAMPLEID:e.get("BLSAMPLEID"),SAMPLE:e.get("NAME"),CRYSTAL:e.get("CRYSTAL"),PACKINGFRACTION:e.get("PACKINGFRACTION"),THEORETICALDENSITY:e.get("THEORETICALDENSITY"),DIMENSION1:e.get("DIMENSION1"),DIMENSION2:e.get("DIMENSION2"),DIMENSION3:e.get("DIMENSION3")})},initialize:function(e){r.__super__.initialize.call(this,e),this.column.get("containers")&&this.listenTo(this.column.get("containers"),"sync add remove reset",this.render)},render:function(){return this.model.isNew()?(this.$el.html('<select name="BLSAMPLEID">'+this.column.get("containers").opts({empty:!0})+"<select>"),this.$el.find("select[name=BLSAMPLEID]").val(this.model.get("BLSAMPLEID"))):this.$el.text(this.model.get("SAMPLE")),this}}),c=t.Cell.extend({events:{"click a.save":"saveModel","click a.remove":"removeModel"},saveModel:function(e){e.preventDefault();var t=this;this.model.save({},{success:function(e,i){delete t.model.collection,t.model.parent.add(t.model)}})},removeModel:function(e){e.preventDefault(),this.model.destroy()},render:function(){return console.log("render",this.model,this.model.collection),this.model.get("BLSAMPLEID")&&this.model.get("BLSAMPLEID")!=this.column.get("PARENTBLSAMPLEID")&&(this.$el.html('<a class="button" href="/instances/sid/'+this.model.get("BLSAMPLEID")+'"><i class="fa fa-search"></i></a>'),this.$el.append(' <a class="button remove" href="#"><i class="fa fa-times"></i></a>')),this.model.isNew()&&this.$el.html('<a class="button save" href="#"><i class="fa fa-check"></i></a>'),this}}),p=e.LayoutView.extend({template:n.template('<h3>Group: <%-INDEX%><h3><div class="members"></div>'),regions:{rmembers:".members"},templateHelpers:function(){return{INDEX:this.model.collection.indexOf(this.model)+1}},onRender:function(){console.log("render members",this.model),this.rmembers.show(new i({collection:this.model.get("MEMBERS"),columns:[{name:"SAMPLE",label:"Name",cell:r,editable:!1,containers:this.getOption("containers")},{name:"GROUPORDER",label:"Order",cell:"string",editable:!1},{name:"CRYSTAL",label:"Instance of",cell:"string",editable:!1},{name:"TYPE",label:"Type",cell:"string",editable:!1},{label:"Exp. Density",cell:s.TemplateCell,editable:!1,template:"<% if (BLSAMPLEID) { %><%-(THEORETICALDENSITY*PACKINGFRACTION).toFixed(3)%><% } %>"},{label:"Dimensions",cell:s.TemplateCell,editable:!1,template:"<% if (DIMENSION1) { %><%-DIMENSION1%> x <%-DIMENSION2%> x <%-DIMENSION3%><% } %>"},{label:"",cell:c,editable:!1,PARENTBLSAMPLEID:this.getOption("PARENTBLSAMPLEID")}],pages:!1}))}}),d=e.ItemView.extend({template:n.template("This instance is not in any groups yet")}),u=e.CollectionView.extend({childView:p,emptyView:d});return e.LayoutView.extend({template:n.template('<div class="ra"><a href="#" class="button new"><i class="fa fa-plus"></i> <span>Create Group</span></div><div class="groups"></div>'),regions:{rgroups:".groups"},events:{"click a.new":"createGroup"},initialize:function(e){e.collection||(this.collection=new l,this.collection.queryParams.BLSAMPLEID=e.parent.get("BLSAMPLEID"),this.collection.fetch()),e.containers||(this.options.containers=new o,this.options.containers.queryParams.lt=1,this.options.containers.fetch())},createGroup:function(e){e.preventDefault();var t=this.getOption("parent"),i=new a({BLSAMPLEID:t.get("BLSAMPLEID"),TYPE:"sample",GROUPORDER:1,SAMPLE:t.get("NAME"),CRYSTAL:t.get("CRYSTAL"),PACKINGFRACTION:t.get("PACKINGFRACTION"),THEORETICALDENSITY:t.get("THEORETICALDENSITY"),DIMENSION1:t.get("DIMENSION1"),DIMENSION2:t.get("DIMENSION2"),DIMENSION3:t.get("DIMENSION3")}),n=this;i.save({},{success:function(){n.collection.add(i)}})},onRender:function(){this.rgroups.show(new u({collection:this.collection.groups(),childViewOptions:{containers:this.getOption("containers"),PARENTBLSAMPLEID:this.getOption("parent").get("BLSAMPLEID")}}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(57),i(58)],void 0===(s=function(e,t){var i=e.extend({initialize:function(e,t){i.__super__.initialize.call(this,e,t),this.listenTo(this.get("components"),"change add remove reset",this.updateComposition),this.listenTo(this,"change:THEORETICALDENSITY change:PACKINGFRACTION",this.updateExpDensity),this.updateComposition(),this.updateExpDensity()},updateExpDensity:function(){var e=this.get("PACKINGFRACTION")*this.get("THEORETICALDENSITY");this.set("EXPERIMENTALDENSITY",e.toFixed(3))},updateComposition:function(){if(this.get("components").length){var e=t.composeComposition(this.get("components"),this.get("components").pluck("ABUNDANCE"),!0);this.set("COMPOSITION",e),console.log("update comp",e,this)}}});return i}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(6),i(1257),i(37),i(921)],void 0===(l=function(e,t,i,a,l){DISABLE_DAY_SCROLL=!1,DISABLE_ITEM_SCROLL=!1;var o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],c=e.ItemView.extend({template:n.template('<%-BL%>: <a class="setVisit" href="/dc/visit/<%-VISIT%>"><%-VISIT%></a> (<%-LEN%>h)<% if(LC) { %><br />&nbsp; - <%-LC%><% } %><%if(SESSIONTYPE) { %><br />[<%-SESSIONTYPE%>]<% } %>'),tagName:"li",events:{"click .setVisit":"setVisit"},className:function(){var e=[];return this.model.get("ENISO")<new Date&&e.push("past"),1==this.model.get("ACTIVE")&&e.push("active"),e.join(" ")},setVisit:function(){app.visit=this.model.get("VIS")}}),p=e.CompositeView.extend({template:n.template("<% if (hour < 10) {%>0<% } %><%-hour%>:00 <ul></ul>"),tagName:"li",childView:c,childViewContainer:"ul",initialize:function(e){this.collection=new t.Collection(this.model.get("visits"))}}),d=e.CompositeView.extend({tagName:"li",childView:p,childViewContainer:"ul",templateHelpers:function(){return{dayNames:o,monthNames:r}},initialize:function(e){var s=app.options.get("timezone")?app.options.get("timezone"):"Europe/London",a=n.uniq(n.map(this.model.get("visits"),(function(e){const t=e.get("STISO");return i.default(t,s).getUTCHours()})));hc=[],n.each(a,(function(e){hc.push({hour:e,visits:n.filter(this.model.get("visits"),(function(t){const n=t.get("STISO");return i.default(n,s).getUTCHours()==e}))})}),this),hc=n.sortBy(hc,(function(e){return e.hour})),this.collection=new t.Collection(hc)},onRender:function(){"day"==this.model.get("type")&&this.$el.attr("data-day",this.model.get("date").getDate())},getTemplate:function(){return"head"==this.model.get("type")?n.template("<%-dayNames[day]%>"):"day"==this.model.get("type")?n.template('<span class="full"><%-dayNames[date.getDay()]%></span> <%-date.getDate()%> <span class="full"><%-monthNames[date.getMonth()]%></span><ul></ul>'):n.template("&nbsp")},className:function(){var e=[];if("head"==this.model.get("type"))e.push("head"),0!=this.model.get("day")&&6!=this.model.get("day")||e.push("wend");else if("day"==this.model.get("type")){var t=new Date;this.model.get("date").getTime()==new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()&&e.push("today"),0==this.model.get("visits").length&&e.push("no_event")}else e.push("noday");return e.join(" ")}}),u=e.ItemView.extend({tagName:"li",templateHelpers:function(){return{dayNames:o}},attributes:function(){return{"data-day":this.model.get("date").getDate()}},events:{click:"gotoDay"},gotoDay:function(){this.trigger("gotoDay",this.model.get("date").getDate())},template:n.template('<span class="day"><%-dayNames[date.getDay()].substr(0,3)%></span><span class="number"><%-date.getDate()%></span>'),className:function(){var e=[],t=new Date;return this.model.get("date").getTime()==new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()&&e.push("today"),this.model.get("visits").length&&e.push("event"),this.model.get("date")<new Date&&e.push("past"),e.join(" ")}}),h=e.CollectionView.extend({childView:u,childEvents:{gotoDay:"doGotoDay"},collectionEvents:{reset:"render"},events:{scroll:"onScroll"},initialize:function(e){this.onScroll=n.debounce(this.onScroll,100),this.lastDay=null},onRender:function(){var e=new Date,t=this.collection.at(0);if(t){var i=t.get("date");e.getMonth()==i.getMonth()&&e.getFullYear()==i.getFullYear()?this.doGotoDay(null,e.getDate()):s(".calendar_main").animate({scrollTop:0})}},onScroll:function(e){if(!DISABLE_DAY_SCROLL){DISABLE_ITEM_SCROLL=!0;var t=null,i=this.children.find((function(e){return e.$el.offset().left>0&&e.model.get("visits").length}));i&&(t=i.model.get("date").getDate()),t!=this.lastDay&&t&&this.doGotoDay(null,t),this.lastDay=t,setTimeout((function(){DISABLE_ITEM_SCROLL=!1}),1e3)}},doGotoDay:function(e,t){console.log("day",t);var i=s(".calendar_main li[data-day="+t+"]").offset().top;s(".calendar_main").animate({scrollTop:i-s(".calendar_main").offset().top+s(".calendar_main").scrollTop()})}});return e.CompositeView.extend({template:l,className:"content",childView:d,childViewContainer:"ul.calendar_main",ui:{mprev:".mprev",mnext:".mnext",yprev:".yprev",ynext:".ynext",title:"span.title",purl:".purl"},events:{"click @ui.yprev":"prevYear","click @ui.mprev":"prevMonth","click @ui.ynext":"nextYear","click @ui.mnext":"nextMonth","scroll .calendar_main":"onScroll"},onScroll:function(e){if(!DISABLE_ITEM_SCROLL){DISABLE_DAY_SCROLL=!0;var t=null,i=this.children.find((function(e){return e.$el.offset().top-this.$el.find(".calendar_main").offset().top>0}),this);i&&(t=i.model.get("date").getDate()),t&&this.lastDay!=t&&this.gotoDay(t),this.lastDay=t,setTimeout((function(){DISABLE_DAY_SCROLL=!1}),1e3)}},gotoDay:function(e){var t=s(".calendar_days li[data-day="+e+"]").offset().left;this.$el.find(".calendar_days").animate({scrollLeft:t-this.$el.find(".calendar_days").offset().left+this.$el.find(".calendar_days").scrollLeft()})},prevYear:function(){this.year--,this.generateMonth()},nextYear:function(){this.year++,this.generateMonth()},prevMonth:function(){0==this.month?(this.month=11,this.year--):this.month--,this.generateMonth()},nextMonth:function(){11==this.month?(this.year++,this.month=0):this.month++,this.generateMonth()},initialize:function(e){this.lastDay=null,this.onScroll=n.debounce(this.onScroll,100),this.collection=new t.Collection,this.days=new t.Collection;var i=new Date;this.year=void 0!==e.y?e.y:i.getFullYear(),this.month=void 0!==e.m?e.m:i.getMonth();var s=this,l={year:function(){return s.year},month:function(){var e=s.month+1;return e<10?"0"+e:e},all:e.all};e.all&&(l.ty=app.type),e.bl&&(l.bl=e.bl),this.visits=new a(null,{queryParams:l,state:{pageSize:9999}}),this.listenTo(this.visits,"request",this.displaySpinner),this.listenTo(this.visits,"sync",this.removeSpinner),this.listenTo(this.visits,"error",this.removeSpinner),this.generateMonth()},getPrivateURL:function(){var e=this;t.ajax({url:app.apiurl+"/cal/ext",success:function(t){e.ui.purl.html('<a class="button export" href="'+app.apiurl+t+'"><i class="fa fa-external-link"></i> Export (Private URL)</a>')}})},onRender:function(){this.daylistview=new h({collection:this.days,el:this.$el.find(".calendar_days")}),this.generateLinks(),this.displaySpinner(),this.$el.find(".calendar_main").scroll(this.onScroll.bind(this)),this.getOption("all")||this.getPrivateURL()},onDestroy:function(){this.$el.find(".calendar_main").unbind("scroll")},displaySpinner:function(){this.$el.addClass("loading")},removeSpinner:function(){this.$el.removeClass("loading")},generateLinks:function(){console.log(this.month,this.year),this.ui.mnext.text(r[(this.month+1)%12]),this.ui.mprev.text(r[(this.month-1+12)%12]),this.ui.yprev.text(this.year-1),this.ui.ynext.text(this.year+1),this.ui.title.text(r[this.month]+" "+this.year)},generateMonth:function(){this.visits.fetch().done(this.onGenerateMonth.bind(this))},onGenerateMonth:function(){var e=new Date(this.year,this.month+1,0).getDate(),t=new Date(this.year,this.month,1).getDay(),i=new Date(this.year,this.month,e).getDay();console.log(e,t,i);var s=[];n.each(n.range(7),(function(e){s.push({type:"head",day:((e+1)%7+7)%7})})),n.each(n.range(((t-1)%7+7)%7),(function(e){s.push({type:"pre"})})),n.each(n.range(e),(function(e){var t=new Date(this.year,this.month,e+1),i=this.visits.filter((function(e){return e.get("STISO")>t&&e.get("STISO")<new Date(t.getTime()+864e5)}));s.push({type:"day",date:t,visits:i})}),this),n.each(n.range(6%i),(function(e){s.push({type:"post"})})),this.collection.reset(s),this.generateLinks(),this.days.reset(this.collection.where({type:"day"})),console.log(this.days)}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{dc:"dc_list","dc(/visit/:visit)(/dcg/:dcg)(/page/:page)(/s/:search)(/ty/:ty)(/id/:id)(/pjid/:pjid)":"dc_list","dc/view/id/:id":"di_viewer","dc/map/id/:id(/ty/:ty)(/dt/:dt)(/ppl/:ppl)":"mapmodelviewer","dc/rsv/id/:id":"rsviewer","dc/summary/visit/:visit":"summary","dc/apstatussummary/visit/:visit(/ty/:ty)":"apstatussummary","dc/sc/visit/:visit":"sampleChanger","dc/queue/visit/:visit":"queue"},loadEvents:["dclist:show","dc:show"],loadModule:function(e){Promise.all([i.e(8),i.e(2)]).then(i.t.bind(null,987,7)).then(t=>{e(t)})}}))({rjsController:"modules/dc/controller"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(482)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"proposal(/s/:s)(/page/:page)":"list","visits(/s/:s)(/page/:page)":"visit_list"},loadEvents:["proposals:show","visits:show"]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(5),i(7),i(297),i(83),i(37),i(129),i(487),i(488)],void 0===(s=function(e,t,i,n,s,a,l,o){var r={list:function(e,t){app.bc.reset([{title:"Proposals",url:"/proposal"}]),app.loading(),console.log("prop list"),t=t?parseInt(t):1;var s=new n(null,{state:{currentPage:t},queryParams:{s:e}});s.fetch().done((function(){app.content.show(new i({collection:s,params:{s:e}}))}))},visit_list:function(e,t){app.bc.reset([{title:"Proposals",url:"/proposal"},{title:"Visits for "+app.prop}]),app.loading(),t=t?parseInt(t):1;var i=new s(null,{state:{currentPage:t},queryParams:{s:e}});i.fetch().done((function(){var t={saxs:l,mx:a},n=app.proposal&&app.proposal.get("TYPE");view=n in t?t[n]:o,app.content.show(new view({collection:i,params:{s:e}}))}))}};return app.addInitializer((function(){app.log("init router"),app.on("proposals:show",(function(){app.navigate("proposal"),r.list()})),app.on("visits:show",(function(){app.navigate("visits"),r.visit_list()}))})),r}.apply(t,n))||(e.exports=s)},,function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({url:function(){return"/projects/check/ty/"+this.get("type")+"/pid/"+this.get("pid")+"/iid/"+this.get("iid")},parse:function(e){return{state:e}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p><span class="b">Item:</span> <span class="title"></span></p>\n<p><span class="b">Select a project:</span>\n<select name="project"></select></p>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",DCCOUNT>0&&(__p+='\n<a class="button button-notext" title="View Statistics" href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-pie-chart"></i> <span>View Statistics</span></a>\n<a class="button button-notext dll" title="Download PDF Report" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/pdf/report/visit/"+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-list"></i> <span>Download Report</span></a>\n<a class="button button-notext dll" title="Export Data Collections to CSV" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/csv/visit/"+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-file-o"></i> <span>Download CSV</span></a>\n'),__p+="";return __p}},function(e,t,i){var n,s;n=[i(129),i(299)],void 0===(s=function(e,t){return e.extend({linksTemplate:t,clickable:!0})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(129),i(15),i(489)],void 0===(s=function(e,t,i){return e.extend({linksCell:t.TemplateCell,linksTemplate:i})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",DCCOUNT>0&&(__p+='\n<a class="button button-notext" title="View Statistics" href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'"><i class="fa fa-pie-chart"></i> <span>View Statistics</span></a>\n'),__p+="";return __p}},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"shipments(/page/:page)":"list","shipments/add":"add","shipments(/sid/:sid)":"view","shipments/awb/sid/:sid":"create_awb","shipments/pickup/sid/:sid":"rebook_pickup","containers/cid/:cid(/iid/:iid)(/sid/:sid)":"view_container","containers/queue/:cid":"queue_container","containers/add/did/:did":"add_container","containers/add/visit/:visit":"add_container_visit","containers(/s/:s)(/ty/:ty)(/page/:page)":"container_list","containers/registry(/ty/:ty)(/s/:s)(/page/:page)":"container_registry","containers/registry/:crid":"view_rcontainer","dewars(/s/:s)(/page/:page)":"dewar_list","dewars/dispatch/:did":"dispatch_dewar","dewars/transfer/:did":"transfer_dewar","dewars/registry(/ty/:ty)(/s/:s)(/page/:page)":"dewar_registry","dewars/registry/:fc":"view_dewar","dewars/overview(/s/:s)(/page/:page)":"dewar_overview","shipments/manifest":"manifest","shipments/stats":"dewarstats","containers/plan/:cid":"plan_container",migrate:"migrate"},loadEvents:["shipments:show","shipment:show","rcontainer:show","rdewar:show"],loadModule:function(e){Promise.all([i.e(10),i.e(0),i.e(6)]).then(i.t.bind(null,1002,7)).then(t=>{e(t)})}}))({rjsController:"modules/shipment/controller"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(492)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"samples(/s/:s)(/page/:page)":"list","samples/sid/:sid(/visit/:visit)":"view","instances(/s/:s)(/page/:page)":"list","instances/sid/:sid(/visit/:visit)":"view","crystals(/s/:s)(/page/:page)":"crystallist","crystals/cid/:cid":"crystalview","crystals/add":"crystaladd","xsamples(/s/:s)(/page/:page)":"crystallist","xsamples/cid/:cid":"crystalview","xsamples/add":"crystaladd","proteins(/s/:s)(/page/:page)":"proteinlist","proteins/pid/:pid":"proteinview","proteins/add":"proteinadd","proteins/pid/:pid/clone":"proteinclone","phases(/s/:s)(/page/:page)":"proteinlist","phases/pid/:pid":"proteinview","phases/add":"proteinadd"},loadEvents:["samples:show","proteins:show","samples:view","proteins:view","phases:view","xsamples:view","instances:view"]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(300),i(57),i(40),i(46),i(91),i(158),i(157),i(418),i(167)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c){var p={title:"Samples",url:"/samples"},d={list:function(e,i){app.loading();var s=t.SampleList.title(app.type);app.bc.reset([{title:s+"s",url:"/"+s.toLowerCase()+"s"}]),i=i?parseInt(i):1;var a=new n(null,{state:{currentPage:i},queryParams:{s:e}});a.fetch().done((function(){app.content.show(t.SampleList.get(app.type,{collection:a,params:{s:e}}))}))},view:function(e){app.loading(),new c({field:"BLSAMPLEID",value:e}).find({success:function(){var n=new("xpdf"==app.type?r:i)({BLSAMPLEID:e},{addPrimary:"xpdf"==app.type}),s={};"xpdf"==app.type&&(s.seq=1),n.fetch({data:s,success:function(){app.bc.reset([p,{title:n.get("NAME")}]),app.content.show(t.SampleView.get(app.type,{model:n}))},error:function(){app.bc.reset([p]),app.message({title:"No such sample",message:"The specified sample could not be found"})}})},error:function(){app.bc.reset([p]),app.message({title:"No such sample",message:"The specified sample could not be found"})}})},crystallist:function(e,i){app.loading();var n=t.CrystalList.title(app.type);app.bc.reset([{title:n+"s",url:"/"+n.toLowerCase()+"s"}]),i=i?parseInt(i):1;var s={s:e};"xpdf"==app.type&&(s.seq=1);var a=new o(null,{state:{currentPage:i,addPrimary:"xpdf"==app.type},queryParams:s});a.fetch().done((function(){app.content.show(t.CrystalList.get(app.type,{collection:a,params:{s:e}}))}))},crystalview:function(e){app.loading();var i=t.CrystalView.title(app.type),n={title:i+"s",url:"/"+i.toLowerCase()+"s"};new c({field:"CRYSTALID",value:e}).find({success:function(){var s=new l({CRYSTALID:e},{addPrimary:"xpdf"==app.type}),a={};"xpdf"==app.type&&(a.seq=1),s.fetch({data:a,success:function(){app.bc.reset([n,{title:s.get("NAME")}]),app.content.show(t.CrystalView.get(app.type,{model:s}))},error:function(){app.bc.reset([n]),app.message({title:"No such "+i,message:"The specified "+i+" could not be found"})}})},error:function(){app.bc.reset([n]),app.message({title:"No such "+i,message:"The specified "+i+" could not be found"})}})},crystaladd:function(){var e=t.CrystalAdd.title(app.type),i={title:e+"s",url:"/"+e.toLowerCase()+"s"};app.bc.reset([i,{title:"Add "+e}]),app.content.show(t.CrystalAdd.get(app.type))},proteinlist:function(e,i){app.loading();var n=t.ProteinList.title(app.type);app.bc.reset([{title:n+"s",url:"/"+n.toLowerCase()+"s"}]),i=i?parseInt(i):1;var s={s:e};"xpdf"==app.type&&(s.seq=1);var l=new a(null,{state:{currentPage:i},queryParams:s});l.fetch().done((function(){app.content.show(t.ProteinList.get(app.type,{collection:l,params:{s:e}}))}))},proteinview:function(e){app.loading();var i=t.ProteinList.title(app.type),n={title:i+"s",url:"/"+i.toLowerCase()+"s"};new c({field:"PROTEINID",value:e}).find({success:function(){var a=new s({PROTEINID:e});a.fetch({success:function(){app.bc.reset([n,{title:a.get("NAME")}]),app.content.show(t.ProteinView.get(app.type,{model:a}))},error:function(){app.bc.reset([n]),app.message({title:"No such "+i,message:"The specified "+i+" could not be found"})}})},error:function(){app.bc.reset([n]),app.message({title:"No such "+i,message:"The specified "+i+" could not be found"})}})},proteinadd:function(){var e=t.ProteinList.title(app.type);if(app.options.get("valid_components")&&!app.staff)app.message({title:"Cannot Create "+e,message:"Only staff may create new "+e+"s"});else if(app.proposal&&1!=app.proposal.get("ACTIVE"))app.message({title:"Proposal Not Active",message:"This proposal is not active so new "+e+"s cannot be added"});else{var i={title:e+"s",url:"/"+e.toLowerCase()+"s"};app.bc.reset([i,{title:"Add "+e}]),app.content.show(t.ProteinAdd.get(app.type))}},proteinclone:function(e){app.loading();var i=t.ProteinList.title(app.type),n={title:i+"s",url:"/"+i.toLowerCase()+"s"};new c({field:"PROTEINID",value:e}).find({success:function(){var a=new s({PROTEINID:e});a.fetch({success:function(){app.bc.reset([n,{title:"Clone "+i}]),app.content.show(t.ProteinAdd.get(app.type,{model:a}))},error:function(){app.bc.reset([n]),app.message({title:"No such "+i,message:"The specified "+i+" could not be found"})}})},error:function(){app.bc.reset([n]),app.message({title:"No such "+i,message:"The specified "+i+" could not be found"})}})}};return app.addInitializer((function(){app.on("samples:show",(function(){app.navigate("samples"),d.list()})),app.on("proteins:show",(function(){app.navigate("proteins"),d.proteinlist()})),app.on("samples:view",(function(e){app.navigate("samples/sid/"+e),d.view(e)})),app.on("instances:view",(function(e){app.navigate("instances/sid/"+e),d.view(e)})),app.on("crystals:view",(function(e){app.navigate("crystals/cid/"+e),d.crystalview(e)})),app.on("xsamples:view",(function(e){app.navigate("xsamples/cid/"+e),d.crystalview(e)})),app.on("proteins:view",(function(e){app.navigate("proteins/pid/"+e),d.proteinview(e)})),app.on("phases:view",(function(e){app.navigate("phases/pid/"+e),d.proteinview(e)}))})),d}.apply(t,n))||(e.exports=s)},,,,,,,function(module,exports,__webpack_require__){(function(jQuery){!function($){$.fn.editable=function(e,t){if("disable"!=e)if("enable"!=e){if("destroy"!=e){var i=$.extend({},$.fn.editable.defaults,{target:e},t),n=$.editable.types[i.type].plugin||function(){},s=$.editable.types[i.type].submit||function(){},a=$.editable.types[i.type].buttons||$.editable.types.defaults.buttons,l=$.editable.types[i.type].content||$.editable.types.defaults.content,o=$.editable.types[i.type].element||$.editable.types.defaults.element,r=$.editable.types[i.type].reset||$.editable.types.defaults.reset,c=i.callback||function(){},p=i.onedit||function(){},d=i.onsubmit||function(){},u=i.onreset||function(){},h=i.onerror||r;return i.tooltip&&$(this).attr("title",i.tooltip),i.autowidth="auto"==i.width,i.autoheight="auto"==i.height,this.each((function(){var e=this,t=$(e).width(),m=$(e).height();$(this).data("event.editable",i.event),$.trim($(this).html())||$(this).html(i.placeholder),$(this).bind(i.event,(function(u){if(!0!==$(this).data("disabled.editable")&&!e.editing&&!1!==p.apply(this,[i,e])){u.preventDefault(),u.stopPropagation(),i.tooltip&&$(e).removeAttr("title"),0==$(e).width()?(i.width=t,i.height=m):("none"!=i.width&&(i.width=i.autowidth?$(e).width():i.width),"none"!=i.height&&(i.height=i.autoheight?$(e).height():i.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==i.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),e.editing=!0,e.revert=$(e).html(),$(e).html("");var _=$("<form />");i.cssclass&&("inherit"==i.cssclass?_.attr("class",$(e).attr("class")):_.attr("class",i.cssclass)),i.style&&("inherit"==i.style?(_.attr("style",$(e).attr("style")),_.css("display",$(e).css("display"))):_.attr("style",i.style));var f,g=o.apply(_,[i,e]);if(i.loadurl){var v=setTimeout((function(){g.disabled=!0,l.apply(_,[i.loadtext,i,e])}),100),b={};b[i.id]=e.id,$.isFunction(i.loaddata)?$.extend(b,i.loaddata.apply(e,[e.revert,i])):$.extend(b,i.loaddata),$.ajax({type:i.loadtype,url:i.loadurl,data:b,async:!1,success:function(e){window.clearTimeout(v),f=e,g.disabled=!1}})}else i.data?(f=i.data,$.isFunction(i.data)&&(f=i.data.apply(e,[e.revert,i]))):f=e.revert;l.apply(_,[f,i,e]),g.attr("name",i.name),a.apply(_,[i,e]),$(e).append(_),n.apply(_,[i,e]),$(":input:visible:enabled:first",_).focus(),i.select&&g.select(),g.keydown((function(t){27==t.keyCode&&(t.preventDefault(),r.apply(_,[i,e]))})),"cancel"==i.onblur?g.blur((function(t){v=setTimeout((function(){r.apply(_,[i,e])}),500)})):"submit"==i.onblur?g.blur((function(e){v=setTimeout((function(){_.submit()}),200)})):$.isFunction(i.onblur)?g.blur((function(t){i.onblur.apply(e,[g.val(),i])})):g.blur((function(e){})),_.submit((function(t){if(v&&clearTimeout(v),t.preventDefault(),!1!==d.apply(_,[i,e])&&!1!==s.apply(_,[i,e]))if($.isFunction(i.target)){var n=i.target.apply(e,[g.val(),i]);$(e).html(n),e.editing=!1,c.apply(e,[e.innerHTML,i]),$.trim($(e).html())||$(e).html(i.placeholder)}else{var a={};a[i.name]=g.val(),a[i.id]=e.id,$.isFunction(i.submitdata)?$.extend(a,i.submitdata.apply(e,[e.revert,i])):$.extend(a,i.submitdata),"PUT"==i.method&&(a._method="put"),$(e).html(i.indicator);var l={type:"POST",data:a,dataType:"html",url:i.target,success:function(t,n){"html"==l.dataType&&$(e).html(t),e.editing=!1,c.apply(e,[t,i]),$.trim($(e).html())||$(e).html(i.placeholder)},error:function(t,n,s){h.apply(_,[i,e,t])}};$.extend(l,i.ajaxoptions),$.ajax(l)}return $(e).attr("title",i.tooltip),!1}))}})),this.reset=function(t){this.editing&&!1!==u.apply(t,[i,e])&&($(e).html(e.revert),e.editing=!1,$.trim($(e).html())||$(e).html(i.placeholder),i.tooltip&&$(e).attr("title",i.tooltip))}}))}$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable")}else $(this).data("disabled.editable",!1);else $(this).data("disabled.editable",!0)},$.editable={types:{defaults:{element:function(e,t){var i=$('<input type="hidden"></input>');return $(this).append(i),i},content:function(e,t,i){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(e,t){var i=this;if(e.submit){if(e.submit.match(/>$/))var n=$(e.submit).click((function(){"submit"!=n.attr("type")&&i.submit()}));else(n=$('<button type="submit" />')).html(e.submit);$(this).append(n)}if(e.cancel){if(e.cancel.match(/>$/))var s=$(e.cancel);else(s=$('<button type="cancel" />')).html(e.cancel);$(this).append(s),$(s).click((function(n){if($.isFunction($.editable.types[e.type].reset))var s=$.editable.types[e.type].reset;else s=$.editable.types.defaults.reset;return s.apply(i,[e,t]),!1}))}}},text:{element:function(e,t){var i=$("<input />");return"none"!=e.width&&i.width(e.width),"none"!=e.height&&i.height(e.height),i.attr("autocomplete","off"),$(this).append(i),i}},textarea:{element:function(e,t){var i=$("<textarea />");return e.rows?i.attr("rows",e.rows):"none"!=e.height&&i.height(e.height),e.cols?i.attr("cols",e.cols):"none"!=e.width&&i.width(e.width),$(this).append(i),i}},select:{element:function(e,t){var i=$("<select />");return $(this).append(i),i},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each((function(){$(this).val()!=json.selected&&$(this).text()!=$.trim(original.revert)||$(this).attr("selected","selected")}))}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery)}).call(this,__webpack_require__(8))},function(e,t,i){(function(e,t){e.expr[":"].focus=function(e){return e===document.activeElement&&(e.type||e.href)},t.editable.addInputType("datepicker",{element:function(e,i){var n=t(this),s=t("<input />");return s.attr("autocomplete","off"),n.append(s),s},plugin:function(t,i){var n=this,s=n.find("input");t.onblur="nothing",datepicker={onSelect:function(){n.submit()},onClose:function(){setTimeout((function(){s.is(":focus")?n.submit():i.reset(n)}),150)}},t.datepicker&&e.extend(datepicker,t.datepicker),s.datepicker(datepicker)}})}).call(this,i(8),i(8))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"ID"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6),i(503)],void 0===(s=function(e,t){return e.Collection.extend({model:t,url:"/dc/apms"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"ID"})}.apply(t,n))||(e.exports=s)},,function(e,t,i){var n,s;n=[i(7),i(506),i(508),i(509)],void 0===(s=function(e,t,i,n){var s=e.ItemView.extend({modelEvents:{change:"render"},getTemplate:function(e){return"XOalign"==this.model.get("TYPE")||"dials.align_crystal"==this.model.get("TYPE")?n:i}}),a=e.ItemView.extend({template:"<div>No strategies available for this data collection</div>"});return e.CollectionView.extend({childView:s,emptyView:a,initialize:function(e){var i=this;this.collection=new t(null,{id:e.id}),this.collection.fetch().done((function(){i.$el.slideDown()}))},fetch:function(){this.collection.fetch()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(5),i(6),i(507)],void 0===(s=function(e,t,i){return t.Collection.extend({model:i,url:function(){return"/dc/strat/"+this.id},initialize:function(e,t){this.id=t.id},parse:function(t,i){var n=[];return e.each(t[1],(function(e,t){e.STRATS.length&&n.push({TYPE:t,CELL:e.CELL,STRATS:e.STRATS})})),n}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"TYPE"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<h1>"+(null==(__t=TYPE)?"":_.escape(__t))+'</h1>\n<p class="r">\n    <a class="view button" title="Lookup Unit Cell" href="/cell/a/'+(null==(__t=CELL.A)?"":_.escape(__t))+"/b/"+(null==(__t=CELL.B)?"":_.escape(__t))+"/c/"+(null==(__t=CELL.C)?"":_.escape(__t))+"/al/"+(null==(__t=CELL.AL)?"":_.escape(__t))+"/be/"+(null==(__t=CELL.BE)?"":_.escape(__t))+"/ga/"+(null==(__t=CELL.GA)?"":_.escape(__t))+'"><i class="fa fa-search"></i> Lookup Cell</a>\n</p>\n\n<table class="reflow cell">\n    <thead>\n        <tr>\n            <th>Space Group</th>\n            <th>A</th>\n            <th>B</th>\n            <th>C</th>\n            <th>&alpha;</th>\n            <th>&beta;</th>\n            <th>&gamma;</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>'+(null==(__t=CELL.SG)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=CELL.A)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=CELL.B)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=CELL.C)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=CELL.AL)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=CELL.BE)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=CELL.GA)?"":_.escape(__t))+'</td>\n        </tr>\n    </tbody>\n</table>\n\n\n<table class="reflow strat">\n    <thead>\n        <tr>\n            <th>Strategy</th>\n            <th>Description</th>\n            <th>Axis</th>\n            <th>Axis Start</th>\n            <th>Axis Osc</th>\n            <th>Res (&#197;)</th>\n            <th>Ranking Res (&#197;)</th>\n            <th>Rel Trn (%)</th>\n            <th>Abs Trn (%)</th>\n            <th>Exposure (s)</th>\n            <th>No. Images</th>\n        </tr>\n    </thead>\n    \n    ',_.each(STRATS,(function(e,t){__p+='\n    <tr draggable="true" sid="'+(null==(__t=t)?"":_.escape(__t))+'">\n        <td>'+(null==(__t=e.COM)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.COMMENTS)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.ROTATIONAXIS)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.ST)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.OSCRAN)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.RES)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.RANKRES)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.TRAN)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.ATRAN)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.TIME)?"":_.escape(__t))+"</td>\n        <td>"+(null==(__t=e.NIMG)?"":_.escape(__t))+"</td>\n    </tr>\n    "})),__p+="\n</table>\n\n";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<h1>"+(null==(__t=TYPE)?"":_.escape(__t))+'</h1>\n\n\n<table class="reflow cell">\n    <thead>\n        <tr>\n            <th>Axes</th>\n            <th>Kappa</th>\n            <th>Chi</th>\n            <th>Phi</th>\n        </tr>\n    </thead>\n    <tbody>\n        ',_.each(STRATS,(function(e,t){__p+="\n        <tr>\n            <td>"+(null==(__t=e.COMMENTS)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.KAPPA)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.CHI)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.PHI)?"":_.escape(__t))+"</td>\n        </tr>\n        "})),__p+="\n    </tbody>\n</table>\n";return __p}},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"AUTOPROCPROGRAMATTACHMENTID",urlRoot:"/download/ap/attachments"})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return e.Model.extend({idAttribute:"AID",initialize:function(e){this.addClasses(),this.addIcon()},addClasses:function(){"0"!=this.get("PROCESSINGSTATUS")&&(this.attributes.CLASS={RMERGE:{},RMEAS:{},COMPLETENESS:{}},n.each(["overall","innerShell","outerShell"],(function(e){var t=this.get("SHELLS")[e].COMPLETENESS;this.attributes.CLASS.COMPLETENESS[e]=t>95?"active":t>80?"minor":"inactive";var i=this.get("SHELLS")[e].RMEAS;this.attributes.CLASS.RMEAS[e]=i<.5?"active":i<.6?"minor":"inactive"}),this))},addIcon:function(){var e={ERROR:'<i class="fa fa-exclamation-circle red"></i>',WARNING:'<i class="fa fa-exclamation-triangle orange"></i>'},t=["WARNING","ERROR"],i=-1,s="";n.each(this.get("MESSAGES"),(function(n){var a=t.indexOf(n.SEVERITY);a>i&&(i=a,e[n.SEVERITY]&&(s=" "+e[n.SEVERITY]))})),console.log("type icon",this.get("TYPE")+s),this.set({ICON:s,TYPEICON:this.get("TYPE")+s})}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(7),i(513),i(11),i(514),i(8),i(23),i(42)],void 0===(s=function(e,t,i,n,s){return e.ItemView.extend({template:n,model:t,modelEvents:{change:"render"},initialize:function(e){this.model=new t({id:e.id,aid:e.aid}),this.model.fetch(),this.$el.css("opacity",0)},onRender:function(){if(this.model.get("data")){this.$el.find(".rd_plot").height(this.$el.height()-30);var e=s.extend({},i.default_plot,{xaxis:{minTickSize:1,tickDecimals:0}});this.plot=s.plot(this.$el.find(".rd_plot"),[this.model.get("data")],e),this.$el.css("opacity",1)}},onDestroy:function(){this.plot&&this.plot.shutdown()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:function(){return"/dc/rd/aid/"+this.aid},initialize:function(e){this.id=e.id,this.aid=e.aid},parse:function(e,t){return{data:e}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="rd_plot"></div>\nPlot of R_d vs frame difference.<br />\nSee <a href="http://journals.iucr.org/d/issues/2006/01/00/ba5081/index.html">Diederichs, 2006, Acta D62, 96-101</a>';return __p}},function(e,t,i){var n,s;n=[i(10),i(516)],void 0===(s=function(e,t){return e.extend({model:t,mode:"client",url:"/download/plots",state:{pageSize:50}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"AUTOPROCPROGRAMID",urlRoot:"/download/plots"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<div class="plot"></div>\n<div class="filter">\n    <h1>Auto Processings</h1>\n    <div class="programs"></div>\n    <h1>Plots</h1>\n    <div class="plots"></div>\n</div>';return __p}},function(e,t,i){var n,s;n=[i(51),i(64),i(1256)],void 0===(s=function(e,t,i){return t.extend({vueView:e.extend({template:'<section class="content"><plotlychart v-bind:data="plot.data" v-bind:layout="plot.layout"></plotlychart></section>',components:{plotlychart:i.default},data:function(){return{plot:this.$getOption("data")}}})})}.apply(t,n))||(e.exports=s)},,,function(e,t,i){var n=i(522);n.register([i(667)]),e.exports=n},,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){var n,s;n=[i(10),i(669)],void 0===(s=function(e,t){return e.extend({model:t,mode:"client",url:"/dc/apm",state:{pageSize:15}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"AUTOPROCPROGRAMMESSAGEID",urlRoot:"/dc/apm"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="messages"></div>\n\n    ',0==PROCESSINGSTATUS?__p+='\n\n    <p class="r downloads">\n        <a class="view button dll" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/id/"+(null==(__t=DCID)?"":_.escape(__t))+"/aid/"+(null==(__t=AID)?"":_.escape(__t))+'/archive/1"><i class="fa fa-archive"></i> Archive</a>\n        <a class="apattach button" href="#"><i class="fa fa-files-o"></i> Logs &amp; Files</a>\n    </p>\n\n    <p>This procesing job failed: '+(null==(__t=PROCESSINGMESSAGE)?"":_.escape(__t))+"</p>\n\n    ":(__p+='\n\n    <p class="r downloads">\n        ',IMAGESWEEPCOUNT>1&&(__p+="\n            <span>"+(null==(__t=IMAGESWEEPCOUNT)?"":__t)+" image sweeps</span>\n        "),__p+="\n        ",DCCOUNT>1&&(__p+='\n        <a class="button" title="View Data Collections" href="/dc/pjid/'+(null==(__t=PROCESSINGJOBID)?"":__t)+'">\n            <i class="fa fa-list"></i> '+(null==(__t=DCCOUNT)?"":__t)+" Data Sets\n        </a>\n        "),__p+='\n\n        <a class="plot button" href="#"><i class="fa fa-line-chart"></i> Plots</a>\n        <a class="view button dll" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/id/"+(null==(__t=DCID)?"":_.escape(__t))+"/aid/"+(null==(__t=AID)?"":_.escape(__t))+'/archive/1"><i class="fa fa-archive"></i> Archive</a>\n        <a class="apattach button" href="#"><i class="fa fa-files-o"></i> Logs &amp; Files</a>\n    \n        ',"fast_dp"==TYPE&&(__p+='\n        <a href="#" class="button view rd"><i class="fa fa-search"></i> Radiation Damage</a>\n        '),__p+='\n    \n        <a class="view button" title="Lookup Unit Cell" href="/cell/a/'+(null==(__t=CELL.CELL_A)?"":_.escape(__t))+"/b/"+(null==(__t=CELL.CELL_B)?"":_.escape(__t))+"/c/"+(null==(__t=CELL.CELL_C)?"":_.escape(__t))+"/al/"+(null==(__t=CELL.CELL_AL)?"":_.escape(__t))+"/be/"+(null==(__t=CELL.CELL_BE)?"":_.escape(__t))+"/ga/"+(null==(__t=CELL.CELL_GA)?"":_.escape(__t))+'"><i class="fa fa-search"></i> Lookup Cell</a>\n    </p>\n\n    \x3c!-- Beam Centre information and movement warning not useful for i19 small molecule experiment type --\x3e\n    ',"sm"!=PROPOSAL_TYPE&&(__p+='\n    <table class="reflow bc">\n        <thead>\n            <tr>\n                <th>Beam Centre</th>\n                <th>X</th>\n                <th>Y</th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td>Start</td>\n                <td>'+(null==(__t=BEAM.XBEAM?BEAM.XBEAM:"- -")?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=BEAM.YBEAM?BEAM.YBEAM:"- -")?"":_.escape(__t))+"</td>\n            </tr>\n            \x3c!-- these are flipped, not sure why? --\x3e\n            <tr>\n                <td>Refined</td>\n                <td>"+(null==(__t=BEAM.REFINEDYBEAM?BEAM.REFINEDYBEAM:"- -")?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=BEAM.REFINEDXBEAM?BEAM.REFINEDXBEAM:"- -")?"":_.escape(__t))+"</td>\n            </tr>\n            <tr>\n                <td>&Delta;</td>\n                <td>"+(null==(__t=BEAM.REFINEDYBEAM&&BEAM.XBEAM?(BEAM.XBEAM-BEAM.REFINEDYBEAM).toFixed(2):"- -")?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=BEAM.YBEAM&&BEAM.REFINEDXBEAM?(BEAM.YBEAM-BEAM.REFINEDXBEAM).toFixed(2):"- -")?"":_.escape(__t))+"</td>\n            </tr>\n        </tbody>\n    </table>\n\n    ",BEAM.REFINEDYBEAM>0&&(Math.abs(BEAM.XBEAM-BEAM.REFINEDYBEAM)>.5||Math.abs(BEAM.YBEAM-BEAM.REFINEDXBEAM)>.5)&&(__p+='\n    <p class="message alert">WARNING: Beam centre has moved significantly during refinement! (>0.5mm)</p>\n    '),__p+="\n    "),__p+='\n\n    <table class="reflow cell">\n        <thead>\n            <tr>\n                <th>Space Group</th>\n                <th>A</th>\n                <th>B</th>\n                <th>C</th>\n                <th>&alpha;</th>\n                <th>&beta;</th>\n                <th>&gamma;</th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td>'+(null==(__t=SG)?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=CELL.CELL_A)?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=CELL.CELL_B)?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=CELL.CELL_C)?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=CELL.CELL_AL)?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=CELL.CELL_BE)?"":_.escape(__t))+"</td>\n                <td>"+(null==(__t=CELL.CELL_GA)?"":_.escape(__t))+'</td>\n            </tr>\n        </tbody>\n    </table>\n    \n    <table class="reflow shell">\n        <thead>\n            <tr>\n                <th>Shell</th>\n                <th>Observations</th>\n                <th>Unique</th>\n                <th>Resolution</th>\n                <th>Rmeas</th>\n                <th>I/sig(I)</th>\n                <th>CC Half</th>\n                <th>Completeness</th>\n                <th>Multiplicity</th>\n                <th>Anom Completeness</th>\n                <th>Anom Multiplicity</th>\n                <th>CC Anom</th>\n            </tr>\n        </thead>\n    ',_.each(SHELLS,(function(e,t){__p+='\n        <tr class="'+(null==(__t=t)?"":_.escape(__t))+'">\n            <td>'+(null==(__t=t)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.NTOBS)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.NUOBS)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.RHIGH)?"":_.escape(__t))+" - "+(null==(__t=e.RLOW)?"":_.escape(__t))+"</td>\n            <td>",print("Fast DP"==TYPE?e.RMERGE:e.RMEAS),__p+="</td>\n            <td>"+(null==(__t=e.ISIGI)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.CCHALF)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.COMPLETENESS)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.MULTIPLICITY)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.ANOMCOMPLETENESS)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.ANOMMULTIPLICITY)?"":_.escape(__t))+"</td>\n            <td>"+(null==(__t=e.CCANOMALOUS)?"":_.escape(__t))+"</td>\n        </tr>\n    "})),__p+="\n    </table>\n\n    "),__p+="\n";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(84),i(369),i(673),i(677),i(679),i(681)],void 0===(a=function(e,t,i,s,a,l,o){var r=e.ItemView.extend({template:"<p>No downstream processing available for this data collection</p>",tagName:"p"}),c=t.extend({tabTitle:"TYPE",tabID:"TYPE",tabContentItem:function(){var e={"Fast EP":s,Dimple:a,MrBUMP:l,"Big EP":o};for(var t in tabType=this.model.get("TYPE"),e)if(tabType.indexOf(t)>-1)return e[t]},childViewOptions:function(){var e=this.getOption("id");return{holderWidth:this.getOption("holderWidth"),templateHelpers:function(){return{DCID:e,APIURL:app.apiurl}},DCID:e}}});return e.LayoutView.extend({template:n.template('<div class="sw"></div><div class="res"></div>'),regions:{wrap:".sw"},initialize:function(e){this.collection=new i(null,{id:e.id}),this.collection.fetch().done(this.render.bind(this))},fetch:function(){this.collection.fetch()},onRender:function(){this.update(),this.listenTo(this.collection,"sync",this.update,this)},update:function(){this.collection.length?(this.$el.removeClass("ui-tabs"),this.wrap.show(new c({collection:this.collection,id:this.getOption("id"),el:this.$el.find(".res"),holderWidth:this.$el.parent().width()}))):(this.$el.addClass("ui-tabs"),this.wrap.show(new r)),this.$el.slideDown()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"TYPE"})}.apply(t,n))||(e.exports=s)},function(e,t,n){(function(s){var a,l;a=[n(7),n(674),n(198),n(56),n(676),n(11)],void 0===(l=function(e,t,n,a,l,o){return e.ItemView.extend({template:l,modelEvents:{change:"render"},ui:{plot:".plot_fastep"},events:{"click .logf":"showLog","click a.pattach":"showAttachments","click .dll":o.signHandler},showAttachments:function(e){e.preventDefault(),console.log("phasing",this.model),this.attachments=new t,this.attachments.queryParams.id=this.getOption("DCID"),this.attachments.fetch(),app.dialog.show(new DialogView({title:"Fast EP Attachments: "+this.model.escape("TYPE"),view:new n({collection:this.attachments,urlRoot:"ph",idParam:"PHASINGPROGRAMATTACHMENTID"}),autosize:!0}))},showLog:function(e){e.preventDefault();var t=s(e.target).attr("href"),i=this;o.sign({url:t,callback:function(e){app.dialog.show(new a({title:i.model.get("TYPE")+" Log File",url:t+"?token="+e.token}))}})},onDomRefresh:function(){app.mobile()?this.ui.plot.width(.97*(this.options.holderWidth-14)):this.ui.plot.width(.47*(this.options.holderWidth-14));var e=[{data:this.model.get("PLOTS").FOM,label:"FOM"},{data:this.model.get("PLOTS").CC,label:"mapCC"}],t={series:{lines:{show:!0}},xaxis:{ticks:function(e){var t=[],n=(e.max-e.min)/6;for(i=0;i<=6;i++)t.push(e.min+i*n);return t},tickFormatter:function(e,t){return(1/Math.sqrt(e)).toFixed(t.tickDecimals)},tickDecimals:2}},n=s.extend({},o.default_plot,t);s.plot(this.ui.plot,e,n)}})}.apply(t,a))||(e.exports=l)}).call(this,n(8))},function(e,t,i){(function(n){var s,a;s=[i(10),i(675),i(14)],void 0===(a=function(e,t,i){return e.extend(n.extend({model:t,mode:"client",url:"/download/ph/attachments",keyAttribute:"FILENAME",valueAttribute:"PHASINGPROGRAMATTACHMENTID",state:{pageSize:15}},i))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"PHASINGPROGRAMATTACHMENTID",urlRoot:"/download/ph/attachments"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div>\n    \n    <div class="plot_fastep"></div>\n    \n    <p class="r">\n        <a class="view button" href="/dc/map/id/'+(null==(__t=DCID)?"":_.escape(__t))+'/ty/ep"><i class="fa fa-search"></i> Map / Model Viewer</a>\n        <a class="dll button" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/ep/id/"+(null==(__t=DCID)?"":_.escape(__t))+'"><i class="fa fa-download"></i> PDB/MTZ file</a>\n        <a class="pattach button" href="#"><i class="fa fa-files-o"></i> Files</a>\n    </p>\n    \n    <ul>\n        <li>Figure of Merit: '+(null==(__t=FOM)?"":_.escape(__t))+"</li>\n        <li>Pseudo-free CC:  "+(null==(__t=CC)?"":_.escape(__t))+'</li>\n    </ul>\n\n    <table class="atoms">\n        <thead>\n            <tr>\n                <th>#</th>\n                <th>X</th>\n                <th>Y</th>\n                <th>Z</th>\n                <th>Occ</th>\n            </tr>\n        </thead>\n    \n        ',_.each(ATOMS,(function(e){__p+="\n        <tr>\n            ",_.each(e,(function(e){__p+="\n            <td>"+(null==(__t=e)?"":_.escape(__t))+"</td>\n            "})),__p+="\n        </tr>\n        \n        "})),__p+="\n        \n    </table>\n\n</div>";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(56),i(678),i(11),i(29),i(47)],void 0===(a=function(e,t,i,s,a){return e.ItemView.extend({template:i,modelEvents:{change:"render"},className:"clearfix",ui:{plot:".plot_dimple"},events:{"click .logf":"showLog","click .dll":s.signHandler},showLog:function(e){e.preventDefault();var i=n(e.target).attr("href"),a=this;s.sign({url:i,callback:function(e){app.dialog.show(new t({title:a.model.get("TYPE")+" Log File",url:i+"?token="+e.token}))}})},showBlob:function(){this.$el.find(".blobs img").attr("src",this.blob.src)},onDomRefresh:function(){console.log("showing dimple"),this.$el.find(".blobs").magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0,navigateByImgClick:!0}}),this.model.get("BLOBS")>0&&(this.blob=new a,this.blob.onload=this.showBlob.bind(this),this.blob.load(app.apiurl+"/image/dimp/id/"+this.getOption("DCID"))),app.mobile()?this.ui.plot.width(.93*(this.options.holderWidth-14)):(this.ui.plot.width(.67*(this.options.holderWidth-14)),this.ui.plot.height(.41*this.ui.plot.width()-80)),console.log(this.ui.plot);var e=[{data:this.model.get("PLOTS").FVC,label:"Rfree vs. Cycle"},{data:this.model.get("PLOTS").RVC,label:"R vs. Cycle"}],t=n.extend({},s.default_plot,{series:{lines:{show:!0}}});n.plot(this.ui.plot,e,t)}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div>\n\n    <div class="blobs">\n        ',_.each(_.range(BLOBS),(function(e){__p+='\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/dimp/id/"+(null==(__t=DCID)?"":_.escape(__t))+"/n/",print(e+1),__p+='" title="Dimple Blob ',print(e+1),__p+='">\n            ',0==e&&(__p+='\n                <img alt="Dimple Blob 1" />\n            '),__p+="\n        </a>\n        "})),__p+='\n        \n    </div>\n    <p class="r">\n        <a class="view button" href="/dc/map/id/'+(null==(__t=DCID)?"":_.escape(__t))+'"><i class="fa fa-search"></i> Map / Model Viewer</a>\n        <a class="dll button" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/dimple/id/"+(null==(__t=DCID)?"":_.escape(__t))+'"><i class="fa fa-download"></i> PDB/MTZ file</a>\n        <a class="view button logf" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/dimple/id/"+(null==(__t=DCID)?"":_.escape(__t))+'/log/1"><i class="fa fa-search"></i> Log file</a>\n    </p>\n    \n    <table class="rstats">\n        ',_.each(STATS[0],(function(e,t){__p+="\n        <tr>\n            ",_.each(_.range(STATS.length),(function(e){__p+="\n            <td>"+(null==(__t=STATS[e][t])?"":_.escape(__t))+"</td>\n            "})),__p+="\n        </tr>\n        "})),__p+='\n    </table>\n    \n    <div class="plot_dimple"></div>\n    \n</div>';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(56),i(680),i(11),i(47)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({template:i,modelEvents:{change:"render"},className:"clearfix",ui:{plot:".plot_dimple"},events:{"click .logf":"showLog","click .dll":s.signHandler},showLog:function(e){e.preventDefault();var i=n(e.target).attr("href"),a=this;s.sign({url:i,callback:function(e){app.dialog.show(new t({title:a.model.get("TYPE")+" Log File",url:i+"?token="+e.token}))}})},onDomRefresh:function(){console.log("showing dimple"),this.$el.find(".blobs").magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0,navigateByImgClick:!0}}),app.mobile()?this.ui.plot.width(.93*(this.options.holderWidth-14)):(this.ui.plot.width(.67*(this.options.holderWidth-14)),this.ui.plot.height(.41*this.ui.plot.width()-80)),console.log(this.ui.plot);var e=[{data:this.model.get("PLOTS").FVC,label:"Rfree vs. Cycle"},{data:this.model.get("PLOTS").RVC,label:"R vs. Cycle"}],t=n.extend({},s.default_plot,{series:{lines:{show:!0}}});n.plot(this.ui.plot,e,t)}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div>\n\n    <p class="r">\n        <a class="view button" href="/dc/map/id/'+(null==(__t=DCID)?"":_.escape(__t))+'/ty/mrbump"><i class="fa fa-search"></i> Map / Model Viewer</a>\n        <a class="dll button" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/mrbump/id/"+(null==(__t=DCID)?"":_.escape(__t))+'"><i class="fa fa-download"></i> PDB/MTZ file</a>\n        <a class="view button logf" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/mrbump/id/"+(null==(__t=DCID)?"":_.escape(__t))+'/log/1"><i class="fa fa-search"></i> Log file</a>\n    </p>\n    \n    <table class="rstats">\n        ',_.each(STATS[0],(function(e,t){__p+="\n        <tr>\n            ",_.each(_.range(STATS.length),(function(e){__p+="\n            <td>"+(null==(__t=STATS[e][t])?"":_.escape(__t))+"</td>\n            "})),__p+="\n        </tr>\n        "})),__p+='\n    </table>\n    \n    <div class="plot_dimple"></div>\n    \n</div>';return __p}},function(e,t,n){(function(s){var a,l;a=[n(7),n(56),n(682),n(11)],void 0===(l=function(e,t,n,a){return e.ItemView.extend({template:n,modelEvents:{change:"render"},ui:{XDS:".plot_shelx-XDS",DIALS:".plot_shelx-DIALS"},events:{"click .logf":"showLog","click .dll":a.signHandler},showLog:function(e){e.preventDefault(),app.dialog.show(new t({title:this.model.get("TYPE")+" Log File",url:s(e.target).attr("href")}))},onShow:function(){var e=this.model.get("SHELXC").PLOTS;for(var t in e){app.mobile()?this.ui[t].width(.97*(this.options.holderWidth-14)):this.ui[t].width(.47*(this.options.holderWidth-14));var n=[{data:e[t].DSIG,label:'&ltd"/sig&gt',yaxis:1},{data:e[t].CC12,label:"CC(1/2)",yaxis:2}],l={series:{lines:{show:!0}},xaxis:{ticks:function(e){var t=[],n=(e.max-e.min)/6;for(i=0;i<=6;i++)t.push(e.min+i*n);return t},tickFormatter:function(e,t){return(1/Math.sqrt(e)).toFixed(t.tickDecimals)},tickDecimals:2},yaxes:[{position:"left"},{position:"right"}]},o=s.extend({},a.default_plot,l);s.plot(this.ui[t],n,o)}}})}.apply(t,a))||(e.exports=l)}).call(this,n(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="","undefined"!=typeof SETTINGS&&(__p+='\n    <section class="bigep-settings">\n        <h2>Settings</h2>\n        <table class="bepm_sets reflow">\n            <thead>\n                <tr>\n                    <th>Processed</th>\n                    <th>Anom. scatterer</th>\n                    <th>Space group</th>\n                    <th>Num. scatterers</th>\n                    <th>Dataset type</th>\n                    <th>Compound</th>\n                    <th>Sequence</th>\n                </tr>\n            </thead>\n            ',_.each(SETTINGS,(function(e,t){__p+="\n                <tr>\n                    <td>"+(null==(__t=t)?"":_.escape(__t))+"</td>\n                    <td>"+(null==(__t=e.atom)?"":_.escape(__t))+"</td>\n                    <td>"+(null==(__t=e.spacegroup)?"":_.escape(__t))+"</td>\n                    <td>"+(null==(__t=e.nsites)?"":_.escape(__t))+"</td>\n                    <td>"+(null==(__t=e.dataset)?"":_.escape(__t))+"</td>\n                    <td>"+(null==(__t=e.compound)?"":_.escape(__t))+'</td>\n                    <td><div class="bepm-seq seq">'+(null==(__t=e.sequence)?"":_.escape(__t))+"</div></td>\n                </tr>\n            "})),__p+="\n        </table>\n    </section>\n"),__p+="\n","undefined"!=typeof SHELXC&&(__p+="\n    ",_.each(SHELXC.PLOTS,(function(e,t){__p+='\n        <section class="bigep-stats clearfix">\n            <h2>'+(null==(__t=t)?"":_.escape(__t))+"</h2>\n            ","undefined"!=typeof PROC&&PROC.hasOwnProperty(t)&&(__p+='\n            <section class="bigep-models clearfix">\n                <table class="bepm_stats bepm_stats2 reflow">\n                    <thead>\n                        <tr>\n                            <th>Pipeline</th>\n                            <th>Resid. / Frag / Max. Frag.</th>\n                            <th>Best MapCC (Resol.)</th>\n                            <th>&nbsp;</th>\n                        </tr>\n                    </thead>\n                    ',_.each(PROC[t],(function(e,t){__p+="\n                    <tr>\n                        <td>"+(null==(__t=t)?"":_.escape(__t))+"</td>\n                        <td>"+(null==(__t=e.RESID)?"":_.escape(__t))+" / "+(null==(__t=e.FRAGM)?"":_.escape(__t))+" / "+(null==(__t=e.MAXLEN)?"":_.escape(__t))+"</td>\n                        <td>"+(null==(__t=e.MAPCC)?"":_.escape(__t))+" ("+(null==(__t=e.MAPRESOL)?"":_.escape(__t))+')</td>\n                        <td>\n                            <a class="view button" href="/dc/map/id/'+(null==(__t=DCID)?"":_.escape(__t))+"/ty/bigep/dt/"+(null==(__t=TAG)?"":_.escape(__t))+"/ppl/"+(null==(__t=t)?"":_.escape(__t))+'"><i class="fa fa-search"></i> Map / Model Viewer</a> \n                            <a class="dll button" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/bigep/id/"+(null==(__t=DCID)?"":_.escape(__t))+"/dt/"+(null==(__t=TAG)?"":_.escape(__t))+"/ppl/"+(null==(__t=t)?"":_.escape(__t))+'"><i class="fa fa-download"></i> PDB/MTZ file</a> \n                            <a class="view button logf" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/bigep/id/"+(null==(__t=DCID)?"":_.escape(__t))+"/dt/"+(null==(__t=TAG)?"":_.escape(__t))+"/ppl/"+(null==(__t=t)?"":_.escape(__t))+'/log/1"><i class="fa fa-search"></i> Log file</a>\n                        </td>\n                    </tr>\n                    '})),__p+="\n                </table>\n            </section>\n            "),__p+='\n            <div class="plot_shelx-'+(null==(__t=t)?"":_.escape(__t))+'"></div>\n        </section>\n    '})),__p+="\n"),__p+="\n";return __p}},function(e,t,i){var n,s;n=[i(7),i(8)],void 0===(s=function(e,t){return e.ItemView.extend({template:!1,modelEvents:{change:"render"},ui:{holder:".message-holder"},initialize:function(e){this.listenTo(e.statuses,"sync",this.getModel,this)},getModel:function(){var e=this.getOption("statuses").findWhere({ID:this.getOption("ID")});e!=this.model&&(this.undelegateEvents(),this.model=e,this.delegateEvents(),this.model&&this.render())},onRender:function(){console.log("render apmessage",this.model);var e=parseInt(this.model.get("ERRORS"))>0?'<i class="fa fa-exclamation-circle red"></i> '+this.model.get("ERRORS"):"",t=parseInt(this.model.get("WARNINGS"))>0?'<i class="fa fa-exclamation-triangle orange"></i> '+this.model.get("WARNINGS"):"",i=parseInt(this.model.get("INFOS"))>0?'<i class="fa fa-info-circle green"></i> '+this.model.get("INFOS"):"";this.ui.holder.html('<a href="#" class="button messages">'+e+" "+t+" "+i+"</a>")}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="state"></div>\n<h1>'+(null==(__t=IMP)?"":_.escape(__t))+"_"+(null==(__t=RUN)?"":_.escape(__t))+"</h1>\n<h2>"+(null==(__t=DIR)?"":_.escape(__t))+'</h2>\n<div class="distl" title="Per Image Analysis: Number of spots detected for each image. Select which images to integrate by dragging across the graph"></div>\n<span>&'+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Start: "+(null==(__t=AXISSTART)?"":_.escape(__t))+"&deg; &"+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Osc: "+(null==(__t=AXISRANGE)?"":_.escape(__t))+'&deg; | <a title="Click to view diffraction images for this data collection" class="images" href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'">Images</a></span>\n<div title="Autoprocessing results, click to use these cell parameters for reintegration">AP Cell: <span class="cells"></span></div>\n';return __p}},function(e,t,i){var n,s;n=[i(10),i(374)],void 0===(s=function(e,t){return e.extend({model:t,mode:"server",url:"/dc/comments",state:{pageSize:10},parseState:function(e,t,i,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>\n\tComments for <span class="date">'+(null==(__t=DC.ST)?"":_.escape(__t))+'</span><span class="spacer"> - </span> <span class="temp">'+(null==(__t=DC.DIR)?"":_.escape(__t))+(null==(__t=DC.FILETEMPLATE)?"":_.escape(__t))+'</span>\n</h1>\n\n<div class="comments"></div>\n\n\n<h1>Add a Comment</h1>\n<form method="post" id="add_comment" enctype="multipart/form-data">\n\n<div class="form">\n    <ul>\n\n        <li>\n            <label>Comment\n            \t<br />\n\t            <span><a href="http://daringfireball.net/projects/markdown/">Markdown Supported</a></span>\n            </label>\n            <textarea name="COMMENTS"></textarea>\n        </li>\n\n        <button name="submit" value="1" type="submit" class="button submit">Add Comment</button>\n\n    </ul>\n</div>\n\n</form>';return __p}},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"DATACOLLECTIONFILEATTACHMENTID",urlRoot:"/download/attachments"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='        <span class="button_holder">\n            <a href="#" class="atp button button-notext" ty="dc" iid="'+(null==(__t=DCG)?"":_.escape(__t))+'" name="'+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+'"><i class="fa fa-book"></i> <span>Add to Project</span></a>\n            <a href="#" class="button button-notext flag ',FLAG&&(__p+="button-highlight"),__p+='" title="Click to add this data collection to the list of favourite data collections"><i class="fa fa-star-o"></i> <span>Favourite</span></a>\n            <span class="dcglink">\n                <a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/dcg/"+(null==(__t=DCG)?"":_.escape(__t))+'" class="perm button button-notext" title="Permalink"><i class="fa fa-link"></i> <span>Permalink</span></a>\n            </span>\n            <span class="dclink">\n                <a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/id/"+(null==(__t=ID)?"":_.escape(__t))+'" class="perm button button-notext" title="Permalink"><i class="fa fa-link"></i> <span>Permalink</span></a>\n            </span>\n            <a href="#" class="comments button button-notext" title="Comments"><i class="fa fa-comments"></i> <b class="DCCC">'+(null==(__t=DCCC)?"":_.escape(__t))+'</b> <span>Comment(s)</span></a>\n\n            <a href="#" class="button attach"><i class="fa fa-file"></i> '+(null==(__t=DCAC)?"":_.escape(__t))+'</a>\n\n            <span class="extra"></span>\n        </span>\n\n        <span class="date">',IS_VISIT||(__p+='[<a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+'">'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"</a>]"),__p+=" "+(null==(__t=ST)?"":_.escape(__t))+'</span><span class="spacer"> - </span><i class="button fa fa-caret-right expand"></i> <span class="temp">'+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+"</span>\n\n        ","1"==ARCHIVED&&(__p+='\n            <i class="fa fa-archive r" title="This data collection is archived and data is no longer available on disk"></i>\n        '),__p+="";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data" ty="',print(0==AXISRANGE?"grid":0!=OVERLAP?"screen":""),__p+='">\n    <h1 class="title"></h1>\n\n    <div class="distl" title="Per Image Analysis plot showing number of spots (yellow and blue points), and estimated resolution (red points) for each image in the data collection"></div>\n    <div class="snapshots" title="View crystal snapshots for the current data collection">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot 1"><img dsrc="" alt="Crystal Snapshot 1" /></a>\n        </div>\n    <div class="diffraction" title="Click to view diffraction images">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><img dsrc="" alt="Diffraction Image 1" /></a>\n    </div>\n    \n    <div class="links">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><i class="fa fa-picture-o fa-2x"></i> Images</a> \n        <a class="sn" href="#snapshots"><i class="fa fa-camera fa-2x"></i> Snapshots</a> \n        <a class="dl" href="#distl"><i class="fa fa-bar-chart-o fa-2x"></i> DISTL</a> \n    </div>\n    \n    <ul class="clearfix">\n        <li>Flux: '+(null==(__t=parseFloat(FLUX).toExponential(2))?"":_.escape(__t))+"</li>\n        <li>&"+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Start: "+(null==(__t=AXISSTART)?"":_.escape(__t))+"&deg;</li>\n        <li>&"+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Osc: "+(null==(__t=AXISRANGE)?"":_.escape(__t))+"&deg;</li>\n        <li>&"+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Overlap: "+(null==(__t=OVERLAP)?"":_.escape(__t))+"&deg;</li>\n        <li>No. Images: "+(null==(__t=NUMIMG)?"":_.escape(__t))+"</li>\n        ",1!=SI&&(__p+=" <li>First Image: "+(null==(__t=SI)?"":_.escape(__t))+"</li>"),__p+="\n        ",(KAPPA&&0!=KAPPA||PHI&&0!=PHI||CHISTART&&0!=CHISTART)&&(__p+="<li>",null!=KAPPA&&(__p+="&kappa;: "+(null==(__t=KAPPA)?"":_.escape(__t))+"&deg;"),__p+=" ",null!=PHI&&(__p+="&phi;: "+(null==(__t=PHI)?"":_.escape(__t))+"&deg;"),__p+=" ",null!=CHISTART&&(__p+="&chi;: "+(null==(__t=CHISTART)?"":_.escape(__t))+"&deg;"),__p+="</li>"),__p+="\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Wavelength: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Transmission: "+(null==(__t=TRANSMISSION)?"":_.escape(__t))+"%</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+"&mu;m</li>\n        <li>Type: ",DCT&&print(DCT),__p+='</li>\n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+='<li>Status: <span class="b">Stopped</span></li>'),__p+='\n    </ul>\n    \n    <div class="holder">\n    ',AXISRANGE>0&&(__p+="\n        ",0!=OVERLAP?__p+='\n        <h1 title="Click to show EDNA/mosflm/xia2 strategies" class="strat">Strategies<span><i class="fa fa-spinner fa-spin"></i></span></h1>\n        <div class="strategies"></div>\n        ':__p+='\n        <h1 title="Click to show autoprocessing results such as Fast_DP and XIA2" class="ap">Auto Processing<span><i class="fa fa-spinner fa-spin"></i></span></h1>\n        <div class="autoproc"></div>\n        <h1 title="Click to show downstream processing results such as Dimple and Fast_EP" class="dp">Downstream Processing<span><i class="fa fa-spinner fa-spin"></i></span></h1>\n        <div class="downstream"></div>\n        ',__p+="\n    "),__p+="\n\n    </div>\n</div>";return __p}},function(e,t,i){var n,s;n=[i(7),i(145),i(84),i(106),i(20),i(6),i(233),i(698),i(27),i(146),i(375),i(144),i(702),i(703),i(18)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c,p,d,u,h){return t.extend({template:h,apStatusItem:d,events:{"click @ui.zoom":"toggleZoom"},ui:{di:"div.diviewer",im:"div.image",x:".x",y:".y",z:".z",val:".val",img:".img",bx:".boxx",by:".boxy",zoom:"a.zoom",holder:".holder h1"},toggleZoom:function(e){e.preventDefault();var t=this.ui.zoom.find("i"),i=this.ui.zoom.find("span");t.hasClass("fa-search-plus")?(this.ui.di.height(2*this.ui.di.height()),this.ui.im.height(2*this.ui.im.height()),t.removeClass("fa-search-plus").addClass("fa-search-minus"),i.text("Shrink")):(this.ui.di.height(this.ui.di.height()/2),this.ui.im.height(this.ui.im.height()/2),t.removeClass("fa-search-minus").addClass("fa-search-plus"),i.text("Expand")),this.onDomRefresh()},initialize:function(e){this.xrc=null,this.hasXRC=!1,this.gridplot=new o({BL:this.model.get("BL"),ID:this.model.get("ID"),NUMIMG:this.model.get("NUMIMG"),parent:this.model,imagestatuses:this.getOption("imagestatuses")}),this.listenTo(this.gridplot,"current",this.loadImage,this)},loadImage:function(e,t,i,n,s){console.log("set currnet",arguments),this.diviewer.change(e+1),this.ui.x.text(t),this.ui.y.text(i),this.ui.z.text(n),this.ui.val.text(s),this.ui.img.text(e+1)},onShow:function(){this.ui.holder.hide(),this.ui.zoom.hide(),this.diviewer=new l({model:this.model,embed:!0,readyText:"Click on the grid to load a diffraction image"}),this.ui.di.append(this.diviewer.render().$el),this.ui.im.append(this.gridplot.render().$el),a.Validation.unbind(this),a.Validation.bind(this),this.gridplot.gridPromise().done(this.showBox.bind(this)),this.apstatus=new(this.getOption("apStatusItem"))({ID:this.model.get("ID"),XRC:!0,statuses:this.getOption("apstatuses"),el:this.$el}),this.listenTo(this.apstatus,"model:change",this.checkXRC),this.updateInPlace(!0)},showBox:function(){var e=this.gridplot.gridInfo();this.ui.bx.text&&this.ui.bx.text((1e3*e.get("DX_MM")).toFixed(0)),this.ui.bx.text&&this.ui.by.text((1e3*e.get("DY_MM")).toFixed(0)),e.get("STEPS_Y")>10&&this.ui.zoom.show&&this.ui.zoom.show()},checkXRC:function(){if(!this.xrc){var e=this.apstatus.getStatus({type:"XrayCentring"});console.log("xrc state",e),e>=1&&!this.hasXRC&&(this.ui.holder.show(),this.hasXRC=!0),2==e&&(this.xrc=new u({id:this.model.get("ID")}),this.xrc.fetch({success:this.showXRC.bind(this)}))}},showXRC:function(){this.ui.holder.prepend("Method: "+this.xrc.get("METHOD")+" - X Pos: "+this.xrc.get("X")+" Y Pos: "+this.xrc.get("Y"))},onDestroy:function(){this.diviewer.destroy(),this.gridplot.destroy()},onDomRefresh:function(){this.diviewer.triggerMethod("dom:refresh"),this.gridplot.triggerMethod("dom:refresh")}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<h1 class="no_mobile"><span class="visit">'+(null==(__t=VIS_LINK)?"":_.escape(__t))+": </span>"+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+'</h1>\n\n<p class="help">This page is a full scale diffraction image viewer. Mousehweel zooms in and out, drag click to pan around the image. Press &gt; to go to the next image and &lt; the previous.</p>\n\n<div class="data_collection dc_params">\n    <ul class="full clearfix">\n        <li>Exposure: '+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Transmission: "+(null==(__t=TRANSMISSION)?"":_.escape(__t))+"%</li>\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Wavelength: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Oscillation: "+(null==(__t=AXISRANGE)?"":_.escape(__t))+'&deg;</li>\n    </ul>\n</div>\n\n<div class="image_controls border clearfix">\n    \n    <div class="im_col">\n        <abbr title="Hotkey: B increases, b decreases">B</abbr>rightness: <span class="bval">0</span> <div class="brightness"></div>\n    </div>\n    \n    <div class="im_col">\n        <abbr title="Hotkey: C increases, c decreases">C</abbr>ontrast: <span class="cval">0</span> <div class="contrast"></div>\n    </div>\n    \n    <div class="im_size im_col">\n        <abbr title="Hotkey: Z zooms in, z zooms out">Z</abbr>oom: <span class="zval">0</span>% <div class="zoom"></div>\n    </div>\n    \n    <div class="im_col toggles">\n        <label><abbr title="Hotkey: R toggles resolution rings">R</abbr>esolution Rings: <input type="checkbox" name="res" value="1" /></label>\n        <label>Ice Rings: <input type="checkbox" name="ice" value="1" /></label>\n        <label><abbr title="Hotkey: I toggles image inversion">I</abbr>nvert: <input type="checkbox" name="invert" value="1" /></label>\n        <label><abbr title="Hotkey: T toggles image thresholding">T</abbr>hreshold: <input type="checkbox" name="threshold" value="1" /></label>\n    </div>\n    \n    <div class="im_num">\n        <button name="prev" title="Load previous image">&lt;</button>\n        <input type="text" name="num" value="1" title="Load the image with this number" />/'+(null==(__t=NI)?"":_.escape(__t))+'\n        <button name="next" title="Load next image">&gt;</button>\n        <button name="reset" title="Reset Image">Reset</button>\n    </div>\n    \n</div>\n\n<div class="message_box"></div>\n\n<div class="image_container border">\n    <div class="im_highlight"></div>\n    <div class="im_progress"></div>\n    \n    <div class="im_cur" title="Zoomed region, click on the main image to select the region to zoom">\n        <p title="Diffraction resolution at cursor position">Resolution: <span class="res">0</span>&#197;</p>\n        <span class="progress"></span>\n    </div>\n    \n    <div class="yprofile"></div>\n    <div class="xprofile"></div>\n    \n    <div class="im_zoom">\n        <canvas class="im_zoomc" width="200" height="100"></canvas>\n    </div>\n    \n    <div class="image">\n        <canvas class="img"></canvas>\n    </div>\n</div>\n\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="image_container border clearfix">\n    <div class="im_highlight"></div>\n    <div class="im_progress"></div>\n    \n    <div class="im_cur" title="Zoomed region, click on the main image to select the region to zoom">\n        <p title="Diffraction resolution at cursor position">Resolution: <span class="res">0</span>&#197;</p>\n        <span class="progress"></span>\n    </div>\n    \n    <div class="yprofile"></div>\n    <div class="xprofile"></div>\n    \n    <div class="im_zoom">\n        <canvas class="im_zoomc" width="200" height="100"></canvas>\n    </div>\n    \n    <div class="embed_control">\n        <label><abbr title="Hotkey: T toggles image thresholding">T</abbr>hreshold: <input type="checkbox" name="threshold" value="1" /></label>\n    </div>\n\n    <div class="image">\n        <canvas class="img"></canvas>\n    </div>\n\n    <div class="image_controls border clearfix">\n        <div class="im_size im_col">\n            <abbr title="Hotkey: Z zooms in, z zooms out">Z</abbr>oom: <span class="zval">0</span>% <div class="zoom"></div>\n        </div>\n        \n        <div class="im_col toggles">\n            <label><abbr title="Hotkey: R toggles resolution rings">R</abbr>esolution Rings: <input type="checkbox" name="res" value="1" /></label>\n            <label>Ice Rings: <input type="checkbox" name="ice" value="1" /></label>\n            <label><abbr title="Hotkey: I toggles image inversion">I</abbr>nvert: <input type="checkbox" name="invert" value="1" /></label>\n        </div>\n    </div>\n\n</div>\n';return __p}},function(e,t,i){(function(e){(function(){(function(){var t,i,n,s,a,l,o,r,c,p,d,u,h,m,_,f,g,v,b,w,E,S,I,y,C,x=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},A=[].slice,T={}.hasOwnProperty,N=function(e,t){return function(){return e.apply(t,arguments)}};C=["extended","included"],f=function(){function e(){}return e.extends=function(e){var t,i,n;for(t in e)i=e[t],x.call(C,t)<0&&(this[t]=i);return null!=(n=e.extended)&&n.apply(this),this},e.includes=function(e){var t,i,n;for(t in e)i=e[t],x.call(C,t)<0&&(this.prototype[t]=i);return null!=(n=e.included)&&n.apply(this),this},e.delegate=function(){var e,t,i,n,s,a;for(i=(e=1<=arguments.length?A.call(arguments,0):[]).pop(),a=[],n=0,s=e.length;n<s;n++)t=e[n],a.push(this.prototype[t]=i.prototype[t]);return a},e.aliasFunction=function(e,t){var i=this;return this.prototype[e]=function(){var e;return e=1<=arguments.length?A.call(arguments,0):[],i.prototype[t].apply(i,e)}},e.aliasProperty=function(e,t){return Object.defineProperty(this.prototype,e,{get:function(){return this[t]},set:function(e){return this[t]=e}})},e.included=function(e){return e.call(this,this.prototype)},e}(),Array.prototype.slice,t=function(e,t){return null==t&&(t=document),"object"==typeof e?e:t.querySelector(e)},S=function(){function e(){}var t;return e.uniqid=(t=0,{get:function(){return t++}}),e.extend=function(){var e,t,i,n,s,a;for(t=arguments[0],s=0,a=(n=2<=arguments.length?A.call(arguments,1):[]).length;s<a;s++)for(i in e=n[s])T.call(e,i)&&(t[i]=e[i]);return t},e.clampRGB=function(e){return e<0?0:e>255?255:e},e.copyAttributes=function(e,t,i){var n,s,a,l,o,r;for(null==i&&(i={}),r=[],s=0,a=(l=e.attributes).length;s<a;s++)n=l[s],null!=i.except&&(o=n.nodeName,x.call(i.except,o)>=0)||r.push(t.setAttribute(n.nodeName,n.nodeValue));return r},e.dataArray=function(e){return null==e&&(e=0),a.NodeJS||null!=window.Uint8Array?new Uint8Array(e):new Array(e)},e}(),w=window,a=function(n){function s(){this.nodeFileReady=N(this.nodeFileReady,this);var e,t,n,a=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof s?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),e=arguments[0],s.NodeJS||(n=parseInt(s.getAttrId(e[0]),10),t="function"==typeof e[1]?e[1]:"function"==typeof e[2]?e[2]:function(){},isNaN(n)||!E.has(n))?(this.id=S.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new i(this),this.renderer=new b(this),this.domIsLoaded((function(){return a.parseArguments(e),a.setup()})),this):E.execute(n,t)):new s(arguments)}return function(e,t){for(var i in t)T.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(s,n),s.version={release:"4.1.2",date:"7/27/2013"},s.DEBUG=!1,s.allowRevert=!0,s.crossOrigin="anonymous",s.remoteProxy="",s.proxyParam="camanProxyUrl",s.NodeJS=!1,s.autoload=!s.NodeJS,s.toString=function(){return"Version "+s.version.release+", Released "+s.version.date},s.getAttrId=function(e){return!!s.NodeJS||("string"==typeof e&&(e=t(e)),null==e||null==e.getAttribute?null:e.getAttribute("data-caman-id"))},s.prototype.domIsLoaded=function(e){var t,i=this;return s.NodeJS?setTimeout((function(){return e.call(i)}),0):"complete"===document.readyState?(_.debug("DOM initialized"),setTimeout((function(){return e.call(i)}),0)):(t=function(){if("complete"===document.readyState)return _.debug("DOM initialized"),e.call(i)},document.addEventListener("readystatechange",t,!1))},s.prototype.parseArguments=function(e){var t,i,n,s;if(0===e.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(e[0]),1!==e.length){switch(typeof e[1]){case"string":this.imageUrl=e[1];break;case"function":this.callback=e[1]}if(2!==e.length&&(this.callback=e[2],4===e.length)){for(t in s=[],n=e[4])T.call(n,t)&&(i=n[t],s.push(this.options[t]=i));return s}}},s.prototype.setInitObject=function(e){if(s.NodeJS)return this.initObj=e,void(this.initType="node");if(this.initObj="object"==typeof e?e:t(e),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},s.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},s.prototype.initNode=function(){return _.debug("Initializing for NodeJS"),"string"==typeof this.initObj&&this.initObj.match(/^https?:\/\//)?this.readFromHttp(this.initObj,this.nodeFileReady):"string"==typeof this.initObj?I.readFile(this.initObj,this.nodeFileReady):this.nodeFileReady(null,this.initObj)},s.prototype.readFromHttp=function(t,i){return _.debug("Fetching image from "+t),y.get(t,(function(t){var n;return n="",t.setEncoding("binary"),t.on("data",(function(e){return n+=e})),t.on("end",(function(){return i(null,new e(n,"binary"))}))})).on("error",i)},s.prototype.nodeFileReady=function(e,t){if(e)throw e;return this.image=new h,this.image.src=t,_.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.canvas=new o(this.imageWidth(),this.imageHeight()),this.finishInit()},s.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),S.copyAttributes(this.image,this.canvas,{except:["src"]}),null!=this.image.parentNode&&this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},s.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},s.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(_.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),u.isRemote(this.image))return this.image.src=u.proxyUrl(this.image.src),_.debug("Remote image detected, using URL = "+this.image.src)},s.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},s.prototype.isImageLoaded=function(){return!!this.image.complete&&(null==this.image.naturalWidth||0!==this.image.naturalWidth)},s.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},s.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},s.prototype.imageLoaded=function(){return _.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},s.prototype.finishInit=function(){var e,t,i,n,a;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data,s.allowRevert)for(this.initializedPixelData=S.dataArray(this.pixelData.length),this.originalPixelData=S.dataArray(this.pixelData.length),e=i=0,n=(a=this.pixelData).length;i<n;e=++i)t=a[e],this.initializedPixelData[e]=t,this.originalPixelData[e]=t;return this.dimensions={width:this.canvas.width,height:this.canvas.height},s.NodeJS||E.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},s.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},s.prototype.resetOriginalPixelData=function(){var e,t,i,n,a,l;if(!s.allowRevert)throw"Revert disabled";for(this.originalPixelData=S.dataArray(this.pixelData.length),l=[],e=i=0,n=(a=this.pixelData).length;i<n;e=++i)t=a[e],l.push(this.originalPixelData[e]=t);return l},s.prototype.hasId=function(){return null!=s.getAttrId(this.canvas)},s.prototype.assignId=function(){if(!s.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},s.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},s.prototype.hiDPIAdjustments=function(){var e;if(!s.NodeJS&&this.needsHiDPISwap())return 1!==(e=this.hiDPIRatio())?(_.debug("HiDPI ratio = "+e),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*e,this.canvas.height=this.preScaledHeight*e,this.canvas.style.width=this.preScaledWidth+"px",this.canvas.style.height=this.preScaledHeight+"px",this.context.scale(e,e),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},s.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)},s.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},s.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},s.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},s.prototype.replaceCanvas=function(e){var t;return t=this.canvas,this.canvas=e,this.context=this.canvas.getContext("2d"),s.NodeJS||t.parentNode.replaceChild(this.canvas,t),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},s.prototype.render=function(e){var t=this;return null==e&&(e=function(){}),c.trigger(this,"renderStart"),this.renderer.execute((function(){return t.context.putImageData(t.imageData,0,0),e.call(t)}))},s.prototype.revert=function(e){var t,i,n,a,l;if(null==e&&(e=!0),!s.allowRevert)throw"Revert disabled";for(t=n=0,a=(l=this.originalVisiblePixels()).length;n<a;t=++n)i=l[t],this.pixelData[t]=i;if(e)return this.context.putImageData(this.imageData,0,0)},s.prototype.reset=function(){var e,t,i,n,s,a,l,o,r;for(e=document.createElement("canvas"),S.copyAttributes(this.canvas,e),e.width=this.originalWidth,e.height=this.originalHeight,a=(n=(t=e.getContext("2d")).getImageData(0,0,e.width,e.height)).data,i=l=0,o=(r=this.initializedPixelData).length;l<o;i=++l)s=r[i],a[i]=s;return t.putImageData(n,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(e)},s.prototype.originalVisiblePixels=function(){var e,t,i,n,a,l,o,r,c,p,d,u,h,m,_,f,v,b,w,E,S;if(!s.allowRevert)throw"Revert disabled";if(p=[],n=(u=this.cropCoordinates.x)+this.width,a=(h=this.cropCoordinates.y)+this.height,this.resized){for((e=document.createElement("canvas")).width=this.originalWidth,e.height=this.originalHeight,c=(o=(i=e.getContext("2d")).getImageData(0,0,e.width,e.height)).data,l=_=0,v=(b=this.originalPixelData).length;_<v;l=++_)r=b[l],c[l]=r;i.putImageData(o,0,0),(d=document.createElement("canvas")).width=this.width,d.height=this.height,(i=d.getContext("2d")).drawImage(e,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),c=i.getImageData(0,0,this.width,this.height).data,m=this.width}else c=this.originalPixelData,m=this.originalWidth;for(l=f=0,w=c.length;f<w;l=f+=4)u<=(E=(t=g.locationToCoordinates(l,m)).x)&&E<n&&h<=(S=t.y)&&S<a&&p.push(c[l],c[l+1],c[l+2],c[l+3]);return p},s.prototype.process=function(e,t){return this.renderer.add({type:d.Type.Single,name:e,processFn:t}),this},s.prototype.processKernel=function(e,t,i,n){var s,a,l;if(null==i&&(i=null),null==n&&(n=0),null==i)for(i=0,s=a=0,l=t.length;0<=l?a<l:a>l;s=0<=l?++a:--a)i+=t[s];return this.renderer.add({type:d.Type.Kernel,name:e,adjust:t,divisor:i,bias:n}),this},s.prototype.processPlugin=function(e,t){return this.renderer.add({type:d.Type.Plugin,plugin:e,args:t}),this},s.prototype.newLayer=function(e){var t;return t=new m(this),this.canvasQueue.push(t),this.renderer.add({type:d.Type.LayerDequeue}),e.call(t),this.renderer.add({type:d.Type.LayerFinished}),this},s.prototype.executeLayer=function(e){return this.pushContext(e)},s.prototype.pushContext=function(e){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=e,this.pixelData=e.pixelData},s.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},s.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},s}(f),w.Caman=a,a.Analyze=function(){function e(e){this.c=e}return e.prototype.calculateLevels=function(){var e,t,i,n,s,a,l;for(t={r:{},g:{},b:{}},e=n=0;n<=255;e=++n)t.r[e]=0,t.g[e]=0,t.b[e]=0;for(e=s=0,l=this.c.pixelData.length;s<l;e=s+=4)t.r[this.c.pixelData[e]]++,t.g[this.c.pixelData[e+1]]++,t.b[this.c.pixelData[e+2]]++;for(i=this.c.pixelData.length/4,e=a=0;a<=255;e=++a)t.r[e]/=i,t.g[e]/=i,t.b[e]/=i;return t},e}(),i=a.Analyze,a.DOMUpdated=function(){var e,t,i,n,s;if((t=document.querySelectorAll("img[data-caman]")).length>0){for(s=[],i=0,n=t.length;i<n;i++)e=t[i],s.push(new l(e,(function(){return this.parse(),this.execute()})));return s}},a.autoload&&("complete"===document.readyState?a.DOMUpdated():document.addEventListener("DOMContentLoaded",a.DOMUpdated,!1)),l=function(){function e(e,t){this.dataStr=e.getAttribute("data-caman"),this.caman=a(e,t.bind(this))}return"(\\w+)\\((.*?)\\)",e.prototype.parse=function(){var e,t,i,n,s,a,l,o,r,c,p;if(this.ele=this.caman.canvas,a=new RegExp("(\\w+)\\((.*?)\\)","g"),(l=this.dataStr.match(a)).length>0){for(a=new RegExp("(\\w+)\\((.*?)\\)"),p=[],o=0,r=l.length;o<r;o++){(c=l[o].match(a))[0],i=c[1],e=c[2],s=new Function("return function() {        this."+i+"("+e+");      };");try{n=s(),p.push(n.call(this.caman))}catch(e){t=e,p.push(_.debug(t))}}return p}},e.prototype.execute=function(){var e;return e=this.ele,this.caman.render((function(){return e.parentNode.replaceChild(this.toImage(),e)}))},e}(),a.Blender=function(){function e(){}return e.blenders={},e.register=function(e,t){return this.blenders[e]=t},e.execute=function(e,t,i){return this.blenders[e](t,i)},e}(),n=a.Blender,a.Calculate=function(){function e(){}return e.distance=function(e,t,i,n){return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))},e.randomRange=function(e,t,i){var n;return null==i&&(i=!1),n=e+Math.random()*(t-e),i?n.toFixed(i):Math.round(n)},e.luminance=function(e){return.299*e.r+.587*e.g+.114*e.b},e.bezier=function(e,t,i,n,s,l){var o,r,c,p,d,u,h,m,_,f,g,v,b;if(null==s&&(s=0),null==l&&(l=255),e[0]instanceof Array?(c=e,s=t,l=i):c=[e,t,i,n],c.length<2)throw"Invalid number of arguments to bezier";for(o={},h=function(e,t,i){return e*(1-i)+t*i},r=function(e,t,i){return Math.min(Math.max(e,t),i)},d=g=0;g<1e3;d=++g){for(f=d/1e3,_=c;_.length>1;){for(m=[],u=v=0,b=_.length-2;0<=b?v<=b:v>=b;u=0<=b?++v:--v)m.push([h(_[u][0],_[u+1][0],f),h(_[u][1],_[u+1][1],f)]);_=m}o[Math.round(_[0][0])]=Math.round(r(_[0][1],s,l))}return p=c[c.length-1][0],null==(o=a.Calculate.missingValues(o,p))[p]&&(o[p]=o[p-1]),o},e.hermite=function(e,t,i){var n,s,l,o,r,c,p,d,u,h,m,_,f,g,v,b,w,E,S,I,y,C,x;if(e.length<2)throw"Invalid number of arguments to hermite";for(E={},function(e,t,i){return e*(1-i)+t*i},n=function(e,t,i,n){return[e[0]+t[0]+i[0]+n[0],e[1]+t[1]+i[1]+n[1]]},_=function(e,t){return[e[0]*t[0],e[1]*t[1]]},S=function(e,t){return[e[0]-t[0],e[1]-t[1]]},s=function(e,t,i){return Math.min(Math.max(e,t),i)},0,d=y=0,x=e.length-2;0<=x?y<=x:y>=x;d=0<=x?++y:--y)for(f=e[d],b=1/(v=(g=e[d+1])[0]-f[0]),d===e.length-2&&(b=1/(v-1)),h=_(S(g,d>0?e[d-1]:f),[.5,.5]),m=_(S(d<e.length-2?e[d+2]:g,f),[.5,.5]),u=C=0;0<=v?C<=v:C>=v;u=0<=v?++C:--C)r=(I=u*b)*I*I-2*I*I+I,c=-2*I*I*I+3*I*I,p=I*I*I-I*I,w=n(_(f,[o=2*I*I*I-3*I*I+1,o]),_(h,[r,r]),_(g,[c,c]),_(m,[p,p])),E[Math.round(w[0])]=Math.round(s(w[1],t,i)),1;return l=e[e.length-1][0],E=a.Calculate.missingValues(E,l)},e.missingValues=function(e,t){var i,n,s,a,l,o,r;if(Object.keys(e).length<t+1){for(a={},i=o=0;0<=t?o<=t:o>=t;i=0<=t?++o:--o)if(null!=e[i])a[i]=e[i];else{for(s=[i-1,a[i-1]],n=r=i;i<=t?r<=t:r>=t;n=i<=t?++r:--r)if(null!=e[n]){l=[n,e[n]];break}a[i]=s[1]+(l[1]-s[1])/(l[0]-s[0])*(i-s[0])}return a}return e},e}(),s=a.Calculate,a.Convert=function(){function e(){}return e.hexToRGB=function(e){return"#"===e.charAt(0)&&(e=e.substr(1)),{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16)}},e.rgbToHSL=function(e,t,i){var n,s,a,l,o,r;return"object"==typeof e&&(t=e.g,i=e.b,e=e.r),e/=255,t/=255,i/=255,l=Math.max(e,t,i),o=Math.min(e,t,i),a=(l+o)/2,l===o?s=r=0:(n=l-o,r=a>.5?n/(2-l-o):n/(l+o),s=function(){switch(l){case e:return(t-i)/n+(t<i?6:0);case t:return(i-e)/n+2;case i:return(e-t)/n+4}}(),s/=6),{h:s,s:r,l:a}},e.hslToRGB=function(e,t,i){var n,s,a,l,o;return"object"==typeof e&&(t=e.s,i=e.l,e=e.h),0===t?o=s=n=i:(a=2*i-(l=i<.5?i*(1+t):i+t-i*t),o=this.hueToRGB(a,l,e+1/3),s=this.hueToRGB(a,l,e),n=this.hueToRGB(a,l,e-1/3)),{r:255*o,g:255*s,b:255*n}},e.hueToRGB=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},e.rgbToHSV=function(e,t,i){var n,s,a,l,o,r;return e/=255,t/=255,i/=255,a=Math.max(e,t,i),l=Math.min(e,t,i),r=a,n=a-l,o=0===a?0:n/a,a===l?s=0:(s=function(){switch(a){case e:return(t-i)/n+(t<i?6:0);case t:return(i-e)/n+2;case i:return(e-t)/n+4}}(),s/=6),{h:s,s:o,v:r}},e.hsvToRGB=function(e,t,i){var n,s,a,l,o,r,c,p;switch(o=i*(1-t),r=i*(1-(s=6*e-(l=Math.floor(6*e)))*t),p=i*(1-(1-s)*t),l%6){case 0:c=i,a=p,n=o;break;case 1:c=r,a=i,n=o;break;case 2:c=o,a=i,n=p;break;case 3:c=o,a=r,n=i;break;case 4:c=p,a=o,n=i;break;case 5:c=i,a=o,n=r}return{r:Math.floor(255*c),g:Math.floor(255*a),b:Math.floor(255*n)}},e.rgbToXYZ=function(e,t,i){return t/=255,i/=255,(e/=255)>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,t>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:100*(.4124*e+.3576*t+.1805*i),y:100*(.2126*e+.7152*t+.0722*i),z:100*(.0193*e+.1192*t+.9505*i)}},e.xyzToRGB=function(e,t,i){var n,s,a;return s=-.9689*(e/=100)+1.8758*(t/=100)+.0415*(i/=100),n=.0557*e+-.204*t+1.057*i,(a=3.2406*e+-1.5372*t+-.4986*i)>.0031308?a=1.055*Math.pow(a,.4166666667)-.055:a*=12.92,s>.0031308?s=1.055*Math.pow(s,.4166666667)-.055:s*=12.92,n>.0031308?n=1.055*Math.pow(n,.4166666667)-.055:n*=12.92,{r:255*a,g:255*s,b:255*n}},e.xyzToLab=function(e,t,i){return"object"==typeof e&&(t=e.y,i=e.z,e=e.x),95.047,100,108.883,t/=100,i/=108.883,e=(e/=95.047)>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345,{l:116*(t=t>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345)-16,a:500*(e-t),b:200*(t-(i=i>.008856451679?Math.pow(i,.3333333333):7.787037037*i+.1379310345))}},e.labToXYZ=function(e,t,i){var n,s,a;return"object"==typeof e&&(t=e.a,i=e.b,e=e.l),a=(s=(e+16)/116)-i/200,(n=s+t/500)>.2068965517?n*=n*n:n=.1284185493*(n-.1379310345),s>.2068965517?s*=s*s:s=.1284185493*(s-.1379310345),a>.2068965517?a*=a*a:a=.1284185493*(a-.1379310345),{x:95.047*n,y:100*s,z:108.883*a}},e.rgbToLab=function(e,t,i){var n;return"object"==typeof e&&(t=e.g,i=e.b,e=e.r),n=this.rgbToXYZ(e,t,i),this.xyzToLab(n)},e.labToRGB=function(e,t,i){},e}(),r=a.Convert,a.Event=function(){function e(){}return e.events={},e.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],e.trigger=function(e,t,i){var n,s,a,l,o;if(null==i&&(i=null),this.events[t]&&this.events[t].length){for(o=[],s=0,a=(l=this.events[t]).length;s<a;s++)null===(n=l[s]).target||e.id===n.target.id?o.push(n.fn.call(e,i)):o.push(void 0);return o}},e.listen=function(e,t,i){var n,s;return"string"==typeof e&&(s=e,n=t,e=null,t=s,i=n),!(x.call(this.types,t)<0)&&(this.events[t]||(this.events[t]=[]),this.events[t].push({target:e,fn:i}),!0)},e}(),c=a.Event,a.Filter=function(){function e(){}return e.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},e.register=function(e,t){return a.prototype[e]=t},e}(),d=a.Filter,a.IO=function(){function e(){}return e.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,e.isRemote=function(e){return null!=e&&(!this.corsEnabled(e)&&this.isURLRemote(e.src))},e.corsEnabled=function(e){var t;return null!=e.crossOrigin&&("anonymous"===(t=e.crossOrigin.toLowerCase())||"use-credentials"===t)},e.isURLRemote=function(e){var t;return!!(t=e.match(this.domainRegex))&&t[1]!==document.domain},e.remoteCheck=function(e){if(this.isURLRemote(e)){if(a.remoteProxy.length)return a.isURLRemote(a.remoteProxy)?void _.info("Cannot use a remote proxy for loading images."):this.proxyUrl(e);_.info("Attempting to load a remote image without a configured proxy. URL: "+e)}},e.proxyUrl=function(e){return a.remoteProxy+"?"+a.proxyParam+"="+encodeURIComponent(e)},e.useProxy=function(e){var t;return null!=(t={ruby:"rb",python:"py",perl:"pl",javascript:"js"})[e=e.toLowerCase()]&&(e=t[e]),"proxies/caman_proxy."+e},e}(),a.prototype.save=function(){return this.browserSave.apply(this,arguments)},a.prototype.browserSave=function(e){var t;return null==e&&(e="png"),e=e.toLowerCase(),t=this.toBase64(e).replace("image/"+e,"image/octet-stream"),document.location.href=t},a.prototype.nodeSave=function(e,t){null==t&&(t=!0);try{if(I.statSync(e).isFile()&&!t)return!1}catch(t){t,_.debug("Creating output file "+e)}return I.writeFile(e,this.canvas.toBuffer(),(function(){return _.debug("Finished writing to "+e)}))},a.prototype.toImage=function(e){var t;return(t=document.createElement("img")).src=this.toBase64(e),t.width=this.dimensions.width,t.height=this.dimensions.height,window.devicePixelRatio&&(t.width/=window.devicePixelRatio,t.height/=window.devicePixelRatio),t},a.prototype.toBase64=function(e){return null==e&&(e="png"),e=e.toLowerCase(),this.canvas.toDataURL("image/"+e)},u=a.IO,a.Layer=function(){function e(e){this.c=e,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=S.uniqid.get(),this.canvas=document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return e.prototype.newLayer=function(e){return this.c.newLayer.call(this.c,e)},e.prototype.setBlendingMode=function(e){return this.options.blendingMode=e,this},e.prototype.opacity=function(e){return this.options.opacity=e/100,this},e.prototype.copyParent=function(){var e,t,i,n;for(t=this.c.pixelData,e=i=0,n=this.c.pixelData.length;i<n;e=i+=4)this.pixelData[e]=t[e],this.pixelData[e+1]=t[e+1],this.pixelData[e+2]=t[e+2],this.pixelData[e+3]=t[e+3];return this},e.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},e.prototype.overlayImage=function(e){return"object"==typeof e?e=e.src:"string"==typeof e&&"#"===e[0]&&(e=t(e).src),e?(this.c.renderer.renderQueue.push({type:d.Type.LoadOverlay,src:e,layer:this}),this):this},e.prototype.applyToParent=function(){var e,t,i,s,a,l,o,r,c;for(i=this.c.pixelStack[this.c.pixelStack.length-1],c=[],e=o=0,r=(t=this.c.pixelData).length;o<r;e=o+=4)l={r:i[e],g:i[e+1],b:i[e+2],a:i[e+3]},a={r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]},(s=n.execute(this.options.blendingMode,a,l)).r=S.clampRGB(s.r),s.g=S.clampRGB(s.g),s.b=S.clampRGB(s.b),null==s.a&&(s.a=a.a),i[e]=l.r-(l.r-s.r)*(this.options.opacity*(s.a/255)),i[e+1]=l.g-(l.g-s.g)*(this.options.opacity*(s.a/255)),c.push(i[e+2]=l.b-(l.b-s.b)*(this.options.opacity*(s.a/255)));return c},e}(),m=a.Layer,a.Logger=function(){var e,t,i,n;for(t=0,i=(n=["log","info","warn","error"]).length;t<i;t++)this[e=n[t]]=function(e){return function(){var t;if(t=1<=arguments.length?A.call(arguments,0):[],a.DEBUG)try{return console[e].apply(console,t)}catch(i){return console[e](t)}}}(e);this.debug=this.log},_=new a.Logger,a.Pixel=function(){function e(e,t,i,n,s){this.r=null!=e?e:0,this.g=null!=t?t:0,this.b=null!=i?i:0,this.a=null!=n?n:255,this.c=null!=s?s:null,this.loc=0}return e.coordinatesToLocation=function(e,t,i){return 4*(t*i+e)},e.locationToCoordinates=function(e,t){return{x:e%(4*t)/4,y:Math.floor(e/(4*t))}},e.prototype.setContext=function(e){return this.c=e},e.prototype.locationXY=function(){var e;if(null==this.c)throw"Requires a CamanJS context";return e=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),{x:this.loc%(4*this.c.dimensions.width)/4,y:e}},e.prototype.pixelAtLocation=function(t){if(null==this.c)throw"Requires a CamanJS context";return new e(this.c.pixelData[t],this.c.pixelData[t+1],this.c.pixelData[t+2],this.c.pixelData[t+3],this.c)},e.prototype.getPixelRelative=function(t,i){var n;if(null==this.c)throw"Requires a CamanJS context";return(n=this.loc+4*this.c.dimensions.width*(-1*i)+4*t)>this.c.pixelData.length||n<0?new e(0,0,0,255,this.c):this.pixelAtLocation(n)},e.prototype.putPixelRelative=function(e,t,i){if(null==this.c)throw"Requires a CamanJS context";if(this.loc+4*this.c.dimensions.width*(-1*t)+4*e,!(newLoc>this.c.pixelData.length||newLoc<0))return this.c.pixelData[newLoc]=i.r,this.c.pixelData[newLoc+1]=i.g,this.c.pixelData[newLoc+2]=i.b,this.c.pixelData[newLoc+3]=i.a,!0},e.prototype.getPixel=function(e,t){var i;if(null==this.c)throw"Requires a CamanJS context";return i=this.coordinatesToLocation(e,t,this.width),this.pixelAtLocation(i)},e.prototype.putPixel=function(e,t,i){var n;if(null==this.c)throw"Requires a CamanJS context";return n=this.coordinatesToLocation(e,t,this.width),this.c.pixelData[n]=i.r,this.c.pixelData[n+1]=i.g,this.c.pixelData[n+2]=i.b,this.c.pixelData[n+3]=i.a},e.prototype.toString=function(){return this.toKey()},e.prototype.toHex=function(e){var t;return null==e&&(e=!1),t="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16),e?t+this.a.toString(16):t},e}(),g=a.Pixel,a.Plugin=function(){function e(){}return e.plugins={},e.register=function(e,t){return this.plugins[e]=t},e.execute=function(e,t,i){return this.plugins[t].apply(e,i)},e}(),v=a.Plugin,a.Renderer=function(){function e(e){this.c=e,this.processNext=N(this.processNext,this),this.renderQueue=[],this.modPixelData=null}return e.Blocks=a.NodeJS?(!1)("os").cpus().length:4,e.prototype.add=function(e){if(null!=e)return this.renderQueue.push(e)},e.prototype.processNext=function(){var e;if(0===this.renderQueue.length)return c.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case d.Type.LayerDequeue:return e=this.c.canvasQueue.shift(),this.c.executeLayer(e),this.processNext();case d.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case d.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case d.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},e.prototype.execute=function(e){return this.finishedFn=e,this.modPixelData=S.dataArray(this.c.pixelData.length),this.processNext()},e.prototype.eachBlock=function(t){var i,n,s,l,o,r,c,d,u,h,m=this;for(this.blocksDone=0,r=this.c.pixelData.length,o=(i=4*Math.floor(r/4/e.Blocks))+r/4%e.Blocks*4,h=[],l=d=0,u=e.Blocks;0<=u?d<u:d>u;l=0<=u?++d:--d)s=(c=l*i)+(l===e.Blocks-1?o:i),a.NodeJS?(n=p((function(){return t.call(m,l,c,s)})).run(),h.push(this.blockFinished(n))):h.push(setTimeout(function(e,i,n){return function(){return t.call(m,e,i,n)}}(l,c,s),0));return h},e.prototype.executeFilter=function(){return c.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===d.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},e.prototype.executePlugin=function(){return _.debug("Executing plugin "+this.currentJob.plugin),v.execute(this.c,this.currentJob.plugin,this.currentJob.args),_.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},e.prototype.renderBlock=function(t,i,n){var s,l,o;for(_.debug("Block #"+t+" - Filter: "+this.currentJob.name+", Start: "+i+", End: "+n),c.trigger(this.c,"blockStarted",{blockNum:t,totalBlocks:e.Blocks,startPixel:i,endPixel:n}),(l=new g).setContext(this.c),s=o=i;o<n;s=o+=4)l.loc=s,l.r=this.c.pixelData[s],l.g=this.c.pixelData[s+1],l.b=this.c.pixelData[s+2],l.a=this.c.pixelData[s+3],this.currentJob.processFn(l),this.c.pixelData[s]=S.clampRGB(l.r),this.c.pixelData[s+1]=S.clampRGB(l.g),this.c.pixelData[s+2]=S.clampRGB(l.b),this.c.pixelData[s+3]=S.clampRGB(l.a);return a.NodeJS?p.yield(t):this.blockFinished(t)},e.prototype.renderKernel=function(e,t,i){var n,s,l,o,r,c,d,u,h,m,f,v,b,w,E,I,y;for(this.currentJob.name,l=this.currentJob.bias,c=this.currentJob.divisor,f=this.c.pixelData.length,n=this.currentJob.adjust,s=Math.sqrt(n.length),m=[],_.debug("Rendering kernel - Filter: "+this.currentJob.name),t=Math.max(t,4*this.c.dimensions.width*((s-1)/2)),i=Math.min(i,f-4*this.c.dimensions.width*((s-1)/2)),o=(s-1)/2,(b=new g).setContext(this.c),d=E=t;E<i;d=E+=4){for(b.loc=d,r=0,u=I=-o;-o<=o?I<=o:I>=o;u=-o<=o?++I:--I)for(h=y=o;o<=-o?y<=-o:y>=-o;h=o<=-o?++y:--y)v=b.getPixelRelative(u,h),m[3*r]=v.r,m[3*r+1]=v.g,m[3*r+2]=v.b,r++;w=this.processKernel(n,m,c,l),this.modPixelData[d]=S.clampRGB(w.r),this.modPixelData[d+1]=S.clampRGB(w.g),this.modPixelData[d+2]=S.clampRGB(w.b),this.modPixelData[d+3]=this.c.pixelData[d+3]}return a.NodeJS?p.yield(e):this.blockFinished(e)},e.prototype.blockFinished=function(t){var i,n,s;if(t>=0&&_.debug("Block #"+t+" finished! Filter: "+this.currentJob.name),this.blocksDone++,c.trigger(this.c,"blockFinished",{blockNum:t,blocksFinished:this.blocksDone,totalBlocks:e.Blocks}),this.blocksDone===e.Blocks){if(this.currentJob.type===d.Type.Kernel)for(i=n=0,s=this.c.pixelData.length;0<=s?n<s:n>s;i=0<=s?++n:--n)this.c.pixelData[i]=this.modPixelData[i];return t>=0&&_.debug("Filter "+this.currentJob.name+" finished!"),c.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},e.prototype.processKernel=function(e,t,i,n){var s,a,l,o;for(a={r:0,g:0,b:0},s=l=0,o=e.length;0<=o?l<o:l>o;s=0<=o?++l:--l)a.r+=e[s]*t[3*s],a.g+=e[s]*t[3*s+1],a.b+=e[s]*t[3*s+2];return a.r=a.r/i+n,a.g=a.g/i+n,a.b=a.b/i+n,a},e.prototype.loadOverlay=function(e,t){var i,n,s=this;return(i=document.createElement("img")).onload=function(){return e.context.drawImage(i,0,0,s.c.dimensions.width,s.c.dimensions.height),e.imageData=e.context.getImageData(0,0,s.c.dimensions.width,s.c.dimensions.height),e.pixelData=e.imageData.data,s.c.pixelData=e.pixelData,s.processNext()},n=u.remoteCheck(t),i.src=null!=n?n:t},e}(),b=a.Renderer,a.Store=function(){function e(){}return e.items={},e.has=function(e){return null!=this.items[e]},e.get=function(e){return this.items[e]},e.put=function(e,t){return this.items[e]=t},e.execute=function(e,t){var i=this;return setTimeout((function(){return t.call(i.get(e),i.get(e))}),0),this.get(e)},e.flush=function(e){return null==e&&(e=!1),e?delete this.items[e]:this.items={}},e}(),E=a.Store,n.register("normal",(function(e,t){return{r:e.r,g:e.g,b:e.b}})),n.register("multiply",(function(e,t){return{r:e.r*t.r/255,g:e.g*t.g/255,b:e.b*t.b/255}})),n.register("screen",(function(e,t){return{r:255-(255-e.r)*(255-t.r)/255,g:255-(255-e.g)*(255-t.g)/255,b:255-(255-e.b)*(255-t.b)/255}})),n.register("overlay",(function(e,t){var i;return(i={}).r=t.r>128?255-2*(255-e.r)*(255-t.r)/255:t.r*e.r*2/255,i.g=t.g>128?255-2*(255-e.g)*(255-t.g)/255:t.g*e.g*2/255,i.b=t.b>128?255-2*(255-e.b)*(255-t.b)/255:t.b*e.b*2/255,i})),n.register("difference",(function(e,t){return{r:e.r-t.r,g:e.g-t.g,b:e.b-t.b}})),n.register("addition",(function(e,t){return{r:t.r+e.r,g:t.g+e.g,b:t.b+e.b}})),n.register("exclusion",(function(e,t){return{r:128-2*(t.r-128)*(e.r-128)/255,g:128-2*(t.g-128)*(e.g-128)/255,b:128-2*(t.b-128)*(e.b-128)/255}})),n.register("softLight",(function(e,t){var i;return(i={}).r=t.r>128?255-(255-t.r)*(255-(e.r-128))/255:t.r*(e.r+128)/255,i.g=t.g>128?255-(255-t.g)*(255-(e.g-128))/255:t.g*(e.g+128)/255,i.b=t.b>128?255-(255-t.b)*(255-(e.b-128))/255:t.b*(e.b+128)/255,i})),n.register("lighten",(function(e,t){return{r:t.r>e.r?t.r:e.r,g:t.g>e.g?t.g:e.g,b:t.b>e.b?t.b:e.b}})),n.register("darken",(function(e,t){return{r:t.r>e.r?e.r:t.r,g:t.g>e.g?e.g:t.g,b:t.b>e.b?e.b:t.b}})),d.register("fillColor",(function(){var e;return e=1===arguments.length?r.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",(function(t){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=255,t}))})),d.register("brightness",(function(e){return e=Math.floor(e/100*255),this.process("brightness",(function(t){return t.r+=e,t.g+=e,t.b+=e,t}))})),d.register("saturation",(function(e){return e*=-.01,this.process("saturation",(function(t){var i;return i=Math.max(t.r,t.g,t.b),t.r!==i&&(t.r+=(i-t.r)*e),t.g!==i&&(t.g+=(i-t.g)*e),t.b!==i&&(t.b+=(i-t.b)*e),t}))})),d.register("vibrance",(function(e){return e*=-1,this.process("vibrance",(function(t){var i,n,s;return s=Math.max(t.r,t.g,t.b),n=(t.r+t.g+t.b)/3,i=2*Math.abs(s-n)/255*e/100,t.r!==s&&(t.r+=(s-t.r)*i),t.g!==s&&(t.g+=(s-t.g)*i),t.b!==s&&(t.b+=(s-t.b)*i),t}))})),d.register("greyscale",(function(e){return this.process("greyscale",(function(e){var t;return t=s.luminance(e),e.r=t,e.g=t,e.b=t,e}))})),d.register("contrast",(function(e){return e=Math.pow((e+100)/100,2),this.process("contrast",(function(t){return t.r/=255,t.r-=.5,t.r*=e,t.r+=.5,t.r*=255,t.g/=255,t.g-=.5,t.g*=e,t.g+=.5,t.g*=255,t.b/=255,t.b-=.5,t.b*=e,t.b+=.5,t.b*=255,t}))})),d.register("hue",(function(e){return this.process("hue",(function(t){var i,n,s,a,l,o;return s=100*(a=r.rgbToHSV(t.r,t.g,t.b)).h,s+=Math.abs(e),s%=100,s/=100,a.h=s,l=(o=r.hsvToRGB(a.h,a.s,a.v)).r,n=o.g,i=o.b,t.r=l,t.g=n,t.b=i,t}))})),d.register("colorize",(function(){var e,t;return 2===arguments.length?(t=r.hexToRGB(arguments[0]),e=arguments[1]):4===arguments.length&&(t={r:arguments[0],g:arguments[1],b:arguments[2]},e=arguments[3]),this.process("colorize",(function(i){return i.r-=(i.r-t.r)*(e/100),i.g-=(i.g-t.g)*(e/100),i.b-=(i.b-t.b)*(e/100),i}))})),d.register("invert",(function(){return this.process("invert",(function(e){return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,e}))})),d.register("sepia",(function(e){return null==e&&(e=100),e/=100,this.process("sepia",(function(t){return t.r=Math.min(255,t.r*(1-.607*e)+t.g*(.769*e)+t.b*(.189*e)),t.g=Math.min(255,t.r*(.349*e)+t.g*(1-.314*e)+t.b*(.168*e)),t.b=Math.min(255,t.r*(.272*e)+t.g*(.534*e)+t.b*(1-.869*e)),t}))})),d.register("gamma",(function(e){return this.process("gamma",(function(t){return t.r=255*Math.pow(t.r/255,e),t.g=255*Math.pow(t.g/255,e),t.b=255*Math.pow(t.b/255,e),t}))})),d.register("noise",(function(e){return e=2.55*Math.abs(e),this.process("noise",(function(t){var i;return i=s.randomRange(-1*e,e),t.r+=i,t.g+=i,t.b+=i,t}))})),d.register("clip",(function(e){return e=2.55*Math.abs(e),this.process("clip",(function(t){return t.r>255-e?t.r=255:t.r<e&&(t.r=0),t.g>255-e?t.g=255:t.g<e&&(t.g=0),t.b>255-e?t.b=255:t.b<e&&(t.b=0),t}))})),d.register("channels",(function(e){var t;if("object"!=typeof e)return this;for(t in e)T.call(e,t)&&(0!==e[t]?e[t]/=100:delete e[t]);return 0===e.length?this:this.process("channels",(function(t){return null!=e.red&&(e.red>0?t.r+=(255-t.r)*e.red:t.r-=t.r*Math.abs(e.red)),null!=e.green&&(e.green>0?t.g+=(255-t.g)*e.green:t.g-=t.g*Math.abs(e.green)),null!=e.blue&&(e.blue>0?t.b+=(255-t.b)*e.blue:t.b-=t.b*Math.abs(e.blue)),t}))})),d.register("curves",(function(){var e,t,i,n,a,l,o,r,c,p,d,u;if(i=arguments[0],"function"==typeof(o=(n=2<=arguments.length?A.call(arguments,1):[])[n.length-1])?(e=o,n.pop()):"string"==typeof o?(e=s[o],n.pop()):e=s.bezier,"string"==typeof i&&(i=i.split("")),"v"===i[0]&&(i=["r","g","b"]),n.length<2)throw"Invalid number of arguments to curves filter";if(t=e(n,0,255),(r=n[0])[0]>0)for(l=c=0,d=r[0];0<=d?c<d:c>d;l=0<=d?++c:--c)t[l]=r[1];if((a=n[n.length-1])[0]<255)for(l=p=u=a[0];u<=255?p<=255:p>=255;l=u<=255?++p:--p)t[l]=a[1];return this.process("curves",(function(e){var n,s;for(l=n=0,s=i.length;0<=s?n<s:n>s;l=0<=s?++n:--n)e[i[l]]=t[e[i[l]]];return e}))})),d.register("exposure",(function(e){var t,i,n;return t=[0,255*(n=Math.abs(e)/100)],i=[255-255*n,255],e<0&&(t=t.reverse(),i=i.reverse()),this.curves("rgb",[0,0],t,i,[255,255])})),a.Plugin.register("crop",(function(e,t,i,n){var s;return null==i&&(i=0),null==n&&(n=0),s=document.createElement("canvas"),S.copyAttributes(this.canvas,s),s.width=e,s.height=t,s.getContext("2d").drawImage(this.canvas,i,n,e,t,0,0,e,t),this.cropCoordinates={x:i,y:n},this.cropped=!0,this.replaceCanvas(s)})),a.Plugin.register("resize",(function(e){var t;if(null==e&&(e=null),null!==e&&(null!=e.width||null!=e.height))return null==e.width?e.width=this.canvas.width*e.height/this.canvas.height:null==e.height&&(e.height=this.canvas.height*e.width/this.canvas.width),t=document.createElement("canvas"),S.copyAttributes(this.canvas,t),t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,e.width,e.height),this.resized=!0,this.replaceCanvas(t);_.error("Invalid or missing dimensions given for resize")})),a.Filter.register("crop",(function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))})),a.Filter.register("resize",(function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}))}).call(this)}).call(window)}).call(this,i(694).Buffer)},,,,,function(e,t,i){(function(n){var s,a;s=[i(8),i(7),i(6),i(310),i(699),i(700),i(147),i(148),i(701),i(234),i(11),i(29)],void 0===(a=function(e,t,i,s,a,l,o,r,c,p,d,u){return t.ItemView.extend(n.extend({},r,{template:c,className:"content",ui:{canvas:"canvas",hmt:"input[name=heatmap]",ty:"select[name=type]",ty2:"select[name=type2]",xfm:".xfm",flu:"input[name=fluo]",el:"select[name=element]"},events:{"mousemove @ui.canvas":"mouseMove","mousedown @ui.canvas":"mouseDown","change @ui.ty":"setType","change @ui.ty2":"loadAttachment","change @ui.hmt":"setHM","change @ui.flu":"toggleFluo","change @ui.el":"changeElement"},setHM:function(){this.heatmapToggle=this.ui.hmt.is(":checked"),console.log("htm",this.heatmapToggle),this.draw()},setType:function(){this.draw()},gridPromise:function(){return this._gridPromise},gridInfo:function(){return this.grid},initialize:function(e){this.draw=n.debounce(this.draw,10),this.statusesLoaded=!1,this.listenTo(e.imagestatuses,"sync",this.setStatues,this),this._ready=[],this.distl=new s({id:this.getOption("ID"),nimg:this.getOption("NUMIMG"),pm:this.getOption("parent")}),this.listenTo(this.distl,"change",this.draw,this),this.grid=new a({id:this.getOption("ID")});var t=this;this.gridFetched=!1,this._gridPromise=this.grid.fetch().done((function(){t.gridFetched=!0,t.grid.get("ORIENTATION")?t.vertical="vertical"==t.grid.get("ORIENTATION"):t.vertical=t.grid.get("STEPS_Y")>t.grid.get("STEPS_X")&&app.config.gsMajorAxisOrientation,console.log("grid",t.grid.get("DATACOLLECTIONID"),t.grid.get("ORIENTATION"),"vertical",t.vertical)})),this.xfm=new l({id:this.getOption("ID")}),this.xfm.fetch().done(this.populateXFM.bind(this)),this.attachments=new o,this.attachments.queryParams.id=this.getOption("ID"),this.attachments.queryParams.filetype="pia",this.hasSnapshot=!1,this.snapshot=new u,this.snapshot.onload=this.snapshotLoaded.bind(this),this.offset_w=0,this.offset_h=0,this.scale=1,this.current=-1,this.heatmapToggle=!1,this.snapshotLoading=!1,this.listenTo(app,"window:scroll",this.lazyLoad,this)},loadAttachment:function(){var e=this.attachments.findWhere({DATACOLLECTIONFILEATTACHMENTID:this.ui.ty2.val()});if(e)if(e.get("DATA"))this.draw();else{var t=this;i.ajax({url:app.apiurl+"/download/attachment/id/"+this.getOption("ID")+"/aid/"+e.get("DATACOLLECTIONFILEATTACHMENTID"),dataType:"json",success:function(i){var s=n.map(i,(function(e,t){return[t+1,e]}));e.set("DATA",s),t.draw()}})}},toggleFluo:function(){if(this.ui.flu.is(":checked")){this.ui.ty.prop("disabled",!0);var e=n.where(this.xfm.get("data"),{ELEMENT:this.ui.el.val()});this.heatmap.configure({maxOpacity:.4,gradient:{0:"rgba(0,0,0,0)",1:"rgb("+e[0].R+","+e[0].G+","+e[0].B+")"}}),this.draw()}else this.ui.ty.prop("disabled",!1),this.heatmap.configure({maxOpacity:.4,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}}),this.draw()},changeElement:function(){this.draw()},populateXFM:function(){if(this.xfm.get("data").length){this.ui.xfm.show();var e=n.map(n.unique(n.pluck(this.xfm.get("data"),"ELEMENT")),(function(e){return'<option value="'+e+'">'+e+"</option>"}));this.ui.el.html(e.join())}},setStatues:function(){this.statusesLoaded=!0,this.lazyLoad()},lazyLoad:function(){!this.snapshotLoading&&this.statusesLoaded&&d.inView(this.$el)&&(this._ready.push(this.distl.fetch()),this._ready.push(this.attachments.fetch()),console.log("in view"),this.getModel(),e.when.apply(e,this._ready).done(this.populatePIA.bind(this)))},populatePIA:function(e){this.distl.get("data")[0].length||(this.ui.ty.hide(),this.ui.ty2.html(this.attachments.opts()).show(),this.loadAttachment())},getModel:function(){var e=this.getOption("imagestatuses").findWhere({ID:this.getOption("ID")});e.get("SNS").length&&e.get("SNS")[2]&&0==this.hasSnapshot&&(this.snapshotLoading=!0,this.$el.addClass("loading"),this.snapshot.load(app.apiurl+"/image/id/"+this.getOption("ID")+"/f/1"))},snapshotLoaded:function(){console.log("snapshot loaded"),this.hasSnapshot=!0,this.$el.removeClass("loading"),this.draw()},onRender:function(){this.ui.xfm.hide(),this.ui.ty2.hide()},onDomRefresh:function(){this.canvas=this.ui.canvas[0],this.ctx=this.canvas.getContext("2d");var e=window.devicePixelRatio||1,t=this.$el.parent().width(),i=this.$el.parent().height();this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.canvas.width=t*e,this.canvas.height=i*e,this.ctx.scale(e,e),this.perceivedw=t,this.perceivedh=i,this.$el.find("canvas.heatmap-canvas").remove(),this.heatmap=new p.create({container:this.$el[0],maxOpacity:.4}),this.ui.ty.val(1),this.lazyLoad(),this.hasSnapshot&&d.inView(this.$el)&&this.draw()},draw:function(){if(console.log("draw",this.ctx,this.hasSnapshot),this.ctx&&this.gridFetched){var e=1e3*this.grid.get("DX_MM")/this.grid.get("PIXELSPERMICRONX"),t=1e3*this.grid.get("DY_MM")/this.grid.get("PIXELSPERMICRONY"),i=t<e?1.1*t:1.1*e;if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.hasSnapshot){var s=this.grid.get("SNAPSHOT_OFFSETXPIXEL"),a=this.grid.get("SNAPSHOT_OFFSETYPIXEL"),l=e*this.grid.get("STEPS_X"),o=t*this.grid.get("STEPS_Y");if(app.options.get("scale_grid").indexOf(this.getOption("BL"))>-1){var r=this.snapshot.width/1024;s*=r,a*=r,l*=r,o*=r}var c=this.perceivedw/this.perceivedh,p=l/o;this.offset_w=0,this.offset_h=0,c<p?this.offset_h=l/c-o:this.offset_w=c*o-l,this.scale=this.perceivedw/(l+this.offset_w),this.ctx.globalAlpha=1,this.ctx.drawImage(this.snapshot,s-this.offset_w/2,a-this.offset_h/2,l+this.offset_w,o+this.offset_h,0,0,this.perceivedw,this.perceivedh)}var d=[];if(this.ui.flu.is(":checked")){var u=n.where(this.xfm.get("data"),{ELEMENT:this.ui.el.val()});n.each(u,(function(e){d.push([e.IMAGENUMBER,e.COUNTS])}))}else if(this.distl.get("data")&&this.distl.get("data")[0].length)this.distl.get("data")&&(d=this.distl.get("data")[parseInt(this.ui.ty.val())]);else{var h=this.attachments.findWhere({DATACOLLECTIONFILEATTACHMENTID:this.ui.ty2.val()});h&&h.get("DATA")&&(d=h.get("DATA"))}if(d&&d.length){var m=0;n.each(d,(function(e,t){e[1]>m&&(m=e[1])})),m<10&&(m*=50);var _=(this.perceivedw-this.offset_w*this.scale)/this.grid.get("STEPS_X"),f=(this.perceivedh-this.offset_h*this.scale)/this.grid.get("STEPS_Y"),g=[];n.each(d,(function(e,t){var n=e[0]-1;if(this.vertical){var s=Math.floor(n/this.grid.get("STEPS_Y")),a=n%this.grid.get("STEPS_Y");1==this.grid.get("SNAKED")&&s%2==1&&(a=this.grid.get("STEPS_Y")-1-a);var l=s*_+_/2+this.offset_w*this.scale/2,o=a*f+f/2+this.offset_h*this.scale/2}else{s=n%this.grid.get("STEPS_X"),a=Math.floor(n/this.grid.get("STEPS_X"));1==this.grid.get("SNAKED")&&a%2==1&&(s=this.grid.get("STEPS_X")-1-s);l=s*_+_/2+this.offset_w*this.scale/2,o=a*f+f/2+this.offset_h*this.scale/2}e[1]<1||e[1];g.push({x:l,y:o,value:e[1]<1?0:e[1],radius:i}),this.current==n&&(this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle="green",this.ctx.rect(l-_/2-2,o-f/2-1,_,f),this.ctx.stroke())}),this),m&&this.heatmap.setData({max:m,data:g})}}},mouseDown:function(e){var t=d.get_xy(e,this.ui.canvas),i=this._xyToPos(t[0],t[1]);if(i!=this.current){this.current=i;var n=this._getXYZ(i);this.trigger("current",i,n[0],n[1],n[2],this._getVal(i)),this.draw()}},_getXYZ:function(e){if(this.vertical)var t=Math.floor(e/this.grid.get("STEPS_Y")),i=e%this.grid.get("STEPS_Y");else t=e%this.grid.get("STEPS_X"),i=Math.floor(e/this.grid.get("STEPS_X"));var n=Math.PI/180,s=t*this.grid.get("DX_MM")*1e3+this.grid.get("X"),a=-i*this.grid.get("DY_MM")*Math.cos(this.grid.get("AXISSTART")*n)*1e3+this.grid.get("Y"),l=-i*this.grid.get("DY_MM")*Math.sin(this.grid.get("AXISSTART")*n)*1e3+this.grid.get("Z");return[s.toFixed(2),a.toFixed(2),l.toFixed(2)]},mouseMove:function(e){},_getVal:function(e){var t=null,i=this.distl.get("data")[parseInt(this.ui.ty.val())];return n.each(i,(function(i,n){i[0]!=e+1||(t=i[1])})),t},_xyToPos:function(e,t){var i=(this.perceivedw-this.offset_w*this.scale)/this.grid.get("STEPS_X"),n=(this.perceivedh-this.offset_h*this.scale)/this.grid.get("STEPS_Y"),s=e-this.offset_w*this.scale/2,a=t-this.offset_h*this.scale/2;if(this.vertical){e=Math.floor(s/i),t=Math.floor(a/n);1==this.grid.get("SNAKED")&&e%2==1&&(t=this.grid.get("STEPS_Y")-1-t);var l=e*this.grid.get("STEPS_Y")+t}else{e=Math.floor(s/i),t=Math.floor(a/n);1==this.grid.get("SNAKED")&&t%2==1&&(e=this.grid.get("STEPS_X")-1-e);l=e+t*this.grid.get("STEPS_X")}return l},onDestroy:function(){this.distl.stop()}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/dc/grid"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/dc/xfm",parse:function(e,t){return{data:e}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="controls">\n\t<select name="type">\n\t\t<option value="0">Spots</option>\n\t\t<option value="1">Bragg</option>\n\t\t<option value="3">Total Signal</option>\n\t\t<option value="4">Dozor</option>\n\t</select>\n\n\t<select name="type2"></select>\n\n\t<span class="xfm r">\n\t\t<label><input type="checkbox" name="fluo" /> Fluorescence</label>\n\t\t<select name="element"></select>\n\t</span>\n</div>\n<canvas></canvas>';return __p}},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/dc/grid/xrc"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data" ty="',print(0==AXISRANGE?"grid":0!=OVERLAP?"screen":""),__p+='">\n    <h1 class="title"></h1>\n\n    <div class="image"></div>\n    <div class="diviewer"></div>\n    \n    <ul class="clearfix single">\n        <li>&'+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Start: "+(null==(__t=AXISSTART)?"":_.escape(__t))+"&deg;</li>\n        ",(KAPPA&&0!=KAPPA||PHI&&0!=PHI||CHISTART&&0!=CHISTART)&&(__p+="<li>",null!=KAPPA&&(__p+="&kappa;: "+(null==(__t=KAPPA)?"":_.escape(__t))+"&deg;"),__p+=" ",null!=PHI&&(__p+="&phi;: "+(null==(__t=PHI)?"":_.escape(__t))+"&deg;"),__p+=" ",null!=CHISTART&&(__p+="&chi;: "+(null==(__t=CHISTART)?"":_.escape(__t))+"&deg;"),__p+="</li>"),__p+="\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Wavelength: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Transmission: "+(null==(__t=TRANSMISSION)?"":_.escape(__t))+"%</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+'&mu;m</li>\n        <li>Boxsize: <span class="boxx"></span>x<span class="boxy"></span>&mu;m</li>\n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+='<li>Status: <span class="b">Stopped</span></li>'),__p+='\n\n        <li>\n            Image: <span class="img"></span>\n            Value: <span class="val"></span>\n        </li>\n        <li>\n            X: <span class="x"></span>\n            Y: <span class="y"></span>\n            Z: <span class="z"></span>\n        </li>\n    </ul>\n\n    <a href="#" class="button zoom"><i class="fa fa-search-plus"></i> <span>Enlarge</span></a>\n\n    <div class="holder">\n        <h1 title="Xray Centring Status and Results" class="xrc"><span><i class="fa fa-spinner fa-spin"></i></span></h1>\n    </div>\n</div>';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(11),i(29),i(705),i(47)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({template:s,ui:{sns:".snapshots"},initialize:function(e){this.listenTo(app,"window:scroll",this.lazyLoad,this)},lazyLoad:function(){this.$el.find(".lazy").not(".enabled").filter((function(){return t.inView(n(this))})).each((function(e,t){var s=new i;s.onload=function(){n(t).attr("src",this.src),setTimeout((function(){n(t).addClass("show")}),100)},n(t).addClass("enabled"),s.load(n(t).attr("data-src"))}))},onRender:function(){this.$el.find(".snapshots a").magnificPopup({type:"image"}),this.model.get("X2")||this.ui.sns.hide()},onDomRefresh:function(){this.lazyLoad()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection clearfix" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="robot">\n\t<div class="snapshots">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal After Before"><img class="lazy" data-src="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'" alt="Crystal After Before" /></a>\n    </div>\n    <div class="snapshots">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'/n/2/f/1" title="Crystal Snapshot After"><img class="lazy" data-src="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'/n/2" alt="Crystal Snapshot After" /></a>\n    </div>\n\n    <h1>'+(null==(__t=ST)?"":_.escape(__t))+" - Robot ",print(IMP.toLowerCase()),__p+="</h1>\n\n    ",FILETEMPLATE&&"null"!=DIR&&FILETEMPLATE!=DIR&&"NR"!=DIR&&(__p+='\n\t\t<p class="message alert">Barcode Mismatch - Sample: '+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+" Read: "+(null==(__t=DIR)?"":_.escape(__t))+"</p>\n\t"),__p+='\n\n    <ul class="clearfix half">\n        ',BLSAMPLEID&&(__p+='\n        \t<li class="sample"><span class="wrap">Sample: <a href="/samples/sid/'+(null==(__t=BLSAMPLEID)?"":_.escape(__t))+'">'+(null==(__t=SAMPLE)?"":_.escape(__t))+"</a></span></li>\n        "),__p+="\n        <li>Took: "+(null==(__t=BSX)?"":_.escape(__t))+"s</li>\n        <li>Barcode: "+(null==(__t=DIR)?"":_.escape(__t))+"</li>\n        <li>Puck: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+" Pin: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+'</li>\n        <li class="comment">Status: '+(null==(__t=SPOS)?"":_.escape(__t))+" - "+(null==(__t=SAN)?"":_.escape(__t))+"</li>\n    </ul>\n</div>";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(707),i(106),i(20),i(145),i(709),i(18)],void 0===(a=function(e,t,i,s,a,l,o){return l.extend({template:o,plotView:i,onShow:function(){this.edgeview=new(this.getOption("plotView"))({id:this.model.get("ID"),el:n(".edge",this.$el)}),t.Validation.unbind(this),t.Validation.bind(this),new a({model:this.model,el:this.$el}).create("COMMENTS","text")},onDestroy:function(){this.edgeview.destroy()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){var n,s;n=[i(7),i(708),i(11),i(8),i(23)],void 0===(s=function(e,t,i,n){return e.ItemView.extend({template:!1,model:t,modelEvents:{change:"render"},initialize:function(e){this.model=new t({id:e.id}),this.model.fetch(),this.$el.css("opacity",0)},onRender:function(){var e=n.extend({},i.default_plot,{yaxes:[{},{position:"right"}],series:{points:{show:!1},lines:{show:!0}}}),t=[{data:this.model.get("RAW"),color:"rgb(100,100,100)"},{data:this.model.get("FDP"),label:"f&rsquo;&rsquo;",yaxis:2},{data:this.model.get("FP"),label:"f&rsquo;",yaxis:2}];this.plot=n.plot(this.$el,t,e),this.$el.css("opacity",1)},onDestroy:function(){this.plot&&this.plot.shutdown()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/dc/ed",parse:function(e,t){return{RAW:e[0],FDP:e[1],FP:e[2]}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="edge">\n    <div class="edge"></div>\n    <h1>\n        <a href="#" class="atp button button-notext" ty="edge" iid="'+(null==(__t=ID)?"":_.escape(__t))+'" name="'+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+'"><i class="fa fa-book"></i> <span>Add to Project</span></a>\n        <a href="#" class="button button-notext flag ',FLAG&&(__p+="button-highlight"),__p+='" title="Click to add this data collection to the list of favourite data collections"><i class="fa fa-star-o"></i> <span>Favourite</span></a>\n        <a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/ty/edge/id/"+(null==(__t=ID)?"":_.escape(__t))+'" class="perm button button-notext"><i class="fa fa-link"></i> <span>Permalink</span></a>\n            \n        <span class="date">',IS_VISIT||(__p+='[<a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+'">'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"</a>]"),__p+="  "+(null==(__t=ST)?"":_.escape(__t))+'</span><span class="spacer"> - </span><span class="temp">'+(null==(__t=DIR)?"":_.escape(__t))+' Edge Scan</span>\n    </h1>\n    \n    <ul class="clearfix half">\n        <li>Scan File: '+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+"</li>\n        <li>E(Peak): "+(null==(__t=EPK.toFixed(1))?"":_.escape(__t))+"eV (",print((12398.4193/EPK).toFixed(4)),__p+="&#197;)</li>\n        <li>f&rsquo;&rsquo;: "+(null==(__t=NUMIMG)?"":_.escape(__t))+" / f&rsquo;: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"e</li>\n        <li>E(Inf): "+(null==(__t=EIN.toFixed(1))?"":_.escape(__t))+"eV (",print((12398.4193/EIN).toFixed(4)),__p+="&#197;)</li>\n        <li>f&rsquo;&rsquo;: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+" / f&rsquo;: "+(null==(__t=AXISRANGE)?"":_.escape(__t))+"e</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Transmission: "+(null==(__t=TRANSMISSION)?"":_.escape(__t))+"%</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+"&mu;m</li>\n        <li>Axis Position: "+(null==(__t=AXISSTART)?"":_.escape(__t))+'&deg;</li>\n        <li class="comment" title="Click to edit the comment for this edge scan">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n    </ul>\n</div>\n";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(711),i(106),i(20),i(145),i(713),i(18)],void 0===(a=function(e,t,i,s,a,l,o){return l.extend({template:o,plotView:i,onShow:function(){this.mcaview=new(this.getOption("plotView"))({id:this.model.get("ID"),el:n(".mca",this.$el)}),t.Validation.unbind(this),t.Validation.bind(this),new a({model:this.model,el:this.$el}).create("COMMENTS","text")},onDestroy:function(){this.mcaview.destroy()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){var n,s;n=[i(7),i(712),i(11),i(8),i(23)],void 0===(s=function(e,t,i,n){return e.ItemView.extend({template:!1,model:t,modelEvents:{change:"render"},initialize:function(e){this.$el.css("opactiy",0),this.model=new t({id:e.id});var i=this;this.model.fetch().done((function(){console.log(i.model)}))},onRender:function(){var e=this,t=this.model,i=[{label:"XRF",data:t.get("XRF"),color:"rgb(100,100,100)"},{label:"Compton",data:t.get("COMPTON"),color:"rgb(200,200,200)"}],s=n.plot(this.$el,i,{grid:{borderWidth:0},yaxis:{max:1.1*t.get("MAX")}}),a=t.get("MAX"),l=s.getAxes().xaxis.datamax;n.each(t.get("ELEMENTS"),(function(i,o){var r="K"==i[i.length-1]?[1,.2]:[.9,.1,.5,.05,.05],c=["&alpha;","&beta;","&gamma;"],p=o[1]/t.get("MP");n.each(o[0],(function(t,n){if(r[t]>.1&p>.01){var o=s.pointOffset({x:1e3*n-.03*l,y:a*r[t]*p+.18*a});e.$el.append('<div class="annote" style="left:'+(o.left+4)+"px;top:"+o.top+'px;">'+i+"<sub>"+c[t]+"</sub></div>")}}))})),this.$el.css("opactiy",1),this.plot=s},onDestroy:function(){this.plot&&this.plot.shutdown(),this.model.stop()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/dc/mca",initialize:function(e){this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},parse:function(e,t){return{XRF:e[0],COMPTON:e[1],ELEMENTS:e[2],ELNOMATCH:e[3],MP:e[4],MAX:e[5]}},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},poll:function(){clearTimeout(this.refresh_thread),this.running&&(this.get("ELEMENTS").length||(this.refresh_thread=setTimeout(this.fetch.bind(this),1e4)))}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="mca">\n    <div class="mca"></div>\n    <h1>\n        <a href="#" class="atp button button-notext" ty="mca" iid="'+(null==(__t=ID)?"":_.escape(__t))+'" name="'+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+'"><i class="fa fa-book"></i> <span>Add to Project</span></a>\n        <a href="#" class="button button-notext flag ',FLAG&&(__p+="button-highlight"),__p+='" title="Click to add this data collection to the list of favourite data collections"><i class="fa fa-star-o"></i> <span>Favourite</span></a>\n        <a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/ty/mca/id/"+(null==(__t=ID)?"":_.escape(__t))+'" class="perm button button-notext"><i class="fa fa-link"></i> <span>Permalink</span></a>\n        \n        <span class="date">',IS_VISIT||(__p+='[<a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+'">'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"</a>]"),__p+="  "+(null==(__t=ST)?"":_.escape(__t))+'</span>\n        <span class="spacer"> - </span><i class="button fa fa-caret-right expand"></i> <span class="temp">'+(null==(__t=DIR)?"":_.escape(__t))+'</span>\n    </h1>\n    \n    <ul class="clearfix half">\n        <li>Energy: '+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"eV</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Transmission: "+(null==(__t=TRANSMISSION)?"":_.escape(__t))+"%</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+"&mu;m</li>\n        <li>Axis Position: "+(null==(__t=AXISSTART)?"":_.escape(__t))+'&deg;</li>\n        <li class="comment" title="Click to edit the comment for this mca spectrum">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n    </ul>\n</div>";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(11),i(29),i(715),i(47)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({template:s,initialize:function(e){this.listenTo(app,"window:scroll",this.lazyLoad,this)},lazyLoad:function(){var e=this.$el.find(".lazy").not(".enabled").filter((function(){return t.inView(n(this))})),s=this;e.each((function(e,t){var a=new i;a.onload=function(){n(t).attr("src",this.src),setTimeout((function(){n(t).addClass("show")}),100)},n(t).addClass("enabled"),s.model.get("X"+(e+1))&&a.load(n(t).attr("data-src"))}))},onRender:function(){this.$el.find(".snapshots a").magnificPopup({type:"image"})},onDomRefresh:function(){this.lazyLoad()}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="action">\n    <div class="snapshots">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot Before"><img class="lazy" data-src="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'" alt="Crystal Snapshot Before" /></a>\n    </div>\n    \n    <div class="snapshots">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'/n/2/f/1" title="Crystal Snapshot After"><img class="lazy" data-src="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/ai/visit/"+(null==(__t=VIS_LINK)?"":_.escape(__t))+"/aid/"+(null==(__t=ID)?"":_.escape(__t))+'/n/2" alt="Crystal Snapshot After" /></a>\n    </div>\n    \n    <h1>\n        <span class="date">',IS_VISIT||(__p+='[<a href="/dc/visit/'+(null==(__t=VIS_LINK)?"":_.escape(__t))+'">'+(null==(__t=VIS_LINK)?"":_.escape(__t))+"</a>]"),__p+="  "+(null==(__t=ST)?"":_.escape(__t))+'</span><span class="spacer"> - </span><span class="temp">Sample ',print(IMP.toLowerCase()),__p+='</span>\n    </h1>\n    <ul class="clearfix half">\n        ',BLSAMPLEID&&(__p+='<li class="sample"><span class="wrap">Sample: <a href="/samples/sid/'+(null==(__t=BLSAMPLEID)?"":_.escape(__t))+'">'+(null==(__t=SAMPLE)?"":_.escape(__t))+"</a></span></li>"),__p+="\n        <li>Time: "+(null==(__t=BSX)?"":_.escape(__t))+"s</li>\n    </ul>\n</div>";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="key_holder">\n        <i class="fa fa-key"></i>\n        \n        <div class="key">\n            <p>Inner ring: Protein by colour</p>\n            <p>Outer ring: Sample status</p>\n            <ul>\n                <li>Loaded</li>\n                <li>Screened</li>\n                <li>Auto Indexed</li>\n                <li>Data Collected</li>\n                <li>Auto Integrated</li>\n            </ul>\n        </div>\n    </div>\n    \n    <div class="handle">\n        <span class="text" title="Hide / Show Sample Changer Overview. Click to Dock">Sample Changer\n            <span class="controls">\n                <a href="#" class="clearf"><i class="fa fa-filter"></i> Clear Filter</a>\n            </span>\n        </span>\n    </div>\n\n    <div class="wrap">\n        <canvas class="sample_changer"></canvas>\n    </div>\n    \n    <div class="ranking">\n        <label>\n                <input type="checkbox" name="components" /> Group By Component\n        </label>\n        <br />\n\n        <label>\n            <input type="checkbox" name="rank" />\n            Rank By\n        </label>:\n        <select name="param">\n            <option value="SCRESOLUTION" data-inverted="1" data-check="SC">AI Resolution</option>\n            <option value="SCCOMPLETENESS" data-check="SC" data-min="0.85">AI Completeness</option>\n            <option value="DCRESOLUTION" data-inverted="1" data-check="DC">AP Resolution</option>\n            <option value="DCCOMPLETENESS" data-check="DC" data-min="0.85">AP Completeness</option>\n        </select>\n    </div>\n    \n    <div class="details form">\n        <ul>\n            <li>\n                <span class="label">Sample:</span>\n                <span class="sname"></span>\n            </li>\n            <li><span class="label">Protein:</span> <span class="pname"></span></li>\n            <li><span class="label">Components:</span> <span class="comps"></span></li>\n            \x3c!--<li><span class="label">Container:</span> <span class="cname"></span></li>--\x3e\n            <li><span class="label">Loaded:</span> <span class="loaded"></span></li>\n            <li><span class="label">Screened:</span> <span class="screened"></span></li>\n            <li><span class="label">Data:</span> <span class="data"></span></li>\n        </ul>\n    </div>\n';return __p}},function(e,t,i){(function(n,s){var a,l;a=[i(7)],void 0===(l=function(e){var t=e.ItemView.extend({tagName:"li",getTemplate:function(){return n.template(this.model.get("ST").replace(/\d+-\d+-\d+ /,"")+" - "+{data:'<span class="title">New data collection</span> <a href="#"><%-DIR%><%-FILETEMPLATE%></a>',grid:'<span class="title">New grid scan</span> <a href="#"><%-DIR%><%-FILETEMPLATE%></a>',edge:'<span class="title">New edge scan</span> <a href="#"><%-DIR%></a>',mca:'<span class="title">New MCA fluorescence spectrum</span> <a href="#"><%-DIR%></a>',load:'<span class="title">New sample loaded</span> <a href="#">Puck: <%-EXPOSURETIME%> Pin: <%-RESOLUTION%> Barcode: <%-DIR%></a>',action:'<span class="title">New sample action</span> <a href="#"><%-IMP%></a>'}[this.model.get("TYPE")])},events:{"click a":"gotoEvent"},gotoEvent:function(e){e.preventDefault();var t=s('.data_collection[dcid="'+this.model.get("ID")+'"]').offset().top;s("body").animate({scrollTop:t},300)}});return e.CompositeView.extend({template:n.template("<h1>Log</h1><ul></ul>"),className:"log border",childView:t,childViewContainer:"ul"})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},function(e,t,i){(function(n){var s,a;s=[i(7),i(379),i(11),i(721)],void 0===(a=function(e,t,i,s){return e.LayoutView.extend({template:s,className:"content",templateHelpers:function(){return{BL:this.getOption("bl"),APIURL:app.apiurl}},events:{"click h1":"toggleView"},regions:{pvs:".pvs"},ui:{status:"div.status"},timeoutHandler:void 0,timeoutDuration:6e5,toggleView:function(){var e=this;this.ui.status.slideToggle("fast","swing",(function(){e.ui.status.is(":visible")?(e.pvs.show(new t({bl:e.getOption("bl")})),e.$el.find(".webcam img").each((function(t,s){var a=app.apiurl+"/image/cam/bl/"+e.getOption("bl")+"/n/"+t;i.sign({url:a,callback:function(e){n(s).attr("src",a+"?token="+e.token)}})})),e.timeoutHandler=setTimeout((function(){e.toggleView()}),e.timeoutDuration)):(e.timeoutHandler&&clearTimeout(e.timeoutHandler),e.pvs.empty(),e.$el.find(".webcam img").each((function(e,t){n(t).attr("src","")})))}))},onBeforeDestroy:function(){this.$el.find(".webcam img").each((function(e,t){n(t).attr("src","")}))}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){(function(n){var s,a;s=[i(6),i(720)],void 0===(a=function(e,t){return e.Collection.extend({model:t,url:function(){return"/status/pvs/"+this.bl},initialize:function(e,t){this.bl=t.bl,this.running=!0,this.refresh_thread=null},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},parse:function(e){clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),1e4));var t=[];return n.each(e,(function(e,i){t.push({NAME:i,VALUE:e})})),t}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"NAME",initialize:function(e){this.on("change",this.addClass(),this),this.addClass()},addClass:function(){var e=this.get("NAME"),t=this.get("VALUE");c="Ring Current"==e?t<10?"off":"on":"Ring State"==e?"User"==t?"on":"off":"Hutch"==e?"Locked"==t?"on":"off":"Refil"==e?-1==t?"off":"on":"Closed"==t?"off":"on",this.attributes.CLASS=c}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="status">'+(null==(__t=BL)?"":_.escape(__t))+' Webcams &amp; Beamline Status</h1>\n<div class="status ',"i02"==BL&&(__p+="three"),__p+='">\n    <div class="pvs"></div>\n    \n    <div class="webcam"><img src="#" alt="webcam1" /></div>\n    <div class="webcam"><img src="#" alt="webcam2" /></div>\n    ',"i02"==BL&&(__p+='\n\t<div class="webcam"><img src="#" alt="webcam3" /></div>\n    '),__p+="\n</div>";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(149),i(11),i(8),i(23),i(42),i(150),i(74)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({template:!1,modelEvents:{change:"render"},initialize:function(e){this.model=new t(e),this.model.fetch(),this.$el.css("opactiy",0)},className:"horizontal_stack",onRender:function(){if(this.model.get("data")){var e={series:{bars:{horizontal:!0,show:!0},stack:!0},tooltip:!0,tooltipOpts:{content:this.getTooltip.bind(this)},legend:{show:!1},grid:{borderWidth:0,hoverable:!0},yaxis:{max:1,ticks:[]},xaxis:{ticks:[]}},t=this.model.get("data");n.each(t,(function(e,i){t[i]=parseFloat(e)}));var i=[{label:"Startup",color:"yellow",data:[[this.model.get("data").SUP,0]]},{label:"Data Collection",color:"green",data:[[t.DCTIME,0]]},{label:"Auto Indexing",color:"#93db70",data:[[t.AITIME,0]]},{label:"Centring",color:"cyan",data:[[t.CENTTIME,0]]},{label:"Energy Scans",color:"orange",data:[[t.EDGE,0]]},{label:"Robot Actions",color:"blue",data:[[t.R,0]]},{label:"Thinking",color:"purple",data:[[t.T,0]]},{label:"Remaining",color:"red",data:[[t.REM,0]]},{label:"Beam Dump",color:"black",data:[[t.NOBEAM,0]]},{label:"Faults",color:"grey",data:[[t.FAULT,0]]}];s.plot(this.$el,i,e),this.$el.css("opacity",1)}},getTooltip:function(e,t,i,n){return n.series.label+": "+t.toFixed(2)+"hrs"},onDestroy:function(){this.model.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="no_mobile">Queue Builder for '+(null==(__t=VISIT)?"":_.escape(__t))+" on "+(null==(__t=BL)?"":_.escape(__t))+'</h1>\n\n<div class="smpls"></div>\n\n\x3c!--\n<h2>Default Parameters</h2>\n<div class="table">\n    <table>\n        <thead>\n            <tr>\n                <th>Directory</th>\n                <th>Image Prefix</th>\n                <th>Start</th>\n                <th>Osc</th>\n                <th>Overlap</th>\n                <th># Images</th>\n                <th>Exposure</th>\n                <th>Transmission</th>\n                <th>Wavelength</th>\n                <th>Resolution</th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td><input type="text" name="DIR"></td>\n                <td><input type="text" name="IMP"></td>\n                <td><input type="text" name="AXISSTART"></td>\n                <td><input type="text" name="AXISRANGE"></td>\n                <td><input type="text" name="OVERLAP"></td>\n                <td><input type="text" name="NUMIMG"></td>\n                <td><input type="text" name="EXPOSURETIME"></td>\n                <td><input type="text" name="TRANSMISSION"></td>\n                <td><input type="text" name="WAVELENGTH"></td>\n                <td><input type="text" name="RESOLUTION"></td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n--\x3e\n<div class="queue"></div>\n\n<div draggable="true" class="button drag">Drag to GDA</div>\n\n';return __p}},function(e,t){e.exports="<extendedCollectRequest>\n    <collect_request>\n        <fileinfo>\n        <directory><%-DIR%></directory>\n        <prefix><%-IMP%></prefix>\n        </fileinfo>\n        <oscillation_sequence>\n            <start><%-AXISSTART%></start>\n            <range><%-AXISRANGE%></range>\n            <number_of_images><%-NUMIMG%></number_of_images>\n            <overlap><%-OVERLAP%></overlap>\n            <exposure_time><%-EXPOSURETIME%></exposure_time>\n            <start_image_number>1</start_image_number>\n            <number_of_passes>1</number_of_passes>\n        </oscillation_sequence>\n        <wavelength><%-WAVELENGTH%></wavelength>\n        <resolution>\n            <upper><%-RESOLUTION%></upper>\n        </resolution>\n        <sample_reference>\n            <container_reference><%-CPOS%></container_reference>\n            <sample_location><%-SPOS%></sample_location>\n            <blSampleId><%-BLSAMPLEID%></blSampleId>\n        </sample_reference>\n    </collect_request>\n    <runNumber>0</runNumber>\n    <sampleDetectorDistanceInMM><%-DET%></sampleDetectorDistanceInMM>\n    <transmissionInPerCent><%-TRANSMISSION%></transmissionInPerCent>\n    <sampleName><%-SAMPLE%></sampleName>\n    <visitPath><%-VISITPATH%></visitPath>\n    <comment></comment>\n    <suffix>cbf</suffix>\n    <totalNumberOfImages><%-NUMIMG%></totalNumberOfImages>\n    <fileNameTemplate><%-DIR+IMP%>_0_%04cbf</fileNameTemplate>\n    <hasBeamSize>false</hasBeamSize>\n    <hasTransmission>true</hasTransmission>\n    \x3c!--<aperturePosition><%-AP%></aperturePosition>--\x3e\n</extendedCollectRequest>\n"},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1 class="no_mobile">\n        <div class="usage r"></div>\n        Data Collections\n        ',IS_VISIT&&(__p+="for "+(null==(__t=VISIT)?"":_.escape(__t))+" on "+(null==(__t=BEAMLINENAME)?"":_.escape(__t))),__p+='\n    </h1>\n\n    <p class="help">This page shows all data collections for the selected visit. If the visit is ongoing the page will automatically update as new data is collected. Auto processing results will be displayed</p>\n\n    ',IS_VISIT&&!IS_SINGLE&&(__p+="\n    ",-1==VISIT.search("cm")&&-1==VISIT.search("nt")&&-1==VISIT.search("nr")&&"1"!=ACTIVE&&"1"!=ARCHIVED&&(__p+='\n        <p class="message notify">\n            This visit is inactive and will not auto update \n            | Auto Refresh <input type="checkbox" name="autorefresh" value="1" />\n            <a href="#" class="button refresh"><i class="fa fa-refresh"></i> Refresh</a>\n        </p>\n    '),__p+="\n\n    ","1"==ARCHIVED&&(__p+='\n        <p class="message notify">\n            This visit is archived, data is no longer held on disk. You cannot download processing results, view full sized diffraction images, or reprocess data.\n        </p>\n    '),__p+='\n\n    <div class="links">\n        <a class="button" href="/assign/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Assign Containers" class="summary"><i class="fa fa-arrows"></i> <span>Assign Containers</span></a>\n        <a class="button" href="/dc/summary/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Data Summary" class="summary"><i class="fa fa-file-o"></i> <span>Summary</span></a>\n        <a class="button"  href="/dc/apstatussummary/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Autoprocessing Summary"><i class="fa fa-magic"></i> <span>Auto Processing</span></a>\n        <a class="button"  href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Visit Statistics"><i class="fa fa-pie-chart"></i> <span>Visit Stats</span></a>\n        \x3c!-- <a class="button queue"  href="/dc/queue/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Build GDA Queue"><i class="fa fa-cog"></i> <span>Build GDA Queue</span></a> --\x3e\n        <a href="#" class="button users"><i class="fa fa-users"></i> <span>Users</span></a>\n        <a href="#" class="button dewars"><i class="fa fa-truck"></i> <span>Dewars</span></a>\n        <a class="button"  href="/dc/sc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Sample Changer"><i class="fa fa-exchange"></i> <span>Sample Changer</span></a>\n        <a href="#" class="button rpo" title="Reprocessing Overview"><i class="fa fa-cog"></i> <span>Reprocessing</span></a>\n        ',IS_STAFF&&(__p+='\n        <a class="button"  href="/status/bl/'+(null==(__t=BL)?"":_.escape(__t))+'" title="Beamline Status" class="blstat"><i class="fa fa-wrench"></i> <span>Beamline Status</span></a>\n        '),__p+="\n    </div>\n    "),__p+="\n\n    ",(IS_SINGLE||IS_DCG)&&(__p+='\n        <h1 class="message nou"><a class="button" href="/dc',IS_VISIT&&(__p+="/visit/"+(null==(__t=VISIT)?"":_.escape(__t))),__p+='">View All Data Collections</a></h1>\n    '),__p+="\n\n    ",IS_DCG&&(__p+="<h2>Data Collection Group</h2>"),__p+="\n    ",IS_PJ&&(__p+="<h2>Processing Job</h2>"),__p+='\n\n    <div class="st"></div>\n    <div class="sc"></div>\n    <div class="lg"></div>\n\n    <div class="srch"></div>\n    <div class="filter type"></div>\n\n    <div class="page_wrap one"></div>    \n    <div class="data_collections"></div>\n    <div class="page_wrap two"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(27),i(40),i(727),i(8)],void 0===(s=function(e,t,i,n){return e.extend({template:i,title:"Associate Sample",buttons:{Associate:"associateSample",Cancel:"closeDialog"},ui:{sample:"input[name=sample]",sn:".sample"},associateSample:function(){if(this.sample){var e=this.samples.findWhere({BLSAMPLEID:this.sample.value});e&&(console.log("sample",e),this.model.set({BLSAMPLEID:e.get("BLSAMPLEID"),SAMPLE:e.get("NAME")}));var t=this;this.model.save(this.model.changedAttributes(),{patch:!0,success:function(){app.alert({className:"message notify",message:"Sample successfully associated"}),t.trigger("sample:associated"),t.closeDialog()},error:function(){app.alert({message:"Something went wrong associating this sample, please try again"})}})}},initialize:function(e){this.sample=null,this.samples=new t},onRender:function(){this.ui.sample.autocomplete({source:this.getSamples.bind(this),select:this.selectSample.bind(this)}),this.$el.find(".ui-autocomplete").css("z-index",9999)},selectSample:function(e,t){e.preventDefault(),this.ui.sn.text(t.item.label),console.log(t.item.label,t.item.value),this.sample=t.item,this.ui.sample.val("")},getSamples:function(e,t){var i=this;this.samples.fetch({data:{s:e.term},success:function(e){var n=i.samples.map((function(e){return{label:e.get("NAME")+" ("+e.get("ACRONYM")+")",value:e.get("BLSAMPLEID")}}));t(n)}})}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p>\n    <span class="b">Data Collection:</span> \n    <span >'+(null==(__t=ST)?"":_.escape(__t))+'</span> - <span class="temp">'+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+'</span>\n</p>\n<p><span class="b">Select a Sample:</span>\n<input name="sample" /></p>\n<span class="sample"></span>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data">\n    <h1 class="title"></h1>\n\n    <div class="distl"></div>\n    <div class="diffraction" title="Click to view diffraction image">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1/n/4"><img dsrc="" alt="Diffraction Image 1" /></a>\n    </div>\n    <div class="snapshots" title="View sample snapshots for the current data collection">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot 1"><img dsrc="" alt="Crystal Snapshot 1" /></a>\n    </div>\n    \n    <div class="links">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><i class="fa fa-picture-o fa-2x"></i> Images</a> \n        <a class="sn" href="#snapshots"><i class="fa fa-camera fa-2x"></i> Snapshots</a> \n        <a class="dl" href="#distl"><i class="fa fa-bar-chart-o fa-2x"></i> Data Plot</a>\n    </div>\n    \n    <ul class="clearfix">\n        <li>Wavelength: '+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Detector Distance: "+(null==(__t=parseFloat(DET).toFixed(1))?"":_.escape(__t))+"mm</li>\n        <li>Calibrant: </li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+'&mu;m</li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+="<li>Status: <b>Stopped</b></li>"),__p+='\n        </ul>\n    \n    <div class="holder">\n        <h1 title="Download Data">Data Files <span class="r"><i class="fa fa-download"></i> <a class="dd" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/dc/dl/id/"+(null==(__t=ID)?"":_.escape(__t))+'" title="Download files">Download</a></span></h1>\n    </div>\n</div>';return __p}},function(e,t,i){var n,s;n=[i(73),i(77),i(730)],void 0===(s=function(e,t,i){var n=t.extend({apStatus:!0,dcViews:{data:i}});return e.extend({dcListView:n,filters:!1,sampleChanger:!1})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(194),i(196),i(731)],void 0===(s=function(e,t,i){return e.extend({apStatusItem:i,loadAP:function(e){this.ap?this.ap.$el.slideToggle():this.ap=new t({id:this.model.get("ID"),el:this.$el.find("div.autoproc")})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(144)],void 0===(a=function(e){return e.extend({onRender:function(){var e=this.model.get("STATES"),t=['<i class="fa icon blue fa-question-circle alt="N/A"></i>','<i class="fa icon grey fa-cog fa-spin alt="Running"></i>','<i class="fa icon green fa-check alt="Completed"></i>','<i class="fa icon red fa-times alt="Failed"></i>'];n.each(["autoproc","downstream"],(function(i,s){this.ui.holder.eq(s).empty(),n.each(e[i],(function(e,i){0!=e&&this.ui.holder.eq(s).append(i+" "+t[e]+" ")}),this)}),this)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(116),i(77),i(733),i(153)],void 0===(s=function(e,t,i,n){var s=t.extend({dcViews:{data:i}});return e.extend({dcListView:s,template:n})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(92),i(734)],void 0===(s=function(e,t){return e.extend({template:t,plotView:null})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data">\n    <h1 class="title"></h1>\n\n    <div class="diffraction" title="Click to view diffraction image">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1/n/4"><img dsrc="" alt="Diffraction Image 1" /></a>\n    </div>\n    <div class="snapshots" title="View sample snapshots for the current data collection">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot 1"><img dsrc="" alt="Crystal Snapshot 1" /></a>\n    </div>\n    \n    <div class="links">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><i class="fa fa-picture-o fa-2x"></i> Images</a> \n        <a class="sn" href="#snapshots"><i class="fa fa-camera fa-2x"></i> Snapshots</a> \n        <a class="dl" href="#distl"><i class="fa fa-bar-chart-o fa-2x"></i> Data Plot</a>\n    </div>\n    \n    <ul class="clearfix">\n        <li>Wavelength: '+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Calibrant: </li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+'&mu;m</li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+="<li>Status: <b>Stopped</b></li>"),__p+='\n        </ul>\n    \n    <div class="holder">\n        <h1 title="Download Data">Data Files <span class="r"><i class="fa fa-download"></i> <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/dc/dl/id/"+(null==(__t=ID)?"":_.escape(__t))+'" title="Download files">Download</a></span></h1>\n    </div>\n</div>';return __p}},function(e,t,i){var n,s;n=[i(116),i(77),i(736),i(753),i(237),i(117),i(756)],void 0===(s=function(e,t,i,n,s,a,l){var o=t.extend({apStatusCollection:n,dcViews:{data:i},apStatus:!0}),r=e.extend({dcListView:o,template:l,regions:{data_collections:".data_collections",pages:".page_wrap.one",pages2:".page_wrap.two",search:".srch",type:".type",sc:".sc",log:".lg",status:".st",use:".usage",rbd:".breakdown"},initialize:function(e){r.__super__.initialize.call(this,e),this.breakdown=new s({visit:this.options.params.visit}),this.listenTo(this.breakdown,"sync",this.queueRefresh),this.breakdown.fetch()},queueRefresh:function(){this.model&&1==this.model.get("ACTIVE")&&setTimeout(this.breakdown.fetch.bind(this.breakdown),1e4)},onShow:function(){this.getOption("params").id||this.rbd.show(new a({model:this.breakdown,scatters:!0,hideOverview:!0}))}});return r}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(737),i(92),i(738),i(739),i(740),i(743),i(752)],void 0===(s=function(e,t,i,n,s,a,l){var o=t.extend({template:l,plotView:null,apStatusItem:i,regions:{mg:".mg"},events:{"click .holder h1.ap":"loadAP","click .holder h1.dp":"loadDP"},initialize:function(e){o.__super__.initialize.apply(this,e),this.m=910938356e-39,this.h=662607004e-42,this.c=299792458,this.e=160217662e-27,this.model.set("KV",this.l2kV(this.model.get("WAVELENGTH"))),this.overview=new n({pm:this.model,imagestatuses:this.getOption("imagestatuses"),apstatus:this.getOption("apstatuses")}),this.listenTo(this.overview,"current",this.loadPoint,this)},onShow:function(){o.__super__.onShow.apply(this),this.imagestatus=new e({pm:this.model,statuses:this.getOption("apstatuses"),el:this.$el})},onDomRefresh:function(){this.overview.triggerMethod("dom:refresh")},loadPoint:function(e){e&&this.imagestatus.show(e),this.ap&&this.ap.fetch(e)},loadAP:function(e){this.ap?this.ap.$el.slideToggle():(this.ap=new a({id:this.model.get("ID"),el:this.$el.find("div.autoproc")}),this.listenTo(this.ap,"load:movie",this.imagestatus.show.bind(this.imagestatus)))},kV2l:function(e){var t=1e3*e;return this.h/Math.sqrt(2*this.m*this.e*t+Math.pow(this.e*t/this.c,2))*1e10},l2kV:function(e){return((-2*this.m*this.e+Math.sqrt(Math.pow(2*this.m*this.e,2)+4*Math.pow(this.e*this.h/(this.c*e*1e-10),2)))/(2*Math.pow(this.e/this.c,2))/1e3).toFixed(0)}});return o}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(11),i(29),i(8),i(47)],void 0===(a=function(e,t,i,s){return e.ItemView.extend({modelEvents:{change:"render"},template:!1,ui:{sn:".mg img",sna:".mg a",mg:".mg",cap:"figcaption"},initialize:function(e){this.pm=e.pm,this.listenTo(e.statuses,"sync",this.getModel,this),this.listenTo(app,"window:scroll",this.lazyLoad,this),this.imagenumber=null,this.image=null},lazyLoad:function(){inview=this.$el.find(".lazy").not(".enabled").filter((function(){return t.inView(s(this))}));var e=this;inview.each((function(t,n){e.image=new i,e.image.onload=function(){s(n).attr("src",this.src),e.ui.cap.text("Micrograph "+e.imagenumber),setTimeout((function(){s(n).addClass("show")}),100)},e.image.onprogress=e.onProgress.bind(e),s(n).addClass("enabled"),e.image.load(s(n).attr("data-src"))}))},onProgress:function(e){this.ui.cap.text("Loading Micrograph "+this.imagenumber+" "+e+"%")},getModel:function(){var e=this.getOption("statuses").findWhere({ID:this.pm.get("ID")});e!=this.model&&(this.undelegateEvents(),this.model=e,this.delegateEvents(),this.model&&this.render())},show:function(e){this.image&&(this.imagenumber=e,this.image.load(app.apiurl+"/em/mc/image/"+this.model.get("ID")+"?IMAGENUMBER="+this.imagenumber),this.ui.sna.attr("href",app.apiurl+"/em/mc/image/"+this.model.get("ID")+"?IMAGENUMBER="+this.imagenumber))},onRender:function(){console.log("render im status",this.getOption("TYPE"));this.model.get("ID");n.every(this.model.get("MC"),(function(e,t){if(!this.imagenumber&&1==e)return this.imagenumber=t,this.ui.sn.attr("data-src",app.apiurl+"/em/mc/image/"+this.model.get("ID")+"?IMAGENUMBER="+this.imagenumber).addClass("lazy"),void this.ui.sna.attr("href",app.apiurl+"/em/mc/image/"+this.model.get("ID")+"?IMAGENUMBER="+this.imagenumber)}),this),this.ui.mg.magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0,navigateByImgClick:!0}}),this.lazyLoad(s(window))},onDestroy:function(){console.log("destroying image status view")}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(144)],void 0===(a=function(e){return e.extend({onRender:function(){var e=[];n.each({"Motion Correction":"MC",CTF:"CTF"},(function(t,i){var s=[],a=n.countBy(Object.values(this.model.get(t)),(function(e){return e}));n.each({null:'<i class="fa icon grey fa-cog fa-spin alt="Running"></i>',1:'<i class="fa icon green fa-check alt="Completed"></i>',0:'<i class="fa icon red fa-times alt="Failed"></i>'},(function(e,t){a[t]&&s.push(a[t]+" "+e)}),this),e.push("<span>"+i+": "+(s.length?s.join(" "):'<i class="fa icon blue fa-question-circle alt="N/A"></i>')+"</span>")}),this),this.ui.holder.eq(0).html(e.join(" "))}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(234),i(29)],void 0===(a=function(e,t,i){return e.LayoutView.extend({tagName:"a",template:n.template("<img></img>"),ui:{img:"img"},initialize:function(e){this.draw=n.debounce(this.draw,10),this.listenTo(e.imagestatuses,"sync",this.getModel,this),this.pm=e.pm,this.ready=[],this.current=1,this.hasSnapshot=!1,this.img=new i,this.img.onload=this.onImageLoaded.bind(this)},onImageLoaded:function(){this.ui.img.attr("src",this.img.src).addClass("show")},getModel:function(){var e=this.getOption("imagestatuses").findWhere({ID:this.pm.get("ID")});e.get("SNS").length&&e.get("SNS")[1]&&0==this.hasSnapshot&&this.img.load(app.apiurl+"/image/id/"+this.pm.get("ID")+"/f/1/n/2")}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(741),i(742)],void 0===(a=function(e,t,i){return t.extend({template:i,initialize:function(e){this.pm=e.pm,this.apstatuses=e.apstatuses,this.imagenumber=null,this.listenTo(this.apstatuses,"sync",this.findFirst)},findFirst:function(){var e=this.apstatuses.findWhere({ID:this.pm.get("ID")});e&&n.every(e.get("MC"),(function(e,t){if(!this.imagenumber&&1==e)return this.imagenumber=t,void this.loadMicrograph()}),this)},setMicrograph:function(e){e&&(this.imagenumber=e,this.loadMicrograph())},loadMicrograph:function(){this.img.load(app.apiurl+"/em/mc/image/"+this.pm.get("ID")+"?IMAGENUMBER="+this.imagenumber),this.showProgressBar()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(11),i(29),i(18)],void 0===(a=function(e,t,i){var s=e.LayoutView.extend({className:"image_large",_baseUI:function(){return{canvas:"canvas",zoom:".zoom",zval:".zval",progress:"span.progress"}},_baseEvents:function(){return{"slidechange @ui.zoom":"onZoomChange","mousedown @ui.canvas":"mouseDownCanvas","mousemove @ui.canvas":"mouseMoveCanvas","mouseup @ui.canvas":"mouseUpCanvas","DOMMouseScroll @ui.canvas":"mouseWheelCanvas","mousewheel @ui.canvas":"mouseWheelCanvas","touchstart @ui.canvas":"mouseDownCanvas","touchmove @ui.canvas":"touchMoveCanvas","touchend @ui.canvas":"touchEndCanvas"}},delegateEvents:function(e){return this.ui=n.extend(this._baseUI(),n.result(this,"ui")),this.events=n.extend(this._baseEvents(),n.result(this,"events")),s.__super__.delegateEvents.call(this,e)},constructor:function(e){s.__super__.constructor.call(this,e),this.drawDebounce=n.debounce(this.draw,10),this.img=new i,this.img.onload=this.onImageLoaded.bind(this),this.img.onerror=this.onImageError.bind(this),this.img.onprogress=this.onImageProgress.bind(this),this.rendered=!1,this.scalef=1,this.width=null,this.height=null,this.offsetx=0,this.offsety=0,this.lastv=null},onDomRefresh:function(){this.canvas=this.ui.canvas[0],this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.$el.width(),this.canvas.height=this.$el.parent().height(),this.ui.zoom.slider({min:0,max:200,step:5}),this.rendered=!0},onImageError:function(e){},onImageProgress:function(e){this.rendered&&this.ui.progress.text(e+"% loaded")},showProgressBar:function(){this.rendered&&(this.ui.progress.text("0% loaded"),this.ui.progress.show())},hideProgressBar:function(){this.rendered&&this.ui.progress.hide()},onImageLoaded:function(e){this.hideProgressBar(),this.width=this.img.width,this.height=this.img.height,this.calcZoom(),this.width*this.scalef>this.canvas.width&&(this.offsetx=-(this.width*this.scalef-this.canvas.width)/2),this.height*this.scalef>this.canvas.height&&(this.offsety=-(this.height*this.scalef-this.canvas.height)/2),this.draw()},draw:function(){console.log("draw"),this.ctx.setTransform(this.scalef,0,0,this.scalef,this.offsetx,this.offsety),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.img,0,0,this.width,this.height)},resetZoom:function(){this.setZoom(this.ui.zoom.slider("option","min"))},setZoom:function(e){this.ui.zoom.slider("value",e),this.scalef=this.ui.zoom.slider("value")/100,this.clampOffsets()},onZoomChange:function(e){this.scalef=this.ui.zoom.slider("value")/100,this.ui.zval.text((100*this.scalef).toFixed(0)),e&&e.originalEvent&&(this.clampOffsets(),this.draw())},calcZoom:function(){var e=this.ui.canvas.width()>this.ui.canvas.height()?this.ui.canvas.width()/this.width:this.ui.canvas.height()/this.height;this.ui.zoom.slider("option","min",100*e),this.onZoomChange()},clampOffsets:function(){this.offsety>0&&(this.offsety=0),this.offsety<this.ui.canvas.height()-this.scalef*this.height&&(this.offsety=this.ui.canvas.height()-this.scalef*this.height),this.offsetx>0&&(this.offsetx=0),this.offsetx<this.ui.canvas.width()-this.scalef*this.width&&(this.offsetx=this.ui.canvas.width()-this.scalef*this.width)},mouseWheelCanvas:function(e){e.preventDefault();var i=e.originalEvent,n=i.wheelDelta?i.wheelDelta:-i.detail;this.zoom(t.get_xy(i,this.ui.canvas),n)},zoom:function(e,t){var i=this.scalef;this.scalef+=t>0?.1:-.1,this.scalef<this.ui.canvas.width()/this.width&&(this.scalef=this.ui.canvas.width()/this.width),this.scalef<this.ui.canvas.height()/this.height&&(this.scalef=this.ui.canvas.height()/this.height);var n=(s=-this.offsetx+e[0])*(this.scalef/i);this.offsetx-=n-s;var s;n=(s=-this.offsety+e[1])*(this.scalef/i);this.offsety-=n-s,this.clampOffsets(),this.scalef<2&&this.ui.zoom.slider("value",100*this.scalef),this.ui.zval.text((100*this.scalef).toFixed(0)),this.draw()},mouseDownCanvas:function(e){e.preventDefault(),e.originalEvent.touches&&e.originalEvent.touches.length&&(e=e.originalEvent.touches[0]),this.record=!0,this.startx=e.clientX,this.starty=e.clientY},getScaledXY:function(e){var i=t.get_xy(e,this.ui.canvas),n=parseInt(i[0]/this.scalef-this.offsetx/this.scalef),s=parseInt(i[1]/this.scalef-this.offsety/this.scalef);return console.log(n,s),{x:n,y:s}},mouseMoveCanvas:function(e){if(e.preventDefault(),!(e.originalEvent.touches&&e.originalEvent.touches.length>1)){e.originalEvent.touches&&e.originalEvent.touches.length&&(e=e.originalEvent.touches[0]);t.get_xy(e,this.ui.canvas);this.record&&(this.moved=!0,this.offsetx+=e.clientX-this.startx,this.offsety+=e.clientY-this.starty,this.clampOffsets(),this.drawDebounce(),this.startx=e.clientX,this.starty=e.clientY)}},mouseUpCanvas:function(e){e.preventDefault(),this.moved&&(this.draw(),this.moved=!1),this.record=!1},touchMoveCanvas:function(e){this.mouseMoveCanvas(e),e.originalEvent.touches&&2==e.originalEvent.touches.length&&(x=e.originalEvent.touches[0],y=e.originalEvent.touches[1],v=Math.sqrt(Math.pow(x.pageX-y.pageX,2)+Math.pow(x.pageY-y.pageY,2)),xy=[],xy.push((x.pageX<y.pageX?x.pageX:y.pageX)+Math.abs(x.pageX-y.pageX)/2),xy.push((x.pageY<y.pageY?x.pageY:y.pageY)+Math.abs(x.pageY-y.pageY)/2),v&&this.lastv&&this.zoom(xy,v>this.lastv?1:-1),this.lastv=v)},touchEndCanvas:function(e){this.mouseUpCanvas(e),this.lastv=0}});return s}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="controls">\n    <abbr title="Hotkey: Z zooms in, z zooms out">Z<abbr>oom: <span class="zval">0</span>% <div class="zoom"></div>\n</div>\n\n<div class="objects">\n\t<span class="progress"></span>\n</div>\n\n<div class="image_container border">\n\t<canvas class="full"></canvas>\n</div>\n';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(84),i(744),i(745),i(746),i(750),i(11)],void 0===(a=function(e,t,i,s,a,l,o){return e.LayoutView.extend({template:n.template('<div class="dcap">Movie: <a href="#" class="button prev"><i class="fa fa-angle-left"></i></a><input type="text" name="movie" value="<%-IMAGENUMBER%>" /><a href="#" class="button next"><i class="fa fa-angle-right"></i></a></div><div class="mc dcap"></div><div class="ctf dcap"></div>'),regions:{rmc:".mc",rctf:".ctf"},ui:{mov:"input[name=movie]"},events:{"click a.next":"nextMovie","click a.prev":"prevMovie","change @ui.mov":"loadMovie"},templateHelpers:function(){return{IMAGENUMBER:this.imagenumber}},loadMovie:function(e){this.fetch(parseInt(this.ui.mov.val()))},nextMovie:function(e){e.preventDefault();var t=this.imagenumber+1;this.fetch(t),this.ui.mov.val(t)},prevMovie:function(e){e.preventDefault();var t=this.imagenumber-1;t>0&&(this.fetch(t),this.ui.mov.val(t))},initialize:function(e){this.id=e.id,this.imagenumber=1,this.mc=new i({id:e.id,TYPE:"Motion Correction"}),this.ctf=new s({id:e.id,TYPE:"CTF"}),this.listenTo(this.mc,"error",this.mcReset),this.listenTo(this.ctf,"error",this.ctfReset),this.fetch(),this.render()},mcReset:function(){this.mc.clear().set({id:this.id,TYPE:"Motion Correction"},{silent:!0})},ctfReset:function(){this.ctf.clear().set({id:this.id,TYPE:"CTF"},{silent:!0})},fetch:function(e){e&&(this.imagenumber=e),this.mc.fetch({data:{IMAGENUMBER:this.imagenumber}}),this.ctf.fetch({data:{IMAGENUMBER:this.imagenumber}}),this.trigger("load:movie",e)},onRender:function(){this.rmc.show(new a({model:this.mc})),this.rctf.show(new l({model:this.ctf})),this.$el.slideDown()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/em/mc"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/em/ctf"})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(56),i(747),i(749),i(11),i(29),i(47)],void 0===(a=function(e,t,i,s,a,l){return e.ItemView.extend({getTemplate:function(){return this.model.get("MOTIONCORRECTIONID")?s:"<p>No Motion Correction for this movie</p>"},modelEvents:{change:"render"},className:"clearfix",ui:{plot:".distl"},events:{"click .logf":"showLog","click .dll":a.signHandler},templateHelpers:function(){return{APIURL:app.apiurl}},showLog:function(e){e.preventDefault();var i=n(e.target).attr("href"),s=this;a.sign({url:i,callback:function(e){app.dialog.show(new t({title:s.model.get("TYPE")+" Log File",url:i+"?token="+e.token}))}})},onRender:function(){var e=.175*n(window).width()*.95,t=n(window).width()>1280?e:n(window).width()>800?1.3*e:1.65*e;n(".distl,.diffraction",this.$el).height(.7*t),this.model.get("FFTFULLPATH")>0&&(this.fft=new l,this.fft.onload=this.showFFT.bind(this),this.fft.load(app.apiurl+"/em/mc/fft/image/"+this.model.get("DATACOLLECTIONID")+"/n/"+this.model.get("IMAGENUMBER"))),this.model.get("FFTCORRECTEDFULLPATH")>0&&(this.fft2=new l,this.fft2.onload=this.showFFT2.bind(this),this.fft2.load(app.apiurl+"/em/mc/fft/image/"+this.model.get("DATACOLLECTIONID")+"/n/"+this.model.get("IMAGENUMBER")+"/t/2")),this.plotview=new i({id:this.model.get("DATACOLLECTIONID"),imagenumber:this.model.get("IMAGENUMBER"),el:this.$el.find(".distl")})},showFFT:function(){this.$el.find(".fft img").attr("src",this.fft.src).addClass("show"),this.$el.find(".fft").magnificPopup({delegate:"a",type:"image"})},showFFT2:function(){this.$el.find(".fft2 img").attr("src",this.fft2.src).addClass("show"),this.$el.find(".fft2").magnificPopup({delegate:"a",type:"image"})}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){var n,s;n=[i(7),i(748),i(11),i(8),i(23),i(42),i(195)],void 0===(s=function(e,t,i,n){return e.ItemView.extend({template:!1,modelEvents:{change:"render"},initialize:function(e){this.model=new t({id:e.id}),this.model.fetch({data:{IMAGENUMBER:this.getOption("imagenumber")}}),this.$el.css("opacity",0)},onRender:function(){if(this.model.get("data")){var e=n.extend({},i.default_plot,{xaxis:{min:-20,max:20},yaxis:{min:-20,max:20},grid:{borderWidth:0},series:{lines:{show:!0},points:{show:!0,radius:1}}}),t=[{data:this.model.get("data"),label:"Drift"}];console.log("drift",t),this.plot=n.plot(this.$el,t,e),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop(),this.plot&&this.plot.shutdown()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/em/mc/drift",parse:function(e,t){return{data:e}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2>Motion Correction</h2>\n\n<p class="ra">\n    <a class="dll button" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/id/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/aid/"+(null==(__t=AUTOPROCPROGRAMID)?"":_.escape(__t))+'"><i class="fa fa-download"></i> Micrograph</a>\n        <a class="view button logf" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/id/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/aid/"+(null==(__t=AUTOPROCPROGRAMID)?"":_.escape(__t))+'/log/1"><i class="fa fa-search"></i> Log file</a>\n</p>\n\n<div class="data_collection" type="data">\n\n    <div class="distl" title="Drift Plot"></div>\n    \n    <div class="diffraction fft2" title="Click to view FFT">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/em/mc/fft/image/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/n/"+(null==(__t=IMAGENUMBER)?"":_.escape(__t))+'/t/2" title="FFT Drift Corrected"><img dsrc="" alt="FFT Drift Corrected" /></a>\n    </div>\n    <div class="diffraction fft" title="Click to view drift corrected FFT">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/em/mc/fft/image/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/n/"+(null==(__t=IMAGENUMBER)?"":_.escape(__t))+'" title="FFT"><img dsrc="" alt="FFT" /></a>\n    </div>\n\n    <ul class="clearfix">\n        <li>Movie Number: '+(null==(__t=IMAGENUMBER)?"":_.escape(__t))+"</li>\n        <li>First Frame: "+(null==(__t=FIRSTFRAME)?"":_.escape(__t))+"</li>\n        <li>Last Frame: "+(null==(__t=LASTFRAME)?"":_.escape(__t))+"</li>\n        <li>Dose Per Frame: "+(null==(__t=DOSEPERFRAME)?"":_.escape(__t))+'e<span class="super">-</span>/&#197;<span class="super">2</span></li>\n        <li>Dose Weight: '+(null==(__t=DOSEWEIGHT)?"":_.escape(__t))+"?</li>\n        <li>Total Motion: "+(null==(__t=TOTALMOTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Average Motion / Frame: "+(null==(__t=AVERAGEMOTIONPERFRAME)?"":_.escape(__t))+"&#197;</li>\n        <li>Patches Used: "+(null==(__t=PATCHESUSEDX)?"":_.escape(__t))+"x"+(null==(__t=PATCHESUSEDY)?"":_.escape(__t))+'</li>\n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n    </ul>\n\n</div>\n";return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(56),i(751),i(11),i(29),i(47)],void 0===(a=function(e,t,i,s,a){return e.ItemView.extend({getTemplate:function(){return this.model.get("CTFID")?i:"<p>No CTF Correction for this movie</p>"},modelEvents:{change:"render"},className:"clearfix",events:{"click .logf":"showLog","click .dll":s.signHandler},templateHelpers:function(){return{APIURL:app.apiurl}},showLog:function(e){e.preventDefault();var i=n(e.target).attr("href"),a=this;s.sign({url:i,callback:function(e){app.dialog.show(new t({title:a.model.get("TYPE")+" Log File",url:i+"?token="+e.token}))}})},onRender:function(){var e=.175*n(window).width()*.95,t=n(window).width()>1280?e:n(window).width()>800?1.3*e:1.65*e;n(".diffraction",this.$el).height(.8*t),console.log("showing ctf"),this.model.get("FFTTHEORETICALFULLPATH")>0&&(this.fft=new a,this.fft.onload=this.showFFT.bind(this),this.fft.load(app.apiurl+"/em/ctf/image/"+this.model.get("DATACOLLECTIONID")+"/n/"+this.model.get("IMAGENUMBER")))},showFFT:function(){this.$el.find(".fft img").attr("src",this.fft.src).addClass("show"),this.$el.find(".fft").magnificPopup({delegate:"a",type:"image"})}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h2>CTF Correction</h2>\n\n<p class="ra">\n    <a class="dll button" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/id/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/aid/"+(null==(__t=AUTOPROCPROGRAMID)?"":_.escape(__t))+'"><i class="fa fa-download"></i> Output</a>\n        <a class="view button logf" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/id/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/aid/"+(null==(__t=AUTOPROCPROGRAMID)?"":_.escape(__t))+'/log/1"><i class="fa fa-search"></i> Log file</a>\n</p>\n\n<div class="data_collection" type="data">\n\n    <div class="diffraction fft" title="Click to view FFT">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/em/ctf/image/"+(null==(__t=DATACOLLECTIONID)?"":_.escape(__t))+"/n/"+(null==(__t=IMAGENUMBER)?"":_.escape(__t))+'" title="FFT Theoretical"><img dsrc="" alt="FFT Theoretical" /></a>\n    </div>\n\n    <ul class="clearfix">\n        <li>Movie Number: '+(null==(__t=IMAGENUMBER)?"":_.escape(__t))+"</li>\n        <li>Boxsize: "+(null==(__t=BOXSIZEX)?"":_.escape(__t))+"x"+(null==(__t=BOXSIZEY)?"":_.escape(__t))+"&micro;m</li>\n        <li>Resolution: "+(null==(__t=MINRESOLUTION)?"":_.escape(__t))+" - "+(null==(__t=MAXRESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Defocus: "+(null==(__t=MINDEFOCUS)?"":_.escape(__t))+" - "+(null==(__t=MINDEFOCUS)?"":_.escape(__t))+"&#197;</li>\n        <li>Defocus Step Size: "+(null==(__t=DEFOCUSSTEPSIZE)?"":_.escape(__t))+"&#197;</li>\n        <li>Astigmatism: "+(null==(__t=ASTIGMATISM)?"":_.escape(__t))+"&#197;</li>\n        <li>Astigmatism Angle: "+(null==(__t=ASTIGMATISMANGLE)?"":_.escape(__t))+"&deg;</li>\n        <li>Estimated Resolution: "+(null==(__t=ESTIMATEDRESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Estimated Defocus: "+(null==(__t=ESTIMATEDDEFOCUS)?"":_.escape(__t))+"&#197;</li>\n        <li>Amplitude Contrast: "+(null==(__t=AMPLITUDECONTRAST)?"":_.escape(__t))+"</li>\n        <li>CC Value: "+(null==(__t=CCVALUE)?"":_.escape(__t))+'</li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n    </ul>\n\n</div>\n";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data">\n    <h1 class="title"></h1>\n\n    <div class="image mg">\n        <figcaption></figcaption>\n        <a href="#" title="Micrograph Snapshot"><img title="Micrograph Snapshot" /></a>\n    </div>\n    \n    <ul class="clearfix">\n        <li>Voltage: '+(null==(__t=KV)?"":_.escape(__t))+"kV</li>\n\n        <li>C1 Lens: "+(null==(__t=C1LENS)?"":_.escape(__t))+"% Aperture: "+(null==(__t=C1APERTURE)?"":_.escape(__t))+"&mu;m</li>\n        <li>C2 Lens: "+(null==(__t=C2LENS)?"":_.escape(__t))+"% Aperture: "+(null==(__t=C2APERTURE)?"":_.escape(__t))+"&mu;m</li>\n        <li>C3 Lens: "+(null==(__t=C3LENS)?"":_.escape(__t))+"% Aperture: "+(null==(__t=C3APERTURE)?"":_.escape(__t))+"&mu;m</li>\n\n        <li>Obj Aperture: "+(null==(__t=OBJAPERTURE)?"":_.escape(__t))+"&mu;m</li>\n\n        <li>Magnification: "+(null==(__t=MAGNIFICATION)?"":_.escape(__t))+"x</li>\n\n        ",SLITGAPHORIZONTAL&&(__p+="\n        <li>Energy Filter: "+(null==(__t=SLITGAPHORIZONTAL)?"":_.escape(__t))+"</li>\n        "),__p+="\n\n        <li>Phase Plate: "+(null==(__t=1==PHASEPLATE?"Yes":"No")?"":_.escape(__t))+"</li>\n\n\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+"&mu;m</li>\n\n        <li>Detector: "+(null==(__t=DETECTORMANUFACTURER)?"":_.escape(__t))+" "+(null==(__t=DETECTORMODEL)?"":_.escape(__t))+"</li>\n        <li>Detector Mode: "+(null==(__t=DETECTORMODE)?"":_.escape(__t))+"</li>\n        <li>Sample Pixel Size: "+(null==(__t=PIXELSIZEONIMAGE)?"":_.escape(__t))+"&#197;/pix</li>\n        <li>Binning: "+(null==(__t=BINNING)?"":_.escape(__t))+"pix</li>\n        <li>Image Size: "+(null==(__t=IMAGESIZEX)?"":_.escape(__t))+"x"+(null==(__t=IMAGESIZEY)?"":_.escape(__t))+" pix</li>\n        \n\n        <li>No. Movies: "+(null==(__t=NUMIMG)?"":_.escape(__t))+"</li>\n        <li>Frames/Movie: "+(null==(__t=NUMBEROFPASSES)?"":_.escape(__t))+"</li>\n        <li>Frame Length: "+(null==(__t=EXPOSURETIME/NUMBEROFPASSES)?"":_.escape(__t))+"s</li>\n\n        <li>Total Dose: "+(null==(__t=TOTALDOSE)?"":_.escape(__t))+'e<span class="super">-</span>/&#197;<span class="super">2</span></li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+="<li>Status: <b>Stopped</b></li>"),__p+='\n    </ul>\n\n    <div class="holder">\n        <h1 title="Click to show autoprocessing results" class="ap">Auto Processing<span><i class="fa fa-spinner fa-spin"></i></span></h1>\n        <div class="autoproc"></div>\n    </div>\n    \n</div>\n';return __p}},function(e,t,i){var n,s;n=[i(6),i(308)],void 0===(s=function(e,t){return e.Collection.extend({model:t,url:"/em/aps"})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="overview">\n\t<div class="plot_container border">\n\t    <a href="#" class="r button button-notext" name="reset" title="Reset the zoom level back to the full visit"><i class="fa fa-refresh"></i> <span>Reset</span></a>\n\t    <div id="overview"></div>\n\t</div>\n\n\t<a href="#" class="button prev"><i class="fa fa-minus"></i></a> \n\t<a href="#" class="button next"><i class="fa fa-plus"></i></a>\n\t<span class="r span"></span>\n\t<div class="plot_container border">\n\t    <div id="avg_time"></div>\n\t</div>\n</div>\n\n<div class="plot_container border">\n    <div id="dc_hist"></div>\n</div>';return __p}},function(e,t,i){(function(e){!function(e){function t(e,t){return t*Math.floor(e/t)}function i(e,t,i,n){if("function"==typeof e.strftime)return e.strftime(t);var s,a=function(e,t){return t=""+(null==t?"0":t),1==(e=""+e).length?t+e:e},l=[],o=!1,r=e.getHours(),c=r<12;null==i&&(i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==n&&(n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),s=r>12?r-12:0==r?12:r;for(var p=0;p<t.length;++p){var d=t.charAt(p);if(o){switch(d){case"a":d=""+n[e.getDay()];break;case"b":d=""+i[e.getMonth()];break;case"d":d=a(e.getDate());break;case"e":d=a(e.getDate()," ");break;case"h":case"H":d=a(r);break;case"I":d=a(s);break;case"l":d=a(s," ");break;case"m":d=a(e.getMonth()+1);break;case"M":d=a(e.getMinutes());break;case"q":d=""+(Math.floor(e.getMonth()/3)+1);break;case"S":d=a(e.getSeconds());break;case"y":d=a(e.getFullYear()%100);break;case"Y":d=""+e.getFullYear();break;case"p":d=c?"am":"pm";break;case"P":d=c?"AM":"PM";break;case"w":d=""+e.getDay()}l.push(d),o=!1}else"%"==d?o=!0:l.push(d)}return l.join("")}function n(e){function t(e,t,i,n){e[t]=function(){return i[n].apply(i,arguments)}}var i={date:e};null!=e.strftime&&t(i,"strftime",e,"strftime"),t(i,"getTime",e,"getTime"),t(i,"setTime",e,"setTime");for(var n=["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds"],s=0;s<n.length;s++)t(i,"get"+n[s],e,"getUTC"+n[s]),t(i,"set"+n[s],e,"setUTC"+n[s]);return i}function s(e,t){if("browser"==t.timezone)return new Date(e);if(t.timezone&&"utc"!=t.timezone){if("undefined"!=typeof timezoneJS&&void 0!==timezoneJS.Date){var i=new timezoneJS.Date;return i.setTimezone(t.timezone),i.setTime(e),i}return n(new Date(e))}return n(new Date(e))}var a={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,quarter:7776e6,year:525949.2*60*1e3},l=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"]],o=l.concat([[3,"month"],[6,"month"],[1,"year"]]),r=l.concat([[1,"quarter"],[2,"quarter"],[1,"year"]]);e.plot.plugins.push({init:function(n){n.hooks.processOptions.push((function(n,l){e.each(n.getAxes(),(function(e,n){var l=n.options;"time"==l.mode&&(n.tickGenerator=function(e){var i=[],n=s(e.min,l),c=0,p=l.tickSize&&"quarter"===l.tickSize[1]||l.minTickSize&&"quarter"===l.minTickSize[1]?r:o;null!=l.minTickSize&&(c="number"==typeof l.tickSize?l.tickSize:l.minTickSize[0]*a[l.minTickSize[1]]);for(var d=0;d<p.length-1&&!(e.delta<(p[d][0]*a[p[d][1]]+p[d+1][0]*a[p[d+1][1]])/2&&p[d][0]*a[p[d][1]]>=c);++d);var u=p[d][0],h=p[d][1];if("year"==h){if(null!=l.minTickSize&&"year"==l.minTickSize[1])u=Math.floor(l.minTickSize[0]);else{var m=Math.pow(10,Math.floor(Math.log(e.delta/a.year)/Math.LN10)),_=e.delta/a.year/m;u=_<1.5?1:_<3?2:_<7.5?5:10,u*=m}u<1&&(u=1)}e.tickSize=l.tickSize||[u,h];var f=e.tickSize[0];h=e.tickSize[1];var g=f*a[h];"second"==h?n.setSeconds(t(n.getSeconds(),f)):"minute"==h?n.setMinutes(t(n.getMinutes(),f)):"hour"==h?n.setHours(t(n.getHours(),f)):"month"==h?n.setMonth(t(n.getMonth(),f)):"quarter"==h?n.setMonth(3*t(n.getMonth()/3,f)):"year"==h&&n.setFullYear(t(n.getFullYear(),f)),n.setMilliseconds(0),g>=a.minute&&n.setSeconds(0),g>=a.hour&&n.setMinutes(0),g>=a.day&&n.setHours(0),g>=4*a.day&&n.setDate(1),g>=2*a.month&&n.setMonth(t(n.getMonth(),3)),g>=2*a.quarter&&n.setMonth(t(n.getMonth(),6)),g>=a.year&&n.setMonth(0);var v,b=0,w=Number.NaN;do{if(v=w,w=n.getTime(),i.push(w),"month"==h||"quarter"==h)if(f<1){n.setDate(1);var E=n.getTime();n.setMonth(n.getMonth()+("quarter"==h?3:1));var S=n.getTime();n.setTime(w+b*a.hour+(S-E)*f),b=n.getHours(),n.setHours(0)}else n.setMonth(n.getMonth()+f*("quarter"==h?3:1));else"year"==h?n.setFullYear(n.getFullYear()+f):n.setTime(w+g)}while(w<e.max&&w!=v);return i},n.tickFormatter=function(e,t){var n=s(e,t.options);if(null!=l.timeformat)return i(n,l.timeformat,l.monthNames,l.dayNames);var o=t.options.tickSize&&"quarter"==t.options.tickSize[1]||t.options.minTickSize&&"quarter"==t.options.minTickSize[1],r=t.tickSize[0]*a[t.tickSize[1]],c=t.max-t.min,p=l.twelveHourClock?" %p":"",d=l.twelveHourClock?"%I":"%H";return i(n,r<a.minute?d+":%M:%S"+p:r<a.day?c<2*a.day?d+":%M"+p:"%b %d "+d+":%M"+p:r<a.month?"%b %d":o&&r<a.quarter||!o&&r<a.year?c<a.year?"%b":"%b %Y":o&&r<a.year?c<a.year?"Q%q":"Q%q %Y":"%Y",l.monthNames,l.dayNames)})}))}))},options:{xaxis:{timezone:null,timeformat:null,twelveHourClock:!1,monthNames:null}},name:"time",version:"1.0"}),e.plot.formatDate=i}(e)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="no_mobile">\n    <div class="usage r"></div>\n    Data Collections\n    ',IS_VISIT&&(__p+="for "+(null==(__t=VISIT)?"":_.escape(__t))+" on "+(null==(__t=BEAMLINENAME)?"":_.escape(__t))),__p+="\n</h1>\n\n",IS_VISIT&&!IS_SINGLE&&(__p+="\n",-1==VISIT.search("cm")&&-1==VISIT.search("nt")&&-1==VISIT.search("nr")&&"1"!=ACTIVE&&(__p+='\n<p class="message notify">\n    This visit is inactive and will not auto update\n    | Auto Refresh <input type="checkbox" name="autorefresh" value="1"/>\n    <a href="#" class="button refresh"><i class="fa fa-refresh"></i> Refresh</a>\n</p>\n'),__p+='\n\n<div class="links">\n    <a class="button" href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Visit Statistics"><i class="fa fa-pie-chart"></i> <span>Visit Stats</span></a>\n    <a href="#" class="button users"><i class="fa fa-users"></i> <span>Users</span></a>\n    <a href="#" class="button dewars"><i class="fa fa-truck"></i> <span>Parcels</span></a>\n    \x3c!-- <a class="button"  href="/em/process/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Scipion Processing"><i class="fa fa-cog"></i> <span>Processing</span></a>--\x3e\n    <a class="button" href="/em/process/relion/session/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Relion Processing"><i class="fa fa-cog"></i>\n        <span>Relion Processing</span></a>\n</div>\n\n<div class="breakdown"></div>\n\n'),__p+="\n\n",(IS_SINGLE||IS_DCG)&&(__p+='\n<h1 class="message nou"><a class="button" href="/dc',IS_VISIT&&(__p+="/visit/"+(null==(__t=VISIT)?"":_.escape(__t))),__p+='">View All Data\n    Collections</a></h1>\n'),__p+="\n\n",IS_DCG&&(__p+="<h2>Data Collection Group</h2>"),__p+="\n",IS_PJ&&(__p+="<h2>Processing Job</h2>"),__p+='\n\n<div class="st"></div>\n<div class="lg"></div>\n\n<div class="srch clearfix"></div>\n\n<div class="page_wrap one"></div>\n<div class="data_collections"></div>\n<div class="page_wrap two"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(116),i(77),i(758),i(153)],void 0===(s=function(e,t,i,n){var s=t.extend({dcViews:{data:i}});return e.extend({dcListView:s,template:n})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(92),i(235),i(759),i(385),i(146),i(11),i(761)],void 0===(s=function(e,t,i,n,s,a,l){return e.extend({template:l,plotView:t,imageStatusItem:n,events:{"click .distl":"showPlot","click .diffraction":"showDiff","click a.assoc":"associateSample","click a.dd":a.signHandler},showPlot:function(e){e.preventDefault(),app.dialog.show(new DialogView({title:"1D Plot",view:new i({parent:this.model}),autoSize:!0}))},showDiff:function(e){e.preventDefault(),this.$el.find(".diffraction a").eq(0).trigger("click")}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(7),i(236),i(41),i(11),i(8),i(23),i(42),i(760)],void 0===(a=function(e,t,i,s,a,l){var o=e.Collection.extend({});return t.ItemView.extend({template:!1,model:i,modelEvents:{change:"render"},events:{plotselected:"zoom","dblclick canvas":"reset",touchstart:"touchStart"},touchStart:function(e){if(!(e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(e.preventDefault(),e.originalEvent.touches&&e.originalEvent.touches.length)){if(this.lastClick&&new Date-this.lastClick<1e3)return void this.reset(e);this.lastClick=new Date}},reset:function(e){this.zoom(e,{xaxis:{from:null,to:null},yaxis:{from:null,to:null}})},zoom:function(e,t){if(t.xaxis){var i=this.plot.getOptions();n.each(i.xaxes,(function(e){e.min=t.xaxis.from,e.max=t.xaxis.to})),n.each(i.yaxes,(function(e){e.min=t.yaxis.from,e.max=t.yaxis.to})),this.plot.setupGrid(),this.plot.draw(),this.plot.clearSelection()}},initialize:function(e){this.lastClick=null;var t=e.parent;this.models=new o,this.listenTo(this.models,"add",this.render),t.get("BLSAMPLEID")&&(this.dcs=new s(null,{running:!1}),this.dcs.queryParams.sid=t.get("BLSAMPLEID"),this.listenTo(this.dcs,"sync",this.updatePrevious,this),this.dcs.fetch(),this.$el.addClass("loading")),this.model=new i({id:t.get("ID"),pm:t}),this.model.fetch().done(this.addRoot.bind(this)),this.$el.css("opacity",0)},addRoot:function(){this.models.add(this.model)},updatePrevious:function(){console.log("dcs",this.dcs);var e=[];this.dcs.each((function(t){var n=this,s=new i({id:t.get("ID"),pm:t});s.stop(),e.push(s.fetch().done((function(){n.models.add(s)})))}),this);var t=this;l.when.apply(l,e).done((function(){t.$el.removeClass("loading")}))},onRender:function(){if(this.model.get("data")){var e=l.extend({},a.default_plot,{series:{lines:{show:!0},points:{show:!1}},selection:{mode:"xy"},xaxes:[{axisLabel:"2Theta"}],yaxes:[{axisLabel:"Intensity"}]}),t=[];this.models.each((function(e){var i={data:e.get("data")[0],label:e.get("start")};t.push(i)})),this.plot=l.plot(this.$el,t,e),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop(),this.plot&&this.plot.shutdown()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data">\n    <h1 class="title"></h1>\n\n    <div class="distl"></div>\n    <div class="diffraction" title="Click to view diffraction image">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1/n/4"><img dsrc="" alt="Diffraction Image 1" /></a>\n    </div>\n    <div class="snapshots" title="View sample snapshots for the current data collection">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot 1"><img dsrc="" alt="Crystal Snapshot 1" /></a>\n    </div>\n    \n    <div class="links">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><i class="fa fa-picture-o fa-2x"></i> Images</a> \n        <a class="sn" href="#snapshots"><i class="fa fa-camera fa-2x"></i> Snapshots</a> \n        <a class="dl" href="#distl"><i class="fa fa-bar-chart-o fa-2x"></i> Data Plot</a>\n    </div>\n    \n    <ul class="clearfix">\n        <li>Wavelength: '+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Detector Distance: "+(null==(__t=parseFloat(DET).toFixed(1))?"":_.escape(__t))+"mm</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+'&mu;m</li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+="<li>Status: <b>Stopped</b></li>"),__p+='\n    </ul>\n    \n    <div class="holder">\n        <h1 title="Download Data">Data Files <span class="r"><i class="fa fa-download"></i> <a class="dd" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/dc/id/"+(null==(__t=ID)?"":_.escape(__t))+'" title="Download files">Download</a></span></h1>\n    </div>\n</div>';return __p}},function(e,t,i){var n,s;n=[i(116),i(77),i(763),i(153)],void 0===(s=function(e,t,i,n){var s=t.extend({dcViews:{data:i}});return e.extend({dcListView:s,template:n})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(92),i(764),i(11),i(765)],void 0===(s=function(e,t,i,n){return e.extend({template:n,plotView:t,events:{"click .diffraction":"showDiff","click a.dd":i.signHandler},showDiff:function(e){e.preventDefault(),this.$el.find(".diffraction a").eq(0).trigger("click")}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(236),i(11),i(8),i(23),i(42)],void 0===(s=function(e,t,i,n){return e.ItemView.extend({template:!1,model:t,modelEvents:{change:"render"},initialize:function(e){var n=e.parent,s=i._date_to_unix(n.get("ST"));this.model=new t({id:n.get("ID"),timestamp:s}),this.model.fetch(),this.$el.css("opacity",0)},onRender:function(){if(this.model.get("data")){var e=n.extend({},i.default_plot,{series:{lines:{show:!0},points:{show:!1}}});this.plot=n.plot(this.$el,this.model.get("data"),e),this.$el.css("opacity",1)}},onDestroy:function(){this.model.stop(),this.plot&&this.plot.shutdown()}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data">\n    <h1 class="title"></h1>\n\n    <div class="distl"></div>\n    <div class="diffraction" title="Click to view diffraction image">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1/n/4"><img dsrc="" alt="Diffraction Image 1" /></a>\n    </div>\n    <div class="snapshots" title="View sample snapshots for the current data collection">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot 1"><img dsrc="" alt="Crystal Snapshot 1" /></a>\n    </div>\n    \n    <div class="links">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><i class="fa fa-picture-o fa-2x"></i> Images</a> \n        <a class="sn" href="#snapshots"><i class="fa fa-camera fa-2x"></i> Snapshots</a> \n        <a class="dl" href="#distl"><i class="fa fa-bar-chart-o fa-2x"></i> Data Plot</a>\n    </div>\n    \n    <ul class="clearfix">\n        <li>Wavelength: '+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Detector Distance: "+(null==(__t=parseFloat(DET).toFixed(1))?"":_.escape(__t))+"mm</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Resolution: "+(null==(__t=RESOLUTION)?"":_.escape(__t))+"&#197;</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+'&mu;m</li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+="<li>Status: <b>Stopped</b></li>"),__p+='\n    </ul>\n    \n    <div class="holder">\n        <h1 title="Download Data">Data Files <span class="r"><i class="fa fa-download"></i> <a class="dd" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/dc/id/"+(null==(__t=ID)?"":_.escape(__t))+'" title="Download files">Download</a></span></h1>\n    </div>\n</div>';return __p}},function(e,t,i){var n,s;n=[i(73),i(77),i(767),i(772)],void 0===(s=function(e,t,i,n){var s=t.extend({dcViews:{data:i}});return e.extend({dcListView:s,template:n,filters:!1,sampleChanger:!1})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(92),i(235),i(768),i(11),i(771)],void 0===(s=function(e,t,i,n,s){return e.extend({template:s,plotView:t,events:{"click .holder h1.ap":"loadAP","click .distl":"showPlot","click .diffraction":"showDiff","click .atp":"addToProject","click .flag":"flag","click .comments":"showComments","click a.dl":"showPlot","click a.sn":"showSnapshots","click a.dd":n.signHandler},showDiff:function(e){e.preventDefault(),this.$el.find(".diffraction a").eq(0).trigger("click")},loadAP:function(e){this.ap?this.ap.$el.slideToggle():this.ap=new i({id:this.model.get("ID"),el:this.$el.find("div.autoproc")})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(196),i(769),i(311),i(198),i(12),i(15)],void 0===(s=function(e,t,i,n,s,a){return e.extend({events:{"click a.apattach":"showAttachments"},showAttachments:function(e){e.preventDefault(),this.attachments=new i,this.attachments.url="/download/zocalo/ap/attachments",this.attachments.queryParams.AUTOPROCPROGRAMID=e.target.getAttribute("data-aid"),this.attachments.fetch(),app.dialog.show(new DialogView({title:"Auto Processing Attachments: "+e.target.getAttribute("data-program"),view:new n({collection:this.attachments}),autosize:!0}))},initialize:function(e){this.collection=new t(null,{id:e.id}),this.collection.fetch().done(this.render.bind(this))},onRender:function(){this.update(),this.listenTo(this.collection,"sync",this.update,this),this.summary.show(new s({className:"ui-tabs-panel ui-widget-content",tableClass:"reflow procsummary",noTableHolder:!0,collection:this.collection,columns:[{name:"DISPLAYNAME",label:"Name",cell:a.TemplateCell,editable:!1,template:"<%-DISPLAYNAME%>",test:"DISPLAYNAME"},{name:"COMMENT",label:"Comments",cell:a.TemplateCell,editable:!1,template:"<%-COMMENTS%>",test:"COMMENTS"},{name:"PROCESSINGPROGRAMS",label:"Processing Programs",cell:a.TemplateCell,editable:!1,template:"<%-AUTOPROCPROGRAM.PROCESSINGPROGRAMS%>",test:"PROCESSINGPROGRAMS"},{name:"PROCESSINGMESSAGE",label:"Processing Message",cell:a.TemplateCell,editable:!1,template:"<%-AUTOPROCPROGRAM.PROCESSINGMESSAGE%>",test:"PROCESSINGMESSAGE"},{name:"PROCESSINGSTARTTIME",label:"Processing Start Time",cell:a.TemplateCell,editable:!1,template:"<%-AUTOPROCPROGRAM.PROCESSINGSTARTTIME%>",test:"PROCESSINGSTARTTIME"},{name:"PROCESSINGENDTIME",label:"Processing End Time",cell:a.TemplateCell,editable:!1,template:"<%-AUTOPROCPROGRAM.PROCESSINGENDTIME%>",test:"PROCESSINGENDTIME"},{name:"ATTACHMENTS",label:"Logs/Files",cell:a.TemplateCell,editable:!1,template:"<a href='#' data-aid='<%-AUTOPROCPROGRAM.AID%>' data-program='<%-AUTOPROCPROGRAM.PROCESSINGPROGRAMS%>' class='apattach'>Logs/Files</a>",test:"ATTACHMENTS"}],pages:!1,backgrid:{emptyText:"No auto processing available for this data collection"}})),this.$el.slideDown()},update:function(){if(!this.timer_active){var e=this;setInterval((function(){e.collection.fetch()}),5e3),this.timer_active=!0}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(5),i(6),i(770)],void 0===(s=function(e,t,i){return t.Collection.extend({model:i,url:function(){return"/dc/ap/zocalo/"+this.id},initialize:function(e,t){this.id=t.id},parse:function(t,i){var n=[];return e.each(t,(function(e,t){e.DCID=this.id,n.push(e)}),this),n}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="data_collection" dcid="'+(null==(__t=ID)?"":_.escape(__t))+'" type="data">\n    <h1 class="title"></h1>\n\n    <div class="distl"></div>\n    <div class="diffraction" title="Click to view diffraction image">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1/n/4"><img dsrc="" alt="Diffraction Image 1" /></a>\n    </div>\n    <div class="snapshots" title="View sample snapshots for the current data collection">\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/image/id/"+(null==(__t=ID)?"":_.escape(__t))+'/f/1" title="Crystal Snapshot 1"><img dsrc="" alt="Crystal Snapshot 1" /></a>\n    </div>\n    \n    <div class="links">\n        <a href="/dc/view/id/'+(null==(__t=ID)?"":_.escape(__t))+'"><i class="fa fa-picture-o fa-2x"></i> Images</a> \n        <a class="sn" href="#snapshots"><i class="fa fa-camera fa-2x"></i> Snapshots</a> \n        <a class="dl" href="#distl"><i class="fa fa-bar-chart-o fa-2x"></i> Data Plot</a>\n    </div>\n    \n    <ul class="clearfix">\n        <li>Beam Centre: '+(null==(__t=parseFloat(XBEAM).toFixed(2))?"":_.escape(__t))+" x "+(null==(__t=parseFloat(YBEAM).toFixed(2))?"":_.escape(__t))+"</li>\n        <li>Wavelength: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n        <li>Detector Distance: "+(null==(__t=parseFloat(DET).toFixed(1))?"":_.escape(__t))+"mm</li>\n        <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n        <li>Beamsize: "+(null==(__t=BSX)?"":_.escape(__t))+"x"+(null==(__t=BSY)?"":_.escape(__t))+"&mu;m</li>\n        <li>No. Images: "+(null==(__t=NUMIMG)?"":_.escape(__t))+"</li>\n       <li>Detector: "+(null==(__t=DETECTORMANUFACTURER)?"":_.escape(__t))+" "+(null==(__t=DETECTORMODEL)?"":_.escape(__t))+'</li>\n        \n        <li class="comment" title="Click to edit the comment for this data collection">Comment: <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+"</span></li>\n        ",STATE||(__p+="<li>Status: <b>Stopped</b></li>"),__p+='\n    </ul>\n    \n    <div class="holder">\n        <h1 title="Download Data">Data Files <span class="r"><i class="fa fa-download"></i> <a class="dd" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/download/dc/id/"+(null==(__t=ID)?"":_.escape(__t))+'" title="Download files">Download</a></span></h1>\n        <h1 title="Click to show autoprocessing details" class="ap">Auto Processing<span><i class="fa"></i></span></h1>\n        <div class="autoproc"></div>\n    </div>\n</div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1 class="no_mobile">\n        <div class="usage r"></div>\n        Data Collections\n        ',IS_VISIT&&(__p+="for "+(null==(__t=VISIT)?"":_.escape(__t))+" on "+(null==(__t=BEAMLINENAME)?"":_.escape(__t))),__p+="\n    </h1>\n\n    ",IS_VISIT&&!IS_SINGLE&&(__p+='\n    <div>\n        <a class="button"  href="/stats/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Visit Statistics"><i class="fa fa-pie-chart"></i> <span>Visit Stats</span></a>\n        <a class="button"  href="/containers/add/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" title="Create Instances"><i class="fa fa-plus"></i> <span>Create Instances</span></a>\n    </div>\n    '),__p+="\n\n    ",(IS_SINGLE||IS_DCG)&&(__p+='\n    <h1 class="message nou"><a class="button" href="/dc',IS_VISIT&&(__p+="/visit/"+(null==(__t=VISIT)?"":_.escape(__t))),__p+='">View All Data\n    Collections</a></h1>\n    '),__p+="\n\n    ",IS_DCG&&(__p+="<h2>Data Collection Group</h2>"),__p+="\n    ",IS_PJ&&(__p+="<h2>Processing Job</h2>"),__p+='\n\n    <div class="st"></div>\n    <div class="lg"></div>\n\n    <div class="srch clearfix"></div>\n\n    <div class="page_wrap one"></div>    \n    <div class="data_collections"></div>\n    <div class="page_wrap two"></div>\n    ';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="nav">\n    <a href="#" class="previous"><i class="fa fa-angle-left"></i></a>\n    <a href="#" class="next"><i class="fa fa-angle-right"></i></a>\n</div>\n<div class="columns"></div>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="columns"></div>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Sample Details</h1>\n\n<p class="help">This pages shows details and history for the selected sample</p>\n\n<div class="form">\n    <ul>\n\n        ',PARENTSAMPLEID&&(__p+='\n        <li>\n            <span class="label">Parent</span>\n            <span>'+(null==(__t=PARENTSAMPLE)?"":_.escape(__t))+' <a href="/samples/sid/'+(null==(__t=PARENTSAMPLEID)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> View</a></span>\n        </li>\n        '),__p+='\n        \n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Protein Acronym</span>\n            <span class="ACRONYM">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</span> \n            <a href="/proteins/pid/'+(null==(__t=PROTEINID)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> View All</a>\n        </li>\n\n        <li>\n            <span class="label">User Path</span>\n            <span class="USERPATH">'+(null==(__t=USERPATH)?"":_.escape(__t))+'</span> \n        </li>\n\n        <li>\n            <span class="label">Abundance</span>\n            <span class="ABUNDANCE">'+(null==(__t=ABUNDANCE)?"":_.escape(__t))+"</span>"+(null==(__t=SYMBOL)?"":_.escape(__t))+'\n        </li>\n\n        <li class="clearfix">\n            <span class="label">Components\n                <br /><span class="small">Add: <input type="text" name="COMPONENTID" /></span>\n            </span>\n            <span class="components floated"></span>\n        </li>\n        \n        <li>\n            <span class="label">Volume</span>\n            <span class="VOLUME">'+(null==(__t=VOLUME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Spacegroup</span>\n            <span class="SPACEGROUP">'+(null==(__t=SPACEGROUP)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix reorder">\n            <div class="text_table table">\n                <table class="reflow cell">      \n                    <thead>            \n                        <tr>\n                            <th>A</th>\n                            <th>B</th>\n                            <th>C</th>\n                            <th>&alpha;</th>\n                            <th>&beta;</th>\n                            <th>&gamma;</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>                                \n                            <td><span class="CELL_A">'+(null==(__t=CELL_A)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_B">'+(null==(__t=CELL_B)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_C">'+(null==(__t=CELL_C)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_ALPHA">'+(null==(__t=CELL_ALPHA)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_BETA">'+(null==(__t=CELL_BETA)?"":_.escape(__t))+'</span></td> \n                            <td><span class="CELL_GAMMA">'+(null==(__t=CELL_GAMMA)?"":_.escape(__t))+'</span></td>\n                        </tr> \n                    </tbody>    \n                </table>\n            </div>\n            <span class="label">Unit Cell</span>\n        </li>\n\n        <li>\n            <span class="label">Anomalous Scatterer</span>\n            <span class="ANOMALOUSSCATTERER">'+(null==(__t=ANOMALOUSSCATTERER)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Required Resolution</span>\n            <span class="REQUIREDRESOLUTION">'+(null==(__t=REQUIREDRESOLUTION)?"":_.escape(__t))+'</span>\n        </li>\n    \n\n        <li>\n            <span class="label">Comment</span>\n            <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Barcode</span>\n            <span class="CODE">'+(null==(__t=CODE)?"":_.escape(__t))+"</span>\n        </li>\n        \n        ",CONTAINERID&&(__p+='\n        <li>\n            <span class="label">Container</span>\n            <span class="cont"><a href="/containers/cid/'+(null==(__t=CONTAINERID)?"":_.escape(__t))+'">'+(null==(__t=CONTAINER)?"":_.escape(__t))+"</a></span>\n        </li>\n        "),__p+="\n        \n        ",DEWAR&&(__p+='\n        <li>\n            <span class="label">Dewar</span>\n            <span class="dew">'+(null==(__t=DEWAR)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+="\n        \n        ",SHIPPINGID&&(__p+='\n        <li>\n            <span class="label">Shipment</span>\n            <span class="ship"><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+"</a></span>\n        </li>\n        "),__p+='\n        \n        <li>\n            <span class="label">Snapshots</span>\n            <span class="snapshots sample"></span>\n        </li>\n\n        ',INSPECTIONS>0&&(__p+='\n        <li class="clearfix reorder">\n            <div class="text im_history"></div>\n            <span class="label">Inspections</span>\n        </li>\n        '),__p+="\n\n        ",CONTAINERQUEUEID&&(__p+='\n        <li>\n            <span class="label">Auto Collect Queued</span>\n            <span>'+(null==(__t=QUEUEDTIMESTAMP)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Centring Method</span>\n            <span class="CENTRINGMETHOD">'+(null==(__t=CENTRINGMETHOD)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Experiment Kind</span>\n            <span class="EXPERIMENTKIND">'+(null==(__t=EXPERIMENTKINDNAME)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Energy (eV)</span>\n            <span class="ENERGY">'+(null==(__t=ENERGY)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Radiation Sensitivity Kind</span>\n            <span class="RADIATIONSENSITIVITY">'+(null==(__t=RADIATIONSENSITIVITYNAME)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+='\n        \n    </ul>\n</div>\n\n<h1>Sub Samples</h1>\n<div class="subsamples"></div>\n<div class="history"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(130),i(15)],void 0===(s=function(e,t){return e.extend({filters:[{id:"DC",name:"Data Collected"}],columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"ACRONYM",label:"Component",cell:"string",editable:!1},{name:"COMPONENTACRONYMS",label:"Components",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1},{name:"SHIPMENT",label:"Shipment",cell:"string",editable:!1},{name:"DEWAR",label:"Dewar",cell:"string",editable:!1},{name:"CONTAINER",label:"Container",cell:"string",editable:!1},{label:"Snapshot",cell:e.SnapshotCell,editable:!1},{label:"Status",cell:e.StatusCell,editable:!1},{label:" ",cell:t.ProjectCell,itemname:"NAME",itemid:"BLSAMPLEID",itemtype:"sample",editable:!1}],hiddenColumns:[2,3,4,5,6,7,9]})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(301),i(778)],void 0===(s=function(e,t){return e.extend({template:t})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Sample Details</h1>\n\n<p class="help">This pages shows details and history for the selected sample</p>\n\n<div class="form">\n    <ul>\n\n        ',PARENTSAMPLEID&&(__p+='\n        <li>\n            <span class="label">Parent</span>\n            <span>'+(null==(__t=PARENTSAMPLE)?"":_.escape(__t))+' <a href="/samples/sid/'+(null==(__t=PARENTSAMPLEID)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> View</a></span>\n        </li>\n        '),__p+='\n        \n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Component Acronym</span>\n            <span class="ACRONYM">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</span> <a href="/proteins/pid/'+(null==(__t=PROTEINID)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> View All</a>\n        </li>\n\n        <li class="clearfix">\n            <span class="label">Components\n                <br /><span class="small">Add: <input type="text" name="COMPONENTID" /></span>\n            </span>\n            <span class="components floated"></span>\n        </li>\n        \n        <li>\n            <span class="label">Spacegroup</span>\n            <span class="SPACEGROUP">'+(null==(__t=SPACEGROUP)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix reorder">\n            <div class="text_table table">\n                <table class="reflow cell">      \n                    <thead>            \n                        <tr>\n                            <th>A</th>\n                            <th>B</th>\n                            <th>C</th>\n                            <th>&alpha;</th>\n                            <th>&beta;</th>\n                            <th>&gamma;</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>                                \n                            <td><span class="CELL_A">'+(null==(__t=CELL_A)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_B">'+(null==(__t=CELL_B)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_C">'+(null==(__t=CELL_C)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_ALPHA">'+(null==(__t=CELL_ALPHA)?"":_.escape(__t))+'</span></td>\n                            <td><span class="CELL_BETA">'+(null==(__t=CELL_BETA)?"":_.escape(__t))+'</span></td> \n                            <td><span class="CELL_GAMMA">'+(null==(__t=CELL_GAMMA)?"":_.escape(__t))+'</span></td>\n                        </tr> \n                    </tbody>    \n                </table>\n            </div>\n            <span class="label">Unit Cell</span>\n        </li>\n\n        \x3c!-- <li>\n            <span class="label">Anomalous Scatterer</span>\n            <span class="ANOMALOUSSCATTERER">'+(null==(__t=ANOMALOUSSCATTERER)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Required Resolution</span>\n            <span class="REQUIREDRESOLUTION">'+(null==(__t=REQUIREDRESOLUTION)?"":_.escape(__t))+'</span>\n        </li> --\x3e\n    \n\n        <li>\n            <span class="label">Comment</span>\n            <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</span>\n        </li>\n\n        \x3c!-- <li>\n            <span class="label">Barcode</span>\n            <span class="CODE">'+(null==(__t=CODE)?"":_.escape(__t))+"</span>\n        </li> --\x3e\n        \n        ",CONTAINERID&&(__p+='\n        <li>\n            <span class="label">Container</span>\n            <span class="cont"><a href="/containers/cid/'+(null==(__t=CONTAINERID)?"":_.escape(__t))+'">'+(null==(__t=CONTAINER)?"":_.escape(__t))+"</a></span>\n        </li>\n        "),__p+="\n        \n        ",DEWAR&&(__p+='\n        <li>\n            <span class="label">Dewar</span>\n            <span class="dew">'+(null==(__t=DEWAR)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+="\n        \n        ",SHIPPINGID&&(__p+='\n        <li>\n            <span class="label">Shipment</span>\n            <span class="ship"><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+"</a></span>\n        </li>\n        "),__p+='\n        \n        <li>\n            <span class="label">Snapshots</span>\n            <span class="snapshots sample"></span>\n        </li>\n\n        ',INSPECTIONS>0&&(__p+='\n        <li class="clearfix reorder">\n            <div class="text im_history"></div>\n            <span class="label">Inspections</span>\n        </li>\n        '),__p+='\n        \n    </ul>\n</div>\n\n<h1>Sub Samples</h1>\n<div class="subsamples"></div>\n\n<div class="history"></div>';return __p}},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"COMPONENTTYPEID",urlRoot:"/sample/componenttype",validation:{NAME:{required:!1,pattern:"wwsbdash"}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>"+(null==(__t=title)?"":_.escape(__t))+'s</h1>\n<p class="help">This page lists all '+(null==(__t=title.toLowerCase())?"":_.escape(__t))+"s associated with the currently selected proposal. Approved samples are highlighted in colour.</p>\n\n",CAN_CREATE||(__p+='\n<p class="help">Only staff are able to create new '+(null==(__t=title.toLowerCase())?"":_.escape(__t))+"s from this page. Samples should be created in the user office system and when approved will be displayed here. Approved samples can be cloned by following the links in the table below.</p>\n"),__p+='\n\n<div class="ra">\n',CAN_CREATE&&(__p+='\n    <a class="button" href="/'+(null==(__t=url)?"":_.escape(__t))+'s/add"><i class="fa fa-plus"></i> Add '+(null==(__t=title)?"":_.escape(__t))+"</a>\n"),__p+='\n</div>\n\n<div class="filter type"></div>\n\n<div class="wrapper"></div>\n';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7)],void 0===(a=function(e){var t=e.ItemView.extend({template:n.template('<%-NAME%> <% if (CODE) { %>[CODE]<% } else { %>[File]<% } %> <span class="r"><a class="button button-notext delete" href="#"><i class="fa fa-times"></i> <span>Delete</span></a></span>'),tagName:"li",events:{"click a.delete":"deleteUser"},deleteUser:function(e){this.model.destroy()}}),i=e.ItemView.extend({template:n.template("No PDBs registered to this protein"),tagName:"li"});return e.CollectionView.extend({tagName:"ul",className:"visits clearfix",childView:t,emptyView:i})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="form">\n    <ul>\n        <li>\n            <label>Type:</label>\n            <span>\n                <select name="type">\n                    <option value="pdb_file">File</option>\n                    <option value="pdb_code">Code</option>\n                    <option value="existing_pdb">Existing PDB</option>\n                </select>\n            </span>\n        </li>\n        <li class="ty pdb_file">\n            <label>File:</label>\n            <span class="file">\n                <input type="file" name="pdb_file" />\n            </span>\n        </li>\n        \n        <li class="ty pdb_code">\n            <label>PDB Code:</label>\n            <span>\n                <input type="text" name="pdb_code" />\n            </span>\n        </li>\n        \n        <li class="ty existing_pdb">\n            <label>Existing PDB:</label>\n            <span>\n                <select name="existing_pdb"></select>\n            </span>\n        </li>\n    </ul>\n    <div class="progress"></div>\n</div>';return __p}},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"CONCENTRATIONTYPEID",urlRoot:"/sample/concentrationtype",validation:{NAME:{required:!0},SYMBOL:{required:!0}}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>View Protein</h1>\n\n<p class="help">This page shows details for the selected protein and a list of samples which make use of it</p>\n\n\x3c!-- Only allow cloning for valid/approved proteins --\x3e\n',1==EXTERNAL&&(__p+='\n    <a class="button" href="/proteins/pid/'+(null==(__t=PROTEINID)?"":_.escape(__t))+'/clone">Clone Protein</a>\n'),__p+='\n\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Acronym</span>\n            <span class="ACRONYM">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Molecular Mass</span>\n            <span class="MOLECULARMASS">'+(null==(__t=MOLECULARMASS)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix reorder">\n            <div class="SEQUENCE seq text">'+(null==(__t=SEQUENCEMD)?"":__t)+'</div>\n            <span class="label">Sequence</span>\n        </li>\n        \n        <li>\n            <span class="label">Component Type</span>\n            <span class="COMPONENTTYPEID">'+(null==(__t=COMPONENTTYPE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Concentration Unit</span>\n            <span class="CONCENTRATIONTYPEID">'+(null==(__t=CONCENTRATIONTYPE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Global</span>\n            <span class="GLOBAL">'+(null==(__t=1==GLOBAL?"Yes":"No")?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li class="clearfix">\n            <span class="label">\n                Associated PDB Files<br />\n                <a href="#" class="button add"><i class="fa fa-plus"></i> Add PDB File</a>\n            </span>\n            <span class="pdb floated">\n                <ul class="visits clearfix"></ul>\n            </span>\n        </li>\n        \n    </ul>\n    \n</div>\n\n<div class="conts"></div>\n<div class="samples"></div>\n<div class="datacollections"></div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>New Protein</h1>\n\n",IS_CLONE&&(__p+='\n    <p class="help">This is a clone of a protein</p>\n'),__p+='\n\n<form method="post" id="add_protein" enctype="multipart/form-data">\n    \n    <div class="form">\n        <ul>\n            \n            <li>\n                <label>Name\n                    <span class="small">Name of the protein</span>\n                </label>\n                <span class="name">\n                    ',IS_CLONE?__p+='\n                        <input type="text" name="NAME" disabled>\n                    ':__p+='\n                        <input type="text" name="NAME" />\n                    ',__p+='\n                </span>\n            </li>\n            \n            <li>\n                <label>Acronym\n                    <span class="small">Short form of the protein name</span>\n                </label>\n                <span class="acronym"><input type="text" name="ACRONYM" required /></span>\n            </li>\n            \n            \n            <li>\n                <label>Molecular Mass\n                    <span class="small">Mass of the protein in daltons</span>\n                </label>\n                <span class="MASS"><input type="text" name="MOLECULARMASS" /></span>\n            </li>\n            \n            <li>\n                <label>Sequence\n                    <span class="small">Used to automatically run MrBump</span>\n                </label>\n                <span class="seq"><textarea name="SEQUENCE" ></textarea></span>\n            </li>\n\n            <li>\n                <label>Type\n                    <span class="small">Component Type</span>\n                </label>\n                <select name="COMPONENTTYPEID"></select>\n            </li>\n\n            \x3c!--<li>\n                <label>Sub Type\n                    <span class="small">Component Sub Type</span>\n                </label>\n                <select name="COMPONENTSUBTYPEID"></select>\n            </li>--\x3e\n\n            <li>\n                <label>Concentration Unit\n                    <span class="small">Unit used for measuring concentration</span>\n                </label>\n                <select name="CONCENTRATIONTYPEID"></select>\n            </li>\n\n            <li>\n                <label>Concentration\n                    <span class="small">Concentration of component</span>\n                </label>\n                <span class="acronym"><input type="text" name="ABUNDANCE" required /></span>\n            </li>\n\n            ',IS_STAFF&&(__p+='\n            <li>\n                <label>Global\n                    <span class="small">Make this component visible to all users</span>\n                </label>\n                <select name="GLOBAL">\n                    <option value="0" selected="selected">No</option>\n                    <option value="1">Yes</option>\n                </select>\n            </li>\n            '),__p+='\n            \n            <li>\n                <label>PDB File</label>\n                <span>PDB files can be added on the next page</span>\n            </li>\n        </ul>\n        \n        <button name="submit" value="1" type="submit" class="button submit">Add Protein</button>\n    </div>\n    \n</form>';return __p}},function(e,t,i){var n,s;n=[i(154),i(15)],void 0===(s=function(e,t){return e.extend({title:"Component",columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"ACRONYM",label:"Acronym",cell:"string",editable:!1},{name:"MOLECULARMASS",label:"Mass",cell:"string",editable:!1},{name:"COMPONENTTYPE",label:"Type",cell:"string",editable:!1},{name:"SCOUNT",label:"Samples",cell:"string",editable:!1},{name:"DCOUNT",label:"Data Collections",cell:"string",editable:!1},{name:"SAFETYLEVEL",label:"Risk Rating",cell:t.SafetyCell,editable:!1},{name:" ",cell:t.ProjectCell,itemname:"ACRONYM",itemid:"PROTEINID",itemtype:"protein",editable:!1}],hiddenColumns:[2,3]})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(391),i(788)],void 0===(s=function(e,t){return e.extend({template:t})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Add Component</h1>\n\n<form method="post" id="add_protein" enctype="multipart/form-data">\n    \n    <div class="form">\n        <ul>\n            \n            <li>\n                <label>Name\n                    <span class="small">Name of the component</span>\n                </label>\n                <span class="name"><input type="text" name="NAME" /></span>\n            </li>\n            \n            <li>\n                <label>Acronym\n                    <span class="small">Short form of the component name</span>\n                </label>\n                <span class="acronym"><input type="text" name="ACRONYM" required /></span>\n            </li>\n            \n            \n            <li>\n                <label>Molecular Mass\n                    <span class="small">Mass of the component in daltons</span>\n                </label>\n                <span class="MASS"><input type="text" name="MOLECULARMASS" /></span>\n            </li>\n            \n            \x3c!-- <li>\n                <label>Sequence\n                    <span class="small">Used to automatically run MrBump</span>\n                </label>\n                <span class="seq"><textarea name="SEQUENCE" ></textarea></span>\n            </li> --\x3e\n\n            <li>\n                <label>Type\n                    <span class="small">Component Type</span>\n                </label>\n                <select name="COMPONENTTYPEID"></select>\n            </li>\n\n            \x3c!--<li>\n                <label>Sub Type\n                    <span class="small">Component Sub Type</span>\n                </label>\n                <select name="COMPONENTSUBTYPEID"></select>\n            </li>--\x3e\n\n            <li>\n                <label>Concentration Unit\n                    <span class="small">Unit used for measuring concentration</span>\n                </label>\n                <select name="CONCENTRATIONTYPEID"></select>\n            </li>\n\n            ',IS_STAFF&&(__p+='\n            <li>\n                <label>Global\n                    <span class="small">Make this component visible to all users</span>\n                </label>\n                <select name="GLOBAL">\n                    <option value="0" selected="selected">No</option>\n                    <option value="1">Yes</option>\n                </select>\n            </li>\n            '),__p+='\n            \n            <li>\n                <label>CIF File</label>\n                <span>CIF files can be added on the next page</span>\n            </li>\n        </ul>\n        \n        <button name="submit" value="1" type="submit" class="button submit">Add Component</button>\n    </div>\n    \n</form>';return __p}},function(e,t,i){var n,s;n=[i(387),i(790)],void 0===(s=function(e,t){return e.extend({template:t,showContainers:!1})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>View Component</h1>\n\n<p class="help">This page shows details for the selected component and a list of samples which make use of it</p>\n\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Acronym</span>\n            <span class="ACRONYM">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Molecular Mass</span>\n            <span class="MOLECULARMASS">'+(null==(__t=MOLECULARMASS)?"":_.escape(__t))+'</span>\n        </li>\n\n        \x3c!-- <li class="clearfix reorder">\n            <div class="SEQUENCE seq text">'+(null==(__t=SEQUENCEMD)?"":_.escape(__t))+'</div>\n            <span class="label">Sequence</span>\n        </li> --\x3e\n        \n        <li>\n            <span class="label">Component Type</span>\n            <span class="COMPONENTTYPEID">'+(null==(__t=COMPONENTTYPE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Concentration Unit</span>\n            <span class="CONCENTRATIONTYPEID">'+(null==(__t=CONCENTRATIONTYPE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Global</span>\n            <span class="GLOBAL">'+(null==(__t=1==GLOBAL?"Yes":"No")?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li class="clearfix">\n            <span class="label">\n                Associated CIF Files<br />\n                <a href="#" class="button add"><i class="fa fa-plus"></i> Add CIF File</a>\n            </span>\n            <span class="pdb floated">\n                <ul class="visits clearfix"></ul>\n            </span>\n        </li>\n        \n    </ul>\n    \n</div>\n\n<div class="conts"></div>\n<div class="samples"></div>\n<div class="datacollections"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(7),i(6),i(20),i(157),i(156),i(792),i(793),i(58),i(393),i(900)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c){return e.LayoutView.extend({className:"content",template:c,showContainers:!1,ui:{mass:".MOLECULARMASS"},regions:{cif:".cif",rsamples:".samples"},events:{"click a.add":"addCIF"},initialize:function(e){t.Validation.bind(this),this.listenTo(this.model,"change:SEQUENCE",this.updateMolecularMass),this.crystals=new n,this.crystals.queryParams.pid=this.model.get("PROTEINID"),this.crystals.queryParams.seq=1,this.crystals.state.addPrimary=!0,this.crystals.fetch(),this.cifs=new s(null,{pid:this.model.get("PROTEINID")}),this.getCIFs()},onRender:function(){var e=new i({model:this.model,el:this.$el});e.create("NAME","text"),e.create("SEQUENCE","text"),e.create("DENSITY","text"),this.rsamples.show(new r({collection:this.crystals,noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0,hideButton:!0})),this.cif.show(new a({collection:this.cifs}))},updateMolecularMass:function(){this.model.set("MOLECULARMASS",o.molecularMassFromComposition(this.model.get("SEQUENCE")));var e=this;this.model.save(this.model.changedAttributes(),{patch:!0,success:function(){e.ui.mass.text(e.model.get("MOLECULARMASS"))}})},addCIF:function(){var e=new l({pid:this.model.get("PROTEINID")});this.listenTo(e,"pdb:success",this.getCIFs),app.dialog.show(e)},getCIFs:function(){this.cifs.fetch()}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7)],void 0===(a=function(e){var t=e.ItemView.extend({template:n.template('<%-NAME%> <span class="r"><a class="button button-notext delete" href="#"><i class="fa fa-times"></i> <span>Delete</span></a></span>'),tagName:"li",events:{"click a.delete":"deleteCIF"},deleteCIF:function(e){this.model.destroy()}}),i=e.ItemView.extend({template:n.template("No CIFs registered to this phase"),tagName:"li"});return e.CollectionView.extend({tagName:"ul",className:"visits clearfix",childView:t,emptyView:i})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(389),i(794),i(795)],void 0===(s=function(e,t,i){return e.extend({template:i,title:"Add CIF to Phase",createModel:function(e){this.model=new t({PROTEINID:e.pid})}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(79)],void 0===(a=function(e,t){return e.Model.extend(n.extend({},{idAttribute:"PROTEINHASPDBID",urlRoot:"/sample/pdbs",validation:{pbd_file:function(e){if(e){var t=e.name.split(".");if("cif"!=t[t.length-1].toLowerCase())return"This file must be a CIF file"}}}},t))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="form">\n    <ul>\n        <li>\n            <label>Type:</label>\n            <span>\n                <select name="type">\n                    <option value="pdb_file">File</option>\n                </select>\n            </span>\n        </li>\n        \n        <li class="ty pdb_file">\n            <label>File:</label>\n            <span class="file">\n                <input type="file" name="pdb_file" />\n            </span>\n        \n        </li>\n    </ul>\n    <div class="progress"></div>\n</div>\n';return __p}},function(e,t,i){var n,s;n=[i(51),i(159),i(160),i(64),i(1255)],void 0===(s=function(e,t,i,n,s){return e.use(t),t.Validator.extend("closeExp",{getMessage:e=>e+" must have correctly closed brackets",validate:e=>{for(var t=0,i=0;i<e.length;i++)if("("===e.charAt(i))t++;else if(")"===e.charAt(i)){if(0===t)return!1;t--}return 0===t}}),n.extend({vueView:e.extend({template:'<section class="content"><h1>Simple Sample Wizard</h1><simplesample></simplesample></section>',components:{simplesample:s.default}})})}.apply(t,n))||(e.exports=s)},,,,,,,,function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return e.Model.extend({urlRoot:function(){return this.get("urlRoot")},sync:function(t,i,s){if("create"==t){var a=new FormData;n.each(i.attributes,(function(t,i){t instanceof e.Model||a.append(i,t)})),a.append("json",JSON.stringify(i)),n.defaults(s||(s={}),{data:a,processData:!1,contentType:!1})}return e.sync.call(this,t,i,s)}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(14)],void 0===(a=function(e,t){return e.Collection.extend(n.extend({},t,{capillaries:[{name:"Borosilicate 1mm OD",outer_diameter:1,inner_diameter:.78,wall_thickness:.11,length:40,sequence:"Si0.798B0.221Al0.023Na0.066K0.006O2",density:2.23},{name:"Borosilicate 1.5mm OD",outer_diameter:1.5,inner_diameter:1.17,wall_thickness:.165,length:40,sequence:"Si0.798B0.221Al0.023Na0.066K0.006O2",density:2.23},{name:"Borosilicate 2.0mm OD",outer_diameter:2,inner_diameter:1.56,wall_thickness:.22,length:40,sequence:"Si0.798B0.221Al0.023Na0.066K0.006O2",density:2.23},{name:"Fused Silica 0.4mm OD",outer_diameter:.4,inner_diameter:.3,wall_thickness:.05,length:50,sequence:"SiO2",density:2.203},{name:"Fused Silica 1.0mm OD",outer_diameter:1,inner_diameter:.8,wall_thickness:.1,length:50,sequence:"SiO2",density:2.203},{name:"Fused Silica 1.5mm OD",outer_diameter:1.5,inner_diameter:1.3,wall_thickness:.1,length:50,sequence:"SiO2",density:2.203},{name:"Fused Silica 2.5mm OD",outer_diameter:2.5,inner_diameter:2.3,wall_thickness:.1,length:50,sequence:"SiO2",density:2.203},{name:'Fused Silica 1/8" OD',outer_diameter:3.175,inner_diameter:2.95,wall_thickness:.11,length:60,sequence:"SiO2",density:2.203},{name:'Fused Silica 1/16" OD',outer_diameter:1.59,inner_diameter:1.39,wall_thickness:.11,length:60,sequence:"SiO2",density:2.203}]}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){var n,s;n=[i(51),i(64),i(896),i(46),i(58),i(898)],void 0===(s=function(e,t,i,n,s,a){var l=i.extend({data:function(){return{title:"Phases",headers:["Phase Name","Composition","Phase Fraction"],items:[]}},methods:{}});return t.extend({vueView:e.extend({template:a,data:function(){return{acronym:"",seq:"",mass:"",type:"",name:"",composition:"",density:""}},methods:{updateMolecularMass:function(){this.model.set("MOLECULARMASS",s.molecularMassFromComposition(this.ui.seq.val())),this.ui.mass.val(this.model.get("MOLECULARMASS"))},onsubmit:function(){}},components:{"vue-table":l},el:"#table"})})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(51),i(64),i(897)],void 0===(s=function(e,t,i){return e.component("vue-table",{template:i,data:function(){return{title:"",headers:[],items:[]}},methods:{}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table style="border: 1px solid">\n    <tr>\n        <td v-bind:colspan="headers.length" style="border: 1px solid" v-if="title != \'\'">{{ title }}</td>\n    </tr>\n    <tr>\n        <td style="border: 1px solid" v-for="header in headers">{{ header }}</td>\n    </tr>\n    <tr>\n        <td style="border: 1px solid" v-for="item in items">{{ item }}</td>\n    </tr>\n</table>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div>\n    <h1>Advanced Sample Wizard</h1>\n    <form method="post" id="add_protein">\n\n        <div class="form">\n\n            <ul>\n\n                <li>\n                    <label>Name\n                    <span class="small">Name of the sample</span></label>\n                    <span class="name"><input type="text" name="NAME" /></span>\n                </li>\n\n                <div id="table">\n                    <vue-table></vue-table>\n                </div>\n\n                <li>\n                    <label>Calculated Composition\n                    <span class="small">Chemical formula of the material</span></label>\n                    <span class="composition"><input type="text" name="SEQUENCE" /></span>              \n                </li>\n\n                <div style="text-align: right; border:1px solid">\n                    <ul>\n                        <li>\n                            <span>\n                                <select style="width: 500px">\n                                    <option>Shape</option>\n                                </select>\n                            </span>\n                        </li>\n                        <li>\n                            <label style="text-align: right; margin-right:0px">Dimension 1</label>\n                            <span><input type="text" name="DENSITY" /></span>\n                        </li>\n                        <li>\n                            <label>Dimension 2</label>\n                            <span><input type="text" name="DENSITY" /></span>\n                        </li>\n                        <li>\n                            <label>Dimension 3</label>\n                            <span><input type="text" name="DENSITY" /></span>\n                        </li>\n                    </ul>\n                </div>\n\n                <li>\n                    <span>\n                        <select>\n                            <option>Container</option>\n                        </select>\n                    </span>\n                </li>\n\n                <li>\n                    <span>\n                        <select>\n                            <option>ERA*</option>\n                        </select>\n                    </span>\n                </li>\n\n            </ul>\n\n            \n            \n            <input class="acronym" type="hidden" name="ACRONYM" />\n            <button class="button" name="cancel"><i class="fa"></i>Cancel</button>\n            <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i>Add</button>\n\n        </div>\n\n    </form>\n</div>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Samples</h1>\n<p class="help">This page shows the samples associated with the current '+(null==(__t=TYPE)?"":_.escape(__t))+'</p>\n<div class="ra">\n\t<a class="button addSimpleSample" href="#"><i class="fa fa-plus"></i> New Simple Sample</a>\n\t\x3c!--<a class="button addAdvancedSample" href="#"><i class="fa fa-plus"></i> New Advanced Sample</a>--\x3e\n\t<a class="button new" href="/xsamples/add"><i class="fa fa-plus"></i> New Sample</a>\n</div>\n\n<div class="samples"></div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>View Phase</h1>\n<p class="help">This page shows the details of a phase</p>\n\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Composition</span>\n            <span class="SEQUENCE">'+(null==(__t=SEQUENCE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Density</span>\n            <span class="DENSITY">'+(null==(__t=DENSITY)?"":_.escape(__t))+'</span> g cm<span class="super">-3</span>\n        </li>\n\n        <li>\n            <span class="label">Molecular Mass</span>\n            <span class="MOLECULARMASS">'+(null==(__t=MOLECULARMASS)?"":_.escape(__t))+'</span> a.m.u.\n        </li>\n\n        <li class="clearfix">\n            <span class="label">\n                Associated CIF Files<br />\n                <a href="#" class="button add"><i class="fa fa-plus"></i> Add CIF File</a>\n            </span>\n            <span class="cif floated">\n                <ul class="visits clearfix"></ul>\n            </span>\n        </li>\n    </ul>\n</div> \n\n<div class="samples"></div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Add Phase</h1>\n<form method="post" id="add_protein">\n\n    <div class="form">\n\n        <ul>\n\n            <li>\n                <label>Name\n                <span class="small">Name of the phase</span></label>\n                <span class="name"><input type="text" name="NAME" /></span>\n            </li>\n\n            <li>\n                <label>Composition\n                <span class="small">Chemical formula of the material</span></label>\n                <span class="composition"><input type="text" name="SEQUENCE" /></span>              \n            </li>\n\n            <li>\n                <label>Molecular Mass</label>\n                <span><input type="text" name="MOLECULARMASS" disabled="disabled" />  a.m.u.</span>\n            </li>\n            \n            <li>\n                <label>Density\n                <span class="small">Crystallographic density of the phase (g cm<span class="super">-3</span>)</span></label>\n                <span><input type="text" name="DENSITY" /></span>\n            </li>\n\n        </ul>\n        \n        <input class="acronym" type="hidden" name="ACRONYM" />\n        <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Phase</button>\n\n    </div>\n\n</form>\n';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(40),i(20),i(252),i(416),i(58),i(904)],void 0===(a=function(e,t,i,s,a,l,o,r){return e.LayoutView.extend({className:"content",template:r,regions:{rphase:".phasetable",rinstance:".instancetable"},ui:{THEORETICALDENSITY:".THEORETICALDENSITY",COMPOSITION:".COMPOSITION"},calculateDensity:function(){var e=o.composeDensity(this.model.get("components"),this.model.get("components").pluck("ABUNDANCE"));this.model.set("THEORETICALDENSITY",e),this.model.save({THEORETICALDENSITY:e},{patch:!0,parse:!1}),this.ui.THEORETICALDENSITY.text(e),this.updateComposition()},updateComposition:function(){if(this.model.get("components").length){var e=o.composeComposition(this.model.get("components"),this.model.get("components").pluck("ABUNDANCE"),!0);this.ui.COMPOSITION.text(e)}},saveComponents:function(){this.model.save({COMPONENTIDS:this.model.get("COMPONENTIDS"),COMPONENTAMOUNTS:this.model.get("COMPONENTAMOUNTS"),PROTEINID:this.model.get("PROTEINID"),ABUNDANCE:this.model.get("ABUNDANCE")},{patch:!0,parse:!1})},initialize:function(e){t.Validation.bind(this),this.instances=new i,this.instances.queryParams.crid=this.model.get("CRYSTALID"),this.instances.fetch(),this.listenTo(this.model.get("components"),"change add remove",this.calculateDensity),this.listenTo(this.model.get("components"),"reset",this.updateComposition),this.saveComponents=n.debounce(this.saveComponents.bind(this),100),this.listenTo(this.model,"change:COMPONENTIDS change:COMPONENTAMOUNTS change:PROTEINID change:ABUNDANCE",this.saveComponents)},onRender:function(){var e=new s({model:this.model,el:this.$el});e.create("NAME","text"),e.create("THEORETICALDENSITY","text"),this.rphase.show(new a({collection:this.model.get("components")})),this.rinstance.show(new l({collection:this.instances})),this.updateComposition()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="buttons ra">\n\t<a class="button addphase" href="#" title="Add existing phase"><i class="fa fa-link"></i> <span>Add Existing Phase</span></a>\n\t<a class="button newphase" href="#" title="Create and add new phase"><i class="fa fa-plus"></i> <span>Add New Phase</span></a>\n</div>\n\n<div class="table"></div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Sample details</h1>\n<p class="help"> This page shows the details of a sample</p>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Crystallographic Density</span>\n            <span class="THEORETICALDENSITY">'+(null==(__t=THEORETICALDENSITY)?"":_.escape(__t))+'</span> g cm<span class="super">-3</span>\n        </li>\n\n        <li>\n            <span class="label">Composition</span>\n            <span class="COMPOSITION"></span>\n        </li>\n        \n    </ul>\n</div>\n\n<h2>Phases</h2>\n<div class="phasetable"></div>\n\n<div class="instancetable"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(26),i(158),i(252),i(58),i(906)],void 0===(s=function(e,t,i,n,s){return e.extend({template:s,regions:{rphase:".phase_table"},ui:{THEORETICALDENSITY:"input[name=THEORETICALDENSITY]"},calculateDensity:function(){var e=n.composeDensity(this.model.get("components"),this.model.get("components").pluck("ABUNDANCE"));this.model.set("THEORETICALDENSITY",e),this.ui.THEORETICALDENSITY.val(e)},createModel:function(){this.model=new t({},{addPrimary:!0})},success:function(e,t,i){app.trigger("xsamples:view",e.get("CRYSTALID"))},onRender:function(e){this.listenTo(this.model.get("components"),"change add remove",this.calculateDensity),this.rphase.show(new i({collection:this.model.get("components")}))}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Add Sample</h1>\n<form method="post" id="new_crystal">\n    <div class="form">\n        <ul>\n            <li>\n                <label>Name\n                <span class="small">Name of the sample</span></label>\n                <span class="NAME"><input type="text" name="NAME" /></span>\n            </li>\n            <li>\n                <label>Crystallographic Density\n                <span class="small">Calculated density from all phases</span></label>\n                <span class="THEORETICALDENSITY"><input type="text" name="THEORETICALDENSITY" disabled="disabled" /> g cm<span class="super">-3</span></span>\n            </li>\n        </ul>\n\n        <div class="phase_table"></div>\n\n        <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Sample</button>\n    </div>\n</form>\n';return __p}},function(e,t,i){var n,s;n=[i(7),i(6),i(20),i(41),i(108),i(58),i(252),i(417),i(243),i(253),i(908)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c,p){return e.LayoutView.extend({className:"content",template:p,regions:{history:".history",rcont:".containers",rphases:".phases"},ui:{EXPERIMENTALDENSITY:".EXPERIMENTALDENSITY",COMPOSITION:".COMPOSITION"},initialize:function(e){t.Validation.bind(this),this.dcs=new n(null,{queryParams:{sid:this.model.get("BLSAMPLEID"),state:{pageSize:5}}}),this.dcs.fetch(),this.groups=new r,this.groups.queryParams.BLSAMPLEID=this.model.get("BLSAMPLEID"),this.groups.fetch(),this.containers=new c,this.containers.queryParams.lt=1,this.containers.fetch()},onRender:function(){var e=new i({model:this.model,el:this.$el});e.create("NAME","text"),e.create("COMMENTS","text"),e.create("CODE","text"),e.create("PACKINGFRACTION","text"),e.create("LOOPTYPE","select",{data:{0:"No",1:"Yes"}}),e.create("DIMENSION1","text"),e.create("DIMENSION2","text"),e.create("DIMENSION3","text"),e.create("SHAPE","text"),this.history.show(s.DCView.get(app.type,{model:this.model,collection:this.dcs,params:{visit:null},noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0})),this.rphases.show(new l({collection:this.model.get("components"),editable:!1})),this.rcont.show(new o({collection:this.groups,containers:this.containers,parent:this.model})),this.listenTo(this.model,"change:COMPOSITION",this.updateComposition),this.listenTo(this.model,"change:EXPERIMENTALDENSITY",this.updateExpDensity)},updateComposition:function(){this.ui.COMPOSITION.text(this.model.get("COMPOSITION"))},updateExpDensity:function(){this.ui.EXPERIMENTALDENSITY.text(this.model.get("EXPERIMENTALDENSITY"))}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Instance</h1>\n\n<p class="help"> This page shows the details and history for an instance</p>\n<div class="ra buttons">\n    <a class ="button expplan" href="/containers/plan/'+(null==(__t=CONTAINERID)?"":_.escape(__t))+'" title="Plan experiments for this sample changer"><i class="fa fa-wrench"></i> Plan Experiment</a>\n</div>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Name</span>\n            <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Instance of</span>\n            <span class="CRYSTALID">'+(null==(__t=CRYSTAL)?"":_.escape(__t))+'</span>\n            <a class="button" href="/xsamples/cid/'+(null==(__t=CRYSTALID)?"":_.escape(__t))+'"><i class="fa fa-search"></i> <span>View</span></a>\n        </li>\n\n        <li>\n            <span class="label">Is Container</span>\n            <span class="LOOPTYPE">'+(null==(__t="1"==LOOPTYPE?"Yes":"No")?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Packing fraction</span>\n            <span class="PACKINGFRACTION">'+(null==(__t=PACKINGFRACTION)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Crystallographic density</span>\n            <span class="THEORETICALDENSITY">'+(null==(__t=THEORETICALDENSITY)?"":_.escape(__t))+'</span> g cm<span class="super">-3</span>\n        </li>\n        \n        <li>\n            <span class="label">Experimental Density</span>\n            <span class="EXPERIMENTALDENSITY">'+(null==(__t=EXPERIMENTALDENSITY)?"":_.escape(__t))+'</span> g cm<span class="super">-3</span>\n\n        <li>\n            <span class="label">Overall Composition</span>\n            <span class="COMPOSITION">'+(null==(__t=COMPOSITION)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Comment</span>\n            <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">QR Barcode</span>\n            <span class="CODE">'+(null==(__t=CODE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Shipment</span>\n            <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n        </li>\n        \n        <li>\n            <span class="label">Parcel</span>\n            <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Stage</span>\n            <span class="cont"><a href="/containers/cid/'+(null==(__t=CONTAINERID)?"":_.escape(__t))+'">'+(null==(__t=CONTAINER)?"":_.escape(__t))+'</a></span>\n        </li>        \n    </ul>\n</div>\n\n<h2>Phases</h2>\n<div class="phases"></div>\n\n<h2>Shape</h2>\n<div class="form shape">\n    <ul>\n        <li>\n            <span class="label">Width</span>\n            <span class="DIMENSION1">'+(null==(__t=DIMENSION1)?"":_.escape(__t))+'</span> mm\n        </li>\n        <li>\n            <span class="label">Height</span>\n            <span class="DIMENSION2">'+(null==(__t=DIMENSION2)?"":_.escape(__t))+'</span> mm\n        </li>\n        <li>\n            <span class="label">Length</span>\n            <span class="DIMENSION3">'+(null==(__t=DIMENSION3)?"":_.escape(__t))+'</span> mm\n        </li>\n        <li>\n            <span class="label">Shape</span>\n            <span class="SHAPE">'+(null==(__t=SHAPE)?"":_.escape(__t))+'</span>\n        </li>\n    </ul>\n</div>\n\n<h2>Container Groups</h2>\n<div class="containers"></div>\n\n<div class="history"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(7),i(910)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{projects:"list","projects/pid/:pid":"view"},loadEvents:["projects:view"]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(5),i(7),i(185),i(298),i(911),i(915)],void 0===(s=function(e,t,i,n,s,a){var l={title:"Projects",url:"/projects"},o={list:function(){app.loading(),console.log("prop list"),app.bc.reset([l]);var e=new n;e.fetch().done((function(){app.content.show(new s({collection:e}))}))},view:function(e){var t=new i({PROJECTID:e});t.fetch({success:function(){app.bc.reset([l,{title:t.get("TITLE")}]),app.content.show(new a({model:t}))},error:function(){app.bc.reset([l,{title:"No such project"}]),app.message({title:"No such project",message:"The specified project could not be found"})}})}};return app.addInitializer((function(){app.on("projects:view",(function(e){app.navigate("projects/pid/"+e),o.view(e)}))})),o}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(6),i(49),i(185),i(912),i(913),i(914),i(18)],void 0===(l=function(e,t,i,a,l,o,r){var c=i.extend({getTemplate:function(){return this.model.get("new")?r:o},tagName:"tr",className:function(){return this.model.get("new")?"new":""},events:{"click td":"showProject","click a.cancel":"cancelProject","click a.save":"onSubmit"},ui:{title:"input[name=TITLE]",acronym:"input[name=ACRONYM]"},cancelProject:function(e){e.preventDefault(),this.model.collection.remove(this.model)},setData:function(){this.model.set({TITLE:this.ui.title.val(),ACRONYM:this.ui.acronym.val()})},success:function(e,t,i){this.model.set("new",!1),this.$el.removeClass("new"),this.render()},error:function(e,t,i){app.message("Something went wrong creating this project, please try again")},showProject:function(e){n(e.target).closest(".new").length||app.trigger("projects:view",this.model.get("PROJECTID"))}}),p=e.ItemView.extend({tagName:"tr",template:s.template('<td colspan="3">No projects defined</td>')});return GridView=t.Marionette.CompositeView.extend({className:"content",template:l,childView:c,childViewContainer:"tbody",emptyView:p,events:{"click .add":"addProject"},addProject:function(e){e.preventDefault(),this.$el.find(".new").length||this.collection.add(new a({new:!0}))}})}.apply(t,a))||(e.exports=l)}).call(this,i(8),i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Projects</h1>\n\n<p class="help">This page lists all projects associated with the currently selected proposal.</p>\n\n<p class="help">Projects allow you to group data collections, proteins, and samples into a single place</p>\n\n<div class="ra"><a href="#" class="add button" title="Click to add a new project to this proposal"><i class="fa fa-plus"></i> Add Project</a></div>\n\n\n<div class="table">\n    <table class="projects reflow">\n        <thead>\n            <tr>\n                <th>Name</th>\n                <th>Acronym</th>\n                <th>Owner</th>\n            </tr>\n        </thead>\n        \n        <tbody></tbody>\n    </table>\n</div>';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <td class="TITLE">'+(null==(__t=TITLE)?"":_.escape(__t))+'</td>\n    <td class="ACRONYM">'+(null==(__t=ACRONYM)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=PERSON)?"":_.escape(__t))+"</td>\n";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <td><input name="TITLE" type="text" /></td>\n    <td><input name="ACRONYM" type="text" /></td>\n    <td>\n        <a class="button button-notext save"><i class="fa fa-check"></i> <span>Save Project</span></a>\n        <a class="button button-notext cancel"><i class="fa fa-times"></i> <span>Cancel</span></a>\n    </td>\n\n';return __p}},function(e,t,i){var n,s;n=[i(7),i(20),i(91),i(40),i(41),i(68),i(916),i(68),i(73),i(130),i(154),i(917),i(918),i(6),i(8),i(18)],void 0===(s=function(e,t,i,n,s,a,l,o,r,c,p,d,u,h,m){return e.LayoutView.extend({className:"content",template:u,regions:{dc:".datacollections",smp:".samples",prt:".proteins",usr:"div.users"},events:{"click @ui.imp":"toggleImplicit","keypress @ui.user":"keypressUser"},ui:{imp:"a.imp",user:"input[name=adduser]"},keypressUser:function(e){if(console.log(13==e.which,e.which),13==e.which){var t=new l({PROJECTID:this.model.get("PROJECTID"),PERSONID:this.ui.user.val()}),i=this;t.save({},{success:function(e,n,s){console.log("succes",e,n,s),i.users.add(t)},error:function(e,t,i){app.message("Something went wrong adding that user, please try again")}})}},initialize:function(e){h.Validation.bind(this),this.allusers=new a,this.users=new a(null,{model:l}),this.users.queryParams.pjid=this.model.get("PROJECTID"),this.users.fetch(),this.implicit=1,this.proteins=new i(null,{queryParams:{pjid:this.model.get("PROJECTID"),imp:this.isImplicit.bind(this)},state:{pageSize:5}}),this.proteins.fetch(),this.samples=new n(null,{queryParams:{pjid:this.model.get("PROJECTID"),imp:this.isImplicit.bind(this)},state:{pageSize:5}}),this.samples.fetch(),this.dcs=new s(null,{queryParams:{pjid:this.model.get("PROJECTID"),imp:this.isImplicit.bind(this),pp:5}}),this.dcs.fetch()},isImplicit:function(){return this.implicit},toggleImplicit:function(e){e.preventDefault(),this.implicit=this.implicit?0:1,this.ui.imp.children("span").text(this.implicit?"Implicit":"Explicit"),this.proteins.fetch(),this.samples.fetch(),this.dcs.fetch()},getUsers:function(e,t){var i=this;this.allusers.queryParams.s=e.term,this.allusers.fetch({success:function(e){t(i.allusers.map((function(e){return{label:e.get("FULLNAME"),value:e.get("PERSONID")}})))}})},onRender:function(){if(console.log("PROJECT VIEW AUTO?"),this.ui.user.autocomplete({source:this.getUsers.bind(this)}),this.model.get("IS_OWNER")){var e=new t({model:this.model,el:this.$el});e.create("TITLE","text"),e.create("ACRONYM","text")}this.dc.show(new r({model:this.model,collection:this.dcs,params:{visit:null},noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0})),this.smp.show(new c({collection:this.samples,noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0})),this.prt.show(new p({collection:this.proteins,noPageUrl:!0,noSearchUrl:!0}));var i=this;this.usr.show(new d({collection:this.users,childViewOptions:function(){var e=i.model.get("IS_OWNER");return{templateHelpers:function(){return{IS_OWNER:e}}}}}))}})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({idAttribute:"PPID",urlRoot:"/projects/users",validation:{PROJECTID:{required:!0,pattern:"number"},PERSONID:{required:!0,pattern:"number"}}})}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7)],void 0===(a=function(e){var t=e.ItemView.extend({template:n.template('<%-FULLNAME%><% if (IS_OWNER) { %><span class="r"><a class="button button-notext delete" href="#"><i class="fa fa-times"></i> <span>Delete</span></a></span><% } %>'),tagName:"li",events:{"click a.delete":"deleteUser"},deleteUser:function(e){this.model.destroy()}}),i=e.ItemView.extend({template:n.template("No users registered on this project"),tagName:"li"});return e.CollectionView.extend({tagName:"ul",className:"visits clearfix",childView:t,emptyView:i})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Project Details</h1>\n\n<p class="help">This pages shows details and history for the selected project</p>\n\n<div class="ra"><a href="#" class="button imp" title="Click to change between showing explicity added project members and those implied by added proteins or samples"><i class="fa fa-arrows-alt"></i> <span>Implicit</span> Project Members</a></div>\n\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Owner</span>\n            <span class="PERSON">'+(null==(__t=PERSON)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Name</span>\n            <span class="TITLE">'+(null==(__t=TITLE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Acronym</span>\n            <span class="ACRONYM">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix">\n            <span class="label">Users</span>\n            <span class="users floated">\n                ',IS_OWNER&&(__p+='\n                    <input name="adduser" />\n                '),__p+='\n                <div class="users"></div>\n            </span>\n        </li>\n\n    </ul>\n</div>\n\n<div class="proteins"></div>\n<div class="samples"></div>\n<div class="datacollections"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(7),i(920)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"cal(/bl/:bl)":"calendar",calendar:"calendar_prop",log:"current","ispyb/ispyb":"goHome","":"goHome"},loadEvents:["current:show"]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(5),i(7),i(419),i(922)],void 0===(s=function(e,t,i,n){var s={calendar:function(e){app.bc.reset([{title:"Calendar"}]),app.content.show(new i({all:1,bl:e}))},calendar_prop:function(){app.bc.reset([{title:"Calendar"},{title:app.prop}]),app.content.show(new i({}))},current:function(){app.bc.reset([{title:"Next & Previous Visits"}]),app.content.show(new n)},goHome:function(){app.clearProposal(),app.type?app.trigger("current:show"):app.trigger("proposals:show")}};return app.addInitializer((function(){app.on("current:show",(function(){s.current()})),app.on("go:home",(function(){s.goHome()}))})),s}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <h1 class="calendar_header">Visits for <span class="title"></span></h1>\n\n    <p class="help">Schedule of visits for the currently selected proposal</p>\n\n    <p class="ra purl"></p>\n\n    <div class="calendar">\n        <ul class="links clearfix">\n            <li class="yprev"></li>\n            <li class="mprev"></li>\n            <li class="mnext"></li>\n            <li class="ynext"></li>\n        </ul>\n\n        <ul class="calendar_days"></ul>\n        <ul class="calendar_main clearfix"></ul>\n    </div>\n';return __p}},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(45),i(37),i(254),i(381),i(382),i(923),i(924)],void 0===(l=function(e,t,i,a,l,o,r,c){var p=e.ItemView.extend({tagName:"li",className:function(){if(1==this.model.get("ACTIVE"))return"active"},events:{click:"showVisit","mouseover a.users":"showUsers","mouseout a.users":"hideUsers","mouseover a.dewars":"showDewars","mouseout a.dewars":"hideDewars"},showDewars:function(e){this.dewars||(this.dewars=new o({visit:this.model.get("VISIT")}),this.$el.find(".dewars").append(this.dewars.render().$el)),this.dewars.$el.show()},hideDewars:function(e){this.dewars&&this.dewars.$el.hide()},showUsers:function(e){this.users||(this.users=new l({visit:this.model.get("VISIT")}),this.$el.find(".users").append(this.users.render().$el)),this.users.$el.show()},hideUsers:function(e){this.users&&this.users.$el.hide()},showVisit:function(e){app.trigger("dclist:show",this.model.get("VISIT"))},template:n.template('<div class="r"><a class="button" href="/stats/visit/<%-VISIT%>"><i class="fa fa-pie-chart"></i></a> <a href="#" class="button users"><i class="fa fa-users"></i></a> <a href="#" class="button dewars"><i class="fa fa-truck"></i></a></div><h1><%-BL%>. <%-LC%></h1><h3><a href="/dc/visit/<%-VISIT%>"><%-VISIT%></a></h3><ul><li>Start: <%-ST%></li><li>End: <%-EN%></li><li>&nbsp; <% if (SESSIONTYPE) { %><%-SESSIONTYPE%><% }%></li></ul>')}),d=e.ItemView.extend({tagName:"li",template:n.template("<p>No visits found</p>")}),u=e.CollectionView.extend({tagName:"ul",className:"ul hover full clearfix",childView:p,emptyView:d});return e.LayoutView.extend({template:c,className:"content",regions:{pv:".prev",nv:".next",com:".cm"},ui:{time:"span.time"},templateHelpers:function(){return{SITE_NAME:app.config.site_name||"Diamond House",IS_STAFF:app.staff}},initialize:function(){this.deferreds=[],app.staff?(this.next=new i(null),this.prev=new i(null),this.cm=new i(null),this.beamlines=new a(null,{ty:app.type}),this.beamlines.fetch(),this.listenTo(this.beamlines,"sync",this.getVisits,this)):n.each(["next","prev"],(function(e){var t={all:1};t[e]=1,this[e]=new i(null,{state:{pageSize:5},queryParams:t}),this.deferreds.push(this[e].fetch())}),this),this.time=new r,this.deferreds.push(this.time.fetch())},getVisits:function(){console.log("get visits",this.beamlines);var e=t.extend({idAttribute:"VISIT-TYPE"}),n=i.extend({model:e});this.visits=new n(null,{queryParams:{current:1}});var s=this.visits.fetch({success:this.sortVisits.bind(this)});this.deferreds.push(s)},sortVisits:function(){console.log("sort visits"),this.beamlines.each((function(e,t){n.each(["next","prev","cm"],(function(i){var n=this.visits.findWhere({BL:e.get("BEAMLINE"),type:i});this[i].add(n,{at:t})}),this)}),this)},onRender:function(){s.when.apply(s,this.deferreds).then(this.doRender.bind(this))},doRender:function(){this.pv.show(new u({collection:this.prev})),this.nv.show(new u({collection:this.next})),app.staff&&this.com.show(new u({collection:this.cm})),this.ui.time.text(this.time.time())}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/users/time",time:function(){return this.get("TIME")}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="center nou">Time at '+(null==(__t=SITE_NAME)?"":_.escape(__t))+' is: <span class="time"></span></h1>\n\n<h1>Current &amp; Next Visits</h1>\n<div class="next"></div>\n\n<h1>Last Visits</h1>\n<div class="prev"></div>\n\n',IS_STAFF&&(__p+='\n<h1>Commissioning Visits</h1>\n<div class="cm"></div>\n'),__p+="\n";return __p}},function(e,t,i){var n,s;n=[i(7),i(926)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"contacts(/page/:page)":"list","contacts/cid/:cid":"view","contacts/add":"add","contacts/user(/:pid)":"edit_user"},loadEvents:["contact:show","user:show"]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(168),i(60),i(927),i(928),i(255),i(151),i(931),i(167)],void 0===(s=function(e,t,i,n,s,a,l,o,r){var c={title:"Home Lab Contacts",url:"/contacts"},p={list:function(e){app.loading(),app.bc.reset([c]),e=e?parseInt(e):1;var t=new i(null,{state:{currentPage:e}});t.fetch().done((function(){app.content.show(new n({collection:t}))}))},view:function(e){app.loading(),new r({field:"LABCONTACTID",value:e}).find({success:function(){var i=new t({LABCONTACTID:e});i.fetch({success:function(){app.bc.reset([c,{title:i.get("CARDNAME")}]),app.content.show(new s({model:i}))},error:function(){app.bc.reset([c,{title:"No such contact"}]),app.message({title:"No such contact",message:"The specified contact doesn't exist"})}})},error:function(){app.bc.reset([c,{title:"No such contact"}]),app.message({title:"No such contact",message:"The specified contact doesn't exist"})}})},add:function(){app.proposal&&1!=app.proposal.get("ACTIVE")?app.message({title:"Proposal Not Active",message:"This proposal is not active so new contacts cannot be added"}):(app.bc.reset([c,{title:"Add Contact"}]),app.content.show(new a))},edit_user:function(e){app.loading(),app.bc.reset([c,{title:"View User"}]);var t=new l({PERSONID:e||app.personid});t.fetch({success:function(){app.bc.reset([c,{title:t.get("FULLNAME")}]),app.content.show(new o({model:t}))},error:function(){app.bc.reset([c,{title:"No such user"}]),app.message({title:"No such user",message:"The specified user doesn't exist"})}})}};return app.addInitializer((function(){app.on("contact:show",(function(e){app.navigate("contacts/cid/"+e),p.view(e)})),app.on("user:show",(function(e){app.navigate("contacts/user/"+e),p.edit_user(e)}))})),p}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(12),i(15)],void 0===(a=function(e,t,i){var s=i.ClickableRow.extend({event:"contact:show",argument:"LABCONTACTID"});return e.LayoutView.extend({className:"content",template:'<div><h1>Home Lab Contacts</h1><p class="help">This page shows registered home laboratory contacts. This information is generally used to return shipments back after an experiment</p><div class="ra"><a class="button add" href="/contacts/add"><i class="fa fa-plus"></i> Add Home Lab Contact</a></div><div class="wrapper"></div></div>',regions:{wrap:".wrapper"},ui:{add:"a.add"},initialize:function(e){var i=[{name:"CARDNAME",label:"Card Name",cell:"string",editable:!1},{name:"GIVENNAME",label:"First Name",cell:"string",editable:!1},{name:"FAMILYNAME",label:"Surname",cell:"string",editable:!1},{name:"ADDRESS",label:"Address",cell:"string",editable:!1},{name:"CITY",label:"City",cell:"string",editable:!1},{name:"POSTCODE",label:"Postcode",cell:"string",editable:!1},{name:"COUNTRY",label:"Country",cell:"string",editable:!1},{name:"PHONENUMBER",label:"Phone No.",cell:"string",editable:!1},{name:"LABNAME",label:"Laboratory",cell:"string",editable:!1}];app.mobile()&&n.each([2,3,4,5,6],(function(e){i[e].renderable=!1})),this.table=new t({collection:e.collection,columns:i,tableClass:"proposals",filter:"s",loading:!0,backgrid:{row:s,emptyText:"No contacts found"}})},onRender:function(){app.proposal&&1!=app.proposal.get("ACTIVE")&&this.ui.add.hide(),this.wrap.show(this.table)},onShow:function(){this.table.focusSearch()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(169),i(20),i(929),i(6),i(18)],void 0===(a=function(e,t,i,s,a){return e.ItemView.extend({className:"content",template:s,initialize:function(e){a.Validation.bind(this),this.countries=new t,this.countries.state.pageSize=9999,this.ready=this.countries.fetch()},onRender:function(){n.when(this.ready).done(this.doOnRender.bind(this))},doOnRender:function(){var e=new i({model:this.model,el:this.$el});e.create("CARDNAME","text"),e.create("FAMILYNAME","text"),e.create("GIVENNAME","text"),e.create("PHONENUMBER","text"),e.create("EMAILADDRESS","text"),e.create("LABNAME","text"),e.create("ADDRESS","textarea"),e.create("CITY","text"),e.create("POSTCODE","text"),e.create("COUNTRY","select",{data:this.countries.kv()}),e.create("COURIERACCOUNT","text"),e.create("DEFAULTCOURRIERCOMPANY","text"),e.create("BILLINGREFERENCE","text"),e.create("DEWARAVGCUSTOMSVALUE","text"),e.create("DEWARAVGTRANSPORTVALUE","text")}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n<h1>View Home Lab Contact</h1>\n\n<div class="form">\n    <ul>\n        \n        <li>\n            <span class="label">Card Name</span>\n            <span class="CARDNAME">'+(null==(__t=CARDNAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        \n        <li>\n            <span class="label">Family Name</span>\n            <span class="FAMILYNAME">'+(null==(__t=FAMILYNAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        \n        <li>\n            <span class="label">First Name</span>\n            <span class="GIVENNAME">'+(null==(__t=GIVENNAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Phone Number</span>\n            <span class="PHONENUMBER">'+(null==(__t=PHONENUMBER)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Email</span>\n            <span class="EMAILADDRESS">'+(null==(__t=EMAILADDRESS)?"":_.escape(__t))+'</span>\n        </li>\n        \n        \n        <li>\n            <span class="label">Laboratory Name</span>\n            <span class="LABNAME">'+(null==(__t=LABNAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li class="clearfix reorder">\n            <div class="ADDRESS text">'+(null==(__t=ADDRESS)?"":_.escape(__t))+'</div>\n            <span class="label">Laboratory Street Address <br />(excluding post code, city)</span>\n        </li>\n        \n        <li>\n            <span class="label">Laboratory City</span>\n            <span class="CITY">'+(null==(__t=CITY)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory Postcode</span>\n            <span class="POSTCODE">'+(null==(__t=POSTCODE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory Country</span>\n            <span class="COUNTRY">'+(null==(__t=COUNTRY)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Courier Company</span>\n            <span class="DEFAULTCOURRIERCOMPANY">'+(null==(__t=DEFAULTCOURRIERCOMPANY)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Courier Account No.</span>\n            <span class="COURIERACCOUNT">'+(null==(__t=COURIERACCOUNT)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Billing Reference</span>\n            <span class="BILLINGREFERENCE">'+(null==(__t=BILLINGREFERENCE)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Dewar Customs Value</span>\n            <span class="DEWARAVGCUSTOMSVALUE">'+(null==(__t=DEWARAVGCUSTOMSVALUE)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Dewar Transport Value</span>\n            <span class="DEWARAVGTRANSPORTVALUE">'+(null==(__t=DEWARAVGTRANSPORTVALUE)?"":_.escape(__t))+"</span>\n        </li>\n        \n    </ul>\n</div>\n";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <h1>Add New Home Lab Contact</h1>\n\n    <form method="post" id="add_contact">\n\n    <div class="form">\n        <ul>\n\n\n            <li>\n                <label>Card Name\n                    <span class="small">Name for the Contact Card</span>\n                </label>\n                <input type="text" name="CARDNAME" />\n            </li>\n\n\n            <li class="head">Contact Details</li>\n\n            <li>\n                <label>Contact Family Name\n                    <span class="small">The person\'s family name</span>\n                </label>\n                <input type="text" name="FAMILYNAME" />\n            </li>\n\n\n            <li>\n                <label>Contact First Name\n                    <span class="small">The person\'s first name</span>\n                </label>\n                <input type="text" name="GIVENNAME" />\n            </li>\n\n            <li>\n                <label>Contact Phone Number\n                    <span class="small">The person\'s phone number</span>\n                </label>\n                <input type="text" name="PHONENUMBER" />\n            </li>\n\n            <li>\n                <label>Contact Email\n                    <span class="small">The person\'s email address</span>\n                </label>\n                <input type="email" name="EMAILADDRESS" />\n            </li>\n\n\n            <li class="head">Contact Laboratory Details</li>\n\n            <li>\n                <label>Laboratory Name\n                    <span class="small">The contact\'s laboratory name</span>\n                </label>\n                <input type="text" name="LABNAME" />\n            </li>\n\n            <li>\n                <label>Laboratory Street Address\n                    <span class="small">Street Address (excluding post code, city)</span>\n                </label>\n                <textarea name="ADDRESS"></textarea>\n            </li>\n\n            <li>\n                <label>Laboratory City\n                    <span class="small">The contact\'s laboratory city</span>\n                </label>\n                <input type="text" name="CITY" />\n            </li>\n\n            <li>\n                <label>Laboratory Postcode\n                    <span class="small">The contact\'s laboratory postcode</span>\n                </label>\n                <input type="text" name="POSTCODE" />\n            </li>\n\n            <li>\n                <label>Laboratory Country\n                    <span class="small">The contact\'s laboratory country</span>\n                </label>\n                <select name="COUNTRY"></select>\n            </li>\n\n            <li class="head">\n                Dewar Return Details\n                <br /><span class="small">The following information is used for each shipment associated with this contact</span>\n            </li>\n\n            <li>\n                <label>Courier Company\n                    <span class="small">Courier company to use to return dewars to home lab</span>\n                </label>\n                <input type="text" name="DEFAULTCOURRIERCOMPANY" />\n            </li>\n\n\n            <li>\n                <label>Courier Account No.\n                <span class="small">Courier account number for returning dewars to home lab</span>\n                </label>\n                <input type="text" name="COURIERACCOUNT" />\n            </li>\n\n            <li>\n                <label>Billing Reference\n                    <span class="small">Billing reference to use when returning dewars to home lab</span>\n                </label>\n                <input type="text" name="BILLINGREFERENCE" />\n            </li>\n\n            <li>\n                <label>Average customs value of dewar\n                    <span class="small">The average customs value of a dewar</span>\n                </label>\n                <input type="text" name="DEWARAVGCUSTOMSVALUE" />\n            </li>\n\n            <li>\n                <label>Average transport value of dewar\n                    <span class="small">The average transport value of a dewar</span>\n                </label>\n                <input type="text" name="DEWARAVGTRANSPORTVALUE" />\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Add Home Lab Contact</button>\n\n\n        </ul>\n    </div>\n\n    </form>\n\n';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(169),i(20),i(932),i(6),i(18)],void 0===(a=function(e,t,i,s,a){return e.ItemView.extend({className:"content",template:s,initialize:function(e){a.Validation.bind(this),this.countries=new t,this.countries.state.pageSize=9999,this.ready=this.countries.fetch()},onRender:function(){n.when(this.ready).done(this.doOnRender.bind(this))},doOnRender:function(){var e=new i({model:this.model,el:this.$el});this.model.get("LOGIN")||(e.create("GIVENNAME","text"),e.create("FAMILYNAME","text")),e.create("PHONENUMBER","text"),e.create("EMAILADDRESS","text"),e.create("LABNAME","text"),e.create("ADDRESS","textarea"),e.create("CITY","text"),e.create("POSTCODE","text"),e.create("COUNTRY","select",{data:this.countries.kv()})}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n<h1>View User</h1>\n\n<div class="form">\n    <ul>\n        \n        <li>\n            <span class="label">Login</span>\n            <span class="LOGIN">'+(null==(__t=LOGIN||"N/A - Lab Contact")?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">First Name</span>\n            <span class="GIVENNAME">'+(null==(__t=GIVENNAME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Family Name</span>\n            <span class="FAMILYNAME">'+(null==(__t=FAMILYNAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li class="head">Contact Details</li>\n\n        <li>\n            <span class="label">Phone Number</span>\n            <span class="PHONENUMBER">'+(null==(__t=PHONENUMBER)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li>\n            <span class="label">Email</span>\n            <span class="EMAILADDRESS">'+(null==(__t=EMAILADDRESS)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li class="head">Contact Laboratory Details</li>\n\n        <li>\n            <span class="label">Laboratory Name</span>\n            <span class="LABNAME">'+(null==(__t=LABNAME)?"":_.escape(__t))+'</span>\n        </li>\n        \n        <li class="clearfix reorder">\n            <div class="ADDRESS text">'+(null==(__t=ADDRESS)?"":_.escape(__t))+'</div>\n            <span class="label">Laboratory Address</span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory City</span>\n            <span class="CITY">'+(null==(__t=CITY)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory Postcode</span>\n            <span class="POSTCODE">'+(null==(__t=POSTCODE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory Country</span>\n            <span class="COUNTRY">'+(null==(__t=COUNTRY)?"":_.escape(__t))+"</span>\n        </li>\n        \n        \n    </ul>\n</div>\n";return __p}},function(e,t,i){var n,s;n=[i(7),i(934)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"cell(/page/:page)":"search","cell(/a/:a/b/:b/c/:c/al/:al/be/:be/ga/:ga)(/pdb/:pdb)(/page/:page)":"search_cell"}}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(935)],void 0===(s=function(e,t){var i={search_cell:function(e,i,n,s,a,l,o,r){r=r?parseInt(r):1,app.content.show(new t({pdb:o,cell:{a:e,b:i,c:n,al:s,be:a,ga:l},page:r})),app.bc.reset([{title:"Unit Cell Search"}])},search:function(e){i.search_cell(null,null,null,null,null,null,null,e)}};return i}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n,s){var a,l;a=[i(7),i(6),i(936),i(62),i(937),i(938)],void 0===(l=function(e,t,i,a,l,o){var r=e.ItemView.extend({template:o,className:"cells data_collection clearfix",initialize:function(){var e=[];n.each(this.model.get("USERS"),(function(t){var i=s(t.split(" ")).get(-1);this.getOption("authors").toLowerCase().indexOf(i.toLowerCase())>-1?e.push('<span class="found">'+t+"</span>"):e.push(t)}),this),this.options.templateHelpers={us:e}}}),c=e.ItemView.extend({className:"data_collection",template:n.template("<div>No data collections found</div>")});return e.CompositeView.extend({template:l,className:"content",childView:r,childViewContainer:".data_collections",childViewOptions:function(){return{authors:s(".pdb_details .author").html()}},emptyView:c,templateHelpers:function(){return{cell:this.getOption("cell"),pdb:this.getOption("pdb")}},ui:{get:"a.get",lookup:"a.lookup",a:"input[name=a]",b:"input[name=b]",c:"input[name=c]",al:"input[name=al]",be:"input[name=be]",ga:"input[name=ga]",res:"input[name=res]",sg:"input[name=sg]",tol:"input[name=tol]",pdb:"input[name=pdb]",year:".pdb_details .date",count:".results span.count"},events:{"click @ui.get":"getPDB","click @ui.lookup":"search"},initialize:function(e){console.log(e);var t=this;this.collection=new i(null,{queryParams:{res:function(){if(t.ui.res.val())return 1.25*t.ui.res.val()},tol:function(){return t.ui.tol.val()},a:function(){return t.ui.a.val()},b:function(){return t.ui.b.val()},c:function(){return t.ui.c.val()},al:function(){return t.ui.al.val()},be:function(){return t.ui.be.val()},ga:function(){return t.ui.ga.val()},sg:function(){return t.ui.sg.val().replace(/\s+/g,"")},year:function(){return t.ui.year.html()}},state:{currentPage:e.page}}),this.listenTo(this.collection,"request",this.displaySpinner),this.listenTo(this.collection,"sync",this.removeSpinner),this.listenTo(this.collection,"error",this.removeSpinner),this.first=!0},getPDB:function(e){if(e&&e.preventDefault(),this.ui.pdb.val()){var i=this;t.ajax({url:app.apiurl+"/cell/pdb?pdb="+this.ui.pdb.val(),type:"GET",dataType:"xml",timeout:5e3,success:function(e){var t=!1;s(e).find("record").each((function(e,n){t=!0,s.each({a:"lengthOfUnitCellLatticeA",b:"lengthOfUnitCellLatticeB",c:"lengthOfUnitCellLatticeC",al:"unitCellAngleAlpha",be:"unitCellAngleBeta",ga:"unitCellAngleGamma"},(function(e,t){i.ui[e].val(s(n).find("dimStructure\\."+t).text())})),i.$el.find(".pdb_details .title").text(i.ui.pdb.val()+": "+s(n).find("dimStructure\\.structureTitle").text());var a=s(n).find("dimStructure\\.resolution").text();s(".pdb_details .res").text(a),i.ui.res.val(a),i.ui.sg.val(s(n).find("dimStructure\\.spaceGroup").text().replace(/\s+/g,"")),"null"!=s(n).find("dimStructure\\.diffractionSource").text()&&s(".pdb_details .beamline").text(s(n).find("dimStructure\\.diffractionSource").text()),i.$el.find(".pdb_details .author").text(s(n).find("dimStructure\\.structureAuthor").text());var l=s(n).find("dimStructure\\.title").text();l?s.each(["citationAuthor","firstPage","volumeId","journalName","publicationYear"],(function(e,t){"null"!=s(n).find("dimStructure\\."+t).text()&&(l+=", "+s(n).find("dimStructure\\."+t).text())})):l="N/A",i.$el.find(".pdb_details .citation").text(l),i.$el.find(".pdb_details .date").text(s(n).find("dimStructure\\.releaseDate").text()),i.$el.find(".pdb_details").slideDown(),i.search()})),t||this.$el.find(".pdb_details_not_found").slideDown()}})}},search:function(e){if(this.ui.a.val()&&this.ui.b.val()&&this.ui.c.val()&&this.ui.al.val()&&this.ui.be.val()&&this.ui.ga.val()){this.$el.find(".results").show(),this.ui.count.html('<i class="fa fa-spin fa-circle-o-notch"></i>'),e&&e.preventDefault();return this.collection.state.currentPage=1,this.collection.fetch({success:this.onSearch.bind(this),error:this.onError.bind(this)}),!1}app.alert({message:"Please make sure to fill in all unit cell parameters: a, b, c, alpha, beta, gamma are required"})},onError:function(){},onSearch:function(e,t,i){this.ui.count.text(this.collection.state.totalRecords),this.$el.find(".data_collections, .page_wrap").show()},displaySpinner:function(){this.$el.find(".data_collections").addClass("loading")},removeSpinner:function(){this.$el.find(".data_collections").removeClass("loading")},onRender:function(){console.log("rendering"),this.first&&(this.ui.tol.val(.01),this.$el.find(".results, .data_collections, .page_wrap").hide(),this.ui.pdb.val()&&this.getPDB(),this.ui.a.val()&&this.ui.b.val()&&this.ui.c.val()&&this.ui.al.val()&&this.ui.be.val()&&this.ui.ga.val()&&this.search(),this.first=!1),this.pages=new a({collection:this.collection}),this.$el.find(".page_wrap").html(this.pages.render().$el)}})}.apply(t,a))||(e.exports=l)}).call(this,i(5),i(8))},function(e,t,i){var n,s;n=[i(6),i(10)],void 0===(s=function(e,t){var i=e.Model.extend({idAttribute:"AUTOPROCINTEGRATIONID"});return t.extend({model:i,mode:"server",url:"/cell",state:{pageSize:15},queryParams:{pageSize:"pp"},parseState:function(e,t,i,n){return{totalRecords:parseInt(e[0])}},parseRecords:function(e,t){return e[2]}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Unit Cell Search</h1>\n\n<p class="help">Use this page to search for data collections corresponding to a unit cell or pdb code. Tolerance is by default set to 1%, if you cant find a corresponding data collection increase this value.</p>\n<p class="help">Results are ordered by &quot;Distance&quot; from the search unit cell parameters</p>\n\n<div class="cell_param data_collection">\n    <span class="pdb">\n        <label>PDB Code: <input type="text" name="pdb" value="'+(null==(__t=pdb)?"":_.escape(__t))+'" /></label>\n        <a class="button get" href="#" title="Retrieve details for the selected PDB code"><i class="fa fa-download"></i> Get</a>\n    </span>\n    \n    <span class="cell">\n        <label>a <input type="text" name="a" value="'+(null==(__t=cell.a)?"":_.escape(__t))+'" /></label>\n        <label>b <input type="text" name="b" value="'+(null==(__t=cell.b)?"":_.escape(__t))+'" /></label>\n        <label>c <input type="text" name="c" value="'+(null==(__t=cell.c)?"":_.escape(__t))+'" /></label>\n    </span>\n    \n    <span class="cell">\n        <label>&alpha; <input type="text" name="al" value="'+(null==(__t=cell.al)?"":_.escape(__t))+'" /></label>\n        <label>&beta; <input type="text" name="be" value="'+(null==(__t=cell.be)?"":_.escape(__t))+'" /></label>\n        <label>&gamma; <input type="text" name="ga" value="'+(null==(__t=cell.ga)?"":_.escape(__t))+'" /></label>\n    </span>\n    \n    <span class="opts">\n        <label>Res <input type="text" name="res" title="Resolution limit to match to data collection" /></label>\n        <label>SG <input type="text" name="sg" /></label>\n        \n        <label>Tolerance: <input type="text" name="tol" title="Tolerance for cell parameter search, default 1%" /></label>\n        \n        <a href="#" class="button lookup" title="Search for data collections corresponding to the unit cell supplied"><i class="fa fa-search"></i> Look Up</a>\n    </span>\n</div>\n\n<div class="pdb_details_not_found data_collection">\n    No PDB found corresponding to that code\n</div>\n\n<div class="pdb_details data_collection">\n    <h1 class="title"></h1>\n    <ul class="clearfix">\n        <li>Beamline: <span class="beamline"></span></li>\n        <li>Date: <span class="date"></span>, Resolution: <span class="res"></span></li>\n        <li>Author: <span class="author"></span></li>\n        <li>Citation: <span class="citation"></span></li>\n    </ul>\n</div>\n\n<h1 class="results"><span class="count"></span> Search Results</h1>\n\n<div class="page_wrap"></div>\n<div class="data_collections"></div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <h1><a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+"/id/"+(null==(__t=ID)?"":_.escape(__t))+'" title="Click to view full details for this data collection">'+(null==(__t=VISIT)?"":_.escape(__t))+": "+(null==(__t=BL)?"":_.escape(__t))+" - "+(null==(__t=ST)?"":_.escape(__t))+'</a> (<span title="Distance between search unit cell parameters and those for this data set. A smaller number means the data set is close to the searched parameters">Distance: '+(null==(__t=parseFloat(DIST).toFixed(2))?"":_.escape(__t))+", "+(null==(__t=TYPE)?"":_.escape(__t))+")</span></h1>\n    <h3>"+(null==(__t=DIR)?"":_.escape(__t))+(null==(__t=FILETEMPLATE)?"":_.escape(__t))+'</h3>\n    \n    <div class="users">\n        <h3>Users</h3>\n        <p class="ulist" title="Users that match the user list for the designated PDB file are highlighted in green">'+(null==(__t=us.join(", "))?"":_.escape(__t))+'</p>\n        </div>\n    \n    <div class="cell">\n        <h3>Cell Parameters</h3>\n        <ul>\n            <li>A: '+(null==(__t=CELL_A)?"":_.escape(__t))+"</li>\n            <li>B: "+(null==(__t=CELL_B)?"":_.escape(__t))+"</li>\n            <li>C: "+(null==(__t=CELL_C)?"":_.escape(__t))+"</li>\n            <li>&alpha;: "+(null==(__t=CELL_AL)?"":_.escape(__t))+"</li>\n            <li>&beta;: "+(null==(__t=CELL_BE)?"":_.escape(__t))+"</li>\n            <li>&gamma;: "+(null==(__t=CELL_GA)?"":_.escape(__t))+'</li>\n            </ul>\n        </div>\n    \n    <div class="stats">\n        <h3>Statistics</h3>\n        <ul>\n            <li>Resolution: '+(null==(__t=RHIGH)?"":_.escape(__t))+" - "+(null==(__t=RLOW)?"":_.escape(__t))+"&#197;</li>\n            <li>Spacegroup: "+(null==(__t=SG)?"":_.escape(__t))+"</li>\n            <li>Rmerge: "+(null==(__t=RMERGE)?"":_.escape(__t))+"</li>\n            <li>Completeness: "+(null==(__t=COMPLETENESS)?"":_.escape(__t))+"</li>\n            <li>I/&sigma;(I): "+(null==(__t=ISIGI)?"":_.escape(__t))+"</li>\n            <li>Multiplicity: "+(null==(__t=MULTIPLICITY)?"":_.escape(__t))+'</li>\n            </ul>\n        </div>\n    \n    \n    <div class="data">\n        <h3>Data Collection</h3>\n        <ul>\n            <li>&'+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Start: "+(null==(__t=AXISSTART)?"":_.escape(__t))+"&deg;</li>\n            <li>&"+(null==(__t=ROTATIONAXIS)?"":_.escape(__t))+"; Osc: "+(null==(__t=AXISRANGE)?"":_.escape(__t))+"&deg;</li>\n            <li>No. Images: "+(null==(__t=NUMIMG)?"":_.escape(__t))+"</li>\n            <li>Wavelength: "+(null==(__t=WAVELENGTH)?"":_.escape(__t))+"&#197;</li>\n            <li>Exposure: "+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+"s</li>\n            <li>Transmission: "+(null==(__t=TRANSMISSION)?"":_.escape(__t))+"%</li>\n            </ul>\n        </div>\n    </div>";return __p}},function(e,t,i){var n,s;n=[i(7),i(940)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{assign:"selectVisit","assign/visit/:visit(/page/:page)":"assignVisit"},loadEvents:["assign:visit"]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(45),i(37),i(941),i(943)],void 0===(s=function(e,t,i,n,s){var a={title:"Assign Containers",url:"/assign"},l={selectVisit:function(e){app.loading();var t=new i(null,{queryParams:{next:1}});t.fetch({success:function(){app.bc.reset([a]),app.content.show(new n({collection:t}))},error:function(){app.bc.reset([a,{title:"Error"}]),app.message({title:"Couldn't load visit list",message:"Couldn't load visit list please try again"})}})},assignVisit:function(e,i){app.loading(),app.cookie(e.split("-")[0]);var n=new t({VISIT:e});n.fetch({success:function(){app.bc.reset([a,{title:e,url:"/dc/visit/"+e}]),i=i?parseInt(i):1,app.content.show(new s({visit:n,page:i}))},error:function(){app.bc.reset([a,{title:"Error"}]),app.message({title:"No such visit",message:"The specified visit doesnt exist"})}})}};return app.addInitializer((function(){app.on("assign:visit",(function(e){app.navigate("assign/visit/"+e),l.assign(e)}))})),l}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(942)],void 0===(a=function(e,t){var i=e.ItemView.extend({tagName:"li",template:n.template('<a href="/assign/visit/<%-VISIT%>"><%-VISIT%></a>: <%-BL%> - <%-ST%>'),className:function(){if(1==this.model.get("ACTIVE"))return"active"}}),s=e.ItemView.extend({tagName:"li",template:n.template("No upcoming / current visits")});return e.CompositeView.extend({template:t,className:"content",childView:i,childViewContainer:"ul.visits",emptyView:s})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Assign Containers: Select a Visit</h1>\n\n<p class="help">Select a visit for which you want to assign samples to the beamline sample changer</p>\n\n<ul class="visits clearfix"></ul>';return __p}},function(e,t,i){(function(n){var s,a;s=[i(7),i(6),i(62),i(81),i(80),i(48),i(121),i(152),i(944),i(11),i(945),i(946)],void 0===(a=function(e,t,i,s,a,l,o,r,c,p,d){var u=e.CompositeView.extend({template:n.template('<span class="r"><a class="button button-notext" title="Click to view container contents" href="/containers/cid/<%-CONTAINERID%>"><i class="fa fa-search"></i> <span>View Container</span></a></span><h1><%-NAME%></h1>'),className:function(){return"container"+(this.getOption("assigned")?" assigned":"")},initialize:function(e){this.getOption("model").view=this},onRender:function(){this.$el.draggable({containment:"#drag_container",stack:"#unassigned div",revert:!0})},events:{"drop:assign":"assignContainer","drop:unassign":"unassignContainer"},onDestroy:function(){this.model.view=null},assignContainer:function(e,t){console.log("confirm container on to",t.id,this.model),p.confirm({title:"Confirm Container Assignment",content:"Are you sure you want to assign &quot;"+this.model.get("NAME")+"&quot; to sample changer position &quot;"+t.id+"&quot;?",callback:this.doAssign.bind(this,t)})},doAssign:function(e){console.log("dropped container on to",e.id,this.model,e.assigned);var i=e.assigned.where({SAMPLECHANGERLOCATION:e.id.toString()});console.log(i),n.each(i,(function(t){t.view.doUnAssign.call(t.view,e)})),t.ajax({url:app.apiurl+"/assign/assign",data:{visit:e.visit,cid:this.model.get("CONTAINERID"),pos:e.id},success:this.assignUpdateGUI.bind(this,e),error:function(e,t,i){app.alert({message:"Something went wrong assigning this container:"})}})},assignUpdateGUI:function(e){this.trigger("remove:container",this.model),this.model.set({SAMPLECHANGERLOCATION:e.id.toString()}),e.assigned.add(this.model)},unassignContainer:function(e,t){console.log("unassign container",this.model),p.confirm({title:"Confirm Container Unassignment",content:"Are you sure you want to unassign &quot;"+this.model.get("NAME")+"&quot; from sample changer position &quot;"+this.model.get("SAMPLECHANGERLOCATION")+"&quot;?",callback:this.doUnAssign.bind(this,t)})},doUnAssign:function(e){console.log("unassigning",this.model),t.ajax({url:app.apiurl+"/assign/unassign",data:{visit:e.visit,cid:this.model.get("CONTAINERID")},success:this.unassignUpdateGUI.bind(this,e),error:function(e,t,i){app.alert({message:"Something went wrong unassigning this container:"})}})},unassignUpdateGUI:function(e){(this.model.set({SAMPLECHANGERLOCATION:null}),this.trigger("remove:container",this.model),n.uniq(e.shipments.pluck("SHIPPINGID")).indexOf(this.model.get("SHIPPINGID"))>-1)&&(e.shipments.findWhere({SHIPPINGID:this.model.get("SHIPPINGID")}).get("DEWARS").findWhere({DEWARID:this.model.get("DEWARID")}).get("CONTAINERS").add(this.model),console.log("add container to dewar"))}}),h=e.CompositeView.extend({template:n.template('<h1 class="clearfix"><%-CODE%><span class="r deactivate"><a class="button deact"><i class="fa  fa-power-off"></i> Deactivate Dewar</a></span></h1><div class="containers clearfix"></div>'),className:function(){var e="dewar clearfix";return"processing"==this.model.get("DEWARSTATUS")&&(e+=" active"),e},childView:u,childEvents:{"remove:container":"removeContainer"},events:{"click a.deact":"deactivateDewar"},deactivateDewar:function(e){e.preventDefault();var i=this;t.ajax({url:app.apiurl+"/assign/deact",data:{did:this.model.get("DEWARID")},success:function(){i.$el.removeClass("active"),i.trigger("refresh")},error:function(){app.alert({message:"Something went wrong deactivating this dewar"})}})},removeContainer:function(e,t){console.log("remove container dewar",t),this.collection.remove(t),this.render()},initialize:function(e){this.collection=this.model.get("CONTAINERS")},onRender:function(){this.$el.show()}}),m=e.CompositeView.extend({template:n.template("<h1><%-SHIPPINGNAME%></h1>"),childView:h,className:"shipment",initialize:function(e){this.collection=this.model.get("DEWARS")}}),_=e.CompositeView.extend({className:"bl_puck",template:n.template('<%-id%> <span class="name"></span><div class="ac"></div>'),childView:u,childViewOptions:{assigned:!0},childViewContainer:".ac",childEvents:{"remove:container":"removeContainer"},ui:{name:".name"},removeContainer:function(e,t){console.log("remove container position",t),this.collection.remove(t),this.render()},collectionEvents:{"change reset":"render"},events:{drop:"handleDrop"},initialize:function(e){this.collection=new a,this.assigned=e.assigned,this.listenTo(this.assigned,"change sync reset add remove",this.updateCollection,this),this.updateCollection(),this.listenTo(this.getOption("pucknames"),"sync",this.getNameModel)},getNameModel:function(){this.name=this.getOption("pucknames").findWhere({id:this.model.get("id")}),this.name&&(this.listenTo(this.name,"change update",this.updateName),this.updateName())},updateName:function(){this.name&&this.name.get("name")&&this.ui.name.text(" - "+this.name.get("name"))},updateCollection:function(){this.collection.reset(this.assigned.findWhere({SAMPLECHANGERLOCATION:this.model.get("id").toString()}))},onRender:function(){this.$el.attr("id","blpos"+this.model.get("id")),this.$el.droppable({accept:".container",hoverClass:"bl_puck_drag"}),this.updateName()},handleDrop:function(e,t){t.draggable.trigger("drop:assign",{id:this.model.get("id"),assigned:this.assigned,visit:this.getOption("visit")})}}),f=e.CollectionView.extend({className:"clearfix",childView:_,childViewOptions:function(){return{assigned:this.getOption("assigned"),visit:this.getOption("visit"),pucknames:this.getOption("pucknames")}}});return e.CompositeView.extend({template:d,className:"content",childView:m,childViewContainer:"#unassigned",events:{"drop #unassigned":"handleDrop"},handleDrop:function(e,t){t.draggable.trigger("drop:unassign",{shipments:this.collection,visit:this.getOption("visit").get("VISIT")})},templateHelpers:function(){return{VISIT:this.getOption("visit").toJSON()}},refresh:function(){this.assigned.fetch(),this.containers.fetch()},initialize:function(e){this.collection=new s,this.assigned=new a(null,{queryParams:{assigned:1,bl:this.getOption("visit").get("BL")},state:{pageSize:9999}}),this.assigned.fetch(),this.containers=new a(null,{queryParams:{unassigned:this.getOption("visit").get("BL")},state:{pageSize:30,currentPage:e.page}});var t=this;this.containers.fetch().done((function(){console.log(t.containers)})),this.listenTo(this.containers,"sync",this.generateShipments,this),this.paginator=new i({collection:this.containers}),this.pucknames=new c,this.pucknames.state.pageSize=100,this.pucknames.queryParams.bl=this.getOption("visit").get("BL"),this.pucknames.fetch()},generateShipments:function(){console.log("generate shipments");var e=n.uniq(this.containers.pluck("SHIPPINGID")),t=[];if(n.each(e,(function(e){var i=new a(this.containers.where({SHIPPINGID:e})),s=n.uniq(i.pluck("DEWARID")),c=new l;n.each(s,(function(e){var t=i.findWhere({DEWARID:e}),n=new r({DEWARID:e,CODE:t.get("DEWAR"),DEWARSTATUS:t.get("DEWARSTATUS"),CONTAINERS:new a(i.where({DEWARID:e}))});c.add(n)}),this);var p=new o({SHIPPINGID:e,SHIPPINGNAME:i.at(0).get("SHIPMENT"),DEWARS:c});t.push(p)}),this),0==t.length){var i=new o({SHIPPINGID:0,SHIPPINGNAME:"Drag Container here to unassign"});t.push(i)}this.collection.reset(t)},onShow:function(){if(this.getOption("visit").get("BL")in app.config.pucks)var e=app.config.pucks[this.getOption("visit").get("BL")];else e=10;var i=new t.Collection(n.map(n.range(1,e+1),(function(e){return{id:e}})));this.scview=new f({collection:i,assigned:this.assigned,visit:this.getOption("visit").get("VISIT"),shipments:this.collection,pucknames:this.pucknames}),this.$el.find("#assigned").append(this.scview.render().$el),this.$el.find(".page_wrap").append(this.paginator.render().$el),this.$el.find("#unassigned").droppable({accept:".bl_puck .ac div",hoverClass:"unassigned_drag"})},onDestroy:function(){this.scview&&this.scview.destroy(),this.pucknames.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){var n,s;n=[i(10)],void 0===(s=function(e){return e.extend({mode:"client",url:"/assign/names",initialize:function(e){this.bind("sync",this.poll,this),this.refresh_thread=null,this.running=!0},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},poll:function(){clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),1e4))}})}.apply(t,n))||(e.exports=s)},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>Container Allocation for "+(null==(__t=VISIT.VISIT)?"":_.escape(__t))+" on "+(null==(__t=VISIT.BL)?"":_.escape(__t))+" at "+(null==(__t=VISIT.ST)?"":_.escape(__t))+'</h1>\n\n<p class="help">This page allows you to allocate samples from ISPyB to the beamline sample changer. Drag and drop containers on to the locations on the beamline. Shipments and Dewars can be expanded by clicking on their titles</p>\n<p class="help">Uassign containers by dragging them to any shipment listed under "Unassigned Containers". The container will still belong to its original shipment.</p>\n\n<p class="ra">\n   <a href="/dc/visit/'+(null==(__t=VISIT.VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> Data Collections</a>\n</p>\n\n<div class="drag_container">\n    \n    <div class="c_holder">\n        <h1>Assigned Containers: <?php echo $bl ?> Sample Changer</h1>\n        <div id="assigned"></div>\n    </div>\n    \n    <div class="c_holder">\n        <div class="r"><a class="button" href="/containers/add/visit/'+(null==(__t=VISIT.VISIT)?"":_.escape(__t))+'" title="Click to create a new container"><i class="fa fa-plus"></i> Add New Container</a></div>\n        <h1>Unassigned Containers</h1>\n        <div class="page_wrap"></div>\n        <div id="unassigned"></div>\n    </div>\n    \n</div>\n';return __p}},,function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"faults(/bl/:bl)(/sys/:sys)(/com/:com)(/sub/:sub)(/page/:page)":"list","faults/fid/:fid":"view","faults/add":"add","faults/edit":"edit"},loadEvents:["fault:show"],loadModule:function(e){i.e(1).then(i.t.bind(null,1122,7)).then(t=>{e(t)})}}))}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"stats(/page/:page)":"proposal","stats/visit/:visit(/from/:from)(/to/:to)":"visit","stats/overview(/s/:s)(/page/:page)":"overview","stats/overview/beamlines(/s/:s)(/page/:page)":"bls_overview","stats/overview/bl/:bl":"bl_overview","stats/bl/:bl(/run/:run)(/from/:from)(/to/:to)":"beamline"},loadEvents:["stats:show"],loadModule:function(e){i.e(7).then(i.t.bind(null,1132,7)).then(t=>{e(t)})}}))({rjsController:"modules/stats/controller"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"statistics(/:type)(/:subtype)":"stats"},loadModule:function(e){i.e(7).then(i.t.bind(null,1158,7)).then(t=>{e(t)})}}))({rjsController:"modules/blstats/controller"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(951)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"status/bl/:bl":"status"}}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(952)],void 0===(s=function(e,t){var i={title:"Beamline Status"};return{status:function(e){app.loading(),app.bc.reset([i,{title:e}]),app.content.show(new t({bl:e}))}}}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(7),i(379),i(953),i(955),i(11),i(419),i(961)],void 0===(a=function(e,t,i,s,a,l,o){return e.LayoutView.extend({className:"content",template:o,regions:{pvs:".pvs",ep:".screens",gda:".gda",cal:".calendar"},events:{"click h1.status.oavs":"toggleOAV"},toggleOAV:function(){var e=this;this.$el.find("div.status.oavs").slideToggle("fast","swing",(function(){if(e.$el.find("div.status.oavs").is(":visible")){var t=app.apiurl+"/image/oav/bl/"+e.getOption("bl");a.sign({url:t,callback:function(i){e.$el.find(".oav img").attr("src",t+"?token="+i.token)}})}else e.$el.find(".oav img").attr("src","")}))},templateHelpers:function(){return{BL:this.getOption("bl"),APIURL:app.apiurl}},initialize:function(e){},onRender:function(){this.ep.show(new s({bl:this.getOption("bl")})),this.gda.show(new i({bl:this.getOption("bl")})),this.$el.find("div.status.pv, div.status.webcams").show(),this.pvs.show(new t({bl:this.getOption("bl")}));var e=this;this.$el.find(".webcam img").each((function(t,i){var s=app.apiurl+"/image/cam/bl/"+e.getOption("bl")+"/n/"+t;a.sign({url:s,callback:function(e){n(i).attr("src",s+"?token="+e.token)}})})),this.cal.show(new l({all:1,bl:this.getOption("bl")}))},onBeforeDestroy:function(){this.$el.find(".webcam img").each((function(e,t){n(t).attr("src","")})),this.$el.find(".oav img").attr("src","")}})}.apply(t,s))||(e.exports=a)}).call(this,i(8))},function(e,t,i){(function(n){var s,a;s=[i(7),i(954)],void 0===(a=function(e,t){var i=e.ItemView.extend({tagName:"li",template:n.template("<%-LINE%>"),modelEvents:{change:"render"},onRender:function(){}});return e.CollectionView.extend({tagName:"ul",childView:i,initialize:function(e){this.collection=new t(null,{bl:this.getOption("bl")});var i=this;this.collection.fetch().done((function(){console.log(i.collection)}))},onDestroy:function(){this.collection.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(10)],void 0===(a=function(e,t){var i=e.Model.extend({idAttribute:"LINE"});return t.extend({model:i,url:function(){return"/status/log/"+this.bl},mode:"infinite",initialize:function(e,t){this.bl=t.bl,this.running=!0,t&&0==t.running&&(this.running=!1),this.refresh_thread=null},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},parseRecords:function(e,t){clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),5e3));var i=[];return n.each(e.reverse(),(function(e){i.push({LINE:e})})),i}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(27),i(956),i(957)],void 0===(a=function(e,t,i,s){var a=e.ItemView.extend({tagName:"li",template:n.template('<a href="#" class="button"><%-NAME%></a>'),events:{"click a.button":"showMotors"},showMotors:function(e){e.preventDefault(),app.dialog.show(new t({title:"EPICS "+this.model.get("NAME"),view:new s({epid:this.model.get("ID"),bl:this.getOption("bl")}),autoSize:1}))}});return e.CollectionView.extend({tagName:"ul",childView:a,childViewOptions:function(){return{bl:this.getOption("bl")}},initialize:function(e){this.collection=new i(null,{bl:this.getOption("bl")}),this.collection.fetch()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6),i(14)],void 0===(a=function(e,t){return e.Collection.extend(n.extend({},t,{url:function(){return"/status/ep/"+this.bl},initialize:function(e,t){this.bl=t.bl},keyAttribute:"NAME",valueAttribute:"ID",parse:function(e,t,i){var s=[];return n.each(e,(function(e,t){s.push({ID:t,NAME:e})}),this),s}}))}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(7),i(958),i(959),i(960)],void 0===(a=function(e,t,i,s){var a=e.ItemView.extend({template:s,ui:{b:".button"},modelEvents:{change:"render"},onRender:function(){this.model.get("val")?this.ui.b.addClass("active"):this.ui.b.removeClass("active")}}),l=e.ItemView.extend({template:i,ui:{val:".value",rbv:".readback"},modelEvents:{change:"render"},onRender:function(){this.ui.val.text(this.model.get("val").VAL),this.ui.rbv.text(this.model.get("val").RBV);n.each({SEVR:{MAJOR:"inactive",MINOR:"minor"},DMOV:{0:"active"},HLS:{1:"minor"},LLS:{1:"minor"},LVIO:{1:"minor"}},(function(e,t){var i=this.$el.find(".button."+t.toLowerCase());n.each(e,(function(e,n){this.model.get("val")[t]==n?i.addClass(e):i.removeClass(e)}),this)}),this);var e=this.$el.find(".button.ffe");64==(64&this.model.get("MSTA"))?e.addClass("inactive"):e.removeClass("inactive")}});return e.CollectionView.extend({getChildView:function(e){return 1==e.get("t")?l:a},initialize:function(e){this.collection=new t(null,{bl:this.getOption("bl"),epid:this.getOption("epid")});this.collection.fetch()},onDestroy:function(){this.collection.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(e,t,i){(function(n){var s,a;s=[i(6)],void 0===(a=function(e){return e.Collection.extend({url:function(){return"/status/epics/"+this.bl+"/c/"+this.epid},initialize:function(e,t){this.bl=t.bl,this.epid=t.epid,this.running=!0,t&&0==t.running&&(this.running=!1),this.refresh_thread=null},stop:function(){clearTimeout(this.refresh_thread),this.running=!1},parse:function(e,t){clearTimeout(this.refresh_thread),this.running&&(this.refresh_thread=setTimeout(this.fetch.bind(this),5e3));var i=[];return n.each(e,(function(e,t){i.push(n.extend(e,{title:t}))}),this),i}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="motor">\n    <div class="value" title="Set Value"></div>\n    <h1>'+(null==(__t=title)?"":_.escape(__t))+'</h1>\n    <div class="main">\n        <div class="below">\n            <div class="button l sevr" title="Alarm">!</div>\n            <div class="button r dmov" title="Moving">M</div>\n            <div class="readback" title="Readback Value"></div>\n        </div>\n    </div>\n    <div class="buttons clearfix">\n        <div class="label"><div class="button hls">&nbsp;</div> High Limit</div>\n        <div class="label"><div class="button lls">&nbsp;</div> Low Limit</div>\n        <div class="label"><div class="button lvio">&nbsp;</div> Soft Limit</div>\n        <div class="label"><div class="button ffe">&nbsp;</div> Following Error</div>\n    </div>\n</div>\n';return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="motor">\n    <h1 class="clearfix"><div class="button r">&nbsp;</div>'+(null==(__t=title)?"":_.escape(__t))+"</h1>\n</div>";return __p}},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="status">'+(null==(__t=BL)?"":_.escape(__t))+' Beamline Status</h1>\n<div class="status pv">\n    <div class="pvs"></div>\n</div>\n    \n<h1 class="status webcams">Webcams</h1>\n<div class="status webcams clearfix ',"i02"==BL&&(__p+="three"),__p+='">\n    <div class="webcam"><img alt="webcam1" src="#" /></div>\n    <div class="webcam"><img alt="webcam2" src="#" /></div>\n    ',"i02"==BL&&(__p+='\n\t<div class="webcam"><img alt="webcam3" src="#" /></div>\n    '),__p+='\n</div>\n\n<h1 class="status oavs">OAV</h1>\n<div class="status oavs clearfix">\n    <div class="oav"><img src="#" alt="oav" /></div>\n</div>\n\n<h1>EPICS Screens</h1>\n<div class="screens"></div>\n\n<h1>GDA Log</h1>\n\n<div class="log gda"></div>\n\n<div class="calendar"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"docs(/:id)":"docs"},loadModule:function(e){i.e(3).then(i.t.bind(null,1188,7)).then(t=>{e(t)})}}))}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{feedback:"feedback"},loadModule:function(e){i.e(3).then(i.t.bind(null,1198,7)).then(t=>{e(t)})}}))}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(965)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"mc/visit/:visit(/page/:page)(/s/:search)":"dcs"},loadEvents:[]}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(966),i(41)],void 0===(s=function(e,t,i){var n={title:"Multicrystal Processing",url:"/mc"};return{dcs:function(e,s,a){app.loading(),app.cookie(e.split("-")[0]);var l=new i(null,{queryParams:{visit:e,s:a,t:"fc"}});l.setPageSize(app.mobile()?5:16),s=s?parseInt(s):1,l.state.currentPage=s,l.fetch().done((function(){app.bc.reset([n,{title:e,url:"/dc/visit/"+e},{title:"Merge Data Collections"}]),app.content.show(new t({collection:l,params:{visit:e,search:a}}))}))}}}.apply(t,n))||(e.exports=s)},function(e,t,i){(function(n){var s,a;s=[i(6),i(7),i(227),i(62),i(183),i(383),i(228),i(384),i(229),i(230),i(231),i(232),i(14),i(11),i(967)],void 0===(a=function(e,t,i,s,a,l,o,r,c,p,d,u,h,m,_){var f=t.CollectionView.extend({childView:i}),g=e.Collection.extend(n.extend({keyAttribute:"NAME",valueAttribute:"VALUE"},h));return t.LayoutView.extend({className:"content",template:_,regions:{dcs:".dcs",srch:".srch",pages:".page_wrap",rps:".rps"},events:{"click .integrate":"integrate"},ui:{jobs:".jobs",wait:".wait",met:"select[name=method]"},templateHelpers:function(){return{VISIT:this.getOption("params").visit}},integrate:function(e){e.preventDefault();var t=this.collection.where({selected:!0});if(t.length){var i=this,s=this.pipelines.findWhere({VALUE:i.ui.met.val()}),a=new o({DATACOLLECTIONID:t[0].get("ID"),COMMENTS:"Multicrystal integrator",DISPLAYNAME:s.get("NAME"),RECIPE:i.ui.met.val()});a.save({},{success:function(){var e=new p,s=i.$el.find("input[name=res]").val();s&&e.add(new c({PROCESSINGJOBID:a.get("PROCESSINGJOBID"),PARAMETERKEY:"d_min",PARAMETERVALUE:s}));var l=!0,o=[];n.each(["a","b","c","alpha","beta","gamma"],(function(e,t){var n=i.$el.find("input[name="+e+"]").val().replace(/\s/g,"");n?o.push(n):l=!1})),l&&e.add(new c({PROCESSINGJOBID:a.get("PROCESSINGJOBID"),PARAMETERKEY:"unit_cell",PARAMETERVALUE:o.join(",")}));var r=i.$el.find("input[name=sg]").val().replace(/\s/g,"");r&&e.add(new c({PROCESSINGJOBID:a.get("PROCESSINGJOBID"),PARAMETERKEY:"spacegroup",PARAMETERVALUE:r})),i.$el.find("input[name=sm]").is(":checked")&&e.add(new c({PROCESSINGJOBID:a.get("PROCESSINGJOBID"),PARAMETERKEY:"small_molecule",PARAMETERVALUE:"true"})),e.length&&e.save();var d=[];n.each(t,(function(e){d.push({PROCESSINGJOBID:a.get("PROCESSINGJOBID"),DATACOLLECTIONID:e.get("ID"),STARTIMAGE:e.get("selection")[0],ENDIMAGE:e.get("selection")[1]})})),new u(d).save(),app.alert({message:"1 reprocessing job successfully submitted"}),i._enqueue({PROCESSINGJOBID:a.get("PROCESSINGJOBID")})},error:function(){app.alert({message:"Something went wrong starting that reprocessing run"})}})}else m.confirm({title:"No data collections selected",content:"Please selected some data sets to integrate"})},_enqueue:function(t){e.ajax({url:app.apiurl+"/process/enqueue",method:"POST",data:{PROCESSINGJOBID:t.PROCESSINGJOBID}})},initialize:function(e){this.paginator=new s({collection:e.collection,noUrl:e.noPageUrl}),this.search=new a({value:e.params.search,collection:e.collection,url:!e.noSearchUrl}),this.reprocessings=new r,this.reprocessings.queryParams.visit=e.visit,this.reprocessings.state.pageSize=5,this.listenTo(this.reprocessings,"sync",this.setJobs),this.reprocessings.fetch()},setJobs:function(){var e=this.reprocessings.running,t=this.reprocessings.waiting;this.ui.jobs.text(e),this.ui.wait.text(t),e>0?this.ui.jobs.parent("li").addClass("running"):this.ui.jobs.parent("li").removeClass("running")},onRender:function(){this.pages.show(this.paginator),this.srch.show(this.search);var e=new f({collection:this.collection});this.dcs.show(e),this.listenTo(e,"childview:set:cell",this.setCell,this),this.rps.show(new l({collection:this.reprocessings,embed:!0,results:!0})),this.pipelines=new g([{NAME:"Xia2 3dii",VALUE:"xia2-3dii"},{NAME:"Xia2 DIALS",VALUE:"xia2-dials"},{NAME:"Fast DP",VALUE:"fast_dp"}]),this.ui.met.html(this.pipelines.opts())},setCell:function(e,t){console.log("set cell main view",e,t),n.each({a:"a",b:"b",c:"c",alpha:"al",beta:"be",gamma:"ga"},(function(e,i){this.$el.find("input[name="+i+"]").val(t.get("CELL")["CELL_"+e.toUpperCase()])}),this),this.$el.find("input[name=sg]").val(t.get("SG"))},onDestroy:function(){this.reprocessings.stop(),this.collection.stop()}})}.apply(t,s))||(e.exports=a)}).call(this,i(5))},function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>Data Collections for "+(null==(__t=VISIT)?"":_.escape(__t))+'</h1>\n\n    <p class="help">Use this page to reintegrate multiple data collections together</p>\n    <p class="help">Select data sets to integrate by dragging accross the DISTL plot below. This selects which images of the data set to integrate</p>\n\n    <div class="filter filter-nohide">\n    \t<div class="srch"></div>\n        <ul class="clearfix">\n            <li><span class="wait">-</span> job(s) waiting</li>\n            <li><span class="jobs">-</span> job(s) running</li>\n        </ul>\n    </div>\n\n    <div class="rps"></div>\n\n    <div class="cell data_collection">\n        <div class="autoproc">\n            <label>Auto Processed <select name="cells"></select></label>\n        </div>\n\n        <lable>Pipeline <select name="method"></select></lable>\n        <label>Spacegroup: <input type="text" name="sg" /></label>\n\n        <label>a <input type="text" name="a" /></label>\n        <label>b <input type="text" name="b" /></label>\n        <label>c <input type="text" name="c" /></label>\n        <label>&alpha; <input type="text" name="alpha" /></label>\n        <label>&beta; <input type="text" name="beta" /></label>\n        <label>&gamma; <input type="text" name="gamma" /></label>\n\n        <label>High Resolution <input type="text" name="res" /></label>\n\n        <a href="#" class="button integrate" title="Integrate the selected data collections"><i class="fa fa-cog"></i> Integrate</a>\n    </div>\n\n    <div class="options data_collection">\n        <label><input type="checkbox" name="sm" value="1" /> Small Molecule</label>\n    </div>\n\n    <div class="dcs"></div>\n    <div class="page_wrap"></div>\n';return __p}},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"admin/groups":"manageGroups","admin/groups/:gid":"viewGroup","admin/proposals":"manageProposals","admin/proposals/add":"addProposal","admin/proposals/:prop":"viewProposal","admin/proposals/visit/add/:prop":"addVisit","admin/proposals/visit/:visit":"viewVisit","admin/users":"manageUsers","admin/users/add":"addUser","admin/users/:person":"viewUser"},loadEvents:["group:show","proposal:show","visit:show","useradm:show"],loadModule:function(e){i.e(1).then(i.t.bind(null,1202,7)).then(t=>{e(t)})}}))({rjsController:"modules/admin/controller"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(50)],void 0===(s=function(e){return new(e.extend({appRoutes:{"admin/imaging":"imaging_dash","admin/imaging/schedule":"schedules","admin/imaging/schedule/:sid":"view_schedule","admin/imaging/preset":"view_presets","admin/imaging/param":"view_params","imaging/screen":"screens","imaging/screen/:sid":"view_screen"},loadEvents:["schedule:view","screen:view"],loadModule:function(e){Promise.all([i.e(0),i.e(4)]).then(i.t.bind(null,1230,7)).then(t=>{e(t)})}}))({rjsController:"modules/imaging/controller"})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(971)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"em/process/relion/session/:session_str":"relion"}}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(45),i(972)],void 0===(s=function(e,t,i){return{relion:function(e){app.loading(),e?(app.cookie(e.split("-")[0]),app.content.show(new i({session_str:e}))):(app.bc.reset([{title:"Error"}]),app.message({title:"Session not specified",message:"No session specified"}))}}}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6),i(51),i(159),i(160),i(64),i(124),i(973),i(45),i(974)],void 0===(s=function(e,t,i,n,s,a,l,o,r){return t.use(i),s.extend({vueView:t.extend({template:r,data:function(){return{showSpinner:!1,isSessionLoaded:!1,isSessionActive:!1,isFormReadOnly:!0,isJobStarted:!1,isJobStopped:!1,isLogVisible:!1,sessionEvents:[],session:{},projectAcquisitionSoftware:null,projectMovieFileNameExtension:null,projectGainReferenceFile:null,projectGainReferenceFileName:null,voltage:null,sphericalAberration:null,findPhaseShift:null,pixelSize:null,motionCorrectionBinning:null,dosePerFrame:null,pipelineDo1stPass:null,pipelineDo1stPassClassification2d:null,pipelineDo1stPassClassification3d:null,particleUseCryolo:null,particleDiameterMin:null,particleDiameterMax:null,particleMaskDiameter:null,particleBoxSize:null,particleBoxSizeSmall:null,particleCalculateForMe:null,pipelineDo2ndPass:null,pipelineDo2ndPassClassification2d:null,pipelineDo2ndPassClassification3d:null}},created:function(){this.showSpinner=!0;let e=new o({VISIT:this.$getOption("session_str")}),t=this;e.fetch({success:function(i,n,s){t.session=e.attributes,t.isSessionLoaded=!0,t.isSessionActive=!!+t.session.ACTIVE,t.isSessionActive?t.resetForm():t.sessionEndDateAsString=a.default(t.session.ENISO,"HH:mm 'on' do MMMM"),app.bc.reset([{title:"Data Collections",url:"/dc"},{title:t.session.BL},{title:t.session.VISIT,url:"/dc/visit/"+t.session.VISIT},{title:"Relion Processing"}]),t.sessionEvents=[],t.showSpinner=!1},error:function(e,i,n){t.showSpinner=!1,app.bc.reset([{title:"Error"}]),app.message({title:"No such session",message:"The specified session does not exist"})}})},methods:{resetForm:function(){this.isJobStarted=!1,this.isJobStopped=!1,this.processingIsActive=!1,this.processingTimestamp=!1,this.projectAcquisitionSoftware="EPU",this.projectMovieFileNameExtension=".tiff",this.projectGainReferenceFile=!1,this.projectGainReferenceFileName="gain.mrc",this.voltage=300,this.sphericalAberration=2.7,this.findPhaseShift=null,this.pixelSize=null,this.motionCorrectionBinning=1,this.dosePerFrame=.5,this.pipelineDo1stPass=!1,this.pipelineDo1stPassClassification2d=!0,this.pipelineDo1stPassClassification3d=!1,this.particleUseCryolo=!1,this.particleDiameterMin=null,this.particleDiameterMax=null,this.particleMaskDiameter=null,this.particleBoxSize=null,this.particleBoxSizeSmall=null,this.particleCalculateForMe=!0,this.pipelineDo2ndPass=!1,this.pipelineDo2ndPassClassification2d=!1,this.pipelineDo2ndPassClassification3d=!1,this.isLogVisible=!1,this.sessionEvents=[],this.checkStatus(),this.$nextTick((function(){this.$validator.reset()}))},onCalculateForMe:function(){if(this.pipelineDo1stPass&&this.particleCalculateForMe)if(!this.pixelSize||isNaN(this.pixelSize)||this.errors.has("pixelSize")||!this.particleDiameterMax||isNaN(this.particleDiameterMax)||this.errors.has("particleDiameterMax"))this.particleMaskDiameter=null,this.particleBoxSize=null,this.particleBoxSizeSmall=null;else{let e=this.particleDiameterMax/this.pixelSize;this.particleMaskDiameter=Math.round(1.1*this.particleDiameterMax),this.particleBoxSize=function(e,t){let i=1.2*e,n=Math.ceil(i);return n+n%2}(e,this.motionCorrectionBinning),this.particleBoxSizeSmall=function(e,t,i){let n=[48,64,96,128,160,192,256,288,300,320,360,384,400,420,450,480,512,640,768,896,1024];for(let i=0;i<n.length;i++){let s=n[i];if(s>e)return e;if(t*e/s<4.25)return s}return"Box size is too large!"}(this.particleBoxSize,this.pixelSize,this.motionCorrectionBinning)}},onStart:function(){let e=this;this.$validator.validateAll().then((function(t){if(t){this.showSpinner=!0,this.voltage=parseInt(this.voltage),this.sphericalAberration=parseFloat(this.sphericalAberration),this.findPhaseShift=!0===this.findPhaseShift,this.pixelSize=parseFloat(this.pixelSize),this.motionCorrectionBinning=parseInt(this.motionCorrectionBinning),this.dosePerFrame=parseFloat(this.dosePerFrame),this.pipelineDo1stPass=!0===this.pipelineDo1stPass,this.pipelineDo1stPassClassification2d=!0===this.pipelineDo1stPassClassification2d,this.pipelineDo1stPassClassification3d=!0===this.pipelineDo1stPassClassification3d,this.pipelineDo1stPass&&(this.particleUseCryolo=!0===this.particleUseCryolo,this.particleDiameterMin=parseFloat(this.particleDiameterMin),this.particleDiameterMax=parseFloat(this.particleDiameterMax),this.particleMaskDiameter=parseInt(this.particleMaskDiameter),this.particleBoxSize=parseInt(this.particleBoxSize),this.particleBoxSizeSmall=parseInt(this.particleBoxSizeSmall),this.particleCalculateForMe=!0===this.particleCalculateForMe),this.pipelineDo2ndPass=!0===this.pipelineDo2ndPass,this.pipelineDo2ndPassClassification2d=!0===this.pipelineDo2ndPassClassification2d,this.pipelineDo2ndPassClassification3d=!0===this.pipelineDo2ndPassClassification3d;let t=new l({id:e.session.VISIT,projectAcquisitionSoftware:e.projectAcquisitionSoftware,projectMovieFileNameExtension:e.projectMovieFileNameExtension.substr(1),projectGainReferenceFile:e.projectGainReferenceFile,projectGainReferenceFileName:e.projectGainReferenceFile?e.projectGainReferenceFileName:null,voltage:e.voltage,sphericalAberration:e.sphericalAberration,findPhaseShift:e.findPhaseShift,pixelSize:e.pixelSize,motionCorrectionBinning:e.motionCorrectionBinning,dosePerFrame:e.dosePerFrame,pipelineDo1stPass:e.pipelineDo1stPass,pipelineDo1stPassClassification2d:!!e.pipelineDo1stPass&&e.pipelineDo1stPassClassification2d,pipelineDo1stPassClassification3d:!!e.pipelineDo1stPass&&e.pipelineDo1stPassClassification3d,particleUseCryolo:!!e.pipelineDo1stPass&&e.particleUseCryolo,particleDiameterMin:e.pipelineDo1stPass?e.particleDiameterMin:null,particleDiameterMax:e.pipelineDo1stPass?e.particleDiameterMax:null,particleMaskDiameter:e.particleMaskDiameter,particleBoxSize:e.particleBoxSize,particleBoxSizeSmall:e.particleBoxSizeSmall,particleCalculateForMe:e.particleCalculateForMe,pipelineDo2ndPass:e.pipelineDo2ndPass,pipelineDo2ndPassClassification2d:!!e.pipelineDo2ndPass&&e.pipelineDo2ndPassClassification2d,pipelineDo2ndPassClassification3d:!!e.pipelineDo2ndPass&&e.pipelineDo2ndPassClassification3d});e.isLogVisible=!0,t.save({},{type:"POST",success:function(t,i,n){e.isFormReadOnly=!0,e.isJobStarted=!0,e.isJobStopped=!1,e.showSpinner=!1,"timestamp"in i&&e.sessionEvents.unshift({timestamp_str:a.default(i.timestamp,"HH:mm:ss"),message:"Start processing."})},error:function(t,i,n){e.showSpinner=!1;let s="There was a problem starting this request.";"message"in i.responseJSON&&(s=i.responseJSON.message),app.alert({message:s})}})}else console.log("Form submission prevented, validation failed.")}))},onStop:function(){let t=this;e.ajax({type:"PATCH",url:app.apiurl+"/em/process/relion/session/"+this.session.VISIT,success:function(e){t.isJobStopped=!0,"timestamp"in e&&t.sessionEvents.unshift({timestamp_str:a.default(e.timestamp,"HH:mm:ss"),message:"Stop processing."})},error:function(e,i,n){t.showSpinner=!1;let s="There was a problem stopping this job.";"message"in i.responseJSON&&(s=i.responseJSON.message),app.alert({message:s})}})},checkStatus:function(){let t=this;e.ajax({type:"GET",url:app.apiurl+"/em/process/relion/session/"+this.session.VISIT,success:function(e){"processingIsActive"in e&&(t.processingIsActive=e.processingIsActive),"processingTimestamp"in e&&(t.processingTimestamp=e.processingTimestamp),!0===t.processingIsActive?(t.isFormReadOnly=!0,t.isJobStarted=!0):t.isFormReadOnly=!1},error:function(e,i,n){t.showSpinner=!1;let s="There was a problem checking this job.";"message"in i.responseJSON&&(s=i.responseJSON.message),app.alert({message:s})}})},onReset:function(){let t=this;e.ajax({type:"DELETE",url:app.apiurl+"/em/process/relion/session/"+this.session.VISIT,success:function(e){t.resetForm()},error:function(e,i,n){t.showSpinner=!1;let s="There was a problem resetting this job.";"message"in i.responseJSON&&(s=i.responseJSON.message),app.alert({message:s})}})}}})})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/em/process/relion/session"})}.apply(t,n))||(e.exports=s)},function(e,t){e.exports='<section class=content> <h1>Relion Processing</h1> <p class=help>This page is for submitting processing jobs to Relion.</p> <p v-if="isSessionLoaded && !isSessionActive" class="message alert"> This session ended at {{ sessionEndDateAsString }}. It may no longer be submitted for processing. <a class="button refresh" v-on:click.prevent=onContinue>OK</a> </p> <form novalidate v-bind:class="{loading: showSpinner}"> <div class=form> <ul> <li class=head>Project</li> <li> <label>Acquisition Software</label> <select name=projectAcquisitionSoftware v-if=!isFormReadOnly v-model=projectAcquisitionSoftware> <option value=EPU>EPU</option> <option value=SerialEM>SerialEM</option> </select> <input type=text name=projectAcquisitionSoftware v-if=isFormReadOnly v-model=projectAcquisitionSoftware v-bind:readonly=true style=margin-bottom:20px> </li> <li> <label>Movie File Name Extension</label> <select name=projectMovieFileNameExtension v-if=!isFormReadOnly v-model=projectMovieFileNameExtension> <option value=.tif>.tif</option> <option value=.tiff>.tiff</option> <option value=.mrc>.mrc</option> </select> <input type=text name=projectMovieFileNameExtension v-if=isFormReadOnly v-model=projectMovieFileNameExtension v-bind:readonly=true style=margin-bottom:20px> </li> <li> <label>Gain Reference File</label> <input type=checkbox name=projectGainReferenceFile v-model=projectGainReferenceFile v-bind:disabled=isFormReadOnly> </li> <li v-if=projectGainReferenceFile> <label>Gain Reference File Name</label> <input type=text name=projectGainReferenceFileName v-validate="{ required: true, regex: /^[\\w-]+\\.[\\w]{3,4}$/ }" v-model=projectGainReferenceFileName v-bind:readonly=isFormReadOnly> <span v-if="errors.has(\'projectGainReferenceFileName\')" class="errormessage ferror">{{ errors.first(\'projectGainReferenceFileName\') }}</span> </li> <li class=head>Experiment</li> <li> <label>Voltage (kV)</label> <select name=voltage v-if=!isFormReadOnly v-model=voltage> <option value=200>200</option> <option value=300>300</option> </select> <input type=text v-if=isFormReadOnly v-model=voltage v-bind:readonly=true style=margin-bottom:20px> </li> <li> <label>Spherical Aberration (mm)</label> <select name=sphericalAberration v-if=!isFormReadOnly v-model=sphericalAberration> <option value=2.7>2.7 (Talos/Krios)</option> </select> <input type=text name=sphericalAberration v-if=isFormReadOnly v-model=sphericalAberration v-bind:readonly=true style=margin-bottom:20px> </li> <li> <label>Phase Plate Used</label> <input type=checkbox name=findPhaseShift v-model=findPhaseShift v-bind:disabled=isFormReadOnly> </li> <li> <label>Pixel Size (Å/pixel)</label> <input type=text name=pixelSize v-validate="\'required|min_value:0.02|max_value:100\'" v-model=pixelSize v-on:keyup=onCalculateForMe v-bind:readonly=isFormReadOnly> <span v-if="errors.has(\'pixelSize\')" class="errormessage ferror">{{ errors.first(\'pixelSize\') }}</span> </li> <li> <label>Motion Correction Binning</label> <select name=voltage v-if=!isFormReadOnly v-model=motionCorrectionBinning> <option value=1>1</option> <option value=2>2</option> </select> <input type=text v-if=isFormReadOnly v-model=motionCorrectionBinning v-bind:readonly=true style=margin-bottom:20px> </li> <li> <label>Dose per frame (e<span class=super>-</span>/Å<span class=super>2</span>)</label> <input type=text name=dosePerFrame v-validate="\'required|min_value:0.02|max_value:10\'" v-model=dosePerFrame v-bind:readonly=isFormReadOnly> <span v-if="errors.has(\'dosePerFrame\')" class="errormessage ferror">{{ errors.first(\'dosePerFrame\') }}</span> </li> <li> <label>Continue after CTF estimation</label> <input type=checkbox name=pipelineDo1stPass v-model=pipelineDo1stPass v-bind:disabled=isFormReadOnly> </li> <li class=head v-if=pipelineDo1stPass>2D &amp; 3D Classification</li> <li v-if=pipelineDo1stPass> <label>Do 2D Classification</label> <input type=checkbox name=pipelineDo1stPassClassification2d v-model=pipelineDo1stPassClassification2d v-bind:disabled=isFormReadOnly> </li> <li v-if=pipelineDo1stPass> <label>Do 3D Classification</label> <input type=checkbox name=pipelineDo1stPassClassification3d v-model=pipelineDo1stPassClassification3d v-bind:disabled=isFormReadOnly> </li> <li class=head v-if=pipelineDo1stPass>Particle Picking</li> <li v-if=pipelineDo1stPass> <label>Use crYOLO</label> <input type=checkbox name=particleUseCryolo v-model=particleUseCryolo v-bind:disabled=isFormReadOnly> </li> <li v-if=pipelineDo1stPass> <label>Minimum Diameter (Å)</label> <input type=text name=particleDiameterMin v-validate="\'required|min_value:0.02|max_value:1024\'" v-model=particleDiameterMin v-bind:readonly=isFormReadOnly> <span v-if="errors.has(\'particleDiameterMin\')" class="errormessage ferror">{{ errors.first(\'particleDiameterMin\') }}</span> </li> <li v-if=pipelineDo1stPass> <label>Maximum Diameter (Å)</label> <input type=text name=particleDiameterMax v-validate="\'required|min_value:0.02|max_value:4000\'" v-model=particleDiameterMax v-on:keyup=onCalculateForMe v-bind:readonly=isFormReadOnly> <span v-if="errors.has(\'particleDiameterMax\')" class="errormessage ferror">{{ errors.first(\'particleDiameterMax\') }}</span> </li> <li v-if=pipelineDo1stPass> <label>Mask Diameter (Å)</label> <input type=text name=particleMaskDiameter v-validate="\'required|min_value:0.1|max_value:1024\'" v-model=particleMaskDiameter v-bind:readonly="isFormReadOnly || particleCalculateForMe"> <span v-if="errors.has(\'particleMaskDiameter\')" class="errormessage ferror">{{ errors.first(\'particleMaskDiameter\') }}</span> </li> <li v-if=pipelineDo1stPass> <label>Box Size (px)</label> <input type=text name=particleBoxSize v-validate="\'required|min_value:0.1|max_value:1024\'" v-model=particleBoxSize v-bind:readonly="isFormReadOnly || particleCalculateForMe"> <span v-if="errors.has(\'particleBoxSize\')" class="errormessage ferror">{{ errors.first(\'particleBoxSize\') }}</span> </li> <li v-if=pipelineDo1stPass> <label>Downsample Box Size (px)</label> <input type=text name=particleBoxSizeSmall v-validate="\'required|min_value:0.1|max_value:1024\'" v-model=particleBoxSizeSmall v-bind:readonly="isFormReadOnly || particleCalculateForMe"> <span v-if="errors.has(\'particleBoxSizeSmall\')" class="errormessage ferror">{{ errors.first(\'particleBoxSizeSmall\') }}</span> </li> <li v-if=pipelineDo1stPass> <label>Calculate For Me</label> <input type=checkbox name=particleCalculateForMe v-model=particleCalculateForMe @change=onCalculateForMe v-bind:disabled=isFormReadOnly> </li> <li class=head v-if=pipelineDo1stPass>Second Pass</li> <li v-if=pipelineDo1stPass> <label>Do Second Pass</label> <input type=checkbox name=pipelineDo2ndPass v-model=pipelineDo2ndPass v-bind:disabled=isFormReadOnly> </li> <li v-if="pipelineDo1stPass && pipelineDo2ndPass"> <label>Do 2D Classification</label> <input type=checkbox name=pipelineDo2ndPassClassification2d v-model=pipelineDo2ndPassClassification2d v-bind:disabled=isFormReadOnly> </li> <li v-if="pipelineDo1stPass && pipelineDo2ndPass"> <label>Do 3D Classification</label> <input type=checkbox name=pipelineDo2ndPassClassification3d v-model=pipelineDo2ndPassClassification3d v-bind:disabled=isFormReadOnly> </li> </ul> <button type=submit class=submit v-on:click.prevent=onStart v-if="!isJobStarted && !isJobStopped" v-bind:disabled=errors.any()> Start Processing </button> <button type=submit class=submit v-on:click.prevent=onStop v-if="isJobStarted && !isJobStopped"> Stop Processing </button> <button type=submit class=submit v-on:click.prevent=onStart v-if="isJobStarted && isJobStopped"> Resume </button> <button type=submit class=submit v-on:click.prevent=onReset v-if="isJobStarted && isJobStopped"> Reset </button> <div class=log style=margin-top:20px v-if="isLogVisible && sessionEvents.length"> <ul> <li v-for="sessionEvent in sessionEvents"> {{ sessionEvent.timestamp_str }} : {{ sessionEvent.message }} </li> </ul> </div> </div> </form> </section> '},function(e,t,i){var n,s;n=[i(7),i(976)],void 0===(s=function(e,t){return new(e.AppRouter.extend({appRoutes:{"em/process/scipion/visit/:visit_str":"scipion"}}))({controller:t})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(7),i(45),i(977)],void 0===(s=function(e,t,i){return{scipion:function(e){app.loading(),e?(app.cookie(e.split("-")[0]),app.content.show(new i({visit_str:e}))):(app.bc.reset([{title:"Error"}]),app.message({title:"Visit not specified",message:"No visit specified"}))}}}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(51),i(159),i(160),i(64),i(124),i(978),i(45),i(979)],void 0===(s=function(e,t,i,n,s,a,l,o){return e.use(t),n.extend({vueView:e.extend({template:o,data:function(){return{showSpinner:!1,isVisitLoaded:!1,isVisitActive:!1,isFormReadOnly:!0,isJobQueued:!1,visit:{},dosePerFrame:null,numberOfIndividualFrames:null,patchX:null,patchY:null,samplingRate:null,particleSize:null,minDist:null,windowSize:null,findPhaseShift:!1}},created:function(){let e=this;e.showSpinner=!0;let t=new l({VISIT:this.$getOption("visit_str")});t.fetch({success:function(){e.visit=t.attributes,e.isVisitLoaded=!0,e.isVisitActive=!!+e.visit.ACTIVE,e.isVisitActive?(e.isFormReadOnly=!1,e.resetForm()):e.visitEndDateAsString=s.default(e.visit.ENISO,"HH:mm 'on' do MMMM"),e.showSpinner=!1,app.bc.reset([{title:"Data Collections",url:"/dc"},{title:e.visit.BL},{title:e.visit.VISIT,url:"/dc/visit/"+e.visit.VISIT},{title:"Scipion Processing"}])},error:function(){app.bc.reset([{title:"Error"}]),app.message({title:"No such visit",message:"The specified visit does not exist"})}})},methods:{resetForm:function(){this.dosePerFrame=.5,this.numberOfIndividualFrames=null,this.patchX=5,this.patchY=5,this.samplingRate=null,this.particleSize=null,this.minDist=100,this.windowSize=512,this.findPhaseShift=!1,this.$nextTick((function(){this.$validator.reset()}))},onSubmit:function(){let e=this;this.$validator.validateAll().then((function(t){t?e.submitProcessingJob():console.log("Form submission prevented, validation failed.")}))},submitProcessingJob:function(){this.showSpinner=!0,this.dosePerFrame=parseFloat(this.dosePerFrame),this.numberOfIndividualFrames=parseInt(this.numberOfIndividualFrames),this.patchX=parseInt(this.patchX),this.patchY=parseInt(this.patchY),this.samplingRate=parseFloat(this.samplingRate),this.particleSize=parseInt(this.particleSize),this.minDist=parseInt(this.minDist),this.windowSize=parseInt(this.windowSize),this.findPhaseShift=!0===this.findPhaseShift;let e=new a({id:this.visit.VISIT,dosePerFrame:this.dosePerFrame,numberOfIndividualFrames:this.numberOfIndividualFrames,patchX:this.patchX,patchY:this.patchY,samplingRate:this.samplingRate,particleSize:this.particleSize,minDist:this.minDist,windowSize:this.windowSize,findPhaseShift:this.findPhaseShift}),t=this;e.save({},{type:"POST",success:function(e,i,n){t.isFormReadOnly=!0,t.isJobQueued=!0,t.showSpinner=!1;let a="Job successfully submitted.";"timestamp_iso8601"in i&&(a=a+" Queued at "+s.default(i.timestamp_iso8601,"HH:mm:ss")+"."),app.alert({className:"message notify",message:a})},error:function(e,i,n){t.showSpinner=!1;let s="There was a problem submitting this job.",a=JSON.parse(i.responseText);"message"in a&&(s=a.message),app.alert({message:s})}})},onContinue:function(){app.navigate("dc/visit/"+this.visit.VISIT,{trigger:!0})}}})})}.apply(t,n))||(e.exports=s)},function(e,t,i){var n,s;n=[i(6)],void 0===(s=function(e){return e.Model.extend({urlRoot:"/em/process/scipion/visit"})}.apply(t,n))||(e.exports=s)},function(e,t){e.exports='<section class=content> <h1>Scipion Processing</h1> <p class=help>This page is for submitting processing jobs to Scipion.</p> <p v-if="isVisitLoaded && !isVisitActive" class="message alert"> This session ended at {{ visitEndDateAsString }}. It may no longer be submitted for processing. <a class="button refresh" v-on:click.prevent=onContinue>OK</a> </p> <form novalidate v-bind:class="{loading: showSpinner}"> <div class=form> <ul> <li> <label>Dose per frame (e<span class=super>-</span>/Å<span class=super>2</span>)</label> <input type=text name=dosePerFrame v-bind:class="{ferror: errors.has(\'dosePerFrame\')}" v-validate="\'required|min_value:0.001|max_value:10\'" v-model=dosePerFrame :readonly=isFormReadOnly /> <span v-if="errors.has(\'dosePerFrame\')" class="errormessage ferror">{{ errors.first(\'dosePerFrame\') }}</span> </li> <li> <label>Number of frames</label> <input type=text name=numberOfIndividualFrames v-bind:class="{ferror: errors.has(\'numberOfIndividualFrames\')}" v-validate="\'required|min_value:1|max_value:500\'" v-model=numberOfIndividualFrames :readonly=isFormReadOnly> <span v-if="errors.has(\'numberOfIndividualFrames\')" class="errormessage ferror">{{ errors.first(\'numberOfIndividualFrames\') }}</span> </li> <li> <label>Patch X</label> <input type=text name=patchX v-bind:class="{ferror: errors.has(\'patchX\')}" v-validate="\'required|min_value:1\'" v-model=patchX :readonly=isFormReadOnly> <span v-if="errors.has(\'patchX\')" class="errormessage ferror">{{ errors.first(\'patchX\') }}</span> </li> <li> <label>Patch Y</label> <input type=text name=patchY v-bind:class="{ferror: errors.has(\'patchY\')}" v-validate="\'required|min_value:1\'" v-model=patchY :readonly=isFormReadOnly> <span v-if="errors.has(\'patchY\')" class="errormessage ferror">{{ errors.first(\'patchY\') }}</span> </li> <li> <label>Pixel Size (Å/pixel)</label> <input type=text name=samplingRate v-bind:class="{ferror: errors.has(\'samplingRate\')}" v-validate="\'required|min_value:0.1|max_value:10\'" v-model=samplingRate :readonly=isFormReadOnly> <span v-if="errors.has(\'samplingRate\')" class="errormessage ferror">{{ errors.first(\'samplingRate\') }}</span> </li> <li> <label>Particle Radius (Å)</label> <input type=text name=particleSize v-bind:class="{ferror: errors.has(\'particleSize\')}" v-validate="\'required|min_value:1|max_value:1000\'" v-model=particleSize :readonly=isFormReadOnly> <span v-if="errors.has(\'particleSize\')" class="errormessage ferror">{{ errors.first(\'particleSize\') }}</span> </li> <li> <label>Gautomatch Min Distance (Å)</label> <input type=text name=minDist v-bind:class="{ferror: errors.has(\'minDist\')}" v-validate="\'required|min_value:1|max_value:1000\'" v-model=minDist :readonly=isFormReadOnly> <span v-if="errors.has(\'minDist\')" class="errormessage ferror">{{ errors.first(\'minDist\') }}</span> </li> <li> <label>CTF Window Size (pixel)</label> <input type=text name=windowSize v-bind:class="{ferror: errors.has(\'windowSize\')}" v-validate="\'required|min_value:128|max_value:2048\'" v-model=windowSize :readonly=isFormReadOnly> <span v-if="errors.has(\'windowSize\')" class="errormessage ferror">{{ errors.first(\'windowSize\') }}</span> </li> <li> <label>Phase Plate Used</label> <input type=checkbox name=findPhaseShift value=true v-model=findPhaseShift :disabled=isFormReadOnly> </li> </ul> <button name=start type=submit class=submit v-on:click.prevent=onSubmit v-if=!isJobQueued :disabled=isFormReadOnly> Start Processing </button> <button name=cancel type=submit class=submit v-on:click.prevent=onContinue v-if=!isJobQueued :disabled=isFormReadOnly> Cancel </button> <button name=start type=submit class=submit v-on:click.prevent=onContinue v-if=isJobQueued> Monitor </button> </div> </form> </section> '},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";i.r(t);var n=i(6),s=i.n(n),a=i(46),l=i.n(a),o=i(158),r=i.n(o),c=i(155),p=i.n(c),d=i(804),u=i.n(d),h=i(58),m=i.n(h),_=i(805),f=i.n(_),g=i(243),v=i.n(g),b=i(806),w=i.n(b);const E=(e,t,i)=>`${e} is required in row ${t} / column ${i}`,S=(e,t,i)=>`Please add a column header for ${e}`,I={headers:[{name:"Sample Name",inputName:"sampleName",required:!0,requiredError:E,headerError:S},{name:"Composition",inputName:"composition",required:!0,requiredError:E,headerError:S,validate:function(e){if(e.includes("[")||e.includes("]")||e.includes("{")||e.includes("}"))return!1;for(var t=0,i=0;i<e.length;i++)if("("===e.charAt(i))t++;else if(")"===e.charAt(i)){if(0===t)return!1;t--}return 0===t},validateError:function(e,t,i){return`${e} cannot have [] or {} and any () must be correctly closed in row ${t} / column ${i}`}},{name:"Density",inputName:"density",required:!0,requiredError:E,headerError:S,validate:function(e){return!isNaN(e)},validateError:function(e,t,i){return`${e} must be a numeric decimal number in row ${t} / column ${i}`}},{name:"Packing Fraction",inputName:"packingFraction",required:!0,requiredError:E,headerError:S,validate:function(e){return!isNaN(e)&&e>=0&&e<=1},validateError:function(e,t,i){return`${e} must be a number between 0 and 1 in row ${t} / column ${i}`}},{name:"Comments",inputName:"comments",optional:!0}]};var y={name:"SimpleSample",props:{},data:function(){return{capillaries:(new f.a).__proto__.capillaries,existingCapillaryID:null,seq:"",type:"",capacity:25,name:"",density:"",fraction:null,containers:null,showUploadDialog:!1,cifFiles:[],comments:"",isLoading:!1,containerless:!1,hasExistingCapillaries:!1,defaultDewarId:null,expTime:600,fileUpload:!0,fileValid:!1,csvFile:null,csvData:[],csvErrors:[],commaInComments:!1}},created:function(){let e=(new v.a).fetch({async:!1}),t=this;for(var i=JSON.parse(e.responseText),n=new Set,a=0,l=0;l<i.data.length;l++)"container"==i.data[l].TYPE&&(i.data[l].BLSAMPLEGROUPID>a&&(a=i.data[l].CRYSTALID),n.add(i.data[l].CRYSTALID+":"+i.data[l].CRYSTAL));(n=Array.from(n)).length>0&&(this.hasExistingCapillaries=!0,n.forEach((function(e,i){e.startsWith(a)&&(t.type=e)})));var o=[];for(l=0;l<this.capillaries.length;l++)o[l]=this.capillaries[l].name;this.containers=o.concat(n),s.a.ajax({url:app.apiurl+"/shipment/dewars/default",data:{visit:app.prop+"-0"},success:function(e){console.log("Retrieved Default Dewar for this visit "+e),t.defaultDewarId=e},error:function(){app.alert({title:"Error",message:"The default dewar for this visit could not be created (no session-0?)"})}})},methods:{onSubmit:function(e){e.preventDefault();let t=this;this.$validator.validateAll().then((function(e){t.fileUpload?e&&t.fileValid&&0===t.csvErrors.length&&t.defaultDewarId?t.prepareFromFile():(console.log("File submission prevented, validation failed"),app.alert({title:"Error",message:"File validation failed, or default dewar for this visit could not be created"})):e&&t.defaultDewarId?t.prepareSimpleSample():(console.log("Form submission prevented, validation failed"),app.alert({title:"Error",message:"Form validation failed, or default dewar for this visit could not be created"}))}))},prepareFromFile:function(){this.isLoading=!0,console.log("preparing from file");let e=new u.a({urlRoot:"/sample/simple"}),t=this;this.csvData.forEach((function(i,n){if(0===n)return;console.log(i),(t.type.endsWith("_CP")||t.type.endsWith("_Capillary"))&&(t.existingCapillaryID=t.type.substring(0,t.type.indexOf(":")));let s=new l.a({NAME:i.sampleName+"_CPM",ACRONYM:"xpdfCapillary"+(new Date).getTime().toString()+"_"+n,DENSITY:null!=t.getCapillaryInfo("density")?t.getCapillaryInfo("density"):null,SEQUENCE:null!=t.getCapillaryInfo("sequence")?t.getCapillaryInfo("sequence"):null,MOLECULARMASS:null!=t.getCapillaryInfo("sequence")?m.a.molecularMassFromComposition(t.getCapillaryInfo("sequence")):null}),a=new r.a({CRYSTALID:t.existingCapillaryID,NAME:i.sampleName+"_CP",COMMENTS:i.comments,THEORETICALDENSITY:null!=t.getCapillaryInfo("density")?t.getCapillaryInfo("density"):null,ABUNDANCE:1,CONTAINERLESS:t.containerless,OUTERDIAMETER:null!=t.getCapillaryInfo("outer_diameter")?t.getCapillaryInfo("outer_diameter"):null,INNERDIAMETER:null!=t.getCapillaryInfo("inner_diameter")?t.getCapillaryInfo("inner_diameter"):null,LENGTH:null!=t.getCapillaryInfo("length")?t.getCapillaryInfo("length"):null,SHAPE:"cylinder"}),o=new l.a({NAME:i.sampleName,ACRONYM:"xpdfPhase"+(new Date).getTime().toString()+"_"+n,DENSITY:i.density,MOLECULARMASS:m.a.molecularMassFromComposition(i.composition),SEQUENCE:i.composition}),c=new r.a({NAME:i.sampleName,COMMENTS:i.comments,THEORETICALDENSITY:i.density,ABUNDANCE:1}),d=new p.a({NAME:app.prop+"-"+app.visit+"_samples",CAPACITY:t.capacity,CONTAINERTYPE:"Box",COMMENTS:i.comments}),h=new u.a({capillaryPhase:s,phase:o,crystal:c,capillary:a,container:d,PACKINGFRACTION:i.packingFraction,DEWARID:t.defaultDewarId,EXPOSURETIME:t.expTime,prop:app.prop,fromFile:!0});e.set("sample_"+n,h)}));for(var i=0;i<t.cifFiles.length;i++){var n="pdb_file_"+i;e.set(n,t.cifFiles[i])}console.log(e),this.submitSimpleSample(e)},prepareSimpleSample:function(){this.isLoading=!0,(this.type.endsWith("_CP")||this.type.endsWith("_Capillary"))&&(this.existingCapillaryID=this.type.substring(0,this.type.indexOf(":")));let e=new l.a({NAME:this.name+"_CPM",ACRONYM:"xpdfCapillary"+(new Date).getTime().toString(),DENSITY:null!=this.getCapillaryInfo("density")?this.getCapillaryInfo("density"):null,SEQUENCE:null!=this.getCapillaryInfo("sequence")?this.getCapillaryInfo("sequence"):null,MOLECULARMASS:null!=this.getCapillaryInfo("sequence")?m.a.molecularMassFromComposition(this.getCapillaryInfo("sequence")):null}),t=new r.a({CRYSTALID:this.existingCapillaryID,NAME:this.name+"_CP",COMMENTS:this.comments,THEORETICALDENSITY:null!=this.getCapillaryInfo("density")?this.getCapillaryInfo("density"):null,ABUNDANCE:1,CONTAINERLESS:this.containerless,OUTERDIAMETER:null!=this.getCapillaryInfo("outer_diameter")?this.getCapillaryInfo("outer_diameter"):null,INNERDIAMETER:null!=this.getCapillaryInfo("inner_diameter")?this.getCapillaryInfo("inner_diameter"):null,LENGTH:null!=this.getCapillaryInfo("length")?this.getCapillaryInfo("length"):null,SHAPE:"cylinder"}),i=new l.a({NAME:this.name,ACRONYM:"xpdfPhase"+(new Date).getTime().toString(),DENSITY:this.density,MOLECULARMASS:m.a.molecularMassFromComposition(this.seq),SEQUENCE:this.seq}),n=new r.a({NAME:this.name,COMMENTS:this.comments,THEORETICALDENSITY:this.density,ABUNDANCE:1}),s=new p.a({NAME:app.prop+"-"+app.visit+"_samples",CAPACITY:this.capacity,CONTAINERTYPE:"Box",COMMENTS:this.comments}),a=new u.a({capillaryPhase:e,phase:i,crystal:n,capillary:t,container:s,PACKINGFRACTION:this.fraction,DEWARID:this.defaultDewarId,EXPOSURETIME:this.expTime,prop:app.prop,fromFile:!1}),o=new u.a({urlRoot:"/sample/simple"});o.set("sample_1",a);for(var c=0;c<this.cifFiles.length;c++){var d="pdb_file_"+c;o.set(d,this.cifFiles[c])}this.submitSimpleSample(o)},submitSimpleSample:function(e){let t=this;e.save({},{success:function(){app.triggerMethod("sample:reloadSampleTable"),app.alert({className:"message notify",message:"Successfully added sample and relevant capillary data."}),t.isLoading=!1,app.dialog.currentView&&app.dialog.currentView.closeDialog()},error:function(e,i,n){let s="Failed to add Simple Sample information",a=JSON.parse(i.responseText);"message"in a&&(s=s+": "+a.message),app.alert({message:s}),t.isLoading=!1,app.dialog.currentView&&app.dialog.currentView.closeDialog()}})},getCapillaryInfo:function(e){for(var t=0;t<this.capillaries.length;t++)if(this.capillaries[t].name==this.type)return this.capillaries[t][e];return null},showCifFileDialog:function(){this.showUploadDialog?this.showUploadDialog=!1:this.showUploadDialog=!0},setCifFile:function(e){for(var t=0;t<e.target.files.length;t++)this.cifFiles[t]=e.target.files[t];console.log(this.cifFiles)},setCSVFile:function(e){if(0===e.target.files.length)return this.fileValid=!1,this.csvFile=null,this.csvData=[],void(this.csvErrors=[]);this.csvFile=e.target.files[0];var t=this,i=!1,n=function(){!0===i?w()(t.csvFile,I).then(e=>{t.csvData=e.data,t.csvErrors=e.inValidMessages,t.commaInComments&&t.csvErrors.push("Column count is greater than expected, you likely have a comma in a comment. Please remove any additional commas"),1===t.csvData.length&&0===t.csvErrors.length&&t.csvErrors.push("Only headers have been submitted, please add some sample information"),0===t.csvErrors.length?t.fileValid=!0:t.fileValid=!1,console.log(e.data),console.log(e.inValidMessages)}):setTimeout(n,1e3)};n();var s=new FileReader;s.onload=function(e){t.commaInComments=!1,e.target.result.split("\n").forEach((function(e){if(e.split(",").length>5)return t.commaInComments=!0,void(i=!0)}));var n=e.target.result.split(","),s="";n.forEach((function(e){s+=e.trim(),e.endsWith("\n")||(s+=",")}));var a=new Blob([s],{type:t.csvFile.type});a.name=t.csvFile.name,t.csvFile=a,i=!0},s.readAsText(this.csvFile)},closeDialog:function(){app.dialog.currentView.closeDialog()},toggleSelectEnabled:function(){this.containerless?document.getElementById("containerSelect").disabled=!0:document.getElementById("containerSelect").disabled=!1}}},C=i(367),x=Object(C.a)(y,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("form",{class:{loading:e.isLoading},attrs:{method:"post",id:"add_protein"},on:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[i("div",{staticClass:"form"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fileUpload,expression:"fileUpload"}],attrs:{type:"radio",id:"file",name:"fileupload",value:"multi",checked:"checked"},domProps:{value:!0,checked:e._q(e.fileUpload,!0)},on:{change:function(t){e.fileUpload=!0}}}),e._v(" "),i("label",{attrs:{for:"file"}},[e._v("File Upload for Multiple Samples")]),i("br"),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.fileUpload,expression:"fileUpload"}],attrs:{type:"radio",id:"form",name:"fileupload",value:"single"},domProps:{value:!1,checked:e._q(e.fileUpload,!1)},on:{change:function(t){e.fileUpload=!1}}}),e._v(" "),i("label",{attrs:{for:"form"}},[e._v("Form for Single Sample")]),i("br"),e._v(" "),e.fileUpload?i("section",[i("ul",e._l(e.csvErrors,(function(t){return i("li",{staticStyle:{color:"red","font-size":"medium"}},[e._v(e._s(t))])})),0),e._v(" "),i("ul",[i("li",[i("span",{staticClass:"file"},[i("input",{attrs:{type:"file",name:"csv_file",accept:".csv"},on:{change:function(t){return e.setCSVFile(t)}}}),e._v(" "),e.fileValid?i("span",{staticStyle:{color:"green","font-size":"medium"}},[e._v("File OK")]):e._e(),e._v(" "),i("button",{attrs:{type:"button",onclick:"window.open('/assets/files/simple_sample_csv_template.csv');return false"}},[e._v("Download CSV Template")])]),e._v(" "),i("p",[e._v("CSV files must contain 4 comma separated columns with the following mandatory headers on the first row: Sample Name,Composition,Density,Packing Fraction")]),e._v(" "),i("p",[e._v("An optional column is: Comments")])])]),e._v(" "),i("br"),i("br")]):i("section",[i("ul",[i("li",[e._m(0),e._v(" "),i("span",{staticClass:"name"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:{ferror:e.errors.has("name")},attrs:{type:"text",name:"name"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),e._v(" "),e.errors.has("name")?i("span",{staticClass:"errormessage ferror"},[e._v(e._s(e.errors.first("name")))]):e._e()]),e._v(" "),i("li",[e._m(1),e._v(" "),i("span",{staticClass:"composition"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.seq,expression:"seq"},{name:"validate",rawName:"v-validate",value:{required:!0,closeExp:!0,regex:/^[a-zA-Z0-9\(\)\.]*$/},expression:"{required: true, closeExp: true, regex:/^[a-zA-Z0-9\\(\\)\\.]*$/ }"}],class:{ferror:e.errors.has("seq")},attrs:{type:"text",name:"seq"},domProps:{value:e.seq},on:{input:function(t){t.target.composing||(e.seq=t.target.value)}}})]),e._v(" "),e.errors.has("seq")?i("span",{staticClass:"errormessage ferror"},[e._v(e._s(e.errors.first("seq")))]):e._e()]),e._v(" "),i("li",[e._m(2),e._v(" "),i("span",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.density,expression:"density"},{name:"validate",rawName:"v-validate",value:"required|decimal",expression:"'required|decimal'"}],class:{ferror:e.errors.has("density")},attrs:{type:"text",name:"density"},domProps:{value:e.density},on:{input:function(t){t.target.composing||(e.density=t.target.value)}}})]),e._v(" "),e.errors.has("density")?i("span",{staticClass:"errormessage ferror"},[e._v(e._s(e.errors.first("density")))]):e._e()]),e._v(" "),i("li",[e._m(3),e._v(" "),i("span",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fraction,expression:"fraction"},{name:"validate",rawName:"v-validate",value:"required|min_value:0|max_value:1",expression:"'required|min_value:0|max_value:1'"}],class:{ferror:e.errors.has("fraction")},attrs:{type:"text",name:"fraction"},domProps:{value:e.fraction},on:{input:function(t){t.target.composing||(e.fraction=t.target.value)}}})]),e._v(" "),e.errors.has("fraction")?i("span",{staticClass:"errormessage ferror"},[e._v(e._s(e.errors.first("fraction")))]):e._e()]),e._v(" "),i("li",[i("label",[e._v("Comments")]),e._v(" "),i("span",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comments,expression:"comments"}],staticStyle:{width:"400px",height:"80px"},attrs:{name:"comments",maxlength:"255"},domProps:{value:e.comments},on:{input:function(t){t.target.composing||(e.comments=t.target.value)}}})])])])]),e._v(" "),i("ul",[i("li",[e._m(4),e._v(" "),i("span",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.expTime,expression:"expTime"},{name:"validate",rawName:"v-validate",value:"required|min_value:0",expression:"'required|min_value:0'"}],class:{ferror:e.errors.has("expTime")},attrs:{type:"text",name:"expTime"},domProps:{value:e.expTime},on:{input:function(t){t.target.composing||(e.expTime=t.target.value)}}})]),e._v(" "),e.errors.has("expTime")?i("span",{staticClass:"errormessage ferror"},[e._v(e._s(e.errors.first("expTime")))]):e._e()]),e._v(" "),i("li",[i("span",[i("label",[e._v("Containerless?")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.containerless,expression:"containerless"}],attrs:{type:"checkbox",value:"true"},domProps:{checked:Array.isArray(e.containerless)?e._i(e.containerless,"true")>-1:e.containerless},on:{change:[function(t){var i=e.containerless,n=t.target,s=!!n.checked;if(Array.isArray(i)){var a=e._i(i,"true");n.checked?a<0&&(e.containerless=i.concat(["true"])):a>-1&&(e.containerless=i.slice(0,a).concat(i.slice(a+1)))}else e.containerless=s},function(t){return e.toggleSelectEnabled()}]}}),i("br"),e._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:e.type,expression:"type"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticStyle:{width:"400px"},attrs:{id:"containerSelect",name:"type"},on:{change:[function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.type=t.target.multiple?i:i[0]},function(t){return e.getCapillaryInfo("density")}]}},[e.hasExistingCapillaries?e._e():i("option",{attrs:{disabled:"",value:""}},[e._v("Container*")]),e._v(" "),e._l(e.containers,(function(t){return i("option",[e._v(e._s(t))])}))],2),e._v(" "),e.errors.has("type")?i("span",{staticClass:"errormessage ferror"},[e._v(e._s(e.errors.first("type")))]):e._e()])]),e._v(" "),e._m(5),e._v(" "),i("button",{attrs:{type:"button"},on:{click:function(t){return e.showCifFileDialog()}}},[e._v("Upload CIF")]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUploadDialog,expression:"showUploadDialog"}]},[i("ul",[e._m(6),e._v(" "),i("li",{staticClass:"ty pdb_file"},[i("label",[e._v("File:")]),e._v(" "),i("span",{staticClass:"file"},[i("input",{attrs:{type:"file",name:"pdb_file[]",multiple:""},on:{change:function(t){return e.setCifFile(t)}}})])])]),e._v(" "),i("div",{staticClass:"progress"})]),e._v(" "),i("p",[e._v("Add a cif file to this sample to enable downstream processing of your data")])]),e._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("button",{staticClass:"button submit",attrs:{type:"button",name:"cancel"},on:{click:function(t){return e.closeDialog()}}},[i("i",{staticClass:"fa"}),e._v("Cancel")]),e._v(" "),e._m(7)])])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("label",[this._v("Name\n                        "),t("span",{staticClass:"small"},[this._v("Name of the sample")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("label",[this._v("Composition\n                        "),t("span",{staticClass:"small"},[this._v("Chemical formula of the material")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("label",[this._v("Density\n                        "),t("span",{staticClass:"small"},[this._v("Crystallographic density of the phase (g cm"),t("span",{staticClass:"super"},[this._v("-3")]),this._v(")")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("label",[this._v("Packing Fraction\n                                "),t("span",{staticClass:"small"},[this._v("Must be between 0 and 1")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("label",[this._v("Exposure Time\n                            "),t("span",{staticClass:"small"},[this._v("Must be a non negative integer")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",[t("select",{staticStyle:{width:"400px"},attrs:{title:"Not currently supported",disabled:""}},[t("option",[this._v("ERA* !NOT CURRENTLY SUPPORTED!")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("label",[this._v("Type:")]),this._v(" "),t("span",[t("select",{attrs:{name:"type"}},[t("option",{attrs:{value:"pdb_file"}},[this._v("File")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"button submit",attrs:{name:"submit",value:"1",type:"submit"}},[t("i",{staticClass:"fa fa-plus"}),this._v(" Add Sample")])}],!1,null,null,null);t.default=x.exports},function(e,t,i){"use strict";i.r(t);var n=i(521),s=i.n(n),a={name:"PlotlyChart",props:{data:{type:Object,required:!1},layout:{type:Object,required:!1}},components:{plotly:s.a},mounted:function(){this.doPlot()},methods:{doPlot:function(){s.a.newPlot(this.$el,this.data,this.layout)}}},l=i(367),o=Object(l.a)(a,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("plotly")],1)}),[],!1,null,null,null);t.default=o.exports}]]);