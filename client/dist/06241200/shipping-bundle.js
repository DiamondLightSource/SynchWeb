(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1002:function(e,t,s){var n,i;n=[s(6),s(1003),s(152),s(121),s(81),s(1034),s(1035),s(1049),s(155),s(80),s(256),s(1051),s(118),s(1067),s(260),s(259),s(1069),s(1072),s(171),s(268),s(1077),s(1078),s(1083),s(1085),s(1088),s(1091),s(48),s(1094),s(1096),s(1098),s(1102),s(1105),s(1107),s(1120),s(167)],void 0===(i=function(e,t,s,n,i,a,l,o,r,c,p,h,d,u,m,_,f,g,E,b,v,I,A,T,C,N,w,S,R,O,D,y,P,x,L){var M={title:"Shipments",url:"/shipments"},k={list:function(e){console.log("ship list"),app.loading();var t=new i;t.state.currentPage=e?parseInt(e):1,t.fetch().done((function(){app.bc.reset([M]),app.content.show(new a({collection:t}))}))},view:function(e){new L({field:"SHIPPINGID",value:e}).find({success:function(){app.log("ship view",e);var t=new n({SHIPPINGID:e});t.fetch({success:function(){app.bc.reset([M,{title:t.get("SHIPPINGNAME")}]),app.content.show(new l({model:t}))},error:function(){app.bc.reset([M]),app.message({title:"No such shipment",message:"The specified shipment could not be found"})}})},error:function(){app.bc.reset([M,{title:"No such shipment"}]),app.message({title:"No such shipment",message:"The specified shipment could not be found"})}})},add:function(){app.proposal&&1!=app.proposal.get("ACTIVE")?app.message({title:"Proposal Not Active",message:"This proposal is not active so new shipments cannot be added"}):(app.log("ship add view"),app.bc.reset([M,{title:"Add New Shipment"}]),e.ajax({url:app.appurl+"/assets/js/shipment_comments.json",dataType:"json",success:function(e){app.content.show(new o({comments:e}))},error:function(){app.content.show(new o({comments:{}}))}}))},create_awb:function(e){var t=new n({SHIPPINGID:e});t.fetch({success:function(){app.bc.reset([M,{title:t.get("SHIPPINGNAME")},{title:"Create Airway Bill"}]),app.content.show(new D({shipment:t}))},error:function(){app.bc.reset([M]),app.message({title:"No such shipment",message:"The specified shipment could not be found"})}})},rebook_pickup:function(e){var t=new n({SHIPPINGID:e});t.fetch({success:function(){t.get("DELIVERYAGENT_FLIGHTCODE")?(app.bc.reset([M,{title:t.get("SHIPPINGNAME")},{title:"Rebook Pickup"}]),app.content.show(new y({shipment:t}))):(app.bc.reset([M]),app.message({title:"Shipment not booked",message:"The specified shipment does not have a valid courier booking"}))},error:function(){app.bc.reset([M]),app.message({title:"No such shipment",message:"The specified shipment could not be found"})}})},container_list:function(e,s,n){console.log("cont list"),app.loading(),app.bc.reset([M,{title:"Containers"}]),n=n?parseInt(n):1;var i=new c(null,{state:{currentPage:n},queryParams:{s:e,ty:s}});i.fetch().done((function(){app.content.show(t.ContainersList.get(app.type,{collection:i,params:{s:e,ty:s}}))}))},view_container:function(e,s,n){new L({field:"CONTAINERID",value:e}).find({success:function(){app.log("cont view",e,s,n);var i=new r({CONTAINERID:e});i.fetch({success:function(){app.bc.reset([M,{title:i.get("SHIPMENT"),url:"/shipments/sid/"+i.get("SHIPPINGID")},{title:"Containers"},{title:i.get("NAME")}]);var e=!(["Box","Puck","PCRStrip",null].indexOf(i.get("CONTAINERTYPE"))>-1);e&&i.get("CONTAINERTYPE").includes("Xpdf")&&(e=!1),console.log("is plate",e),e?app.content.show(new h({model:i,params:{iid:s,sid:n}})):app.content.show(t.ContainerView.get(app.type,{model:i}))},error:function(){app.bc.reset([M,{title:"No such container"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},error:function(){app.bc.reset([M,{title:"No such container"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},add_container:function(e,n){app.proposal&&1!=app.proposal.get("ACTIVE")?app.message({title:"Proposal Not Active",message:"This proposal is not active so new containers cannot be added"}):new L({field:"DEWARID",value:e}).find({success:function(){app.log("cont view");var i=new s({DEWARID:e});i.fetch({success:function(){app.bc.reset([M,{title:i.get("SHIPPINGNAME"),url:"/shipments/sid/"+i.get("SHIPPINGID")},{title:"Containers"},{title:"Add Container"}]),app.content.show(t.ContainerAddView.get(app.type,{dewar:i,visit:n}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},queue_container:function(e){new L({field:"CONTAINERID",value:e}).find({success:function(){var t=new r({CONTAINERID:e});t.fetch({success:function(){app.bc.reset([M,{title:t.get("SHIPMENT"),url:"/shipments/sid/"+t.get("SHIPPINGID")},{title:"Containers"},{title:t.get("NAME")},{title:"Queue Samples"}]),app.content.show(new u({model:t}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},plan_container:function(e){new L({field:"CONTAINERID",value:e}).find({success:function(){var t=new r({CONTAINERID:e});t.fetch({success:function(){app.bc.reset([M,{title:t.get("SHIPMENT"),url:"/shipments/sid/"+t.get("SHIPPINGID")},{title:"Containers"},{title:t.get("NAME")},{title:"Plan Experiment"}]),app.content.show(new P({model:t}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},add_container_visit:function(t){e.ajax({url:app.apiurl+"/shipment/dewars/default",data:{visit:t},success:function(e){k.add_container(e,t),app.navigate("/containers/add/did/"+e)},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"Error",message:"The default dewar for this visit could not be created"})}})},container_registry:function(e,t,s){app.loading(),s=s?parseInt(s):1;var n=new _(null,{state:{currentPage:s},queryParams:{s:t,ty:e}});n.state.currentPage=s,n.queryParams.all=1,n.fetch().done((function(){app.bc.reset([M,{title:"Registered Containers",url:"/dewars"}]),app.content.show(new f({collection:n,params:{s:t,ty:e}}))}))},view_rcontainer:function(e){var t=new m({CONTAINERREGISTRYID:e});t.fetch({data:{all:1},success:function(){app.bc.reset([M,{title:t.get("BARCODE")}]),app.content.show(new g({model:t}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such container",message:"The specified container could not be found"})}})},dewar_registry:function(e,t,s){app.loading(),s=s?parseInt(s):1;var n=new b(null,{state:{currentPage:s},queryParams:{s:t,ty:e}});n.state.currentPage=s,n.queryParams.all=1,n.fetch().done((function(){app.bc.reset([M,{title:"Registered Dewars",url:"/dewars"}]),app.content.show(new T({collection:n,params:{s:t,ty:e}}))}))},dewar_list:function(e,t){console.log("dew list"),app.loading();var s=new b;s.state.currentPage=t?parseInt(t):1,s.fetch().done((function(){app.bc.reset([M,{title:"Registered Dewars",url:"/dewars"}]),app.content.show(new v({collection:s,params:{s:e}}))}))},view_dewar:function(e){app.log("rdewar view");var t=new E({FACILITYCODE:e});t.fetch({success:function(){t.fetched=!0,app.bc.reset([M,{title:"Registered Dewars",url:"/dewars"},{title:t.get("FACILITYCODE")}]),app.content.show(new I({model:t}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},add_dewar:function(){app.log("dew add view"),app.bc.reset([M,{title:"Registered Dewars",url:"/dewars"},{title:"Add New Dewar"}]),app.content.show(new A)},dispatch_dewar:function(e){new L({field:"DEWARID",value:e}).find({success:function(){var t=new s({DEWARID:e});t.fetch({success:function(){app.bc.reset([M,{title:"Dispatch Dewar"},{title:t.get("CODE")}]),app.content.show(new C({dewar:t}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},transfer_dewar:function(e){new L({field:"DEWARID",value:e}).find({success:function(){var t=new s({DEWARID:e});t.fetch({success:function(){app.bc.reset([M,{title:"Transfer Dewar"},{title:t.get("CODE")}]),app.content.show(new N({dewar:t}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No such dewar",message:"The specified dewar could not be found"})}})},dewar_overview:function(e,t){t=t?parseInt(t):1;var s=new w(null,{state:{currentPage:t},queryParams:{s:e,all:1,ty:app.type}});s.setSorting("FIRSTEXPERIMENTST",1),s.fetch({success:function(){app.bc.reset([M,{title:"Dewar Overview"}]),app.content.show(new S({collection:s,params:{s:e}}))},error:function(){app.bc.reset([M,{title:"Error"}]),app.message({title:"No dewars",message:"Couldn't fetch dewar list"})}})},manifest:function(){app.bc.reset([M,{title:"Manifest"}]),app.content.show(new R)},dewarstats:function(){app.bc.reset([M,{title:"Dewar Stats"}]),app.content.show(new O)},migrate:function(){app.bc.reset([M,{title:"Migrate"}]),app.content.show(new x)}};return app.addInitializer((function(){app.on("shipments:show",(function(){app.navigate("shipments"),k.list()})),app.on("shipment:show",(function(e){app.navigate("shipments/sid/"+e),k.view(e)})),app.on("container:show",(function(e,t,s){app.navigate("containers/cid/"+e+(t?"/iid/"+t:"")+(s?"/sid/"+s:"")),k.view_container(e,t,s)})),app.on("rdewar:show",(function(e){app.navigate("dewars/registry/"+e),k.view_dewar(e)})),app.on("rcontainer:show",(function(e){app.navigate("containers/registry/"+e),k.view_rcontainer(e)}))})),k}.apply(t,n))||(e.exports=i)},1003:function(e,t,s){var n,i;n=[s(187),s(118),s(256),s(426),s(1023),s(1024),s(1029)],void 0===(i=function(e,t,s,n,i,a,l){return{ContainersList:new e({views:{xpdf:i},default:t}),ContainerView:new e({views:{xpdf:a},default:s}),ContainerAddView:new e({views:{xpdf:l},default:n})}}.apply(t,n))||(e.exports=i)},1004:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <thead>\n        <tr>\n            <th>Location</th>\n            <th>Protein Acronym</th>\n            <th>Name</th>\n            <th class="xtal auto-extra">Spacegroup</th>\n            <th class="xtal auto-extra">Barcode</th>\n            <th class="non-xtal">Volume</th>\n\n            <th class="auto">Centring Method</th>\n            <th class="auto">Experiment Kind</th>\n            <th class="auto">Energy (eV)</th>\n            <th class="auto extra">User Path</th>\n\n            <th>Comment</th>\n\n            <th class="xtal">Anomalous</th>\n\n            <th class="requireresolution xtal">Required Res</th>\n            <th class="extra">Abundance</th>\n            <th class="extra">Components</th>\n            \n            <th class="extra">Unit Cell</th>\n            \n            <th>Status</th>\n            <th>&nbsp;</th>\n        </tr>\n    </thead>\n    \n    <tbody></tbody>\n';return __p}},1005:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n    <td>"+(null==(__t=LOCATION)?"":_.escape(__t))+"</td>\n    ",-1==PROTEINID?__p+='\n    <td colspan="5">&nbsp;</td>\n    <td class="non-xtal" colspan="1">&nbsp;</td>\n    <td class="xtal" colspan="1">&nbsp;</td>\n    <td class="extra" colspan="3">&nbsp;</td>\n    <td class="auto" colspan="4">&nbsp;</td>\n    <td class="auto-extra" colspan="2">&nbsp;</td>\n\n    ':(__p+='\n\n    <td class="protein">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</td>\n    <td class="name">'+(null==(__t=NAME)?"":_.escape(__t))+'</td>\n    <td class="spacegroup xtal auto-extra">'+(null==(__t=SPACEGROUP)?"":_.escape(__t))+'</td>\n    <td class="barcode xtal auto-extra">'+(null==(__t=CODE)?"":_.escape(__t))+'</td>\n    <td class="volume non-xtal">'+(null==(__t=VOLUME)?"":_.escape(__t))+'</td>\n\n    <td class="centringmethod auto">'+(null==(__t=CENTRINGMETHOD)?"":_.escape(__t))+'</td>\n    <td class="experimentkindname auto">'+(null==(__t=EXPERIMENTKINDNAME)?"":_.escape(__t))+'</td>\n    <td class="energy auto">'+(null==(__t=ENERGY)?"":_.escape(__t))+'</td>\n    <td class="userpath auto extra">'+(null==(__t=USERPATH)?"":_.escape(__t))+'</td>\n\n\n    <td class="comments">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</td>\n    <td class="anomalousscatterer">'+(null==(__t=ANOMALOUSSCATTERER)?"":_.escape(__t))+'</td>\n\n    <td class="requiredresolution xtal">'+(null==(__t=REQUIREDRESOLUTION)?"":_.escape(__t))+'</td>\n\n    <td class="abundance extra">\n        ',ABUNDANCE&&(__p+="\n            "+(null==(__t=ABUNDANCE)?"":_.escape(__t))+(null==(__t=SYMBOL)?"":_.escape(__t))+"\n        "),__p+='    \n    </td>\n    <td class="extra components"></td>\n    \n    <td class="unitcell extra">\n        <table class="reflow unitcell">      \n            <thead>            \n                <tr>\n                    <th>A</th>\n                    <th>B</th>\n                    <th>C</th>\n                    <th>&alpha;</th>\n                    <th>&beta;</th>\n                    <th>&gamma;</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr>                                \n                    <td><span class="CELL_A">'+(null==(__t=CELL_A)?"":_.escape(__t))+'</span></td>\n                    <td><span class="CELL_B">'+(null==(__t=CELL_B)?"":_.escape(__t))+'</span></td>\n                    <td><span class="CELL_C">'+(null==(__t=CELL_C)?"":_.escape(__t))+'</span></td>\n                    <td><span class="CELL_ALPHA">'+(null==(__t=CELL_ALPHA)?"":_.escape(__t))+'</span></td>\n                    <td><span class="CELL_BETA">'+(null==(__t=CELL_BETA)?"":_.escape(__t))+'</span></td> \n                    <td><span class="CELL_GAMMA">'+(null==(__t=CELL_GAMMA)?"":_.escape(__t))+"</span></td>\n                </tr> \n            </tbody>    \n        </table>\n    </td>\n\n    <td>\n        ",BLSAMPLEID&&STATUS&&(__p+='\n        <ul class="status">\n            <li class="'+(null==(__t=STATUS)?"":_.escape(__t))+'"></li>\n        </ul>\n        '),__p+="\n    </td>\n\n    "),__p+="\n    <td>\n        ",IN_USE||(__p+='\n            <a href="#" class="edit button button-notext" title="Edit sample details"><i class="fa fa-pencil"></i> <span>Edit Sample</span></a>\n            ',PROTEINID>-1&&(__p+='\n            \x3c!--<a href="#" class="delete button button-notext"><i class="fa fa-times"></i> <span>Delete Sample</span></a>--\x3e\n            '),__p+="\n        "),__p+="\n        ",PROTEINID>-1&&(__p+='\n        <a href="/samples/sid/'+(null==(__t=BLSAMPLEID)?"":_.escape(__t))+'" class="view button button-notext" title="View sample details"><i class="fa fa-search"></i> <span>View Sample</span></a>\n        '),__p+="        \n    </td>\n";return __p}},1006:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<td>"+(null==(__t=LOCATION)?"":_.escape(__t))+"</td>\n\n",HASDATA?__p+='\n\t<td class="protein">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</td>\n\t<td class="name">'+(null==(__t=NAME)?"":_.escape(__t))+"</td>\n":__p+='\n\t<td class="protein"><select name="PROTEINID"></select>\n\t<td class="name"><input type="text" name="NAME" value="'+(null==(__t=NAME)?"":_.escape(__t))+'" /></td>\n',__p+='\n\n\n<td class="spacegroup xtal auto-extra"><select name="SPACEGROUP"></select></td>\n\n',HASDATA&&CODE?__p+='\n\t<td class="barcode xtal auto-extra">'+(null==(__t=CODE)?"":_.escape(__t))+"\n":__p+='\n\t<td class="barcode xtal auto-extra"><input name="CODE" type="text" value="'+(null==(__t=CODE)?"":_.escape(__t))+'" /></td>\n',__p+='\n\n<td class="volume non-xtal"><input type="text" name="VOLUME" value="'+(null==(__t=VOLUME)?"":_.escape(__t))+'" /></td>\n\n<td class="centringmethod auto"><select name="CENTRINGMETHOD"></select></td>\n<td class="experimentkind auto"><select name="EXPERIMENTKIND"></select></td>\n<td class="energy auto"><input type="text" name="ENERGY" /></td>\n\n',HASDATA?__p+='\n\t<td class="userpath auto extra">'+(null==(__t=USERPATH)?"":_.escape(__t))+"</td>\n":__p+='\n\t<td class="userpath auto extra"><input type="text" name="USERPATH" /></td>\n',__p+='\n\n<td class="comments"><input type="text" name="COMMENTS" value="'+(null==(__t=COMMENTS)?"":_.escape(__t))+'" /></td>\n\n<td class="anomalousscatterer"><select class="xtal" name="ANOMALOUSSCATTERER"></select></td>\n\n<td class="requiredresolution xtal"><input type="text" name="REQUIREDRESOLUTION" /></td>\n\n<td class="abundance extra"><input type="text" name="ABUNDANCE" value="'+(null==(__t=ABUNDANCE)?"":_.escape(__t))+'" /> <span class="SYMBOL">'+(null==(__t=SYMBOL)?"":_.escape(__t))+'</span></td>\n<td class="extra components">\n\tAdd: <input type="text" name="COMPONENTID">\n</td>\n\n<td class="unitcell extra">\n\t<input type="text" name="CELL_A" placeholder="A" />\n\t<input type="text" name="CELL_B" placeholder="B" />\n\t<input type="text" name="CELL_C" placeholder="C" />\n\t<input type="text" name="CELL_ALPHA" placeholder="&alpha;" />\n\t<input type="text" name="CELL_BETA" placeholder="&beta;" />\n\t<input type="text" name="CELL_GAMMA" placeholder="&gamma;" />\n</td>\n\n<td>&nbsp;</td>\n<td>\n    <a href="#" class="button button-notext save"><i class="fa fa-check"></i> <span>Save Changes</span></a>\n    <a href="#" class="button button-notext cancel"><i class="fa fa-times"></i> <span>Cancel</span></a>\n</td>\n';return __p}},1007:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"CONTAINERHISTORYID",urlRoot:"/shipment/containers/history",validation:{BARCODE:{required:!0,pattern:"wwdash"},LOCATION:{required:!0,pattern:"number"},STATUS:{required:!0,pattern:"word"}}})}.apply(t,n))||(e.exports=i)},1009:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"PROCESSINGPIPELINEID"})}.apply(t,n))||(e.exports=i)},1010:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Container: <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span></h1>\n\n<a name="top"></a>\n<p class="help">This page shows the contents of the selected container. Samples can be added and edited by clicking the pencil icon, and removed by clicking the x</p>\n\n',"processing"==CONTAINERSTATUS&&(__p+='\n<p class="message alert">This container is currently assigned and in use on a beamline sample changer. Unassign it to make it editable</p>\n'),__p+='\n\n<div class="form clearfix puck_wrap">\n    <div class="puck" title="Click to jump to a position in the puck"></div>\n    \n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n        </li>\n        \n        <li>\n            <span class="label">Dewar</span>\n            <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Container Type</span>\n            <span>'+(null==(__t=CONTAINERTYPE)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Registered Container</span>\n            <span class="CONTAINERREGISTRYID">'+(null==(__t=REGISTRY)?"":_.escape(__t))+"</span>\n            ",CONTAINERREGISTRYID&&(__p+='<a class="crlink" href="/containers/registry/'+(null==(__t=CONTAINERREGISTRYID)?"":_.escape(__t))+'">[View]</a>'),__p+='\n        </li>\n        <li>\n            <span class="label">Barcode</span>\n            <span class="BARCODE">'+(null==(__t=BARCODE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Priority Processing</span>\n            <span class="PROCESSINGPIPELINEID">'+(null==(__t=PIPELINE)?"":_.escape(__t))+'</span>\n        </li>\n\n\n        <li class="pck">\n            <span class="label">Automated Collection</span>\n            <span class="auto"></span>\n        </li>\n        ',EXPERIMENTTYPE&&(__p+='\n        <li>\n            <span class="label">Experiment Type</span>\n            <span class="EXPERIMENTTYPE">'+(null==(__t=EXPERIMENTTYPE)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+="\n        ",STORAGETEMPERATURE&&(__p+='\n        <li>\n            <span class="label">Storage Temperature</span>\n            <span class="STORAGETEMPERATURE">'+(null==(__t=STORAGETEMPERATURE)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+="\n\n        ",VISIT&&(__p+='\n        <li>\n            <span class="label">Data Collections</span>\n            <span><a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> <span>View</span></a></span>\n        </li>\n        '),__p+='\n        \n        <li>\n            <span class="label">Comments</span>\n            <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix reorder">\n            <div class="history text_table small"></div>\n            <span class="label">Location History</span>\n        </li>\n    </ul>\n</div>\n\n<a class="button extrainfo r" href="#" title="Show extra fields"><i class="extra-state fa fa-plus"></i> Extra Fields</a>\n<div class="table sample"></div>';return __p}},1011:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"name",urlRoot:"/shipment/cache",parse:function(e){return console.log("load cache modl",e),{data:e}}})}.apply(t,n))||(e.exports=i)},1012:function(e,t,s){(function(n,i){var a,l;a=[s(27),s(46),s(57)],void 0===(l=function(e,t,s){var a=s.extend({idAttribute:"LOCATION"});return e.extend({template:n.template('<p>Press ctrl-v to paste container contents from the clipboard</p><textarea name="pasted"></textarea>'),title:"Paste from Clipboard",buttons:{Insert:"insertContent",Close:"closeDialog"},ui:{content:"textarea[name=pasted]"},insertContent:function(){var e={samples:[]},s=this.ui.content.val().split("\n"),l=[];n.each(s,(function(t,s){var n=t.split("\t");if("Puck"==n[2]&&(e.title=n[3]),n[0]>0&&n[0]<=16&&n[2]){var i={};n[2]=n[2].replace(/\W/g,""),this.getOption("proteins").findWhere({ACRONYM:n[2]})||-1==l.indexOf(n[2])&&l.push(n[2]),i.ACRONYM=n[2],i.SPACEGROUP=n[3],i.NAME=n[4],i.CODE=n[5],i.COMMENTS=n[19],i.LOCATION=n[0],e.samples.push(new a(i))}}),this);var o=this;_ready=[],n.each(l,(function(e,s){var n=new t({ACRONYM:e});_ready.push(n.save({},{success:function(){o.getOption("proteins").add(n)}}))})),i.when.apply(i,_ready).done((function(){n.each(e.samples,(function(e,t){var s=o.getOption("proteins").findWhere({ACRONYM:e.get("ACRONYM")});s?e.set("PROTEINID",s.get("PROTEINID")):console.log("Could not find protein for acronym:"+e.get("ACRONYM"))})),o.trigger("content:parsed",e),o.closeDialog()}))}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1013:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n    <h2>Sample</h2>\n\n    ",existingContainer||(__p+='\n    <div class="ra">\n        <a href="#" class="button clone-plate"><i class="fa fa-plus"></i> Plate</a>\n        <a href="#" class="button clone-col"><i class="fa fa-plus"></i> Column</a>\n        <a href="#" class="button clone-row"><i class="fa fa-plus"></i> Row</a>\n\n        <a href="#" class="button clear-plate" title="Clear Plate"><i class="fa fa-times"></i> Plate</a>\n        <a href="#" class="button clear-col" title="Clear Column"><i class="fa fa-times"></i> Column</a>\n        <a href="#" class="button clear-row" title="Clear Row"><i class="fa fa-times"></i> Row</a>\n        \n        <a href="#" class="button clear" title="Clear Sample"><i class="fa fa-times"></i></a>\n    </div>\n    '),__p+='\n\n    <form>\n\n    <a class="button extrainfo r" href="#" title="Show extra fields"><i class="fa fa-plus"></i> Extra Fields</a>\n    <div class="form">\n        <ul>\n            <li>\n                <label>Protein</label>\n                <select name="PROTEINID"></select>\n            </li>\n            <li>\n                <label>Abundance</label>\n                <input name="ABUNDANCE" /> <span class="SYMBOL"></span>\n            </li>\n            <li>\n                <label>Sample Name</label>\n                <input type="text" name="NAME" />\n            </li>\n            <li>\n                <label>Spacegroup</label>\n                <select name="SPACEGROUP"></select>\n            </li>\n            <li>\n                <label>Comments</label>\n                <input type="text" name="COMMENTS" />\n            </li>\n\n            <li class="extra">\n                <label>Required Res</label>\n                <input type="text" name="REQUIREDRESOLUTION" />\n            </li>\n            <li class="extra">\n                <label>Anom Scatterer</label>\n                <select name="ANOMALOUSSCATTERER"></select>\n            </li>\n            <li class="extra clearifx reorder">\n                <div class="text_table table">\n                    <table class="reflow cell">      \n                        <thead>            \n                            <tr>\n                                <th>A</th>\n                                <th>B</th>\n                                <th>C</th>\n                                <th>&alpha;</th>\n                                <th>&beta;</th>\n                                <th>&gamma;</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>                                \n                                <td><input type="text" name="CELL_A" /></td>\n                                <td><input type="text" name="CELL_B" /></td>\n                                <td><input type="text" name="CELL_C" /></td>\n                                <td><input type="text" name="CELL_ALPHA" /></td>\n                                <td><input type="text" name="CELL_BETA" /></td>\n                                <td><input type="text" name="CELL_GAMMA" /></td>\n                            </tr> \n                        </tbody>    \n                    </table>\n                </div>\n                <label>Unit Cell</label>\n            </li>\n        </ul>\n    </div>\n\n    </form>\n\n    <div class="form">\n        <ul>\n            <li class="clearfix">\n                <label>Components\n                    <span class="small">Add: <input type="text" name="COMPONENTID"></span>\n                </label>\n                <span class="components floated">\n                    \n                </span>\n            </li>\n        </ul>\n    </div>\n\n    ',existingContainer&&(__p+='\n    <div class="form">\n        <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Sample</button>\n    </div>\n    '),__p+="\n\n";return __p}},1014:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <h2>Sample</h2>\n\n    <a class="button extrainfo r" href="#" title="Show extra fields"><i class="fa fa-plus"></i> Extra Fields</a>\n    <div class="form">\n        <ul class="clearfix">\n            <li>\n                <span class="label">Protein</span>\n                <span class="PROTEINID">'+(null==(__t=ACRONYM)?"":_.escape(__t))+'</span>\n            </li>\n            <li>\n                <span class="label">Abundance</span>\n                <span class="ABUNDANCE">'+(null==(__t=ABUNDANCE)?"":_.escape(__t))+"</span> "+(null==(__t=SYMBOL)?"":_.escape(__t))+'\n            </li>\n            <li class="clearfix">\n                <span class="label">Components\n                    <span class="small"><br />Add: <input type="text" name="COMPONENTID"></span>\n                </span>\n                <span class="components floated">\n                    \n                </span>\n            </li>\n            <li>\n                <span class="label">Sample Name</span>\n                <span><span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span> <a href="/samples/sid/'+(null==(__t=BLSAMPLEID)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> View</a></span>\n            </li>\n            <li>\n                <span class="label">Spacegroup</span>\n                <span class="SPACEGROUP">'+(null==(__t=SPACEGROUP)?"":_.escape(__t))+'</span>\n            </li>\n            <li class="clearfix reorder">\n                <div class="COMMENTS text">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</div>\n                <span class="label">Comments</span>\n            </li>\n\n            <li class="extra">\n                <span class="label">Required Res</span>\n                <span class="REQUIREDRESOLUTION">'+(null==(__t=REQUIREDRESOLUTION)?"":_.escape(__t))+'</span>\n            </li>\n            <li class="extra">\n                <span class="label">Anom Scatterer</span>\n                <span class="ANOMALOUSSCATTERER">'+(null==(__t=ANOMALOUSSCATTERER)?"":_.escape(__t))+'</span>\n            </li>\n            <li class="extra clearifx reorder">\n                <div class="text_table table">\n                    <table class="reflow cell">      \n                        <thead>            \n                            <tr>\n                                <th>A</th>\n                                <th>B</th>\n                                <th>C</th>\n                                <th>&alpha;</th>\n                                <th>&beta;</th>\n                                <th>&gamma;</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr>                                \n                                <td><span class="CELL_A">'+(null==(__t=CELL_A)?"":_.escape(__t))+'</span></td>\n                                <td><span class="CELL_B">'+(null==(__t=CELL_B)?"":_.escape(__t))+'</span></td>\n                                <td><span class="CELL_C">'+(null==(__t=CELL_C)?"":_.escape(__t))+'</span></td>\n                                <td><span class="CELL_ALPHA">'+(null==(__t=CELL_ALPHA)?"":_.escape(__t))+'</span></td>\n                                <td><span class="CELL_BETA">'+(null==(__t=CELL_BETA)?"":_.escape(__t))+'</span></td> \n                                <td><span class="CELL_GAMMA">'+(null==(__t=CELL_GAMMA)?"":_.escape(__t))+'</span></td>\n                            </tr> \n                        </tbody>    \n                    </table>\n                </div>\n                <span class="label">Unit Cell</span>\n            </li>\n\n        </ul>\n    </div>\n';return __p}},1015:function(e,t,s){(function(n){var i,a;i=[s(7),s(12),s(15),s(428)],void 0===(a=function(e,t,s,i){return e.LayoutView.extend({className:"content",template:n.template('<h1>Schedule for <%-NAME%></h1><p class="help">This page lists the components for the selected schedule</p><div class="wrapper"></div>'),regions:{wrap:".wrapper"},initialize:function(e){this.components=new i,this.components.queryParams.shid=this.model.get("SCHEDULEID"),this.components.fetch();this.table=new t({collection:this.components,columns:[{name:"OFFSET_HOURS",label:"Offset Hours",cell:"string",editable:!1},{name:"INSPECTIONTYPE",label:"Imaging Type",cell:"string",editable:!1}],tableClass:"components",pages:!1,loading:!0,backgrid:{emptyText:"No components found"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1020:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="messages"></div>\n\n<h1 class="no_mobile">Add New Container</h1>\n\n<div class="ra">\n    <a class="button" href="/assign"><i class="fa fa-arrows"></i> <span>Assign Containers</span></a>\n</div>\n\n<p class="help">This page shows the contents of the selected container. Samples can be added and edited by clicking the pencil icon, and removed by clicking the x</p>\n\n<div class="form clearfix puck_wrap">\n    <form>\n    <a href="#" class="button pf no_mobile" title="Paste container contents from clipboard"><i class="fa fa-paste"></i> Paste from Spreadsheet</a>\n    <a name="top"></a>\n    <div class="puck" title="Click to jump to a position in the puck"></div>\n    \n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n        </li>\n        \n        <li>\n            <span class="label">Dewar</span>\n            <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <label>Container Type</label>\n            <select name="CONTAINERTYPE"></select>\n        </li>\n        <li>\n            <label>Container Name</label>\n            <input type="text" name="NAME" />\n        </li>\n        <li class="pck">\n            <label>Registered Container</label>\n            <select name="CONTAINERREGISTRYID"></select>\n        </li>\n\n        <li class="autoprocessing_options">\n            <label>Priority Processing\n                <span class="small">Other data reduction pipelines will run on a lower priority queue</span>\n            </label>\n            <select name="PIPELINE"></select>\n        </li>\n\n        <li class="pck">\n            <label>Automated Collection</label>\n            <input type="checkbox" name="AUTOMATED" value="1" />\n        </li>\n\n        <li class="pcr plate">\n            <label>Barcode</label>\n            <input type="text" name="BARCODE" /> <span class="message"></span>\n        </li>\n\n        <li>\n            <label>Owner\n                <span class="small">This user will be emailed with container updates. Check your email is up to date!</span>\n            </label>\n            <select name="PERSONID"></select> <a href="#" class="button edit_user"><i class="fa fa-search"></i> View</a>\n        </li>\n\n        <li class="pcr">\n            <label>Experiment Type\n            </label>\n            <select name="EXPERIMENTTYPE">\n                <option value="">-</option>\n                <option value="robot">Robot</option>\n                <option value="hplc">HPLC</option>\n            </select>\n        </li>\n\n        <li class="pcr">\n            <label>Storage Temperature\n            </label>\n            <select name="STORAGETEMPERATURE">\n                <option value="">-</option>\n                <option value="-80">-80</option>\n                <option value="0">-0</option>\n                <option value="25">25</option>\n            </select>\n        </li>\n\n        <li>\n            <label>Comments\n                <span class="small">Comment for the container</span>\n            </label>\n            <input type="text" name="COMMENTS" />\n        </li>\n\n        <li class="plate">\n            <label>Requested Imager\n                <span class="small">Imager this container should go into</span>\n            </label>\n            <select name="REQUESTEDIMAGERID"></select>\n        </li>\n\n        <li class="plate">\n            <label>Imaging Schedule\n                <span class="small">Requested imaging schedule</span>\n            </label>\n            <select name="SCHEDULEID"></select> <a href="#" class="button view_sch"><i class="fa fa-search"></i> View</a>\n        </li>\n\n        <li class="plate">\n            <label>Crystallisation Screen\n                <span class="small">Crystallisation screen that was used for this container</span>\n            </label>\n            <select name="SCREENID"></select>\n        </li>\n    </ul>\n    \n    </form>\n    <div class="left">\n        <div class="singlesamp"></div>\n        <div class="group "></div>\n    </div>\n    \n</div>\n\n\n<div class="la puck_controls">\n    <a class="button autofill" href="#" title="Autofill puck"><i class="fa fa-plus"></i> Autofill Puck</a>\n\n    <a class="button clonepuck" href="#" title="Clone entire puck from first sample"><i class="fa fa-plus"></i> Clone from First Sample</a>\n    <a class="button clearpuck" href="#" title="Clear entire puck"><i class="fa fa-times"></i> Clear Puck</a>\n\n    <a class="button extrainfo r" href="#" title="Show extra fields"><i class="fa fa-plus extra-state"></i> Extra Fields</a>\n</div>\n<div class="table sample"></div>\n\n<div class="form">\n    <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Container</button>\n</div>';return __p}},1021:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <thead>\n        <tr>\n            <th>Location</th>\n            <th>Protein Acronym</th>\n            \n            <th>Name</th>\n            <th class="xtal auto-extra">Spacegroup</th>\n            <th class="xtal auto-extra">Barcode</th>\n            <th class="non-xtal">Volume</th>\n\n            <th class="auto">Centring Method</th>\n            <th class="auto">Experiment Kind</th>\n            <th class="auto">Energy (eV)</th>\n            <th class="auto extra">User Path</th>\n\n            <th>Comment</th>\n\n            <th class="xtal">Anomalous</th>\n\n            <th class="xtal requireresolution">Required Res</th>\n            <th class="extra">Abundance</th>\n            <th class="extra">Components</th>\n\n            <th class="extra">Unit Cell</th>\n            \n            <th>&nbsp;</th>\n        </tr>\n    </thead>\n    \n    <tbody></tbody>\n';return __p}},1022:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<td>"+(null==(__t=LOCATION)?"":_.escape(__t))+'</td>\n<td class="protein"><select name="PROTEINID"></select></td>\n\n<td class="name"><input class="sname" type="text" name="NAME" /></td>\n<td class="spacegroup xtal auto-extra"><select class="sg" name="SPACEGROUP"></select></td>\n<td class="barcode xtal auto-extra"><input class="barcode" name="CODE" type="text" /></td>\n<td class="volume non-xtal"><input class="volume" type="text" name="VOLUME" /></td>\n\n<td class="centringmethod auto"><select name="CENTRINGMETHOD"></select></td>\n<td class="experimentkind auto"><select name="EXPERIMENTKIND"></select></td>\n<td class="energy auto"><input type="text" name="ENERGY"></select></td>\n<td class="userpath auto extra"><input type="text" name="USERPATH"></select></td>\n\n<td class="comments"><input class="comments" type="text" name="COMMENTS" /></td>\n\n<td class="anomalousscatterer"><select class="xtal" name="ANOMALOUSSCATTERER"></select></td>\n\n<td class="requiredresolution xtal"><input type="text" name="REQUIREDRESOLUTION" /></td>\n\n<td class="abundance extra"><input type="text" name="ABUNDANCE" value="'+(null==(__t=ABUNDANCE)?"":_.escape(__t))+'" /> <span class="SYMBOL">'+(null==(__t=SYMBOL)?"":_.escape(__t))+'</span></td>\n<td class="extra components">\n    Add: <input type="text" name="COMPONENTID">\n</td>\n\n<td class="unitcell extra">\n\t<input type="text" name="CELL_A" placeholder="A" />\n\t<input type="text" name="CELL_B" placeholder="B" />\n\t<input type="text" name="CELL_C" placeholder="C" />\n\t<input type="text" name="CELL_ALPHA" placeholder="&alpha;" />\n\t<input type="text" name="CELL_BETA" placeholder="&beta;" />\n\t<input type="text" name="CELL_GAMMA" placeholder="&gamma;" />\n</td>\n\n<td>\n    <a href="#" class="button button-notext clone"><i class="fa fa-plus"></i> <span>Clone</span></a>\n    <a href="#" class="button button-notext clear"><i class="fa fa-times"></i> <span>Clear</span></a>\n    <span class="top r"><a href="#top" class="button"><i class="fa fa-angle-double-up"></i> Top</a></span>\n</td>\n';return __p}},1023:function(e,t,s){var n,i;n=[s(118)],void 0===(i=function(e){return e.extend({showFilter:!1,showImaging:!1,columns:[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"DEWAR",label:"Dewar",cell:"string",editable:!1},{name:"BARCODE",label:"Barcode",cell:"string",editable:!1},{name:"SHIPMENT",label:"Shipment",cell:"string",editable:!1},{name:"SAMPLES",label:"# Samples",cell:"string",editable:!1},{name:"DCCOUNT",label:"# DCs",cell:"string",editable:!1},{name:"CONTAINERTYPE",label:"Type",cell:"string",editable:!1}]})}.apply(t,n))||(e.exports=i)},1024:function(e,t,s){var n,i;n=[s(7),s(157),s(253),s(256),s(96),s(433),s(434),s(1028)],void 0===(i=function(e,t,s,n,i,a,l,o){var r=n.extend({template:o,createSamples:function(){this.samples=new s(null,{state:{pageSize:9999,addPrimary:!0}}),this.samples.queryParams.seq=1},initialize:function(e){r.__super__.initialize.call(this,e),this.crystals=new t,this.crystals.fetch()},onShow:function(){this._ready.done(this.doOnShow.bind(this))},doOnShow:function(){console.log("Showing XPDF container"),this.types=new l,this.type=this.types.findWhere({name:this.model.get("CONTAINERTYPE")}),this.type.get("capacity")>1&&(this.$el.find(".puck").css("width","50%"),this.puck.show(new i({collection:this.samples,type:this.type}))),this.table.show(new a({collection:this.samples,crystals:this.crystals,proteins:this.proteins}))}});return r}.apply(t,n))||(e.exports=i)},1025:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="    <thead>\n        <tr>\n            <th>Location</th>\n            <th>Sample</th>\n            <th>Name</th>\n            <th>Packing Fraction</th>\n            <th>Exp. Density</th>\n            <th>Composition</th>\n            <th>Comment</th>\n            <th>Container</th>\n            <th>Shape</th>\n            <th>Status</th>\n            <th>&nbsp;</th>\n        </tr>\n    </thead>\n    \n    <tbody></tbody>\n";return __p}},1026:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n    <td>"+(null==(__t=LOCATION)?"":_.escape(__t))+"</td>\n\n    ",-1==CRYSTALID?__p+='\n    <td colspan="9">&nbsp;</td>\n    ':(__p+="\n\n    <td>"+(null==(__t=CRYSTAL)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=NAME)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=PACKINGFRACTION)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=EXPERIMENTALDENSITY)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=COMPOSITION)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=COMMENTS)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t="1"==LOOPTYPE?"Yes":"No")?"":_.escape(__t))+"</td>\n    <td>\n        <table>\n            <tr>\n                <td>Width</td>\n                <td>"+(null==(__t=DIMENSION1)?"":_.escape(__t))+"</td>\n            </tr>\n            <tr>\n                <td>Height</td>\n                <td>"+(null==(__t=DIMENSION2)?"":_.escape(__t))+"</td>\n            </tr>\n            <tr>\n                <td>Length</td>\n                <td>"+(null==(__t=DIMENSION3)?"":_.escape(__t))+"</td>\n            </tr>\n            <tr>\n                <td>Shape</td>\n                <td>"+(null==(__t=SHAPE)?"":_.escape(__t))+"</td>\n            </tr>\n        </table>\n    </td>\n\n    <td>\n        ",BLSAMPLEID&&STATUS&&(__p+='\n        <ul class="status">\n            <li class="'+(null==(__t=STATUS)?"":_.escape(__t))+'"></li>\n        </ul>\n        '),__p+="\n    </td>\n\n    "),__p+="\n    <td>\n        ",IN_USE||(__p+='\n            <a href="#" class="edit button button-notext" title="Edit instance details"><i class="fa fa-pencil"></i> <span>Edit Instance</span></a>\n        '),__p+="\n        ",PROTEINID>-1&&(__p+='\n        <a href="#" class="cont button button-notext" title="Edit instance containers"><i class="fa fa-cubes"></i> <span>Edit Containers</span></a>\n        <a href="/instances/sid/'+(null==(__t=BLSAMPLEID)?"":_.escape(__t))+'" class="view button button-notext" title="View instance details"><i class="fa fa-search"></i> <span>View Instance</span></a>\n        '),__p+="        \n    </td>\n";return __p}},1027:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<td>"+(null==(__t=LOCATION)?"":_.escape(__t))+'</td>\n<td><select name="CRYSTALID"></select>\n<td><input type="text" name="NAME" value="'+(null==(__t=NAME)?"":_.escape(__t))+'" /></td>\n<td><input type="text" name="PACKINGFRACTION" value="'+(null==(__t=PACKINGFRACTION)?"":_.escape(__t))+'" /></td>\n<td>&nbsp;</td>\n<td>&nbsp;</td>\n<td><input type="text" name="COMMENTS" value="'+(null==(__t=COMMENTS)?"":_.escape(__t))+'" /></td>\n<td><input type="checkbox" name="LOOPTYPE" value="1" '+(null==(__t="1"==LOOPTYPE?'checked="checked"':"")?"":_.escape(__t))+' /></td>\n<td>\n    <table>\n        <tr>\n            <td>Width</td>\n            <td><input type="text" name="DIMENSION1" value="'+(null==(__t=DIMENSION1)?"":_.escape(__t))+'" /></td>\n        </tr>\n        <tr>\n            <td>Height</td>\n            <td><input type="text" name="DIMENSION2" value="'+(null==(__t=DIMENSION2)?"":_.escape(__t))+'" /></td>\n        </tr>\n        <tr>\n            <td>Length</td>\n            <td><input type="text" name="DIMENSION3" value="'+(null==(__t=DIMENSION3)?"":_.escape(__t))+'" /></td>\n        </tr>\n        <tr>\n            <td>Shape</td>\n            <td><input type="text" name="SHAPE" value="'+(null==(__t=SHAPE)?"":_.escape(__t))+'" /></td>\n        </tr>\n    </table>\n</td>\n<td>&nbsp;</td>\n<td>\n    <a href="#" class="button button-notext save"><i class="fa fa-check"></i> <span>Save Changes</span></a>\n    <a href="#" class="button button-notext cancel"><i class="fa fa-times"></i> <span>Cancel</span></a>\n</td>\n';return __p}},1028:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Container: <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span></h1>\n\n<a name="top"></a>\n<p class="help">This page shows the contents of the selected box or sample stage. Samples can be added by clicking the position in the table. Or will be, once ContainerId and Position can be changed.</p>\n\n\x3c!-- \n',"processing"==CONTAINERSTATUS&&(__p+='\n<p class="message alert">This container is currently assigned and in use on a beamline sample changer. Unassign it to make it editable</p>\n'),__p+='\n--\x3e\n<div class="form clearfix puck_wrap">\n    <div class="puck" title="Click to jump to a position in the sample changer"></div>\n    \n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n        </li>\n        \n        <li>\n            <span class="label">Stage Parcel</span>\n            <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Stage Type</span>\n            <span>'+(null==(__t=CONTAINERTYPE)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Barcode</span>\n            <span class="BARCODE">'+(null==(__t=BARCODE)?"":_.escape(__t))+"</span>\n        </li>\n        ",EXPERIMENTTYPE&&(__p+='\n        <li>\n            <span class="label">Experiment Type</span>\n            <span class="EXPERIMENTTYPE">'+(null==(__t=EXPERIMENTTYPE)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+="\n        ",STORAGETEMPERATURE&&(__p+='\n        <li>\n            <span class="label">Storage Temperature</span>\n            <span class="STORAGETEMPERATURE">'+(null==(__t=STORAGETEMPERATURE)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+='\n        <li>\n            <span class="label">Comments</span>\n            <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</span>\n        </li>\n        <li class="clearfix reorder">\n            <div class="history text_table half"></div>\n            <span class="label">Location History</span>\n        </li>\n    </ul>\n</div>\n<a class ="button expplan" href="/containers/plan/'+(null==(__t=CONTAINERID)?"":_.escape(__t))+'" title="Plan experiments for this sample changer"><i class="fa fa-wrench"></i> Plan Experiments</a>\n<div class="table sample"></div>\n\n';return __p}},1029:function(e,t,s){var n,i;n=[s(7),s(426),s(1030),s(96),s(157),s(433),s(434),s(1031),s(1032),s(1033)],void 0===(i=function(e,t,s,n,i,a,l,o,r,c){var p=t.extend({template:o,initialize:function(e){p.__super__.initialize.call(this,e),this.ctypes=new l,this.crystals=new i,this.crystals.fetch()},setType:function(e){this.type=this.ctypes.findWhere({name:this.ui.type.val()}),this.type.set({isSelected:!0}),this.model.set({CAPACITY:this.type.get("capacity"),CONTAINERTYPE:this.type.get("name")}),this.puck.$el.css("width",app.mobile()?"100%":"50%"),this.puck.show(new n({collection:this.samples,type:this.type,showValid:!0})),this.buildCollection(),this.stable=new a({crystals:this.crystals,proteins:this.proteins,gproteins:this.gproteins,collection:this.samples,childTemplate:c,template:r}),this.table.show(this.stable),this.single.empty(),this.ui.pc.show()},selectSample:function(){}});return p}.apply(t,n))||(e.exports=i)},1030:function(e,t,s){var n,i;n=[s(16),s(12),s(15)],void 0===(i=function(e,t,s){return t.extend({columns:[{name:"LOCATION",label:"Location",cell:"string",editable:!1},{name:"PROTEINID",label:"Sample",cell:"integer",editable:!0},{name:"NAME",label:"Name",cell:"string",editable:!0},{name:"PACKINGFRACTION",label:"Packing Fraction",cell:"string",editable:!0},{name:"EXPERIMENTALDENSITY",label:"Exp. Density",cell:"string",editable:!1},{name:"COMPOSITION",label:"Composition",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1},{cell:"string",editable:!1}],backgrid:{},pages:!1})}.apply(t,n))||(e.exports=i)},1031:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="messages"></div>\n\n<h1 class="no_mobile">Add New Sample Stage</h1>\n\n<div class="ra">\n    <a class="button" href="/assign"><i class="fa fa-arrows"></i> <span>Assign Containers</span></a>\n</div>\n\n\n<p class="help">This page shows the contents of the selected stage. Sample instances can be added and edited by clicking the pencil icon, and removed by clicking the x</p>\n\n<div class="form clearfix puck_wrap">\n    <form>\n    <a name="top"></a>\n    <div class="puck"></div>\n    \n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n        </li>\n        \n        <li>\n            <span class="label">Parcel</span>\n            <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <label>Stage Type</label>\n            <select name="CONTAINERTYPE"></select>\n        </li>\n        <li>\n            <label>Stage Name</label>\n            <input type="text" name="NAME" />\n        </li>\n\n        <li>\n            <label>Barcode</label>\n            <input type="text" name="BARCODE" /> <span class="message"></span>\n        </li>\n\n        <li>\n            <label>Owner\n                <span class="small">This user will be emailed with container updates. Check your email is up to date!</span>\n            </label>\n            <select name="PERSONID"></select> <a href="#" class="button edit_user"><i class="fa fa-search"></i> View</a>\n        </li>\n\n        <li>\n            <label>Comments\n                <span class="small">Comment for the container</span>\n            </label>\n            <input type="text" name="COMMENTS" />\n        </li>\n\n    </form>\n    <div class="left">\n        <div class="singlesamp"></div>\n    </div>\n    \n</div>\n\n<div class="la puck_controls">\n    <a class="button clearpuck" href="#" title="Clear entire sample changer"><i class="fa fa-times"></i> Clear Sample Changer</a>\n</div>\n<div class="table sample"></div>\n\n<div class="form">\n    <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Container</button>\n</div>\n';return __p}},1032:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="    <thead>\n        <tr>\n            <th>Location</th>\n            <th>Sample</th>\n            <th>Name</th>\n            <th>Packing Fraction</th>\n            <th>Comment</th>\n            <th>Container</th>\n            <th>Shape</th>\n            <th>&nbsp;</th>\n        </tr>\n    </thead>\n    \n    <tbody></tbody>\n";return __p}},1033:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n<td>"+(null==(__t=LOCATION)?"":_.escape(__t))+'</td>\n<td><select name="CRYSTALID"></select></td>\n<td><input class="sname" type="text" name="NAME" /></td>\n<td><input type="text" name="PACKINGFRACTION" /></td>\n<td><input class="comments" type="text" name="COMMENTS" /></td>\n<td><input type="checkbox" name="LOOPTYPE" /></td>\n<td>\n    <table>\n        <tr>\n            <td>Width</td>\n            <td><input type="text" name="DIMENSION1" /></td>\n        </tr>\n        <tr>\n            <td>Height</td>\n            <td><input type="text" name="DIMENSION2" /></td>\n        </tr>\n        <tr>\n            <td>Length</td>\n            <td><input type="text" name="DIMENSION3" /></td>\n        </tr>\n        <tr>\n            <td>Shape</td>\n            <td><input type="text" name="SHAPE" /></td>\n        </tr>\n    </table>\n</td>\n<td>\n    <a href="#" class="button button-notext clone"><i class="fa fa-plus"></i> <span>Clone</span></a>\n    <a href="#" class="button button-notext clear"><i class="fa fa-times"></i> <span>Clear</span></a>\n    <span class="top r"><a href="#top" class="button"><i class="fa fa-angle-double-up"></i> Top</a></span>\n</td>\n';return __p}},1034:function(e,t,s){(function(n){var i,a;i=[s(7),s(16),s(12)],void 0===(a=function(e,t,s){var i=t.Row.extend({events:{click:"onClick"},onClick:function(){app.trigger("shipment:show",this.model.get("SHIPPINGID"))},render:function(){return t.Row.prototype.render.call(this),console.log("render row",this.model.get("SAFETYLEVEL")),"Yellow"==this.model.get("SAFETYLEVEL")&&this.$el.addClass("minor"),"Red"==this.model.get("SAFETYLEVEL")&&this.$el.addClass("inactive"),this}});return e.LayoutView.extend({className:"content",template:'<div><h1>Shipments</h1><p class="help">This page shows a list of shipments associated with the currently selected proposal</p><p class="help">In order to register your samples you need to create a shipment. Shipments contain dewars, dewars contain containers, and containers individual samples. These can be created sequentially by viewing a particular shipment</p><div class="ra"><a class="button add" href="/shipments/add"><i class="fa fa-plus"></i> Add Shipment</a></div><div class="wrapper"></div></div>',regions:{wrap:".wrapper"},ui:{add:"a.add"},initialize:function(e){var t=[{name:"SHIPPINGNAME",label:"Name",cell:"string",editable:!1},{name:"CREATED",label:"Creation Date",cell:"string",editable:!1},{name:"LCOUT",label:"Outgoing Contact",cell:"string",editable:!1},{name:"LCRET",label:"Return Contact",cell:"string",editable:!1},{name:"SHIPPINGSTATUS",label:"Status",cell:"string",editable:!1},{name:"DCOUNT",label:"# Comp",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1}];app.mobile()&&n.each([2,3,5,6],(function(e){t[e].renderable=!1})),this.table=new s({collection:e.collection,columns:t,tableClass:"shipments",backgrid:{row:i,emptyText:"No shipments found"}})},onRender:function(){app.proposal&&1!=app.proposal.get("ACTIVE")&&this.ui.add.hide(),this.wrap.show(this.table)}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1035:function(e,t,s){(function(n){var i,a;i=[s(7),s(152),s(48),s(60),s(1036),s(80),s(1040),s(172),s(1045),s(435),s(1046),s(20),s(11),s(1048),s(6),s(18)],void 0===(a=function(e,t,s,i,a,l,o,r,c,p,h,d,u,m,_){return e.LayoutView.extend({className:"content",template:m,regions:{table:".table",history:".history",cont:".dcontent",rtracking:".tracking"},templateHelpers:function(){return{APIURL:app.apiurl,PROP:app.prop,DHL_ENABLE:app.options.get("dhl_enable")}},events:{"click #add_dewar":"addDewar","click a.send":"sendShipment","click a.pdf":u.signHandler,"click a.cancel_pickup":"cancelPickup"},ui:{add_dewar:"#add_dewar"},cancelPickup:function(e){e.preventDefault(),u.confirm({title:"Cancel Pickup",content:"Are you sure you want to cancel this pickup? This cannot be undone",callback:this.doCancelPickup.bind(this)})},doCancelPickup:function(){var e=this;_.ajax({type:"DELETE",url:app.apiurl+"/shipment/pickup/cancel/"+this.model.get("SHIPPINGID"),success:function(){e.model.set("DELIVERYAGENT_PICKUPCONFIRMATION",null),e.render(),app.alert({message:"Pickup Cancelled"})},error:function(e,t,s){var i;if(e.responseText)try{i=n.parseJSON(e.responseText)}catch(e){}app.alert({message:i.message})}})},sendShipment:function(e){e.preventDefault();var t=this;_.ajax({url:app.apiurl+"/shipment/send/"+this.model.get("SHIPPINGID"),success:function(){t.model.set({SHIPPINGSTATUS:"send to DLS"}),app.alert({className:"message notify",message:"Shipment successfully marked as sent"}),t.render()},error:function(){app.alert({message:"Something went wrong sending this shipment, please try again"})}})},addDewar:function(e){e.preventDefault(),this.dewars.add(new t({SHIPPINGID:this.model.get("SHIPPINGID"),new:!0}))},initialize:function(e){this.lastDewarID=null,_.Validation.bind(this),this.dewarcontent=new l,this.dewarcontent.setSorting("NAME"),this.dewarhistory=new r,this.dewartracking=new p,this.dewars=new s(null,{id:this.model.get("SHIPPINGID")}),this.fetchDewars(),this.listenTo(app,"shipment:showdewar",this.showDewar)},fetchDewars:function(e){var t=this;this.dewars.fetch().done((function(){console.log("dewars fetch",t.dewars),t.dewars.length&&t.showDewar(t.dewars.at(0).get("DEWARID"),e),e&&t.table.currentView.render()}))},showDewar:function(e,t){if(e!=this.lastDewarID||t){this.$el.find(".dewar_name").text(this.dewars.findWhere({DEWARID:e}).get("CODE")),app.proposal&&"1"==app.proposal.get("ACTIVE")&&this.$el.find(".add_container").html('<a class="button" href="/containers/add/did/'+e+'"><i class="fa fa-plus"></i> Add Container</a>'),this.dewarcontent.dewarID=e,this.dewarcontent.fetch(),this.dewarhistory.id=e,this.dewarhistory.fetch();var s=this.dewars.findWhere({DEWARID:e});s&&(s.get("TRACKINGNUMBERTOSYNCHROTRON")||s.get("TRACKINGNUMBERTOSYNCHROTRON"))?(this.dewartracking.queryParams.DEWARID=e,this.dewartracking.fetch()):(this.dewartracking.ORIGIN="N/A",this.dewartracking.DESTINATION="N/A",this.dewartracking.reset(),this.lastDewarID=e)}},refreshDewar:function(){this.fetchDewars(!0)},onRender:function(){app.proposal&&"1"!=app.proposal.get("ACTIVE")&&this.ui.add_dewar.hide(),this.table.show(new a({collection:this.dewars})),this.cont.show(new o({collection:this.dewarcontent})),this.history.show(new c({collection:this.dewarhistory})),this.rtracking.show(new h({collection:this.dewartracking})),this.listenTo(this.cont.currentView,"refresh:dewars",this.refreshDewar,this);var e=new d({model:this.model,el:this.$el});e.create("SHIPPINGNAME","textlong"),e.create("SAFETYLEVEL","select",{data:{Green:"Green",Yellow:"Yellow",Red:"Red"}}),e.create("COMMENTS","textarea"),e.create("DELIVERYAGENT_AGENTNAME","text"),e.create("DELIVERYAGENT_AGENTCODE","text"),e.create("DELIVERYAGENT_SHIPPINGDATE","date"),e.create("DELIVERYAGENT_DELIVERYDATE","date"),e.create("DELIVERYAGENT_FLIGHTCODE","text"),e.create("PHYSICALLOCATION","text"),e.create("READYBYTIME","time"),e.create("CLOSETIME","time");var t=this;this.contacts=new i(null,{state:{pageSize:9999}}),this.contacts.fetch().done((function(){console.log(t.contacts,t.contacts.kv()),e.create("SENDINGLABCONTACTID","select",{data:t.contacts.kv()}),e.create("RETURNLABCONTACTID","select",{data:t.contacts.kv()})}))}})}.apply(t,i))||(e.exports=a)}).call(this,s(8))},1036:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(6),s(37),s(268),s(49),s(20),s(128),s(11),s(1037),s(1038),s(1039),s(18)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d){var u=l.extend(n.extend({},r,{getTemplate:function(){return this.model.get("new")?d:h},tagName:"tr",templateHelpers:function(){return{APIURL:app.apiurl,PROP:app.prop}},events:{"click a.cancel":"cancelDewar","click td":"showDewar","click a.deact":"deactivateDewar","click a.print":c.signHandler},ui:{first:"select[name=FIRSTEXPERIMENTID]",fc:"select[name=FACILITYCODE]"},className:function(){if("processing"==this.model.get("DEWARSTATUS"))return"active"},deactivateDewar:function(e){e.preventDefault();var s=this;t.ajax({url:app.apiurl+"/assign/deact",data:{did:this.model.get("DEWARID")},success:function(){s.$el.removeClass("active")},error:function(){app.alert({message:"Something went wrong deactivating this dewar"})}})},showDewar:function(e){console.log("show dewar",this.model.get("new")),this.model.get("new")||app.trigger("shipment:showdewar",this.model.get("DEWARID"))},setData:function(){var e={};n.each(["CODE","FACILITYCODE","FIRSTEXPERIMENTID","TRACKINGNUMBERTOSYNCHROTRON","TRACKINGNUMBERFROMSYNCHROTRON","WEIGHT"],(function(t){e[t]=i("[name="+t+"]").val()})),this.model.set(e)},success:function(e,t,s){this.model.set("new",!1);var n=this;this.model.fetch().done((function(){n.render()}))},error:function(e,t,s){app.message("Something went wrong creating this dewar, please try again")},cancelDewar:function(e){e.preventDefault(),this.model.collection.remove(this.model)},initialize:function(){this.showDewar=n.debounce(this.showDewar,500)},onRender:function(){console.log("rendering row"),t.Validation.unbind(this),t.Validation.bind(this);var e=new o({model:this.model,el:this.$el});e.create("CODE","text");var n=this;e.create("FACILITYCODE","select",{data:function(){return n.getOption("regdewars").kv({empty:!0})}}),e.create("TRACKINGNUMBERTOSYNCHROTRON","text"),e.create("TRACKINGNUMBERFROMSYNCHROTRON","text"),e.create("WEIGHT","text");n=this;this.visits=new s(null,{queryParams:{next:1},state:{pageSize:5}}),this.visits.fetch().done((function(){n.ui.first.html(n.visits.opts()),e.create("FIRSTEXPERIMENTID","select",{data:n.visits.kv()},!0)})),this.ui.fc.html(this.getOption("regdewars").opts({empty:!0}))}})),m=e.ItemView.extend({tagName:"tr",template:n.template('<td colspan="10">No dewars for this shipment</td>')});return GridView=t.Marionette.CompositeView.extend({tagName:"table",emptyView:m,className:"dewars reflow",template:p,childView:u,proteins:"",childViewOptions:function(){return{regdewars:this.regdewars}},initialize:function(e){e.childTemplate&&(this.options.childViewOptions.template=e.childTemplate),this.regdewars=new a,this.regdewars.state.pageSize=9999,this.regdewars.fetch()}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1037:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="    <thead>\n        <tr>\n            <th>Name</th>\n            <th>Barcode</th>\n            <th>Facility Code</th>\n            <th>Weight (Kg)</th>\n            <th>First Experiment</th>\n            <th>Tracking # to</th>\n            <th>Tracking # from</th>\n            <th>Status</th>\n            <th>Location</th>\n            <th>Containers</th>\n            <th>&nbsp;</th>\n        </tr>\n    </thead>\n    \n    <tbody></tbody>\n";return __p}},1038:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <td class="CODE">'+(null==(__t=CODE)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=BARCODE)?"":_.escape(__t))+'</td>\n    <td class="FACILITYCODE">'+(null==(__t=FACILITYCODE)?"":_.escape(__t))+'</td>\n    <td class="WEIGHT">'+(null==(__t=WEIGHT)?"":_.escape(__t))+'</td>\n    <td class="FIRSTEXPERIMENTID">'+(null==(__t=EXP)?"":_.escape(__t))+'</td>\n    <td class="TRACKINGNUMBERTOSYNCHROTRON">'+(null==(__t=TRACKINGNUMBERTOSYNCHROTRON)?"":_.escape(__t))+'</td>\n    <td class="TRACKINGNUMBERFROMSYNCHROTRON">'+(null==(__t=TRACKINGNUMBERFROMSYNCHROTRON)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=DEWARSTATUS)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=STORAGELOCATION)?"":_.escape(__t))+"</td>\n    <td>"+(null==(__t=CCOUNT)?"":_.escape(__t))+'</td>\n    <td>\n        <span class="deactivate"><a class="button button-notext deact" title="Deactivate Dewar"><i class="fa  fa-power-off"></i> <span>Deactivate Dewar</span></a></span>\n        <a class="button button-notext print" title="Click to print dewar contents" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/pdf/container/did/"+(null==(__t=DEWARID)?"":_.escape(__t))+"/prop/"+(null==(__t=PROP)?"":_.escape(__t))+'"><i class="fa fa-print"></i> <span>Print Dewar Report</span></a>\n        <a class="button button-notext add" title="Click to add a container" href="/containers/add/did/'+(null==(__t=DEWARID)?"":_.escape(__t))+'"><i class="fa fa-plus"></i> <span>Add Container</span></a>\n\n        ',"stores-out"!=STORAGELOCATION&&(__p+='\n        <a class="button button-notext" title="Click to dispatch dewar back to your lab" href="/dewars/dispatch/'+(null==(__t=DEWARID)?"":_.escape(__t))+'"><i class="fa fa-home"></i> <span>Dispatch Dewar</span></a>\n        <a class="button button-notext" title="Click to transfer dewar to another beamline" href="/dewars/transfer/'+(null==(__t=DEWARID)?"":_.escape(__t))+'"><i class="fa fa-arrows-h"></i> <span>Transfer Dewar</span></a>\n        '),__p+="\n    </td>\n\n";return __p}},1039:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <td><input name="CODE" /></td>\n    <td>&nbsp;</td>\n    <td><select name="FACILITYCODE"></select></td>\n    <td><input name="WEIGHT" /></td>\n    <td><select name="FIRSTEXPERIMENTID"></select></td>\n    <td><input name="TRACKINGNUMBERTOSYNCHROTRON" /></td>\n    <td><input name="TRACKINGNUMBERFROMSYNCHROTRON" /></td>\n    <td colspan="3">&nbsp;</td>\n    <td>\n        <a class="button button-notext save"><i class="fa fa-check"></i> <span>Save Dewar</span></a>\n        <a class="button button-notext cancel"><i class="fa fa-times"></i> <span>Cancel</span></a>\n    </td>\n\n';return __p}},1040:function(e,t,s){(function(n){var i,a;i=[s(7),s(1041),s(62),s(11),s(1043)],void 0===(a=function(e,t,s,i,a){var l=e.ItemView.extend({tagName:"li",template:"<li>No Containers for this dewar</li>"}),o=e.ItemView.extend({tagName:"li",template:a,events:{"click a.move":"moveContainer","click a.print":i.signHandler},templateHelpers:function(){return{APIURL:app.apiurl,PROP:app.prop}},moveContainer:function(e){e.preventDefault(),app.dialog.show(new t({model:this.model})),this.listenTo(app.dialog.currentView,"container:moved",this.triggerRefresh,this)},triggerRefresh:function(){this.trigger("container:moved")}}),r=e.CollectionView.extend({className:"containers",tagName:"ul",childView:o,emptyView:l,childEvents:{"container:moved":"triggerRefresh"},triggerRefresh:function(){this.trigger("refresh:dewars")}});return e.LayoutView.extend({template:n.template('<div class="rcont"></div><div class="rpages page_wrap"></div>'),regions:{rcont:".rcont",rpages:".rpages"},onRender:function(){this.rcont.show(new r({collection:this.getOption("collection")})),this.rpages.show(new s({collection:this.getOption("collection")}))}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1041:function(e,t,s){var n,i;n=[s(6),s(27),s(81),s(48),s(1042)],void 0===(i=function(e,t,s,n,i){return t.extend({template:i,title:"Move Container",buttons:{Move:"moveContainer",Cancel:"closeDialog"},ui:{dewar:"select[name=dewar]",shipment:"select[name=shipment]"},events:{"change @ui.shipment":"refreshDewars"},updateShipments:function(){this.ui.shipment.html(this.shipments.opts()),this.refreshDewars()},refreshDewars:function(){this.ui.shipment.val()&&(this.dewars=new n(null,{id:this.ui.shipment.val(),state:{pageSize:9999}}),this.dewars.fetch().done(this.updateDewars.bind(this)))},updateDewars:function(){this.ui.dewar.html(this.dewars.opts())},moveContainer:function(){var t=this;e.ajax({url:app.apiurl+"/shipment/containers/move",data:{cid:this.model.get("CONTAINERID"),did:this.ui.dewar.val()},success:function(){app.alert({className:"message notify",message:"Container successfully moved"}),t.trigger("container:moved"),t.closeDialog()},error:function(){app.alert({message:"Something went wrong moving this container, please try again"})}})},initialize:function(e){console.log(e.model),this.shipments=new s(null,{state:{pageSize:9999}}),this.shipments.fetch().done(this.updateShipments.bind(this))}})}.apply(t,n))||(e.exports=i)},1042:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<p><span class="b">Container:</span> '+(null==(__t=NAME)?"":_.escape(__t))+'</p>\n<p><span class="b">Select a Shipment:</span>\n<select name="shipment"></select></p>\n<p><span class="b">Select a Dewar:</span>\n<select name="dewar"></select></p>\n';return __p}},1043:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n        "+(null==(__t=NAME)?"":_.escape(__t))+" ("+(null==(__t=SAMPLES)?"":_.escape(__t))+" samples)\n        ",REQUESTEDIMAGERID&&(__p+="\n        \t[Req: "+(null==(__t=REQUESTEDIMAGER)?"":_.escape(__t))+"]\n        "),__p+="\n        ",IMAGERID&&(__p+="\n        \t[Img: "+(null==(__t=IMAGER)?"":_.escape(__t))+"]\n        "),__p+='\n        <span class="r">\n            <a class="button button-notext print" title="Click to print container contents" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/pdf/container/cid/"+(null==(__t=CONTAINERID)?"":_.escape(__t))+"/prop/"+(null==(__t=PROP)?"":_.escape(__t))+'"><i class="fa fa-print"></i> <span>Print Container Report</span></a>\n            <a class="button button-notext view" title="Click to View Container" href="/containers/cid/'+(null==(__t=CONTAINERID)?"":_.escape(__t))+'"><i class="fa fa-search"></i> <span>View Container</span></a>\n            \n            <a href="#" class="button button-notext move"><i class="fa fa-arrows"></i> <span>Move Container</span></a>\n        </span>\n';return __p}},1044:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"DEWARTRANSPORTHISTORYID",urlRoot:"/shipment/dewars/history",validation:{BARCODE:{required:!0,pattern:"wwdash"},LOCATION:{required:!0,pattern:"wwsdash"}}})}.apply(t,n))||(e.exports=i)},1045:function(e,t,s){var n,i;n=[s(12)],void 0===(i=function(e){return e.extend({backgrid:{emptyText:"No history available"},className:"history",columns:[{name:"ARRIVAL",label:"Date",cell:"string",editable:!1},{name:"DEWARSTATUS",label:"Status",cell:"string",editable:!1},{name:"STORAGELOCATION",label:"Location",cell:"string",editable:!1}]})}.apply(t,n))||(e.exports=i)},1046:function(e,t,s){var n,i;n=[s(7),s(12),s(1047)],void 0===(i=function(e,t,s){return e.LayoutView.extend({template:s,regions:{rtr:".rtr"},ui:{origin:".origin",dest:".destination"},initialize:function(){this.listenTo(this.collection,"sync reset",this.update,this)},update:function(){this.ui.origin.text(this.collection.ORIGIN),this.ui.dest.text(this.collection.DESTINATION)},onRender:function(){console.log("dhl",this.collection),this.rtr.show(new t({collection:this.collection,columns:[{name:"DATE",label:"Date",cell:"string",editable:!1},{name:"STATE",label:"Status",cell:"string",editable:!1},{name:"LOCATION",label:"Location",cell:"string",editable:!1},{name:"SIGNATORY",label:"Signatory",cell:"string",editable:!1}],backgrid:{emptyText:"No tracking available"},pages:!1}))}})}.apply(t,n))||(e.exports=i)},1047:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="form">\n        <ul>\n            <li>\n                <span class="label">Origin</span>\n                <span class="origin">N/A</span>\n            </li>\n\n            <li>\n                <span class="label">Destination</span>\n                <span class="destination">N/A</span>\n            </li>\n\n        </ul>\n    </div>\n\n    <div class="rtr"></div>\n';return __p}},1048:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='    <h1>Shipment: <span class="SHIPPINGNAME">'+(null==(__t=SHIPPINGNAME)?"":_.escape(__t))+'</span></h1>\n\n    <p class="help">This page shows details and contents of the selected shipment. Most parameters can be edited by simply clicking on them.</p>\n    <p class="help excl">Shipments need to have an outgoing and return home lab contact before shipment labels can be printed</p>\n\n    ',DHL_ENABLE&&(__p+="\n        ","1"==DELIVERYAGENT_HAS_LABEL?__p+='\n            <p class="message notify">You can print your Airway Bill by clicking &quot;Print Airway Bill&quot; below</p>\n        ':__p+='\n            <p class="message notify">You can now book your shipment with DHL using &quot;Create Airway Bill&quot; below</p>\n        ',__p+="\n    "),__p+="\n\n    ",LCOUT&&LCRET&&(__p+='\n    <div class="ra">\n        ',"opened"!=SHIPPINGSTATUS&&"awb created"!=SHIPPINGSTATUS&&"pickup booked"!=SHIPPINGSTATUS||(__p+='\n            <a class="button send" href="#"><i class="fa fa-plane"></i> Mark as Sent</a>\n        '),__p+="\n\n        ",DHL_ENABLE&&(__p+="\n        ","1"==DELIVERYAGENT_HAS_LABEL?(__p+='\n            <a class="button pdf" href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/pdf/awb/sid/"+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'"><i class="fa fa-print"></i> Print Airway Bill</a>\n            \x3c!-- <a class="button cancel" href="#"><i class="fa fa-truck"></i> Cancel Pickup</a> --\x3e\n            ',DELIVERYAGENT_PICKUPCONFIRMATION||(__p+='\n                <a class="button awb" href="/shipments/pickup/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'"><i class="fa fa-truck"></i> Rebook Pickup</a>\n            '),__p+="\n        "):__p+='\n            <a class="button awb" href="/shipments/awb/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'"><i class="fa fa-credit-card"></i> Create Airway Bill</a>\n        ',__p+="\n        "),__p+='\n\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/pdf/sid/"+(null==(__t=SHIPPINGID)?"":_.escape(__t))+"/prop/"+(null==(__t=PROP)?"":_.escape(__t))+'" class="label button pdf" title="Print Shipment Labels"><i class="fa fa-print"></i> Print Shipment Labels</a>\n\n        <a href="'+(null==(__t=APIURL)?"":_.escape(__t))+"/pdf/container/sid/"+(null==(__t=SHIPPINGID)?"":_.escape(__t))+"/prop/"+(null==(__t=PROP)?"":_.escape(__t))+'" class="label button pdf" title="Print Shipment Contents"><i class="fa fa-print"></i> Print Contents</a>\n    </div>\n    '),__p+='\n\n    <div class="form">\n        <ul>\n\n            <li>\n                <span class="label">Created</span>\n                <span class="created">'+(null==(__t=CREATED)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Status</span>\n                <span class="stat">'+(null==(__t=SHIPPINGSTATUS)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Outgoing Lab Contact</span>\n                <span class="SENDINGLABCONTACTID">'+(null==(__t=LCOUT)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Return Lab Contact</span>\n                <span class="RETURNLABCONTACTID">'+(null==(__t=LCRET)?"":_.escape(__t))+'</span>\n            </li>\n            <li>\n                <span class="label">Safety Level</span>\n                <span class="SAFETYLEVEL">'+(null==(__t=SAFETYLEVEL)?"":_.escape(__t))+'</span>\n            </li>\n            <li>\n                <span class="label">Courier</span>\n                <span class="DELIVERYAGENT_AGENTNAME">'+(null==(__t=DELIVERYAGENT_AGENTNAME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Courier Account No.</span>\n                <span class="DELIVERYAGENT_AGENTCODE">'+(null==(__t=DELIVERYAGENT_AGENTCODE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipping Date</span>\n                <span class="DELIVERYAGENT_SHIPPINGDATE">'+(null==(__t=DELIVERYAGENT_SHIPPINGDATE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipping Airway Bill</span>\n                <span class="DELIVERYAGENT_FLIGHTCODE">'+(null==(__t=DELIVERYAGENT_FLIGHTCODE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipping Pickup Location</span>\n                <span class="PHYSICALLOCATION">'+(null==(__t=PHYSICALLOCATION)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipping Ready By</span>\n                <span class="READYBYTIME">'+(null==(__t=READYBYTIME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipping Close Time</span>\n                <span class="CLOSETIME">'+(null==(__t=CLOSETIME)?"":_.escape(__t))+"</span>\n            </li>\n\n            ",DELIVERYAGENT_PICKUPCONFIRMATION&&(__p+='\n            <li>\n                <span class="label">Shipping Pickup Confirmed</span>\n                Yes - Confirmation Number: <span class="DELIVERYAGENT_PICKUPCONFIRMATION">'+(null==(__t=DELIVERYAGENT_PICKUPCONFIRMATION)?"":_.escape(__t))+'</span>\n                <a href="#" class="button cancel_pickup"><i class="fa fa-times"></i> Cancel</a>\n            </li>\n            <li>\n                <span class="label">Shipping Confirmed Ready By</span>\n                <span class="DELIVERYAGENT_READYBYTIME">'+(null==(__t=DELIVERYAGENT_READYBYTIME)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipping Confirmed Call In</span>\n                <span class="DELIVERYAGENT_CALLINTIME">'+(null==(__t=DELIVERYAGENT_CALLINTIME)?"":_.escape(__t))+"</span>\n            </li>\n            "),__p+='\n\n            <li>\n                <span class="label">Estimated Delivery Date</span>\n                <span class="DELIVERYAGENT_DELIVERYDATE">'+(null==(__t=DELIVERYAGENT_DELIVERYDATE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li class="clearfix reorder">\n                <div class="COMMENTS text">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</div>\n                <span class="label">Comments</span>\n            </li>\n\n        </ul>\n        <div class="clear"></div>\n    </div>\n\n\n    <h1>Shipment Contents</h1>\n\n    <p class="help">Select a dewar by clicking on the row in the table below. Dewar details are then shown below. Click the + icon to add a container to the selected dewar</p>\n\n    <div class="ra"><a href="#" class="button" id="add_dewar" title="Add a dewar to this shipment"><i class="fa fa-plus"></i> Add Dewar</a></div>\n\n    <div class="table"></div>\n\n\n    <h1>\n        Dewar Details: <span class="dewar_name"></span>\n        <span class="r padded_button add_container"></span>\n    </h1>\n\n    <p class="help">This section shows contents and history for the selected dewar. Click the spyglass icon to view the contents of the container</p>\n\n    <div class="left dcontent"></div>\n\n\n    <div class="right history table table-no-margin"></div>\n    <div class="right tracking table table-no-margin"></div>\n\n    <div class="clear"></div>';return __p}},1049:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(26),s(121),s(37),s(60),s(268),s(27),s(255),s(1050),s(8),s(6),s(18)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d){var u=e.ItemView.extend({tagName:"span",template:n.template("<select name=FCODES[]></select>"),ui:{select:"select[name^=FCODES]"},onRender:function(){this.ui.select.html('<option value="!">Please select one</option>'+this.getOption("dewars").opts({empty:!0}))}}),m=e.CollectionView.extend({tagName:"span",className:"fcodes",childView:u,childViewOptions:function(){return{dewars:this.getOption("dewars")}}});return t.extend({template:p,templateHelpers:function(){return{DHL_ENABLE:app.options.get("dhl_enable"),DHL_LINK:app.options.get("dhl_link")}},events:{"change input[name=DEWARS]":"updateFCodes","change @ui.lcret":"getlcdetails","change select[name^=FCODES]":"checkFCodes","change @ui.name":"checkFCodes","click a.add_lc":"addLC","click @ui.noexp":"updateFirstExp","click @ui.dynamic":"updateDynamicSchedule"},ui:{lcret:"select[name=RETURNLABCONTACTID]",lcout:"select[name=SENDINGLABCONTACTID]",first:"select[name=FIRSTEXPERIMENTID]",name:"input[name=SHIPPINGNAME]",noexp:"input[name=noexp]",dynamic:"input[name=dynamic]",comments:"textarea[name=COMMENTS]"},addLC:function(e){return e.preventDefault(),app.dialog.show(new r({title:"Add Home Lab Contact",className:"content",view:new c({dialog:!0}),autoSize:!0})),this.listenTo(app.dialog.currentView,"close",this.refreshContacts,this),!1},createModel:function(){this.model=new s},success:function(e,t,s){console.log("success from shipadd"),app.trigger("shipment:show",e.get("SHIPPINGID"))},failure:function(e,t,s){console.log("failure from shipadd"),app.alert({message:"Something went wrong registering this shipment, please try again"})},updateFirstExp:function(){if(this.ui.noexp.is(":checked")){this.ui.first.html('<option value=""> - </option>'),this.ui.dynamic.prop("checked",!1);var e=this.getOption("comments").automated||"";this.ui.comments.val(e)}else this.ui.first.html(this.visits.opts()),this.ui.comments.val("")},updateDynamicSchedule:function(){if(this.ui.dynamic.is(":checked")){this.ui.first.html('<option value=""> - </option>'),this.ui.noexp.prop("checked",!1);var e=this.getOption("comments").dynamic||"";this.ui.comments.val(e)}else this.ui.first.html(this.visits.opts()),this.ui.comments.val("")},onRender:function(){this.dewars=new o(null,{state:{pageSize:9999}}),this.listenTo(this.dewars,"sync",this.updateFCodes),this.refreshDewars(),this.contacts=new l(null,{state:{pageSize:9999}}),this.listenTo(this.contacts,"sync",this.updateContacts),this.refreshContacts(),this.visits=new a(null,{queryParams:{next:1},state:{pageSize:9999}}),this.visits.fetch().done(this.updateFirstExp.bind(this)),this.date("input[name=DELIVERYAGENT_SHIPPINGDATE], input[name=DELIVERYAGENT_DELIVERYDATE]"),this.time("input[name=READYBYTIME], input[name=CLOSETIME]"),this.fcodes=new d.Collection,this.$el.find("li.d .floated").append(new m({collection:this.fcodes,dewars:this.dewars}).render().el),this.checkFCodes()},refreshDewars:function(){this.dewars.fetch()},refreshContacts:function(){this.contacts.fetch()},updateContacts:function(){this.ui.lcret.html(this.contacts.opts()),this.ui.lcout.html(this.contacts.opts()),this.getlcdetails()},getlcdetails:function(){var e=this.contacts.findWhere({LABCONTACTID:this.ui.lcret.val()});console.log(e),e&&(this.$el.find("input[name=DELIVERYAGENT_AGENTNAME]").val(e.get("DEFAULTCOURRIERCOMPANY")),this.$el.find("input[name=DELIVERYAGENT_AGENTCODE]").val(e.get("COURIERACCOUNT")))},updateFCodes:function(){var e=this.$el.find("input[name=DEWARS]").val();e>0?this.$el.find("li.d").show():this.$el.find("li.d").hide();var t=n.map(n.range(1,parseInt(e)+1),(function(e){return{id:e}}));this.fcodes.set(t)},checkFCodes:function(){var e=this.$el.find("select[name^=FCODES]").eq(0);!this.model.preValidate("FCODES[]",e.val())&&e.val()&&e.val().search("MX")>-1&&!this.model.preValidate("SHIPPINGNAME",this.ui.name.val())?this.$el.find('button[name="dls"]').fadeIn():this.$el.find('button[name="dls"]').hide()},prepareModel:function(){this.model.set({FCODES:this.$el.find("select[name^=FCODES]").map((function(e,t){if(i(t).val())return i(t).val()})).get()})}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1050:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="terms"></div>\n\n<h1>Add New Shipment</h1>\n\n<form method="post" id="add_shipment">\n    \n    <div class="form">\n        <ul>\n            \n            <li>\n                <label>Name\n                    <span class="small">Name for the shipment</span>\n                </label>\n                <input type="text" name="SHIPPINGNAME" />\n            </li>\n            \n            <li>\n                <label>Number of Dewars\n                    <span class="small">Number of dewars to automatically create for this shipment</span>\n                </label>\n                <input type="text" name="DEWARS" value="1" />\n            </li>\n            \n            <li class="d clearfix">\n                <label>Facility Dewar Codes\n                    <span class="small">Unique code for each dewar of the shipment.<br />No facility codes listed? Make sure they are <a href="/dewars/registry">Registered</a> to this proposal.</span>\n                </label>\n                <div class="floated">\n                    \x3c!--<span class="fcodes"></span>--\x3e\n                </div>\n            </li>\n            \n            <li>\n                <label>First Experiment / Scheduling\n                    <span class="small">Select first experiment or if it\'s for an automated or responsive remote mail-in session</span>\n                </label>\n                <select name="FIRSTEXPERIMENTID"></select> <label class="secondary"><input type="checkbox" name="noexp"> Automated / Imager</label><label class="secondary"><input type="checkbox" name="dynamic"> Responsive Remote / Mail-in</label>\n            </li>\n\n            <li>\n                <label>Safety Level\n                    <span class="small">The safety level of the shipment</span>\n                </label>\n                <select name="SAFETYLEVEL" required>\n                    <option value="Green">Green</option>\n                    <option value="Yellow">Yellow</option>\n                    <option value="Red">Red</option>\n                </select>\n            </li>\n            \n            <li>\n                <label>Comments\n                    <span class="small">Comment for the shipment</span>\n                </label>\n                <textarea name="COMMENTS" maxlength="1000"></textarea>\n            </li>\n            \n            <li>\n                <label>Outgoing Lab Contact\n                    <span class="small">Lab contact for outgoing transport | <a class="add_lc" href="/contact/add">Add</a></span>\n                </label>\n                <select name="SENDINGLABCONTACTID"></select>\n            </li>\n            \n            <li>\n                <label>Return Lab Contact\n                    <span class="small">Lab contact for return transport | <a class="add_lc" href="/contact/add">Add</a></span>\n                </label>\n                <select name="RETURNLABCONTACTID"></select>\n            </li>\n            \n            <li>\n                <label>Shipping Date\n                    <span class="small">Date shipment will leave lab / be picked up</span>\n                </label>\n                <input class="half" type="text" name="DELIVERYAGENT_SHIPPINGDATE" />\n            </li>\n\n            <li>\n                <label>Pickup Location\n                    <span class="small">Location where shipment can be picked up from. i.e. Reception</span>\n                </label>\n                <input class="half" type="text" name="PHYSICALLOCATION" />\n            </li>\n\n            <li>\n                <label>Ready by Time\n                    <span class="small">Time shipment will be ready for pickup</span>\n                </label>\n                <input class="half" type="text" name="READYBYTIME" />\n            </li>\n\n            <li>\n                <label>Close Time\n                    <span class="small">Time after which shipment cannot be picked up</span>\n                </label>\n                <input class="half" type="text" name="CLOSETIME" />\n            </li>\n            \n            \n            <li>\n                <label>Delivery Date\n                    <span class="small">Estimated date of delivery at facility</span>\n                </label>\n                <input class="half" type="text" name="DELIVERYAGENT_DELIVERYDATE" />\n            </li>\n            \n            <li>\n                <label>Courier Name\n                    <span class="small">Courier name for the return shipment</span>\n                </label>\n                <input type="text" name="DELIVERYAGENT_AGENTNAME" /> \n                ',DHL_ENABLE||(__p+='<a href="'+(null==(__t=DHL_LINK)?"":_.escape(__t))+'" class="dhl button"><i class="fa fa-envelope"></i> Use Facility Account (UK ONLY)</a>'),__p+='\n            </li>\n            \n            <li>\n                <label>Courier Account Number\n                    <span class="small">Courier account number for return shipment</span>\n                </label>\n                <input type="text" name="DELIVERYAGENT_AGENTCODE" />\n            </li>\n            \n            <button name="submit" value="1" type="submit" class="button submit">Add Shipment</button>\n            \n            \n        </ul>\n    </div>\n    \n</form>\n\n';return __p}},1051:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(6),s(16),s(71),s(57),s(40),s(131),s(261),s(95),s(96),s(262),s(173),s(240),s(239),s(437),s(241),s(1055),s(1058),s(1059),s(265),s(170),s(267),s(269),s(41),s(108),s(371),s(27),s(1061),s(1062),s(20),s(12),s(15),s(29),s(11),s(1063),s(1064),s(376),s(1065)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d,u,m,_,f,g,E,b,v,I,A,T,C,N,w,S,R,O,D,y,P,x,L,M,k,Y){var U=s.Cell.extend({events:{"click a.delete":"delete","click a.fish":"fish","click a.measure":"measure","click a.details":"details"},initialize:function(e){this.listenTo(this.model,"change:EXPERIMENTKIND",this.render,this),U.__super__.initialize.call(this,e)},delete:function(e){e.preventDefault();var t=this;M.confirm({title:"Delete Subsample",content:"Are you sure you want to delete this subsample?",callback:function(){t.model.destroy({error:M.jsonError})}})},fish:function(e){e.preventDefault(),app.dialog.show(new R({title:"Add Subsample to Container",className:"content",view:new v({dialog:!0,model:this.model}),autoSize:!0}))},measure:function(e){e.preventDefault()},render:function(){this.$el.empty();this.model.get("EXPERIMENTKIND");var e=this.model.get("SAMPLES")>0?"active":"",t=!1;n.each(["GR","SC","DC"],(function(e){this.model.get(e)>0&&(t=!0)}),this);var s=t?"":'<a href="#" class="button button-notext delete"><i class="fa fa-times"></i> <span>Delete</span></a>';return this.$el.html('\x3c!--<a href="#" class="button button-notext measure" title="Measure"><i class="fa fa-arrows-h"></i> <span>Measure</span></a>--\x3e             <a href="#" class="button button-notext fish '+e+'" title="Fish into puck"><i class="fa fa-crosshairs"></i> <span>Fish</span></a>             '+s),this.delegateEvents(),this}}),q=s.Cell.extend({events:{"click a.data":"showData","click a.reproc":"reprocess"},initialize:function(e){q.__super__.initialize.call(this,e),this.dcs=new N(null,{running:!1}),this.listenTo(this.column.get("dcs"),"sync",this.syncDcs),this.syncDcs()},syncDcs:function(){var e=this.column.get("dcs").where({BLSUBSAMPLEID:this.model.get("BLSUBSAMPLEID")});this.dcs.reset(e)},showData:function(e){e.preventDefault();var t=w.DCView.get(app.type,{collection:this.dcs,params:{visit:null},noPageUrl:!0,noFilterUrl:!0,noSearchUrl:!0});app.dialog.show(new R({title:"Data Collections",view:t,autoSize:1}))},reprocess:function(e){e.preventDefault(),console.log("dcs",this.dcs),app.dialog.currentView instanceof S?app.dialog.currentView.collection.add(this.dcs.at(0)):(app.dialog.show(new S({model:this.dcs.at(0),visit:this.column.get("visit")})),this.dcs.length>1&&app.dialog.currentView.collection.add(this.dcs.at(1)))},render:function(){return this.$el.html('<a href="#" class="button button-notext data" title="View Data"><i class="fa fa-database"></i> <span>Show Data</span></a> <a href="#" class="button button-notext reproc" title="Reprocess"><i class="fa fa-cog""></i> <span>Reprocess</span></a>'),this}}),B=s.Row.extend({events:{click:"onClick"},initialize:function(e){this.listenTo(this.model,"change:isSelected",this.setSelected,this),B.__super__.initialize.call(this,e)},onClick:function(e){i(e.target).is("i")||i(e.target).is("a")||(console.log("click row"),this.model.set({isSelected:!0}),console.log("model",this.model))},setSelected:function(){console.log("addclass"),this.model.get("isSelected")?this.$el.addClass("selected"):this.$el.removeClass("selected")}});return e.LayoutView.extend({className:"content",getTemplate:function(e){return this.model.get("INSPECTIONS")>0?Y:k},regions:{table:".table",plate:".plate",sample:".singlesamp",img:".img",subs:".subs",sten:".startend",grp:".group",hist:".history"},ui:{ins:"select[name=inspection]",add:".add_image",ads:"a.add_point",adr:"a.add_region",drop:".dropimage",prog:".progress",play:"a.play_inspection",gap:"input[name=gap]",ity:"select[name=INSPECTIONTYPEID]",status:"div.sta",ret:"div.return",adh:"span.adhoc",que:"div.queue",ss:"input[name=sample_status]",param:"select[name=param]",rank:"input[name=rank]",auto:"input[name=auto]",schema:"select[name=schema]",class:"select[name=class]"},events:{"change @ui.ins":"selectInspection","click @ui.ads":"setAddSubsamplePoint","click @ui.adr":"setAddSubsampleRegion","click a.add_inspection":"showAddInspection","click a.view_sched":"showViewSchedule","click @ui.play":"playInspection","dragover @ui.drop":"dragHover","dragleave @ui.drop":"dragHover","drop @ui.drop":"uploadFile","click a.adhoc":"requestAdhoc","click a.return":"requestReturn","change @ui.ss":"toggleSampleStatus","click @ui.rank":"setRankStatus","change @ui.param":"setRankStatus","click @ui.auto":"setAutoStatus","change @ui.class":"setAutoStatus","change @ui.schema":"selectSchema"},modelEvents:{"change:QUEUED":"updatedQueued"},toggleSampleStatus:function(e){this.ui.auto.prop("checked",!1),this.plateView.setAutoStatus(!1),this.plateView.setShowSampleStatus(this.ui.ss.is(":checked"))},setRankStatus:function(e){var t=this.ui.param.find("option:selected"),s=this.ui.rank.is(":checked")?{value:t.attr("value"),min:t.data("min"),check:t.data("check"),inverted:t.data("inverted")}:null;this.plateView.setRankStatus(s),this.image.setRankStatus(s),this.ui.rank.is(":checked")&&(this.ui.ss.is(":checked")||(this.ui.ss.prop("checked",!0),this.toggleSampleStatus()))},setAutoStatus:function(e){this.ui.ss.prop("checked",!1),this.ui.rank.prop("checked",!1),this.plateView.setShowSampleStatus(!1);var t=this.ui.auto.is(":checked");console.log("setAutoStatus",t,this.ui.class.val(),t&&this.ui.class.val()),this.plateView.setAutoStatus(t&&this.ui.class.val())},updateAdhoc:function(){"1"==this.model.get("ALLOW_ADHOC")?(this.ui.ity.show(),this.ui.adh.html('<a href="#" class="button adhoc"><i class="fa fa-picture-o"></i> <span>Request Plate Imaging</span></a>')):(this.ui.adh.html("<p>An adhoc inspection of this container has been requested</p>"),this.ui.ity.hide()),this.updateTypes()},updatedQueued:function(){this.model.get("CONTAINERQUEUEID")?this.ui.que.html("<p>This container was queued for data collection at "+this.model.get("QUEUEDTIMESTAMP")+' <a href="/containers/queue/'+this.model.get("CONTAINERID")+'" class="button prepare"><i class="fa fa-list"></i> <span>View Sample Queue</span></a></p>'):this.ui.que.html('<a href="/containers/queue/'+this.model.get("CONTAINERID")+'" class="button prepare"><i class="fa-3x fa fa-list"></i> <span class="large">Prepare for Data Collection</span></a>')},requestReturn:function(e){e.preventDefault();var t=this;this.model.set({REQUESTEDRETURN:"1"}),this.model.save(this.model.changedAttributes(),{patch:!0,success:function(){app.alert({message:"Return of this container to the user has been successfully requested"}),t.updateReturn()}})},updateReturn:function(){"1"==this.model.get("REQUESTEDRETURN")?this.ui.ret.html("<p>This plate has been requested for return to the user</p>"):this.ui.ret.html('<a href="#" class="button return"><i class="fa fa-paper-plane-o"></i> <span>Request Return</span></a>')},dragHover:function(e){e.stopPropagation(),e.preventDefault(),"dragover"==e.type?this.ui.drop.addClass("active"):this.ui.drop.removeClass("active")},uploadFile:function(e){this.dragHover(e);var t=e.originalEvent.dataTransfer.files[0];if(["image/jpeg","image/png"].indexOf(t.type)>-1){var s=new m({CONTAINERINSPECTIONID:this.ui.ins.val(),BLSAMPLEID:this.getSample(),IMAGE:t});this.listenTo(s,"model:progress",this.updateProgress,this);var n=this;this.ui.prog.show(),s.save({},{success:function(){n.inspectionimages.add(s),n.ui.prog.hide(),n.ui.add.removeClass("enable"),n.image.setModel(s),n.historyimages.fetch()},error:function(){app.alert({message:"Something went wrong uploading this image"})}})}else app.alert({message:"You can only upload jpeg or png files"});console.log(t.type,t.name,t.size)},updateProgress:function(e){console.log("prog",e),this.ui.prog.progressbar({value:e})},showAddInspection:function(e){e.preventDefault(),this.addInspection=new E({dialog:!0,CONTAINERID:this.model.get("CONTAINERID")}),this.listenTo(this.addInspection,"inspection:created",this.appendInspection,this),app.dialog.show(new R({title:"Add Manual Container Inspection",className:"content",view:this.addInspection,autoSize:!0}))},appendInspection:function(e){var t=this.addInspection.getModel();this.inspections.add(t),this.ui.ins.html(this.inspections.opts()),this.model.set("INSPECTIONS",this.model.get("INSPECTIONS")+1),1==this.model.get("INSPECTIONS")?(this.render(),this.doOnShow()):this.ui.ins.val(t.get("CONTAINERINSPECTIONID")).trigger("change")},showViewSchedule:function(e){e.preventDefault(),app.dialog.show(new R({title:"View Inspection Schedule",className:"content",view:new b({dialog:!0,CONTAINERID:this.model.get("CONTAINERID")}),autoSize:!0}))},requestAdhoc:function(e){e.preventDefault();var s=this;t.ajax({url:app.apiurl+"/imaging/inspection/adhoc",data:{cid:this.model.get("CONTAINERID"),INSPECTIONTYPEID:this.ui.ity.val()},success:function(e){app.alert({message:"Adhoc inspection successfully requested for this container"}),s.updateAdhoc()},error:function(e){app.alert({message:"Something went wrong request an adhoc inspection for this container"})}})},setAddSubsamplePoint:function(e){e.preventDefault(),this.ui.ads.hasClass("button-highlight")?(this.ui.ads.removeClass("button-highlight"),this.image.setAddSubsample(!1),this.ui.ads.find("span").text("Mark Point")):(this.ui.ads.addClass("button-highlight"),this.image.setAddSubsample(!0),this.ui.ads.find("span").text("Finish")),this.ui.adr.removeClass("button-highlight"),this.image.setAddSubsampleRegion(!1),this.ui.adr.find("span").text("Mark Region")},setAddSubsampleRegion:function(e){e.preventDefault(),this.ui.adr.hasClass("button-highlight")?(this.ui.adr.removeClass("button-highlight"),this.image.setAddSubsampleRegion(!1),this.ui.adr.find("span").text("Mark Region")):(this.ui.adr.addClass("button-highlight"),this.image.setAddSubsampleRegion(!0),this.ui.adr.find("span").text("Finish")),this.ui.ads.removeClass("button-highlight"),this.image.setAddSubsample(!1),this.ui.ads.find("span").text("Mark Point")},selectSchema:function(){this.autoscores.fetch().done(this.updateClasses.bind(this))},selectInspection:function(){this.inspectionimages.fetch().done(this.inspectionLoaded.bind(this)),this.autoscoreschemas.fetch().done(this.updateSchemas.bind(this))},inspectionLoaded:function(){this.selectSample(),this.preCache(1)},preCache:function(e){clearTimeout(this.cachethread);var t=this,s=this.inspectionimages.at(e);if(this.caching&&s){var n=new L;console.log("caching",s.urlFor("hd")),n.load(s.urlFor("full"),(function(){t.plateView.drawPlate(),e+1==t.inspectionimages.length?t.ui.status.html(""):t.ui.status.html("Loaded "+(e+1)+" out of "+t.inspectionimages.length+" images"),t.cachethread=setTimeout((function(){t.preCache(++e)}),200)}))}},playInspection:function(e){e.preventDefault(),this.isPlaying=!this.isPlaying,this.isPlaying?this.ui.play.find("i").removeClass("fa-play").addClass("fa-stop"):this.ui.play.find("i").addClass("fa-play").removeClass("fa-stop"),this.isPlaying&&this.doPlayInspection()},doPlayInspection:function(){var e=this;clearTimeout(this.playthread),this.isPlaying&&(this.playthread=setTimeout((function(){var t=e.getNext();t&&t.set("isSelected",!0),console.log(t),e.doPlayInspection()}),1e3*this.ui.gap.val()))},getNext:function(e){var t=e&&e.s?e.s:this.samples.findWhere({isSelected:!0}),s=this.samples.indexOf(t);if(e&&e.first)var n=this.samples.first();else if(e&&e.last)n=this.samples.last();else n=this.samples.at(s+(e&&e.prev?-1:1));return n||(n=e&&e.prev?this.samples.last():this.samples.at(0)),this.inspectionimages.findWhere({BLSAMPLEID:n.get("BLSAMPLEID")})?n:this.getNext({s:n,prev:e&&e.prev})},initialize:function(e){this.isPlaying=!1,this.cachethread=null,this.playthread=null,this.caching=!app.mobile();this.samples=new o(null,{state:{pageSize:9999}}),this.samples.queryParams.cid=e.model.get("CONTAINERID"),this.listenTo(this.samples,"selected:change",this.selectSample),this.sampledcs=new N(null,{running:!1}),this.sampledcs.state.pageSize=9999,this.sampledcs.queryParams.sid=this.getSample.bind(this),this.subsamples=new r,this.subsamples.queryParams.sid=this.getSample.bind(this),this.listenTo(this.subsamples,"change:COMMENTS",this.saveComment,this),this._ready=[],this._ready.push(this.samples.fetch({data:{sort_by:"POSITION"}})),this.proteins=new a,this.proteins.fetch(),this.ctypes=new p,this.gproteins=new a,this.inspections=new u,this.inspections.queryParams.cid=this.model.get("CONTAINERID"),this.inspections.queryParams.delta=1,this.inspections.setSorting("BLTIMESTAMP",1),this._ready.push(this.inspections.fetch()),this.screencomponentgroups=new I(null,{state:{pageSize:9999}}),this.screencomponentgroups.queryParams.scid=this.model.get("SCREENID"),this.screencomponents=new A(null,{state:{pageSize:9999}}),this.screencomponents.queryParams.scid=this.model.get("SCREENID"),this.model.get("SCREENID")&&(this.screencomponents.fetch(),this.screencomponentgroups.fetch()),this.inspectiontypes=new C,this.inspectiontypes.fetch(),this.history=new c,this.history.queryParams.cid=this.model.get("CONTAINERID"),this.history.fetch(),t.Validation.bind(this)},updateSchemas:function(){this.ui.schema.html(this.autoscoreschemas.opts()),this.selectSchema()},updateClasses:function(){var e=this.autoscores.at(0),t="";n.each(e.get("CLASSES"),(function(e,s){t+='<option value="'+s+'">'+s+"</option>"}),this),this.ui.class.html(t)},updateTypes:function(e){this.ui.ity.html(this.inspectiontypes.opts())},saveComment:function(e,t){console.log("model changed",arguments),e.save(e.changedAttributes(),{patch:!0})},prevImage:function(e){this.getNext({prev:!0}).set({isSelected:!0})},nextImage:function(e){this.getNext().set({isSelected:!0})},firstImage:function(e){this.getNext({first:!0}).set({isSelected:!0})},lastImage:function(e){this.getNext({last:!0}).set({isSelected:!0})},getInspection:function(){return this.ui.ins.val()},getSchema:function(){return this.ui.schema.val()},getSample:function(){var e=this.samples.findWhere({isSelected:!0});if(e)return e.get("BLSAMPLEID")},selectSample:function(){var e=this.samples.findWhere({isSelected:!0});if(e){if(this.singlesample.setModel(e),this.model.get("SCREENID")){var t=this.screencomponentgroups.findWhere({SCREENCOMPONENTGROUPID:e.get("SCREENCOMPONENTGROUPID")});t?this.groupview.setModel(t):this.groupview.setModel(null)}if(0==this.model.get("INSPECTIONS"))return;if(!e.get("BLSAMPLEID"))return this.ui.add.removeClass("enable"),void(this.model.get("INSPECTIONS")>0&&(this.historyimages.reset([]),this.startendimages.reset([]),this.image.setEmpty()));this.sampledcs.fetch(),this.subsamples.fetch(),this.historyimages.fetch();var s=this.inspectionimages.findWhere({BLSAMPLEID:e.get("BLSAMPLEID")});if(s){var n=this.autoscores.findWhere({BLSAMPLEIMAGEID:s.get("BLSAMPLEIMAGEID")});console.log("select image",s.get("BLSAMPLEIMAGEID"),n&&n.get("CLASSES")),this.image.setModel(s),this.ui.add.removeClass("enable")}else{this.historyimages.reset([]),this.startendimages.reset([]),this.image.setEmpty();var i=this.inspections.findWhere({CONTAINERINSPECTIONID:this.ui.ins.val()});i&&(i.get("MANUAL")&&!app.mobile()?this.ui.add.addClass("enable"):this.ui.add.removeClass("enable"))}}},updateStartEnd:function(){var e=[];this.historyimages.length&&(e.push(this.historyimages.first()),e.push(this.historyimages.last())),this.startendimages.reset(e)},onRender:function(){var e=new y({model:this.model,el:this.$el});if(e.create("NAME","text"),e.create("COMMENTS","textarea"),app.user_can("disp_cont")&&e.create("BARCODE","text"),app.user_can("disp_cont")&&e.create("CONTAINERTYPE","select",{data:this.ctypes.kv()}),this.model.get("INSPECTIONS")>0){var t=[{label:"#",cell:x.TemplateCell,editable:!1,template:"<%-(RID+1)%>"},{label:"Type",cell:x.TemplateCell,editable:!1,template:'<%-(X2 ? "Region" : "Point")%>'},{name:"X",label:"X",cell:"string",editable:!1},{name:"Y",label:"Y",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!0},{label:"",cell:x.StatusCell,editable:!1},{name:"DCRESOLUTION",label:"Res",cell:"string",editable:!1},{label:"",cell:q,editable:!1,dcs:this.sampledcs,visit:this.model.get("VISIT")},{label:"",cell:x.TemplateCell,editable:!1,template:'<a href="/samples/sid/<%-BLSAMPLEID%>" class="button"><i class="fa fa-search"></i></a>'}];this.model.get("CONTAINERQUEUEID")||t.push({label:"",cell:U,editable:!1}),this.subtable=new P({collection:this.subsamples,columns:t,tableClass:"subsamples",loading:!1,pages:!1,backgrid:{row:B,emptyText:"No subsamples found"}}),this.subs.show(this.subtable)}t=[{name:"BLTIMESTAMP",label:"Date",cell:"string",editable:!1},{name:"STATUS",label:"Status",cell:"string",editable:!1},{name:"LOCATION",label:"Location",cell:"string",editable:!1},{name:"BEAMLINENAME",label:"Beamline",cell:"string",editable:!1}];this.histtable=new P({collection:this.history,columns:t,tableClass:"hist",loading:!0,pages:!0,backgrid:{emptyText:"No history found"}}),this.hist.show(this.histtable),this.updateReturn(),this.updatedQueued(),this.listenTo(this.inspectiontypes,"sync",this.updateAdhoc),this.updateAdhoc()},resetZoom:function(){this.image&&this.image.resetZoom(100)},onShow:function(){i.when.apply(i,this._ready).then(this.doOnShow.bind(this))},doOnShow:function(){this.ui.ins.html(this.inspections.opts()),this.type=this.ctypes.findWhere({name:this.model.get("CONTAINERTYPE")}),this.plateView=new h({collection:this.samples,type:this.type,showImageStatus:this.model.get("INSPECTIONS")>0}),this.listenTo(this.plateView,"plate:select",this.resetZoom,this),this.plate.show(this.plateView),this.singlesample=new d({proteins:this.proteins,existingContainer:!0,gproteins:this.gproteins});var e=n.map(n.range(1,parseInt(this.model.get("CAPACITY"))+1),(function(e){return e.toString()})),t=n.difference(e,this.samples.pluck("LOCATION"));if(n.each(t,(function(e){var t=this.type.getWell(e),s=this.screencomponentgroups.findWhere({POSITION:(t+1).toString()});this.samples.add(new l({LOCATION:e.toString(),PROTEINID:-1,CONTAINERID:this.model.get("CONTAINERID"),SCREENCOMPONENTGROUPID:s?s.get("SCREENCOMPONENTGROUPID"):null,new:!0}))}),this),this.model.get("SCREENID")&&(this.groupview=new T({components:this.screencomponents,editable:!1}),this.grp.show(this.groupview)),this.model.get("INSPECTIONS")>0&&(this.inspectionimages=new _,this.inspectionimages.queryParams.iid=this.getInspection.bind(this),this.autoscoreschemas=new O,this.autoscoreschemas.queryParams.CONTAINERINSPECTIONID=this.getInspection.bind(this),this.autoscores=new D,this.autoscores.queryParams.CONTAINERINSPECTIONID=this.getInspection.bind(this),this.autoscores.queryParams.BLSAMPLEIMAGEAUTOSCORESCHEMAID=this.getSchema.bind(this),this.plateView.setInspectionImages(this.inspectionimages),this.plateView.setAutoScores(this.autoscores),this.historyimages=new _,this.historyimages.queryParams.sid=this.getSample.bind(this),this.listenTo(this.historyimages,"sync",this.updateStartEnd,this),this.startendimages=new _,this.image=new f({subsamples:this.subsamples,inspectionimages:this.inspectionimages,historyimages:this.historyimages,move:!this.model.get("CONTAINERQUEUEID")}),this.listenTo(this.image,"space",this.playInspection,this),this.listenTo(this.image,"image:next",this.nextImage,this),this.listenTo(this.image,"image:prev",this.prevImage,this),this.listenTo(this.image,"image:first",this.firstImage,this),this.listenTo(this.image,"image:last",this.lastImage,this),this.getOption("params").iid&&this.ui.ins.val(this.getOption("params").iid),this.selectInspection(),this.ui.prog.hide(),this.ui.prog.progressbar({value:0}),this.img.show(this.image),this.sten.show(new g({historyimages:this.startendimages,embed:!0})),app.mobile())){var s=this;console.log("enable swipe"),this.img.$el.find("canvas").swipe({swipe:function(e,t,n,i,a,l){e.preventDefault();var o=null;console.log("swipe",t),"left"==t&&(o=s.getNext()),"right"==t&&(o=s.getNext({prev:!0})),o&&o.set({isSelected:!0})},threshold:0})}if(this.getOption("params").sid){var i=this.samples.findWhere({BLSAMPLEID:this.getOption("params").sid});i&&i.set({isSelected:!0})}else this.samples.at(0).set({isSelected:!0});this.sample.show(this.singlesample)},onDestroy:function(){clearTimeout(this.cachethread),this.caching=!1}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1052:function(e,t,s){(function(n){var i,a;i=[s(10),s(1053),s(14)],void 0===(a=function(e,t,s){return e.extend(n.extend({},s,{model:t,mode:"client",url:"/imaging/inspection/images/scores",keyAttribute:"TITLE",valueAttribute:"BLSAMPLEIMAGESCOREID",state:{pageSize:9999},initialize:function(e){this.on("change:isSelected",this.onSelectedChanged,this),this.trig=!0},onSelectedChanged:function(e){this.each((function(e){!0!==e.get("isSelected")||e._changing||e.set({isSelected:!1})})),this.trig&&this.trigger("selected:change")},setSelected:function(e){if(this.trig=!1,sc=this.findWhere({imagescoreid:e}),sc)sc.set("isSelected",!0);else{var t=this.findWhere({isSelected:!0});t&&t.set("isSelected",!1)}this.trig=!0}}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1053:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"BLSAMPLEIMAGESCOREID",urlRoot:"/imaging/inspection/images/scores"})}.apply(t,n))||(e.exports=i)},1054:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="score">\n    <span class="scoresel">\n        <abbr title="Hotkey: 0-9 to score image">Score</abbr>: <select name="score"></select>\n    </span>\n    <span class="scoreval"></span>\n</div>\n\n<div class="COMMENTS" title="Image Comment, Hotkey: c"></div>\n\n<div class="controls">\n    <abbr title="Hotkey: Z zooms in, z zooms out">Z<abbr>oom: <span id="zval">0</span>% <div id="zoom"></div>\n</div>\n\n<div class="objects">\n\t<span class="progress"></span>\n    <select name="pia"></select>\n    <a href="#" class="button button-notext history" title="View Drop History, Hotkey: h"><i class="fa fa-history"></i> <span>Drop History</span></a>\n    <a href="#"  class="button button-notext move" title="Move, Hotkey: o"><i class="fa fa-arrows"></i> <span>Move</span></a>\n    <a href="#"  class="button button-notext measure" title="Measure, Hotkey: m"><i class="fa fa-expand"></i> <span>Measure</span></a>\n    <a href="#" class="button button-notext help" title="View Help"><i class="fa fa-question"></i> <span>Help</span></a>\n    \x3c!-- <a href="#" class="button button-notext add_object" title="Add Object, Hotkey: o"><i class="fa fa-plus"></i> <span>Add Object</span></a> --\x3e\n    \x3c!-- <a href="#"  class="button button-notext rem_object" title="Remove Object, Hotkey: r"><i class="fa fa-times"></i> <span>Remove Object</span></a> --\x3e\n\n</div>\n\n<div class="help_pane">\n    Hotkeys\n    <ul class="keys">\n        <li><span class="hkey">h</span> Toggle history</li>\n        <li><span class="hkey">m</span> Toggle measure</li>\n        <li><span class="hkey">o</span> Toggle move</li>\n        <li><span class="hkey">a</span> Previous image</li>\n        <li><span class="hkey">d</span> Next image</li>\n        <li><span class="hkey">q</span> Goto first image</li>\n        <li><span class="hkey">e</span> Goto last image</li>\n        <li><span class="hkey">s</span> Toggle Movie Mode</li>\n        <li><span class="hkey">z</span> Zoom out</li>\n        <li><span class="hkey">x</span> Zoom to 100%</li>\n        <li><span class="hkey">c</span> Zoom In</li>\n        <li><span class="hkey">v</span> Zoom to fit</li>\n        <li><span class="hkey">0-9</span> Score Image</li>\n        <li><span class="hkey">?</span> Toggle help</li>\n    </ul>\n</div>\n\n\n<div class="hist"></div>\n<canvas class="full"></canvas>\n<div class="scorebybutton filter filter-nohide"></div>\n';return __p}},1055:function(e,t,s){var n,i;n=[s(26),s(436),s(269),s(1057),s(8),s(6),s(18)],void 0===(i=function(e,t,s,n,i,a){return e.extend({template:n,ui:{dt:"input[name=BLTIMESTAMP]",type:"select[name=INSPECTIONTYPEID]"},initialize:function(e){this.inspectiontypes=new s,this.inspectiontypes.fetch().done(this.populateTypes.bind(this)),this.containerid=e.CONTAINERID},populateTypes:function(){this.ui.type.html(this.inspectiontypes.opts())},createModel:function(){this.model=new t({CONTAINERID:this.containerid,MANUAL:1})},success:function(e,t,s){console.log("success from inspection add"),this.getOption("dialog")?(app.alert({message:"New Container Inspection Created"}),app.dialog.currentView&&app.dialog.currentView.closeDialog(),this.trigger("inspection:created")):app.trigger("inspection:show",e.get("CONTAINERINSPECTIONID"))},getModel:function(){return this.model},failure:function(e,t,s){console.log("failure from inspection add"),app.alert({message:"Something went wrong registering container inspection, please try again"})},onRender:function(){this.ui.dt.datetimepicker({dateFormat:"dd-mm-yy"})}})}.apply(t,n))||(e.exports=i)},1057:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <h1>Add New Container Inspection</h1>\n\n    <form method="post">\n\n    <div class="form">\n        <ul>\n\n\n            <li>\n                <label>Inpsection Type\n                    <span class="small">Type of container inspection</span>\n                </label>\n                <select name="INSPECTIONTYPEID"></select>\n            </li>\n\n            <li>\n                <label>Temperature\n                    <span class="small">Temperature of the container</span>\n                </label>\n                <input type="text" name="TEMPERATURE" />\n            </li>\n\n\n            <li>\n                <label>Time / Date\n                    <span class="small">Time / Date the inspection was conducted</span>\n                </label>\n                <input type="text" name="BLTIMESTAMP" />\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Add Container Inspection</button>\n\n\n        </ul>\n    </div>\n\n    </form>\n\n';return __p}},1058:function(e,t,s){var n,i;n=[s(7),s(12),s(15),s(173)],void 0===(i=function(e,t,s,n){return e.LayoutView.extend({className:"content",template:'<div><h1>Inspection Schedule</h1><p class="help">This page lists all container inspections both completed and scheduled for the selected container</p><div class="wrapper"></div></div>',regions:{wrap:".wrapper"},initialize:function(e){this.inspections=new n,this.inspections.queryParams.cid=e.CONTAINERID,this.inspections.queryParams.allStates=1,this.inspections.fetch();var i=[{name:"OFFSET_HOURS",label:"Expected (hr)",cell:"string",editable:!1},{name:"SCHEDULEDTIMESTAMP",label:"Scheduled",cell:"string",editable:!1},{name:"STATE",label:"Status",cell:"string",editable:!1},{name:"PRIORITY",label:"Priority",cell:"string",editable:!1},{name:"BLTIMESTAMP",label:"Processed",cell:"string",editable:!1},{name:"DELTA",label:"Delta (d)",cell:"string",editable:!1},{name:"INSPECTIONTYPE",label:"Type",cell:"string",editable:!1},{label:"Adhoc",cell:s.TemplateCell,template:"<%-SCHEDULECOMPONENTID ? 'No' : 'Yes' %>",editable:!1},{label:"Manual",cell:s.TemplateCell,template:"<%-MANUAL == 1 ? 'Yes' : 'No' %>",editable:!1}];this.table=new t({collection:this.inspections,columns:i,tableClass:"inspections",pages:!1,loading:!0,backgrid:{emptyText:"No inspections found"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(t,n))||(e.exports=i)},1059:function(e,t,s){(function(n){var i,a;i=[s(7),s(257),s(81),s(48),s(80),s(57),s(40),s(262),s(71),s(1060)],void 0===(a=function(e,t,s,i,a,l,o,r,c,p){return e.LayoutView.extend({template:p,className:"content",regions:{pk:".puck",ss:".singlesample"},ui:{dewar:"select[name=dewar]",shipment:"select[name=shipment]",container:"select[name=container]"},events:{"change @ui.shipment":"refreshDewars","change @ui.dewar":"refreshContainers","change @ui.container":"refreshSamples"},updateShipments:function(){this.ui.shipment.html(this.shipments.opts()),this.refreshDewars()},refreshDewars:function(e){this.dewars.fetch()},updateDewars:function(){this.ui.dewar.html(this.dewars.opts()),this.refreshContainers()},refreshContainers:function(e){this.containers.fetch()},updateContainers:function(){this.ui.container.html(this.containers.opts()),this.refreshSamples()},refreshSamples:function(e){this.samples.fetch({data:{sort_by:"POSITION"}})},getShipment:function(){return this.ui.shipment.val()},getDewar:function(){return this.ui.dewar.val()},getContainer:function(){return this.ui.container.val()},generateSamples:function(){var e=this.containers.findWhere({CONTAINERID:this.ui.container.val()}),t=n.map(n.range(1,parseInt(e.get("CAPACITY"))+1),(function(e){return e.toString()})),s=n.difference(t,this.samples.pluck("LOCATION"));n.each(s,(function(e){this.samples.add(new l({LOCATION:e.toString(),new:!0}))}),this);var i=this.samples.findWhere({new:!0});i&&(i.set({isSelected:!0}),this.puck.sampleSelected(i.get("LOCATION")-1)),this.setSample()},setSample:function(){var e=this.samples.findWhere({isSelected:!0});e.set({PROTEINID:this.model.get("PROTEINID"),BLSUBSAMPLEID:this.model.get("BLSUBSAMPLEID"),CONTAINERID:this.ui.container.val(),COMMENTS:this.model.get("COMMENTS")}),e&&this.single.setModel(e)},initialize:function(e){this.shipments=new s(null,{state:{pageSize:9999}}),this.listenTo(this.shipments,"sync",this.updateShipments.bind(this)),this.dewars=new i(null,{state:{pageSize:9999}}),this.listenTo(this.dewars,"sync",this.updateDewars,this),this.dewars.queryParams.sid=this.getShipment.bind(this),this.containers=new a(null,{state:{pageSize:9999}}),this.listenTo(this.containers,"sync",this.updateContainers,this),this.containers.queryParams.did=this.getDewar.bind(this),this.samples=new o(null,{state:{pageSize:9999}}),this.samples.queryParams.cid=this.getContainer.bind(this),this.listenTo(this.samples,"sync",this.generateSamples,this),this.listenTo(this.samples,"selected:change",this.setSample,this),this.proteins=new c,this.proteins.fetch(),this.shipments.fetch()},onDomRefresh:function(){this.puck=new t({collection:this.samples}),console.log("puck",this.pk.$el),this.pk.show(this.puck),this.single=new r({proteins:this.proteins,existingContainer:!0}),this.ss.show(this.single)}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1060:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="form">\n\t<ul>\n\t\t<li>\n\t\t\t<span class="label">Select a Shipment:</span>\n\t\t\t<select name="shipment"></select>\n\t\t</li>\n\n\t\t<li>\n\t\t\t<span class="label">Select a Dewar:</span>\n\t\t\t<select name="dewar"></select>\n\t\t</li>\n\n\t\t<li>\n\t\t\t<span class="label">Select a Container:</span>\n\t\t\t<select name="container"></select>\n\t\t</li>\n\n\t</ul>\n</div>\n\n\n<div class="clearfix">\n\t<div class="left singlesample"></div>\n\t<div class="right third">\n\t\t<h2>Container</h2>\n\t\t<div class="puck"></div>\n\t</div>\n</div>\n';return __p}},1061:function(e,t,s){(function(n){var i,a;i=[s(10),s(438),s(14)],void 0===(a=function(e,t,s){return e.extend(n.extend({},s,{mode:"client",model:t,url:"/imaging/inspection/images/scores/auto/schemas",keyAttribute:"SCHEMANAME",valueAttribute:"BLSAMPLEIMAGEAUTOSCORESCHEMAID"}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1062:function(e,t,s){var n,i;n=[s(10),s(438)],void 0===(i=function(e,t){return e.extend({mode:"client",model:t,url:"/imaging/inspection/images/scores/auto",state:{pageSize:9999}})}.apply(t,n))||(e.exports=i)},1063:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Container: <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span></h1>\n\n<a name="top"></a>\n<p class="help">This page shows the contents of the selected container. Samples can be added and edited by clicking the pencil icon, and removed by clicking the x</p>\n\n',"processing"==CONTAINERSTATUS&&(__p+='\n<p class="message alert">This container is currently assigned and in use on a beamline sample changer. Unassign it to make it editable</p>\n'),__p+='\n\n<div class="form clearfix puck_wrap">\n    <div class="plate right"></div>\n    \n    <div class="left">\n        <ul>\n            <li>\n                <span class="label">Shipment</span>\n                <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n            </li>\n            \n            <li>\n                <span class="label">Dewar</span>\n                <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n            </li>\n            <li>\n                <span class="label">Container Type</span>\n                <span class="CONTAINERTYPE">'+(null==(__t=CONTAINERTYPE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Barcode</span>\n                <span class="BARCODE">'+(null==(__t=BARCODE)?"":_.escape(__t))+"</span>\n            </li>\n\n            ",REQUESTEDIMAGERID&&(__p+='\n            <li>\n                <span class="label">Requested Imager Location</span>\n                <span class="IMAGERID">'+(null==(__t=REQUESTEDIMAGER)?"":_.escape(__t))+"</span>\n            </li>\n            "),__p+="\n\n            ",IMAGERID&&(__p+='\n            <li>\n                <span class="label">Current Imager Location</span>\n                <span class="IMAGERID">'+(null==(__t=IMAGER)?"":_.escape(__t))+"</span>\n            </li>\n            "),__p+="\n\n            ",SCHEDULEID&&(__p+='\n            <li>\n                <span class="label">Imaging Schedule</span>\n                <span><span class="SCHEDULEID">'+(null==(__t=SCHEDULE)?"":_.escape(__t))+'</span> <a href="#" class="button view_sched"><i class="fa fa-search"></i> <span>View</span></a></span>\n            </li>\n            '),__p+="\n\n            ",SCREENID&&(__p+='\n            <li>\n                <span class="label">Crystallisation Screen</span>\n                <span><span class="SCREENID">'+(null==(__t=SCREEN)?"":_.escape(__t))+'</span> <a href="/imaging/screen/'+(null==(__t=SCREENID)?"":_.escape(__t))+'" class="button view_scr"><i class="fa fa-search"></i> <span>View</span></a></span>\n            </li>\n            '),__p+='\n            \n            <li>\n                <span class="label">Last Inspection</span>\n                <span>\n                    <a href="#" class="button add_inspection"><i class="fa fa-plus"></i> <span>Add Manual Inspection</span></a>\n                </span>\n            </li>\n            \n            <li class="clearfix reorder">\n                <div class="COMMENTS text">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</div>\n                <span class="label">Comments</span>\n            </li>\n\n            <li class="clearfix reorder">\n                <div class="history text_table"></div>\n                <span class="label">Location History</span>\n            </li>\n\n        </ul>\n        <div class="singlesamp"></div>\n        <div class="group"></div>\n    </div>\n</div>\n';return __p}},1064:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1 class="no_mobile">Container: <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span></h1>\n\n<a name="top"></a>\n<p class="help">This page shows the contents of the selected container. Samples can be added and edited by clicking the pencil icon, and removed by clicking the x</p>\n\n',"processing"==CONTAINERSTATUS&&(__p+='\n<p class="message alert">This container is currently assigned and in use on a beamline sample changer. Unassign it to make it editable</p>\n'),__p+='\n\n<div class="inspect clearfix">\n    <div class="img right"></div>\n    <div class="left">\n        <div class="plate"></div>\n        <div class="ra">\n            <span class="label">Show Data Status</span> <input type="checkbox" name="sample_status" />\n            <label>\n                Rank By\n                <input type="checkbox" name="rank" />\n            </label>:\n            <select name="param">\n                <option value="DCRESOLUTION" data-inverted="1" data-check="DC">AP Resolution</option>\n                <option value="DCCOMPLETENESS" data-check="DC" data-min="0.85">AP Completeness</option>\n            </select>\n\n            <div>\n                <span class="label">Show Auto Scores</span> <input type="checkbox" name="auto" /> \n                <select name="schema"></select>\n                Class: <select name="class"></select>\n            </div>\n            <div class="sta small"></div> \n        </div>\n        <div class="form">\n            <ul>\n                <li class="nowrap">\n                    <span class="label">Inspections</span>\n                    <select name="inspection"></select>\n                    <a href="#" class="button button-notext add_inspection"><i class="fa fa-plus"></i> <span>Add</span></a>\n                </li>\n                <li>\n                    <span class="label">Movie</span>\n                    Gap: <input type="number" step="0.1" name="gap" value="0.5" />s\n                    <a href="#" class="button play_inspection"><i class="fa fa-play"></i> <span>Play</span></a> \n                </li>\n            </ul>\n        </div>\n\n        <div>\n            \n        </div>\n\n        <div class="add_image">\n            <h2>Upload Image</h2>\n            <div class="dropimage">\n                <i class="fa fa-2x fa-cloud-upload"></i> Drop Image Here\n                <div class="progress"></div>\n            </div>\n        </div>\n\n        <div class="singlesamp"></div>\n        <div class="startend"></div>\n        <div class="group"></div>\n\n        <div>\n            <h2>Marked Sub Samples</h2>\n            <div class="ra">\n                <a href="#" class="button add_point"><i class="fa fa-plus"></i> <span>Mark Point</span></a>\n                <a href="#" class="button add_region"><i class="fa fa-plus"></i> <span>Mark Region</span></a>\n            </div>\n            <div class="subs"></div>\n        </div>\n    </div>\n</div>\n\n<h1 class="no_mobile">Plate Details</h1>\n<div class="form clearfix">\n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span><a href="/shipments/sid/'+(null==(__t=SHIPPINGID)?"":_.escape(__t))+'">'+(null==(__t=SHIPMENT)?"":_.escape(__t))+'</a></span>\n        </li>\n        \n        <li>\n            <span class="label">Dewar</span>\n            <span>'+(null==(__t=DEWAR)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Container Type</span>\n            <span class="CONTAINERTYPE">'+(null==(__t=CONTAINERTYPE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Barcode</span>\n            <span class="BARCODE">'+(null==(__t=BARCODE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix reorder">\n            <div class="COMMENTS text">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</div>\n            <span class="label">Comments</span>\n        </li>\n\n        ',REQUESTEDIMAGERID&&(__p+='\n            <li>\n                <span class="label">Requested Imager Location</span>\n                <span class="IMAGERID">'+(null==(__t=REQUESTEDIMAGER)?"":_.escape(__t))+"</span>\n            </li>\n        "),__p+="\n\n        ",IMAGERID&&(__p+='\n        <li>\n            <span class="label">Current Imager Location</span>\n            <span class="IMAGERID">'+(null==(__t=IMAGER)?"":_.escape(__t))+"</span>\n        </li>\n        "),__p+="\n\n        ",SCHEDULEID&&(__p+='\n        <li>\n            <span class="label">Imaging Schedule</span>\n            <span><span class="SCHEDULEID">'+(null==(__t=SCHEDULE)?"":_.escape(__t))+'</span> <a href="#" class="button view_sched"><i class="fa fa-search"></i> <span>View</span></a></span>\n        </li>\n        '),__p+="\n\n        ",SCREENID&&(__p+='\n        <li>\n            <span class="label">Crystallisation Screen</span>\n            <span><span class="SCREENID">'+(null==(__t=SCREEN)?"":_.escape(__t))+'</span> <a href="/imaging/screen/'+(null==(__t=SCREENID)?"":_.escape(__t))+'" class="button view_scr"><i class="fa fa-search"></i> <span>View</span></a></span>\n        </li>\n        '),__p+="\n        \n        ",INSPECTIONS>0&&(__p+='\n        <li>\n            <span class="label">Last Inspection</span>\n            <span>'+(null==(__t=LASTINSPECTION)?"":_.escape(__t))+" ("+(null==(__t=INSPECTIONS)?"":_.escape(__t))+" inspections)</span>\n        </li>\n        "),__p+="\n\n        ",VISIT&&(__p+='\n        <li>\n            <span class="label">Data Collections</span>\n            <span><a href="/dc/visit/'+(null==(__t=VISIT)?"":_.escape(__t))+'" class="button"><i class="fa fa-search"></i> <span>View</span></a></span>\n        </li>\n        '),__p+="\n\n        ",IMAGERID&&(__p+='\n        <li class="clearfix reorder">\n            \n            <div class="text_table">\n                <div class="queue"></div>\n                \n                <div>\n                    <select name="INSPECTIONTYPEID"></select> \n                    <span class="adhoc"></span>    \n                </div> \n                <div class="return"></div>\n            </div>\n            <span class="label">Actions</span>\n        </li>\n        '),__p+='\n\n        <li class="clearfix reorder">\n            <div class="history text_table"></div>\n            <span class="label">Location History</span>\n        </li>\n\n    </ul>\n</div>\n';return __p}},1067:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(6),s(95),s(173),s(239),s(437),s(131),s(12),s(15),s(31),s(11),s(270),s(439),s(97),s(1068),s(440),s(441),s(442),s(443),s(444),s(445),s(16),s(184)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d,u,m,_,f,g,E,b,v,I,A,T){var C=T.Cell.extend({events:{"click a.add":"addToQueue"},initialize:function(e){C.__super__.initialize.call(this,e),this.listenTo(this.model,"change:READYFORQUEUE",this.render)},addToQueue:function(e){e.preventDefault();var s=this;t.ajax({url:app.apiurl+"/sample/sub/queue/"+this.model.get("BLSUBSAMPLEID"),success:function(e){s.model.set("READYFORQUEUE","1")},error:function(e){app.alert({message:"Something went wrong queuing this sub sample"})}})},render:function(){return this.$el.empty(),console.log("add cell",this.model.get("CONTAINERQUEUEID")),this.column.get("disable")||"0"!=this.model.get("READYFORQUEUE")||this.model.get("QUEUECOMPLETED")||this.$el.html('<a href="#" class="button add"><i class="fa fa-plus"></i></a>'),this.model.get("QUEUECOMPLETED")&&this.$el.html('<ul class="status"><li class="COMP"></li></ul>'),this}}),N=T.Cell.extend({events:{"click a.rem":"removeFromQueue","click a.clone":"clone","click a.save":"saveAsPreset"},clone:function(e){e.preventDefault(),this.model.trigger("clone",this.model)},saveAsPreset:function(e){e.preventDefault();var t=new u(this.model.toJSON());t.set({COMMENTS:(this.model.get("X2")?"Region":"Point")+(this.column.get("plans").length+1),DIFFRACTIONPLANID:null});var s=this;t.save({},{success:function(){app.alert({message:"Preset successfully saved"}),s.column.get("plans").add(t)},error:function(e){app.alert({message:"Something went wrong saving this preset"})}})},removeFromQueue:function(e){e.preventDefault();var s=this;t.ajax({url:app.apiurl+"/sample/sub/queue/"+this.model.get("BLSUBSAMPLEID"),data:{UNQUEUE:1},success:function(e){s.model.set("READYFORQUEUE","0"),s.render()},error:function(e){app.alert({message:"Something went wrong removing this sub sample"})}})},render:function(){return this.$el.empty(),this.model.get("CONTAINERQUEUEID")||this.$el.html('<a href="#" class="button clone" title="Clone these parameters to the selected samples"><i class="fa fa-files-o"></i></a>                <a href="#" class="button save" title="Save these parameters as a preset"><i class="fa fa-save"></i></a>                <a href="#" class="button rem" title="Remove from Queue"><i class="fa fa-minus"></i></a>'),this}}),w=T.Cell.extend({render:function(){this.$el.empty();var e=this.column.get("type").getName(this.model.get("LOCATION")),t=this.column.get("type").getDrop(this.model.get("LOCATION"));return this.$el.text(e+"d"+t),this.delegateEvents(),this}}),S=T.Row.extend({events:{click:"onClick"},onClick:function(e){n(e.target).is("a")||n(e.target).is("i")||n(e.target).is("input")||n(e.target).is("select")||this.model.set({isSelected:!0})},initialize:function(e){S.__super__.initialize.call(this,e),this.listenTo(this.model,"change:isSelected",this.setActive,this)},setActive:function(){this.model.get("isSelected")?this.$el.addClass("selected"):this.$el.removeClass("selected")},render:function(){return this.setActive(),S.__super__.render.call(this)}}),R=T.Cell.extend({plans:{SAD:v,MESH:I,XFE:A},events:{"change input":"updateModel","blur input":"updateModel","keyup input":"updateModel","change select":"updateModel"},updateModel:function(e){console.log("up mod",n(e.target).attr("name")),this.model.set(n(e.target).attr("name"),n(e.target).val()),this.plan.set(this.model.toJSON()),this.validate({attr:n(e.target).attr("name"),val:n(e.target).val()}),this.preSave()},preSave:function(){if(this.plan.isValid(!0)){var e=this.model.changedAttributes();console.log("model valid",this.model,e),0==this.model.get("_valid")?this.model.save():!e||1==Object.keys(e).length&&("isSelected"in e||"_valid"in e||this.plan.computed().indexOf(Object.keys(e)[0])>-1)||(console.log("attrs changed",this.model.changedAttributes()),this.model.save()),this.model.set("_valid",!0)}else console.log("model invalid"),this.model.set("_valid",!1)},validate:function(e){var t=this.plan.preValidate(e.attr,e.val),s=this.$el.find("[name="+e.attr+"]");t?this.invalid(s,t):this.valid(s)},invalid:function(e,t){n(e).removeClass("fvalid").addClass("ferror"),n(e).siblings("span.errormessage").length?n(e).siblings("span.errormessage").text(t):n(e).after('<span class="errormessage ferror">'+t+"</span>")},valid:function(e){n(e).removeClass("ferror").addClass("fvalid").siblings("span.errormessage").remove()},initialize:function(e){R.__super__.initialize.call(this,e),this.listenTo(this.model,"change:EXPERIMENTKIND",this.render,this),this.listenTo(this.model,"refresh",this.render,this),this.preSave=i.debounce(this.preSave,1e3)},setPlan:function(){if(this.model.get("EXPERIMENTKIND")in this.plans){var e={};console.log("binding model",this.column.get("beamlinesetups")),this.column.get("beamlinesetups")&&this.column.get("beamlinesetups").length&&(e.beamlinesetup=this.column.get("beamlinesetups").at(0)),this.plan=new(this.plans[this.model.get("EXPERIMENTKIND")])(null,e)}else this.plan=new u},checkIsValid:function(){this.setPlan(),t.Validation.bind(this,{model:this.plan}),this.plan.set(this.model.toJSON()),this.updateComputed();var e=this.plan.isValid(!0);return this.model.set("_valid",e),e},bindModel:function(){this.setPlan(),t.Validation.unbind(this),t.Validation.bind(this,{model:this.plan,selector:"name",valid:function(e,t){e.valid(e.$el.find('[name="'+t+'"]'))},invalid:function(e,t,s){e.invalid(e.$el.find('[name="'+t+'"]'),s)}}),this.plan.set(this.model.toJSON()),this.listenTo(this.plan,"computed:changed",this.updateComputed)},updateComputed:function(){i.each(this.plan.computed(),(function(e){this.$el.find("[name="+e+"]").val(this.plan.get(e)).trigger("change")}),this)},render:function(e){console.log("render cell exp");var t={SAD:g,MESH:E,XFE:b};return this.$el.empty(),this.model.get("EXPERIMENTKIND")in t&&this.$el.html(t[this.model.get("EXPERIMENTKIND")](this.model.toJSON())),this.model.get("CONTAINERQUEUEID")&&this.$el.find("input").attr("disabled","disabled"),this.bindModel(),this.model.set("_valid",this.plan.isValid(!0)),this.updateComputed(),this}}),O=T.Cell.extend({events:{"change select":"updateModel"},updateModel:function(){this.model.set("EXPERIMENTKIND",this.$el.find("select").val())},types:{Point:[{name:"Point Collection",type:"SAD"},{name:"Fluorescence",type:"XFE"}],Region:[{name:"Grid Scan",type:"MESH"}],Line:[{name:"Line Scan",type:"SAD"}]},render:function(){if(this.$el.empty(),this.model.get("X2")&&this.model.get("Y2"))var e=this.types.Region;else e=this.types.Point;var t="";return i.each(e,(function(e){t+='<option value="'+e.type+'">'+e.name+"</option>"})),this.$el.html('<select name="EXPERIMENTKIND">'+t+"</select>"),this.$el.find("select").val(this.model.get("EXPERIMENTKIND")),this.model.get("CONTAINERQUEUEID")&&this.$el.find("select").attr("disabled","disabled"),this}}),D=h.extend({filters:[{id:"point",name:"Point"},{id:"region",name:"Region"},{id:"invalid",name:"Invalid"}],initialize:function(e){D.__super__.initialize.call(this,e),this.filterablecollection=e.collection.fullCollection,this.shadowCollection=this.filterablecollection.clone(),this.listenTo(this.filterablecollection,"add",(function(e,t,s){this.shadowCollection.add(e,s)})),this.listenTo(this.filterablecollection,"remove",(function(e,t,s){this.shadowCollection.remove(e,s)})),this.listenTo(this.filterablecollection,"sort",(function(e){this.query()||this.shadowCollection.reset(e.models)})),this.listenTo(this.filterablecollection,"reset",(function(e,t){(t=i.extend({reindex:!0},t||{})).reindex&&null==t.from&&null==t.to&&(this.shadowCollection.reset(e.models),this.selected()&&this._filter())}))},_filter:function(){var e=this.selected();this.trigger("selected:change",e,this.selectedName()),e?this.filterablecollection.reset(this.shadowCollection.filter((function(t){return"invalid"==e?0==t.get("_valid"):"region"==e?t.get("X2")&&t.get("Y2"):"point"==e?t.get("X")&&t.get("Y")&&!t.get("X2"):void 0})),{reindex:!1}):(console.log("reset",this.shadowCollection),this.filterablecollection.reset(this.shadowCollection.models,{reindex:!1}))}}),y=T.Cell.extend({image:null,className:"cleafix",selectImage:function(){this.image=this.column.get("inspectionimages").findWhere({BLSAMPLEID:this.model.get("BLSAMPLEID")}),console.log("selectimage",this.image),this.image&&this.viewer.setModel(this.image)},render:function(){var e=this.model.clone();return e.set({isSelected:!0}),this.viewer=new o({subsamples:new r([e]),scores:!1,showBeam:!1,move:!1,showHeatmap:!1}),this.$el.html(this.viewer.render().$el),this.afterRender(),this},afterRender:function(){this.viewer.$el.width(300),this.viewer.onDomRefresh(),this.listenTo(this.column.get("inspectionimages"),"sync",this.selectImage),this.selectImage()}});return e.LayoutView.extend({className:"content",template:f,regions:{asmps:".asamples",qsmps:".qsamples",qfilt:".qfilt",rimg:".image"},events:{"click button.submit":"queueContainer","click a.apply":"applyPreset","click a.unqueue":"unqueueContainer","click a.addall":"queueAllSamples","change @ui.nodata":"refreshSubSamples","change @ui.notcompleted":"refreshSubSamples"},ui:{preset:"select[name=preset]",rpreset:".rpreset",xtal:".xtalpreview",nodata:"input[name=nodata]",notcompleted:"input[name=notcompleted]"},queueAllSamples:function(e){e.preventDefault();var s=this,n=i.map(this.subsamples.filter((function(e){return!e.get("QUEUECOMPLETED")})),(function(e){return e.get("BLSUBSAMPLEID")}));t.ajax({url:app.apiurl+"/sample/sub/queue",data:{BLSUBSAMPLEID:n},success:function(e){i.each(e,(function(e){s.subsamples.findWhere({BLSUBSAMPLEID:e.BLSUBSAMPLEID}).set({READYFORQUEUE:"1"})}))}}),setTimeout((function(){s.refreshQSubSamples.bind(s)}),200)},unqueueContainer:function(e){e.preventDefault(),d.confirm({title:"Unqueue Container?",content:"Are you sure you want to remove this container from the queue? You will loose your current place",callback:this.doUnqueueContainer.bind(this)})},doUnqueueContainer:function(){t.ajax({url:app.apiurl+"/shipment/containers/queue",data:{CONTAINERID:this.model.get("CONTAINERID"),UNQUEUE:1},success:function(e){app.alert({message:"Container Successfully Unqueued"})},error:function(e){app.alert({message:"Something went wrong unqueuing this container"})}})},applyPreset:function(e){e.preventDefault();var t=this.plans.findWhere({DIFFRACTIONPLANID:this.ui.preset.val()});t&&this.applyModel(t)},applyModel:function(e){var t=this.qsubsamples.where({isGridSelected:!0});i.each(t,(function(t){e.get("EXPERIMENTKIND")==t.get("EXPERIMENTKIND")&&(i.each(["REQUIREDRESOLUTION","PREFERREDBEAMSIZEX","PREFERREDBEAMSIZEY","EXPOSURETIME","BOXSIZEX","BOXSIZEY","AXISSTART","AXISRANGE","NUMBEROFIMAGES","TRANSMISSION","ENERGY","MONOCHROMATOR"],(function(s){null!==e.get(s)&&t.set(s,e.get(s))}),this),t.save(),t.trigger("refresh"))}),this)},cloneModel:function(e){console.log("cloning",e),this.applyModel(e)},queueContainer:function(e){if(e.preventDefault(),this.qsubsamples.fullCollection.length){this.qsubsamples.fullCollection.each((function(e){if(void 0===e.get("_valid"))new R({model:e,column:{beamlinesetups:this.beamlinesetups}}).checkIsValid()}),this);var s=this.qsubsamples.fullCollection.where({_valid:!1});if(console.log("queue",s,s.length>0),s.length>0){app.alert({message:"There are "+s.length+" sub samples with invalid experimental plans, please either correct or remove these from the queue"});var n=this.typeselector.collection.findWhere({id:"invalid"});n&&n.set({isSelected:!0})}else{t.ajax({url:app.apiurl+"/shipment/containers/queue",data:{CONTAINERID:this.model.get("CONTAINERID")},success:function(e){app.alert({message:"Container Successfully Queued"})},error:function(e){app.alert({message:"Something went wrong queuing this container"})}})}}else app.alert({message:"Please add some samples before queuing this container"})},selectModel:function(e,t){console.log("model seleted in grid"),e.set({isGridSelected:t})},getNoData:function(){return this.ui.nodata.is(":checked")?1:null},getNotCompleted:function(){return this.ui.notcompleted.is(":checked")?1:null},refreshSubSamples:function(){this.subsamples.fetch()},initialize:function(e){this._lastSample=null,this.platetypes=new s,this.type=this.platetypes.findWhere({name:this.model.get("CONTAINERTYPE")}),this.subsamples=new r,this.subsamples.queryParams.cid=this.model.get("CONTAINERID"),this.subsamples.state.pageSize=10,this.listenTo(this.subsamples,"change:isSelected",this.selectSubSample,this),this.listenTo(this.subsamples,"sync add remove change:READYFORQUEUE",this.refreshQSubSamples,this),this.subsamples.fetch(),this.inspections=new a,this.inspections.queryParams.cid=this.model.get("CONTAINERID"),this.inspections.setSorting("BLTIMESTAMP",1),this.inspections.fetch().done(this.getInspectionImages.bind(this)),this.inspectionimages=new l,this.imagess=new r,this.image=new o({subsamples:this.imagess,scores:!1,showBeam:!0,move:!this.model.get("CONTAINERQUEUEID")}),this.qsubsamples=new r,this.qsubsamples.state.pageSize=5,this.listenTo(this.qsubsamples,"backgrid:selected",this.selectModel,this),this.listenTo(this.qsubsamples,"clone",this.cloneModel,this),this.plans=new m,this.plans.fetch(),this.listenTo(this.plans,"add remove sync",this.populatePresets,this),this.beamlinesetups=new _,this.beamlinesetups.queryParams.ACTIVE=1,this.beamlinesetups.queryParams.BEAMLINENAME=this.model.get("BEAMLINENAME"),this._ready=this.beamlinesetups.fetch()},onScroll:function(e){(console.log("scrolling",e),this.fixedPreview)?d.inView(this.$el.find(".qfilt"),-100)&&(this.ui.xtal.removeClass("fixed"),n(".content").removeClass("fixed"),this.subsamples.setPageSize(10),this.fixedPreview=!1):d.inView(this.ui.xtal,-200)||(this.ui.xtal.addClass("fixed"),this.subsamples.setPageSize(5),n(".content").addClass("fixed"),this.fixedPreview=!0)},populatePresets:function(){this.ui.preset.html(this.plans.opts())},getInspectionImages:function(){this.inspectionimages.queryParams.iid=this.inspections.at(0).get("CONTAINERINSPECTIONID"),this.inspectionimages.fetch().done(this.selectSample.bind(this))},selectSample:function(){this.subsamples.at(0).set({isSelected:!0})},refreshQSubSamples:function(){console.log("ref q subs",this.subsamples.where({READYFORQUEUE:"1"})),this.model.get("CONTAINERQUEUEID")?this.qsubsamples.fullCollection.reset(this.subsamples.fullCollection.where({CONTAINERQUEUEID:this.model.get("CONTAINERQUEUEID")})):this.qsubsamples.fullCollection.reset(this.subsamples.fullCollection.where({READYFORQUEUE:"1"}))},selectSubSample:function(){var e=this.subsamples.findWhere({isSelected:!0}).get("BLSAMPLEID");if(e!=this._lastSample){this.imagess.reset(this.subsamples.where({BLSAMPLEID:e}));var t=this.inspectionimages.findWhere({BLSAMPLEID:e});this.image.setModel(t)}},onRender:function(){this.subsamples.queryParams.nodata=this.getNoData.bind(this),this.subsamples.queryParams.notcompleted=this.getNotCompleted.bind(this),this._ready.done(this.doOnRender.bind(this))},doOnRender:function(){var e=[{label:"#",cell:p.TemplateCell,editable:!1,template:"<%-(RID+1)%>"},{name:"SAMPLE",label:"Sample",cell:"string",editable:!1},{name:"PROTEIN",label:"Protein",cell:"string",editable:!1},{label:"Location",cell:w,editable:!1,type:this.type},{label:"Type",cell:p.TemplateCell,editable:!1,template:'<%-(X2 ? "Region" : "Point")%>'},{label:"",cell:p.StatusCell,editable:!1},{label:"",cell:C,editable:!1,disable:this.model.get("CONTAINERQUEUEID")}];app.mobile()&&i.each([],(function(t){e[t].renderable=!1})),this.table=new c({collection:this.subsamples,columns:e,tableClass:"subsamples",loading:!0,backgrid:{row:S,emptyText:"No sub samples found"},noPageUrl:!0}),this.asmps.show(this.table);e=[{label:"#",cell:p.TemplateCell,editable:!1,template:"<%-(RID+1)%>"},{label:"",cell:"select-row",headerCell:"select-all",editable:!1},{name:"SAMPLE",label:"Sample",cell:"string",editable:!1},{label:"Type",cell:p.TemplateCell,editable:!1,template:'<%-(X2 ? "Region" : "Point")%>'},{label:"Experiment",cell:O,editable:!1},{label:"Parameters",cell:R,editable:!1,beamlinesetups:this.beamlinesetups},{name:"_valid",label:"Valid",cell:p.TemplateCell,editable:!1,test:"_valid",template:'<i class="button fa fa-check active"></i>'},{name:"",cell:p.StatusCell,editable:!1},{label:"",cell:y,editable:!1,inspectionimages:this.inspectionimages},{label:"",cell:N,editable:!1,plans:this.plans}];app.mobile()&&i.each([],(function(t){e[t].renderable=!1})),this.typeselector=new D({url:!1,collection:this.qsubsamples}),this.qfilt.show(this.typeselector),this.model.get("CONTAINERQUEUEID")&&(this.ui.rpreset.hide(),e.push({label:"",cell:p.StatusCell,editable:!1}),e.push({label:"",cell:p.TemplateCell,editable:!1,template:'<a href="/samples/sid/<%-BLSAMPLEID%>" class="button"><i class="fa fa-search"></i></a>'})),this.table2=new c({collection:this.qsubsamples,columns:e,tableClass:"subsamples",loading:!1,backgrid:{emptyText:"No sub samples found"},noPageUrl:!0}),this.qsmps.show(this.table2)},onShow:function(){this.rimg.show(this.image)}})}.apply(t,a))||(e.exports=l)}).call(this,s(8),s(5))},1068:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Prepare Container for Data Collection</h1>\n\n<p class="help">This pages allows you to queue samples in a container for data collection</p>\n\n',CONTAINERQUEUEID&&(__p+='\n<p class="message alert">\n    ',["disposed","in_storage",null].indexOf(CONTAINERSTATUS)>-1?__p+='\n        This container is queued for data collection, you can not modify it without unqueuing it\n        <a href="#" class="button unqueue"><i class="fa fa-times"></i> Unqueue</a>\n    ':__p+="\n        This container is en route for data collection, it cannot be unqueued.\n    ",__p+="\n</p>\n"),__p+='\n\n<div class="clearfix xtalpreview">\n    <div class="image right"></div>\n    <div class="left">\n        <div class="form">\n            <ul>\n                <li>\n                    <span class="label">Container</span>\n                    <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n                </li>\n\n                <li>\n                    <span class="label">Type</span>\n                    <span class="CONTAINERTYPE">'+(null==(__t=CONTAINERTYPE)?"":_.escape(__t))+'</span>\n                </li>\n            </ul>\n        </div>\n\n        <h2>Available Samples</h2>\n        <div class="filter">\n            <span class="r">\n                <a href="#" class="button addall"><i class="fa fa-plus"></i> <span>Add Current Page to Queue</span></a>\n            </span>\n            <ul>\n                <li><label><input type="checkbox" name="nodata" /> Without Data</label></li>\n                <li><label><input type="checkbox" name="notcompleted" /> Not Completed</label></li>\n            </ul>\n        </div>\n        <div class="asamples"></div>\n    </div>\n</div>\n\n<h2>Queued Samples</h2>\n<div class="r rpreset">\nPresets: <select name="preset"></select> <a href="#" class="button apply" title="Apply this preset to the selected samples"><i class="fa fa-file-o"></i> Apply</a>\n</div>\n<div class="filter filter-nohide qfilt"></div>\n<div class="qsamples"></div>\n\n',CONTAINERQUEUEID||(__p+='\n<h2>Queue Plate</h2>\n<p>Queuing the container will make the queued items immutable, please make sure you have added all sub samples, and that they have valid experimental plans</p>\n<div class="form">\n    <button name="submit" value="1" type="submit" class="button submit">Queue Container</button>\n</div>\n'),__p+="\n";return __p}},1069:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(260),s(446),s(83),s(26),s(31),s(12),s(15),s(1070),s(1071)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h){var d=c.ClickableRow.extend({event:"rcontainer:show",argument:"CONTAINERREGISTRYID",onClick:function(e){n(e.target).is("i")||n(e.target).is("a")||n(e.target).is("input")||n(e.target).hasClass("editable")||(this.cookie&&this.model.get("PROP")&&app.staff&&app.cookie(this.model.get("PROP")),app.trigger(this.event,this.model.get(this.argument)))}}),u=l.extend({template:p,ui:{barcode:"input[name=BARCODE]",comments:"input[name=COMMENTS]"},createModel:function(){this.model=new t},success:function(e,t,s){app.alert({message:"New container registered "+this.model.get("BARCODE"),notify:!0}),this.ui.barcode.val(""),this.ui.comments.val(""),this.trigger("model:saved",this.model),this.setupValidation()},failure:function(e,t,s){console.log(t),t.responseText.indexOf("already")>-1?app.alert({message:"That barcode is already registered"}):app.alert({message:"Something went wrong registering that container, please try again"})}});return e.LayoutView.extend({className:"content",template:h,regions:{wrap:".wrapper",type:".type",wrap2:".wrapper2",add:".add"},templateHelpers:function(){return{STAFF:app.staff}},events:{"click a.addprop":"addProp"},selectModel:function(e,t){console.log("model seleted in grid"),e.set({isGridSelected:t})},addProp:function(e){e.preventDefault();var t=this.collection.where({isGridSelected:!0});console.log("addprops",t),i.each(t,(function(e){this.addProposalsToModel(e)}),this)},initialize:function(e){var t=[{name:"BARCODE",label:"Barcode",cell:"string",editable:!1},{name:"PROPOSALS",label:"Proposals",cell:"string",editable:!1},{name:"RECORDTIMESTAMP",label:"Created",cell:"string",editable:!1},{name:"INSTANCES",label:"# Uses",cell:"string",editable:!1},{name:"LASTUSE",label:"Last Use",cell:"string",editable:!1},{name:"REPORTS",label:"Reports",cell:"string",editable:!1},{name:"COMMENTS",label:"Comments",cell:"string",editable:!1}];if(app.staff&&t.unshift({label:"",cell:"select-row",headerCell:"select-all",editable:!1}),app.mobile()&&i.each([2,4],(function(e){t[e].renderable=!1})),this.table=new r({collection:e.collection,columns:t,tableClass:"containers",filter:"s",search:e.params.s,loading:!0,backgrid:{row:d,emptyText:"No containers found"}}),app.staff){this.listenTo(this.collection,"backgrid:selected",this.selectModel,this),this.proposals=new a,this.listenTo(this.proposals,"backgrid:selected",this.selectModel,this),this.proposals.fetch();t=[{label:"",cell:"select-row",headerCell:"select-all",editable:!1},{name:"PROPOSALCODE",label:"Code",cell:"string",editable:!1},{name:"PROPOSALNUMBER",label:"Number",cell:"string",editable:!1},{name:"VCOUNT",label:"Visits",cell:"string",editable:!1},{name:"TITLE",label:"Title",cell:"string",editable:!1}];this.table2=new r({collection:this.proposals,columns:t,tableClass:"proposals",filter:"s",search:e.params.s,loading:!0,noPageUrl:!0,noSearchUrl:!0,backgrid:{emptyText:"No proposals found"}}),this.ty=new o({collection:this.collection,name:"t",filters:[{id:"orphan",name:"Orphaned"}],value:e.params&&e.params.ty})}},addToCollection:function(e){this.collection.add(e),this.addProposalsToModel(e)},addProposalsToModel:function(e){var t=this.proposals.where({isGridSelected:!0});i.each(t,(function(t){new s({PROPOSALID:t.get("PROPOSALID"),CONTAINERREGISTRYID:e.get("CONTAINERREGISTRYID")}).save({},{success:function(){var s=e.get("PROPOSALS");(s=s?s.split(","):[]).push(t.get("PROPOSAL")),e.set("PROPOSALS",s.join(",")),app.alert({message:"Added registered container "+e.get("BARCODE")+" to proposal(s) "+s,notify:!0})}})}),this)},onRender:function(){this.wrap.show(this.table),app.staff&&(this.wrap2.show(this.table2),this.addview=new u,this.listenTo(this.addview,"model:saved",this.addToCollection),this.add.show(this.addview),this.type.show(this.ty))}})}.apply(t,a))||(e.exports=l)}).call(this,s(8),s(5))},1070:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Add New Container</h1>\n<form>\n<div class="form clearfix">\n    <ul>\n\t\t<li>\n            <label>Barcode</label>\n            <input type="text" name="BARCODE" />\n        </li>\n        <li>\n            <label>Comments</label>\n            <input type="text" name="COMMENTS" />\n        </li>\n    </ul>\n\n    <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Container</button>\n</div>\n</form>\n';return __p}},1071:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Registered Containers</h1>\n<div class="filter type"></div>\n<div class="wrapper"></div>\n\n',STAFF&&(__p+='\n<h1>Add Proposal</h1>\n<div class="wrapper2"></div>\n<a href="#" class="button addprop"><i class="fa fa-plus"></i> Add Proposal(s)</a>\n\n<div class="add"></div>\n'),__p+="\n";return __p}},1072:function(e,t,s){(function(n){var i,a;i=[s(7),s(6),s(16),s(261),s(1073),s(1074),s(80),s(447),s(26),s(12),s(15),s(20),s(29),s(1075),s(1076),s(8),s(47)],void 0===(a=function(e,t,s,i,a,l,o,r,c,p,h,d,u,m,_,f){var g=e.ItemView.extend({tagName:"li",template:n.template('<%-PROPOSAL%> <% if (STAFF) { %><span class="r"><a class="button button-notext delete" href="#"><i class="fa fa-times"></i> <span>Delete</span></a></span><% } %>'),templateHelpers:function(){return{STAFF:app.staff}},events:{"click a.delete":"deleteProposal"},deleteProposal:function(e){this.model.destroy()}}),E=e.CollectionView.extend({tagName:"ul",className:"visits clearfix",childView:g}),b=s.Cell.extend({render:function(){if(this.$el.empty(),"1"==this.model.get("ATTACHMENT")){this.$el.html('<a class="popup" href="'+app.apiurl+"/image/cr/"+this.model.get("CONTAINERREPORTID")+'"><img class="img" alt="attachment" /></a>');var e=this,t=new u;t.onload=function(){e.$el.find("img").attr("src",t.src)},t.load(app.apiurl+"/image/cr/"+this.model.get("CONTAINERREPORTID"))}return this}}),v=h.ClickableRow.extend({event:"container:show",argument:"CONTAINERID",cookie:!0}),I=c.extend({template:_,ui:{report:"textarea[name=REPORT]",att:"input[name=ATTACHMENT]"},createModel:function(){this.model=new r({CONTAINERREGISTRYID:this.getOption("CONTAINERREGISTRYID")})},success:function(){this.trigger("report:added")},failure:function(){app.alert("Something went wrong registering that report, please try again")},onSubmit:function(e){if(!f(e.target).closest(".editable").length){e.preventDefault(),this.model.set({REPORT:this.ui.report.val(),ATTACHMENT:this.ui.att[0].files[0]}),this.model.validate();var t=this.model.isValid(!0);if(app.log("submitted",t,this.model),t){var s=this;this.$el.find("form").addClass("loading"),this.beforeSave&&this.beforeSave.call(this),this.model.save({},{success:function(e,t,n){s.$el.find("form").removeClass("loading"),s.success(e,t,n)},error:function(e,t,n){s.$el.find("form").removeClass("loading"),s.failure(e,t,n)}})}}}});return e.LayoutView.extend({className:"content",template:m,regions:{hist:".history",prs:".proposals",con:".conts",rep:".reports",props:".props",ar:"div.addreport"},templateHelpers:function(){return{STAFF:app.staff}},initialize:function(e){t.Validation.bind(this),this.history=new i;var s=[{name:"BLTIMESTAMP",label:"Date",cell:"string",editable:!1},{name:"STATUS",label:"Status",cell:"string",editable:!1},{name:"LOCATION",label:"Location",cell:"string",editable:!1},{name:"BEAMLINENAME",label:"Beamline",cell:"string",editable:!1}];this.histtable=new p({collection:this.history,columns:s,tableClass:"history",loading:!0,backgrid:{emptyText:"No history found"}}),this.containers=new o,this.containers.queryParams.CONTAINERREGISTRYID=this.model.get("CONTAINERREGISTRYID"),this.containers.queryParams.all=1,this.containers.fetch().done(this.getHistory.bind(this));s=[{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"BLTIMESTAMP",label:"Created",cell:"string",editable:!1},{name:"CONTAINERSTATUS",label:"Status",cell:"string",editable:!1},{label:"Shipment",cell:h.TemplateCell,editable:!1,template:'<a href="/shipments/sid/<%-SHIPPINGID%>"><%-SHIPMENT%></a>'},{name:"DCCOUNT",label:"# DCs",cell:"string",editable:!1},{name:"DCVISITS",label:"Visits",cell:"string",editable:!1},{name:"DCDATES",label:"Dates",cell:"string",editable:!1}];app.mobile()&&n.each([4,6],(function(e){s[e].renderable=!1})),this.conttable=new p({collection:this.containers,columns:s,tableClass:"containers",loading:!0,backgrid:{row:v,emptyText:"No containers found"}}),this.reports=new a(null,{queryParams:{CONTAINERREGISTRYID:this.model.get("CONTAINERREGISTRYID")}}),this.listenTo(this.reports,"sync",this.setupPopups,this),this.reports.fetch();s=[{name:"RECORDTIMESTAMP",label:"Time / Date",cell:"string",editable:!1},{name:"REPORTER",label:"Reporter",cell:"string",editable:!1},{name:"REPORT",label:"Report",cell:"string",editable:!1},{label:"Image",cell:b,editable:!1}];this.reptable=new p({collection:this.reports,columns:s,tableClass:"reports",loading:!0,backgrid:{emptyText:"No reports found"}}),this.proposals=new l,this.proposals.queryParams.CONTAINERREGISTRYID=this.model.get("CONTAINERREGISTRYID"),this.proposals.fetch()},setupPopups:function(){this.$el.find("td a.popup").magnificPopup({type:"image"})},getHistory:function(){this.history.queryParams.CONTAINERREGISTRYID=this.model.get("CONTAINERREGISTRYID"),this.history.queryParams.all=1,this.history.fetch()},onRender:function(){(this.hist.show(this.histtable),this.con.show(this.conttable),this.rep.show(this.reptable),this.props.show(new E({collection:this.proposals})),app.staff)&&(new d({model:this.model,el:this.$el}).create("COMMENTS","text"),this.ar.show(new I({CONTAINERREGISTRYID:this.model.get("CONTAINERREGISTRYID")})))}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1073:function(e,t,s){var n,i;n=[s(10),s(447)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:"/shipment/containers/reports",state:{pageSize:15},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},1074:function(e,t,s){var n,i;n=[s(10),s(446)],void 0===(i=function(e,t){return e.extend({model:t,mode:"client",url:"/shipment/containers/registry/proposals",state:{pageSize:15}})}.apply(t,n))||(e.exports=i)},1075:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>"+(null==(__t=BARCODE)?"":_.escape(__t))+'</h1>\n\n<div class="form clearfix">    \n    <ul>\n        <li>\n            <span class="label">Created</span>\n            <span class="RECORDTIMESTAMP">'+(null==(__t=RECORDTIMESTAMP)?"":_.escape(__t))+'</span>\n        </li>\n        <li>\n            <span class="label">Comments</span>\n            <span class="COMMENTS">'+(null==(__t=COMMENTS)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix">\n            <span class="label">\n                Associated Proposals\n            </span>\n            <span class="props floated">\n                <ul class="visits clearfix"></ul>\n            </span>\n        </li>\n    </ul>\n</div>\n\n<h1>Instances</h1>\n<div class="table conts"></div>\n\n<h1>Location History</h1>\n<div class="table history"></div>\n\n<h1>Reports</h1>\n<div class="table reports"></div>\n\n<div class="addreport"></div>\n';return __p}},1076:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Add Report</h1>\n<form>\n<div class="form clearfix">\n    <ul>\n        <li>\n            <label>Report</label>\n            <textarea name="REPORT"></textarea>\n        </li>\n        <li>\n            <label>Image Attachment</label>\n            <input type="file" name="ATTACHMENT" accept="image/jpeg" />\n        </li>\n    </ul>\n\n    <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Report</button>\n</div>\n</form>\n';return __p}},1077:function(e,t,s){(function(n){var i,a;i=[s(7),s(12),s(15)],void 0===(a=function(e,t,s){var i=s.ClickableRow.extend({event:"rdewar:show",argument:"FACILITYCODE",cookie:!0});return e.LayoutView.extend({className:"content",template:n.template('<h1>Registered Dewars</h1><div class="ra"><% if (STAFF) { %><a href="#" class="button all">Show All</a><% } %> <a class="button" href="/dewars/add"><i class="fa fa-plus"></i> Register Dewar</a></div><div class="wrapper"></div>'),regions:{wrap:".wrapper",type:".type"},templateHelpers:function(){return{STAFF:app.staff}},events:{"click a.all":"showAll"},showAll:function(e){e.preventDefault(),this.collection.queryParams.all=1,this.collection.fetch()},initialize:function(e){var s=[{name:"FACILITYCODE",label:"Dewar Code",cell:"string",editable:!1},{name:"CARDNAME",label:"Lab Contact",cell:"string",editable:!1},{name:"GIVENNAME",label:"Name",cell:"string",editable:!1},{name:"FAMILYNAME",label:"Surname",cell:"string",editable:!1},{name:"LABNAME",label:"Lab Name",cell:"string",editable:!1},{name:"ADDRESS",label:"Address",cell:"string",editable:!1},{name:"DEWARS",label:"# Uses",cell:"string",editable:!1}];app.mobile()&&n.each([1,2,5,6],(function(e){s[e].renderable=!1})),this.table=new t({collection:e.collection,columns:s,tableClass:"containers",filter:"s",search:e.params.s,loading:!0,backgrid:{row:i,emptyText:"No dewars found"}})},onRender:function(){this.wrap.show(this.table)}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1078:function(e,t,s){(function(n){var i,a;i=[s(7),s(6),s(16),s(172),s(1079),s(1081),s(48),s(60),s(12),s(15),s(20),s(29),s(1082),s(8),s(47)],void 0===(a=function(e,t,s,i,a,l,o,r,c,p,h,d,u,m){var _=s.Cell.extend({events:{"click a.delete":"deleteProposal"},deleteProposal:function(e){e.preventDefault(),this.model.destroy()},render(){return this.$el.empty(),this.$el.html('<a class="button button-notext delete" href="#"><i class="fa fa-times"></i> <span>Delete</span></a></span>'),this}}),f=s.Cell.extend({render:function(){this.$el.empty(),this.$el.html('<a class="popup" href="'+app.apiurl+"/image/dr/"+this.model.escape("DEWARREPORTID")+'"><img class="img" alt="attachment" /></a>');var e=this,t=new d;return t.onload=function(){e.$el.find("img").attr("src",t.src)},t.load(app.apiurl+"/image/dr/"+this.model.get("DEWARREPORTID")),this}});return e.LayoutView.extend({className:"content",template:u,regions:{hist:".history",dew:".dewars",rep:".reports",props:".proposals"},initialize:function(e){t.Validation.bind(this),this.history=new i;var s=[{label:"First Exp",cell:p.TemplateCell,editable:!1,template:"<%-VISIT%> (<%-BL%>)"},{name:"LOCALCONTACT",label:"Local Contact",cell:"string",editable:!1},{name:"ARRIVAL",label:"Date",cell:"string",editable:!1},{name:"DEWARSTATUS",label:"Status",cell:"string",editable:!1},{name:"STORAGELOCATION",label:"Location",cell:"string",editable:!1}];app.mobile()&&n.each([1],(function(e){s[e].renderable=!1})),this.histtable=new c({collection:this.history,columns:s,tableClass:"history",loading:!0,backgrid:{emptyText:"No history found"}}),this.dewars=new o(null,{FACILITYCODE:this.model.get("FACILITYCODE")}),this.dewars.fetch().done(this.getHistory.bind(this));s=[{name:"CODE",label:"Name",cell:"string",editable:!1},{label:"Shipment",cell:p.TemplateCell,editable:!1,template:'<a href="/shipments/sid/<%-SHIPPINGID%>"><%-SHIPPINGNAME%></a>'},{name:"EXP",label:"First Exp",cell:"string",editable:!1},{name:"FIRSTEXPERIMENTST",label:"First Exp Start",cell:"string",editable:!1},{name:"LOCALCONTACT",label:"Local Contact",cell:"string",editable:!1},{name:"DEWARSTATUS",label:"Status",cell:"string",editable:!1},{name:"STORAGELOCATION",label:"Location",cell:"string",editable:!1},{name:"TRACKINGNUMBERTOSYNCHROTRON",label:"Track # to",cell:"string",editable:!1},{name:"TRACKINGNUMBERFROMSYNCHROTRON",label:"Track # from",cell:"string",editable:!1}];app.mobile()&&n.each([0,1,3,6,7],(function(e){s[e].renderable=!1})),this.dewtable=new c({collection:this.dewars,columns:s,tableClass:"dewars",loading:!0,backgrid:{emptyText:"No dewars found"}}),this.reports=new a(null,{queryParams:{FACILITYCODE:this.model.get("FACILITYCODE")}}),this.listenTo(this.reports,"sync",this.setupPopups,this),this.reports.fetch();s=[{name:"BLTIMESTAMP",label:"Time / Date",cell:"string",editable:!1},{name:"REPORT",label:"Report",cell:"string",editable:!1},{label:"Image",cell:f,editable:!1}];this.reptable=new c({collection:this.reports,columns:s,tableClass:"samples",loading:!0,backgrid:{emptyText:"No reports found"}}),this.proposals=new l,this.proposals.queryParams.DEWARREGISTRYID=this.model.get("DEWARREGISTRYID"),this.proposals.fetch();s=[{name:"PROPOSAL",label:"Proposal",cell:"string",editable:!1},{name:"GIVENNAME",label:"Given Name",cell:"string",editable:!1},{name:"FAMILYNAME",label:"Family Name",cell:"string",editable:!1},{name:"LABNAME",label:"Lab Name",cell:"string",editable:!1},{name:"ADDRESS",label:"Address",cell:"string",editable:!1}];app.staff&&s.push({name:"",label:"",cell:_,editable:!1}),this.proptable=new c({collection:this.proposals,columns:s})},setupPopups:function(){this.$el.find("td a.popup").magnificPopup({type:"image"})},getHistory:function(){var e=this.dewars.at(0);e?(this.history.queryParams.did=e.get("DEWARID"),this.history.fetch()):console.log("No dewar history for this registered dewar")},onRender:function(){var e=new h({model:this.model,el:this.$el});e.create("PURCHASEDATE","date");var t=this;this.contacts=new r(null,{state:{pageSize:9999}}),this.contacts.fetch().done((function(){e.create("LABCONTACTID","select",{data:t.contacts.kv()})})),this.hist.show(this.histtable),this.dew.show(this.dewtable),this.rep.show(this.reptable),this.props.show(this.proptable),app.staff&&e.create("NEWFACILITYCODE")}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1079:function(e,t,s){var n,i;n=[s(10),s(1080)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:"/shipment/dewars/reports",state:{pageSize:15},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},1080:function(e,t,s){(function(n){var i,a;i=[s(6),s(72),s(79)],void 0===(a=function(e,t,s){return e.Model.extend(n.extend({},{idAttribute:"DEWARREPORTID",urlRoot:"/shipment/dewars/reports",initialize:function(){this.on("change",this.refreshOptions,this),this.refreshOptions()},defaults:{REPORTMD:""},refreshOptions:function(){this.get("REPORT")&&(this.attributes.REPORTMD=t.toHTML(this.get("REPORT")))},validation:{FACILITYCODE:{required:!0,pattern:"wwdash"},REPORT:{required:!0},ATTACHMENT:function(e){if(e){var t=e.substr(e.lastIndexOf(".")+1);if(-1==["png","jpg","jpeg"].indexOf(t.toLowerCase()))return"Attachment must be a png or jpeg file"}}}},s))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1081:function(e,t,s){var n,i;n=[s(10),s(448)],void 0===(i=function(e,t){return e.extend({model:t,mode:"client",url:"/shipment/dewars/registry/proposals",state:{pageSize:15}})}.apply(t,n))||(e.exports=i)},1082:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Dewar: <span class="NEWFACILITYCODE">'+(null==(__t=FACILITYCODE)?"":_.escape(__t))+'</span></h1>\n\n<div class="form clearfix puck_wrap">\n    <div class="puck" title="Click to jump to a position in the puck"></div>\n    \n    <ul>\n        <li>\n            <span class="label">Purchase Date</span>\n            <span class="PURCHASEDATE">'+(null==(__t=PURCHASEDATE)?"":_.escape(__t))+"</span> (Age: "+(null==(__t=AGE)?"":_.escape(__t))+' months)\n        </li>\n    </ul>\n</div>\n\n<h1>Associated Proposals</h1>\n<div class="table proposals"></div>\n\n<h1>Shipments</h1>\n<div class="table dewars"></div>\n\n<h1>Location History</h1>\n<div class="table history"></div>\n\n<h1>Dewar Reports</h1>\n<div class="table reports"></div>';return __p}},1083:function(e,t,s){var n,i;n=[s(7),s(26),s(171),s(60),s(27),s(255),s(1084),s(8),s(6),s(18)],void 0===(i=function(e,t,s,n,i,a,l,o,r){return t.extend({template:l,ui:{lc:"select[name=LABCONTACTID]"},events:{"click a.add_lc":"addLC"},addLC:function(e){return e.preventDefault(),app.dialog.show(new i({title:"Add Home Lab Contact",className:"content",view:new a({dialog:!0}),autoSize:!0})),this.listenTo(app.dialog.currentView,"close",this.refreshContacts,this),!1},createModel:function(){this.model=new s({new:!0})},prepareModel:function(){this.model.set({new:!1})},success:function(e,t,s){console.log("success from dewadd"),app.trigger("rdewar:show",e.get("FACILITYCODE"))},failure:function(e,t,s){console.log("failure from dewsadd"),app.alert({message:"Something went wrong registering this dewar, please try again"})},onRender:function(){this.contacts=new n(null,{state:{pageSize:9999}}),this.listenTo(this.contacts,"sync",this.updateContacts),this.refreshContacts(),this.date("input[name=PURCHASEDATE]")},refreshContacts:function(){this.contacts.fetch()},updateContacts:function(){this.ui.lc.html(this.contacts.opts())}})}.apply(t,n))||(e.exports=i)},1084:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Register Dewar</h1>\n\n<form>\n    \n    <div class="form">\n        <ul>\n            \n            <li>\n                <label>Facility Code\n                    <span class="small">DLS-XX-XXXX Code</span>\n                </label>\n                <input type="text" name="FACILITYCODE" />\n            </li>\n            \n            <li>\n                <label>Lab Contact\n                    <span class="small">Contact associated with this dewar. <a class="add_lc" href="#">Add Contact</a></span>\n                </label>\n                <select name="LABCONTACTID" /></select>\n            </li>\n            \n            <li>\n                <label>Purchase Date\n                    <span class="small">When the dewar was purchased</span>\n                </label>\n                <input type="text" name="PURCHASEDATE" />\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Register Dewar</button>\n            \n        </ul>\n    </div>\n    \n</form>\n\n';return __p}},1085:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(16),s(171),s(448),s(83),s(60),s(26),s(31),s(12),s(15),s(124),s(1086),s(1087)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d,u,m){var _=h.ClickableRow.extend({event:"rdewar:show",argument:"FACILITYCODE",onClick:function(e){n(e.target).is("i")||n(e.target).is("a")||n(e.target).is("input")||n(e.target).hasClass("editable")||this.model.get("PROP")&&(this.model.get("PROP")&&app.staff&&app.cookie(this.model.get("PROP")),app.trigger(this.event,this.model.get(this.argument)))}}),f=r.extend({template:u,ui:{fc:"input[name=FACILITYCODE]",date:"input[name=PURCHASEDATE]"},onRender:function(){this.date("input[name=PURCHASEDATE]")},createModel:function(){this.model=new s},success:function(){app.alert({message:"New dewar registered "+this.model.get("FACILITYCODE"),notify:!0}),this.ui.fc.val(""),this.ui.date.val(""),this.model.set({DEWARS:0,REPORTS:0,BLTIMESTAMP:d.default(new Date,"yyyy-MM-dd HH:mm:ss")}),this.trigger("model:saved",this.model),this.setupValidation()},failure:function(e,t){console.log(t),t.responseText.indexOf("already")>-1?app.alert({message:"That facility code is already registered"}):app.alert({message:"Something went wrong registering that dewar, please try again"})}}),g=t.Cell.extend({initialize:function(e){g.__super__.initialize.call(this,e),this.listenTo(this.model,"change:isGridSelected",this.render)},events:{"change select[name=LABCONTACTID]":"updateLC"},updateLC:function(){var e=this.$el.find('select[name="LABCONTACTID"]').val();console.log("LabContactCell updateLC",e),this.model.set({LABCONTACTID:e})},render(){if(this.$el.empty(),this.model.get("isGridSelected")){this.column.set({label:"Lab Contact"}),this.$el.html('<i class="fa fa-spin fa-spinner"></i>'),this.labcontacts=new o,this.labcontacts.queryParams.prop=this.model.get("PROP");var e=this;this.labcontacts.fetch().then((function(){e.$el.html('<select name="LABCONTACTID"></select>'),e.$el.find('select[name="LABCONTACTID"]').html(e.labcontacts.opts()),e.updateLC()}))}else this.column.set({label:""});return this}});return e.LayoutView.extend({className:"content",template:m,regions:{wrap:".wrapper",type:".type",wrap2:".wrapper2",add:".add"},templateHelpers:function(){return{STAFF:app.staff}},events:{"click a.addprop":"addProp"},selectModel:function(e,t){console.log("model seleted in grid",e),e.set({isGridSelected:t})},addProp:function(e){e.preventDefault();var t=this.collection.where({isGridSelected:!0});console.log("addprops",t),i.each(t,(function(e){this.addProposalsToModel(e)}),this)},initialize:function(e){var t=[{name:"FACILITYCODE",label:"Facility Code",cell:"string",editable:!1},{name:"PROPOSALS",label:"Proposals",cell:"string",editable:!1},{name:"BLTIMESTAMP",label:"Created",cell:"string",editable:!1},{name:"DEWARS",label:"# Uses",cell:"string",editable:!1},{name:"LASTUSE",label:"Last Use",cell:"string",editable:!1},{name:"REPORTS",label:"Reports",cell:"string",editable:!1}];if(app.staff&&t.unshift({label:"",cell:"select-row",headerCell:"select-all",editable:!1}),app.mobile()&&i.each([2,4],(function(e){t[e].renderable=!1})),this.table=new p({collection:e.collection,columns:t,tableClass:"dewars",filter:"s",search:e.params.s,loading:!0,backgrid:{row:_,emptyText:"No dewars found"}}),app.staff){this.listenTo(this.collection,"backgrid:selected",this.selectModel,this),this.proposals=new l,this.listenTo(this.proposals,"backgrid:selected",this.selectModel,this),this.proposals.fetch();var s=[{label:"",cell:"select-row",headerCell:"select-all",editable:!1},{name:"",label:"",cell:g,editable:!1},{name:"PROPOSALCODE",label:"Code",cell:"string",editable:!1},{name:"PROPOSALNUMBER",label:"Number",cell:"string",editable:!1},{name:"VCOUNT",label:"Visits",cell:"string",editable:!1},{name:"TITLE",label:"Title",cell:"string",editable:!1}];this.table2=new p({collection:this.proposals,columns:s,tableClass:"proposals",filter:"s",loading:!0,noPageUrl:!0,noSearchUrl:!0,backgrid:{emptyText:"No proposals found"}}),this.ty=new c({collection:this.collection,name:"t",filters:[{id:"orphan",name:"Orphaned"}],value:e.params&&e.params.ty})}},addToCollection:function(e){this.collection.add(e),this.addProposalsToModel(e)},addProposalsToModel:function(e){var t=this.proposals.where({isGridSelected:!0});i.each(t,(function(t){new a({PROPOSALID:t.get("PROPOSALID"),DEWARREGISTRYID:e.get("DEWARREGISTRYID"),LABCONTACTID:t.get("LABCONTACTID")}).save({},{success:function(){var s=e.get("PROPOSALS");(s=s?s.split(","):[]).push(t.get("PROPOSAL")),e.set("PROPOSALS",s.join(",")),e.get("PROP")||e.set("PROP",t.get("PROPOSAL")),app.alert({message:"Added registered dewar "+e.get("FACILITYCODE")+" to proposal(s) "+s,notify:!0})}})}),this)},onRender:function(){this.wrap.show(this.table),app.staff&&(this.wrap2.show(this.table2),this.addview=new f,this.listenTo(this.addview,"model:saved",this.addToCollection),this.add.show(this.addview),this.type.show(this.ty))}})}.apply(t,a))||(e.exports=l)}).call(this,s(8),s(5))},1086:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Add New Dewar</h1>\n<form>\n<div class="form clearfix">\n    <ul>\n\t\t<li>\n            <label>Facility Code</label>\n            <input type="text" name="FACILITYCODE" />\n        </li>\n        <li>\n            <label>Purchase Date\n                <span class="small">When the dewar was purchased</span>\n            </label>\n            <input type="text" name="PURCHASEDATE" />\n        </li>\n    </ul>\n\n    <button name="submit" value="1" type="submit" class="button submit"><i class="fa fa-plus"></i> Add Dewar</button>\n</div>\n</form>\n';return __p}},1087:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Registered Dewars</h1>\n<p class="help">Registered Dewar not listed here? Ask your local contact to associate it with this proposal.</p>\n<div class="filter type"></div>\n<div class="wrapper"></div>\n\n',STAFF&&(__p+='\n<h1>Add Proposal</h1>\n<div class="wrapper2"></div>\n<a href="#" class="button addprop"><i class="fa fa-plus"></i> Add to Proposal(s)</a>\n\n<div class="add"></div>\n'),__p+="\n";return __p}},1088:function(e,t,s){var n,i;n=[s(7),s(26),s(37),s(60),s(81),s(48),s(172),s(1089),s(1090),s(8),s(6),s(18)],void 0===(i=function(e,t,s,n,i,a,l,o,r,c,p){var h=s.extend({valueAttribute:"VISIT"});return t.extend({template:r,events:{"change @ui.lc":"getlcdetails","change @ui.exp":"updateLC"},ui:{lc:"select[name=LABCONTACTID]",exp:"select[name=VISIT]",lco:"input[name=LOCALCONTACT]",loc:"input[name=LOCATION]",gn:"input[name=GIVENNAME]",fn:"input[name=FAMILYNAME]",addr:"textarea[name=ADDRESS]",em:"input[name=EMAILADDRESS]",ph:"input[name=PHONENUMBER]",lab:"input[name=LABNAME]",courier:"span.courier"},templateHelpers:function(){return{DEWAR:this.getOption("dewar").toJSON()}},createModel:function(){this.model=new o({FACILITYCODE:this.getOption("dewar").get("FACILITYCODE"),DEWARID:this.getOption("dewar").get("DEWARID"),LABCONTACTID:this.getOption("dewar").get("LABCONTACTID"),VISIT:this.getOption("dewar").get("FIRSTEXPERIMENT")})},success:function(e,t,s){console.log("success from dispatch req"),app.trigger("shipment:show",this.getOption("dewar").get("SHIPPINGID"))},failure:function(e,t,s){console.log("failure from dispatch req"),app.alert({message:"Something went wrong registering this dispatch request, please try again"})},onRender:function(){this.date("input[name=DELIVERYAGENT_SHIPPINGDATE]");var e=new Date,t=(e.getDate()<10?"0"+e.getDate():e.getDate())+"-"+(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+e.getFullYear();this.$el.find("input[name=DELIVERYAGENT_SHIPPINGDATE]").val(t),this.ui.courier.html('<input type="text" name="DELIVERYAGENT_AGENTNAME" />');var s=this;this.ready.done((function(){s.ui.exp.html(s.visits.opts()).val(s.model.get("VISIT")),s.updateLC()}))},initialize:function(){this.contacts=new n(null,{state:{pageSize:9999}}),this.listenTo(this.contacts,"sync",this.updateContacts),this.refreshContacts();var e=this;this.visits=new h(null,{state:{pageSize:9999}}),this.ready=this.visits.fetch(),this.history=new l(null,{queryParams:{did:this.getOption("dewar").get("DEWARID")}}),this.history.fetch().done((function(){var t=e.history.at(0);t&&e.ui.loc.val(t.get("STORAGELOCATION"))}))},updateLC:function(){var e=this.visits.findWhere({VISIT:this.ui.exp.val()});if(e){var t=e.get("LC");if(t){var s=t.split(",");this.ui.lco.val(s[0].trim())}else this.ui.lco.val("")}},refreshContacts:function(){this.contacts.fetch()},updateContacts:function(){this.ui.lc.html(this.contacts.opts()).val(this.getOption("dewar").get("RETURNLABCONTACTID")),this.getlcdetails()},getlcdetails:function(){var e=this.contacts.findWhere({LABCONTACTID:this.ui.lc.val()});e&&(this.ui.gn.val(e.get("GIVENNAME")),this.ui.fn.val(e.get("FAMILYNAME")),this.ui.em.val(e.get("EMAILADDRESS")),this.ui.ph.val(e.get("PHONENUMBER")),this.ui.addr.val([e.get("ADDRESS"),e.get("CITY"),e.get("POSTCODE"),e.get("COUNTRY")].join("\n")),this.ui.lab.val(e.get("LABNAME")))}})}.apply(t,n))||(e.exports=i)},1089:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({urlRoot:"/shipment/dewars/dispatch",validation:{FACILITYCODE:{pattern:"fcode",required:!1},LOCATION:{required:!0,pattern:"wwsdash"},VISIT:{required:!0,pattern:"visit"},LOCALCONTACT:{required:!0,pattern:"wwsdash"},GIVENNAME:{required:!0,pattern:"wwdash"},FAMILYNAME:{required:!0,pattern:"wwdash"},PHONENUMBER:{required:!0},EMAILADDRESS:{required:!0,pattern:"email"},LABNAME:{required:!0,pattern:"wwsdash"},ADDRESS:{required:!0},DESCRIPTION:{required:!0},DELIVERYAGENT_SHIPPINGDATE:{pattern:"edate",required:!0},DELIVERYAGENT_AGENTNAME:{required:!0,pattern:"wwsdash"},DELIVERYAGENT_AGENTCODE:{required:function(){return!this.get("FACILITYCODE")}},AWBNUMBER:{pattern:"word",required:!1}}})}.apply(t,n))||(e.exports=i)},1090:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Request Dewar Dispatch</h1>\n\n<form>\n    \n    <div class="form">\n        <ul>\n            \n            <li>\n                <span class="label">Dewar Name</span>\n                <span class="">'+(null==(__t=DEWAR.CODE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipment</span>\n                <span class="">'+(null==(__t=DEWAR.SHIPPINGNAME)?"":_.escape(__t))+"</span>\n            </li>\n\n            ",DEWAR.FACILITYCODE&&(__p+='\n            <li>\n                <span class="label">Dewar Code</span>\n                <span class="">'+(null==(__t=DEWAR.FACILITYCODE)?"":_.escape(__t))+"</span>\n            </li>\n            "),__p+='\n            \n            <li class="head">Visit Details</li>\n            <li>\n                <label>Visit\n                    <span class="small">The last visit the dewar was used for</span>\n                </label>\n                <select name="VISIT"></select>\n            </li>\n            \n            <li>\n                <label>Local Contact\n                    <span class="small">Beamline local contact</span>\n                </label>\n                <input type="text" name="LOCALCONTACT" />\n            </li>\n\n            <li>\n                <label>Dewar Location\n                    <span class="small">Where the dewar currently is</span>\n                </label>\n                <input type="text" name="LOCATION" />\n            </li>\n\n\n            <li class="head">Contact Details</li>\n            <li>\n                <label>Return Contact\n                    <span class="small">The contact to return the dewar to</span>\n                </label>\n                <select name="LABCONTACTID"></select>\n            </li>\n            \n\n            <li>\n                <label>Full Name\n                    <span class="small">The person\'s given &amp; family name</span>\n                </label>\n                <input type="text" name="GIVENNAME" />\n                <input type="text" name="FAMILYNAME" />\n            </li>\n\n            <li>\n                <label>Phone Number\n                    <span class="small">The person\'s phone number</span>\n                </label>\n                <input type="text" name="PHONENUMBER" />\n            </li>\n\n            <li>\n                <label>Contact Email\n                    <span class="small">The person\'s email address</span>\n                </label>\n                <input type="email" name="EMAILADDRESS" />\n            </li>\n\n            <li>\n                <label>Laboratory Name\n                    <span class="small">The contact\'s laboratory name</span>\n                </label>\n                <input type="text" name="LABNAME" />\n            </li>\n\n            <li>\n                <label>Laboratory Address\n                    <span class="small">The contact\'s laboratory address</span>\n                </label>\n                <textarea name="ADDRESS"></textarea>\n            </li>\n\n             <li>\n                <label>Package description\n                    <span class="small">1 line, please specify value and quantity</span>\n                </label>\n                <textarea name="DESCRIPTION">Dry shipper containing frozen crystals (Value: £100; Quantity: 1)</textarea>\n            </li>\n\n            <li>\n                <label>Pickup Date\n                    <span class="small">Date dewar will be ready for dispatch</span>\n                </label>\n                <input class="half" type="text" name="DELIVERYAGENT_SHIPPINGDATE" />\n            </li>\n\n            \n            <li class="head">Courier Details</li>\n            <li>\n                <label>Courier\n                    <span class="small">Courier Name</span>\n                </label>\n                <span class="courier"></span>\n            </li>\n\n            ',DEWAR.FACILITYCODE||(__p+='\n            <li>\n                <label>Account Number\n                    <span class="small">Courier account number</span>\n                </label>\n                <input type="text" name="DELIVERYAGENT_AGENTCODE" />\n            </li>\n\n            <li>\n                <label>Airway Bill Number\n                    <span class="small">Airway bill no. if you have generated your own</span>\n                </label>\n                <input type="text" name="AWBNUMBER" />\n            </li>\n            '),__p+='\n\n\n            <li>\n                <label>Comments\n                    <span class="small">Comment for the shipment</span>\n                </label>\n                <textarea name="COMMENTS"></textarea>\n            </li>\n\n\n            <button name="submit" value="1" type="submit" class="button submit">Request Dewar Dispatch</button>\n            \n            \n        </ul>\n    </div>\n    \n</form>\n\n';return __p}},1091:function(e,t,s){var n,i;n=[s(7),s(26),s(37),s(60),s(81),s(48),s(172),s(1092),s(1093),s(8),s(6),s(18)],void 0===(i=function(e,t,s,n,i,a,l,o,r,c,p){var h=s.extend({valueAttribute:"VISIT"});return t.extend({template:r,events:{"change @ui.exp":"updateLC","change @ui.nexp":"updateLCNext","change @ui.lc":"getlcdetails"},ui:{lc:"select[name=LABCONTACTID]",exp:"select[name=VISIT]",lco:"input[name=LOCALCONTACT]",loc:"input[name=LOCATION]",nexp:"select[name=NEXTVISIT]",nlco:"input[name=NEXTLOCALCONTACT]",nbl:"input[name=NEXTLOCATION]",gn:"input[name=GIVENNAME]",fn:"input[name=FAMILYNAME]",em:"input[name=EMAILADDRESS]",ph:"input[name=PHONENUMBER]",lab:"input[name=LABNAME]"},templateHelpers:function(){return{DEWAR:this.getOption("dewar").toJSON()}},createModel:function(){this.model=new o({FACILITYCODE:this.getOption("dewar").get("FACILITYCODE"),DEWARID:this.getOption("dewar").get("DEWARID"),LABCONTACTID:this.getOption("dewar").get("LABCONTACTID"),VISIT:this.getOption("dewar").get("FIRSTEXPERIMENT")})},success:function(e,t,s){console.log("success from transfer req"),app.trigger("shipment:show",this.getOption("dewar").get("SHIPPINGID"))},failure:function(e,t,s){console.log("failure from transfer req"),app.alert({message:"Something went wrong registering this transfer request, please try again"})},onRender:function(){this.date("input[name=DELIVERYAGENT_SHIPPINGDATE]");var e=new Date,t=(e.getDate()<10?"0"+e.getDate():e.getDate())+"-"+(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+e.getFullYear();this.$el.find("input[name=DELIVERYAGENT_SHIPPINGDATE]").val(t),console.log("render");var s=this;this.ready.done((function(){s.ui.exp.html(s.visits.opts()).val(s.model.get("VISIT")),s.ui.nexp.html(s.visits.opts()),s.updateLC(),s.updateLCNext()}))},initialize:function(){this.contacts=new n(null,{state:{pageSize:9999}}),this.listenTo(this.contacts,"sync",this.updateContacts),this.refreshContacts();var e=this;this.visits=new h(null,{state:{pageSize:9999}}),this.ready=this.visits.fetch(),this.history=new l(null,{queryParams:{did:this.getOption("dewar").get("DEWARID")}}),this.history.fetch().done((function(){var t=e.history.at(0);t&&e.ui.loc.val(t.get("STORAGELOCATION"))}))},updateLC:function(){var e=this.visits.findWhere({VISIT:this.ui.exp.val()});if(e){var t=e.get("LC");if(t){var s=t.split(",");this.ui.lco.val(s[0].trim())}else this.ui.lco.val("")}},updateLCNext:function(){var e=this.visits.findWhere({VISIT:this.ui.nexp.val()});if(e){var t=e.get("LC");if(t){var s=t.split(",");this.ui.nlco.val(s[0].trim())}else this.ui.nlco.val("");this.ui.nbl.val(e.get("BL"))}},refreshContacts:function(){this.contacts.fetch()},updateContacts:function(){this.ui.lc.html(this.contacts.opts()).val(this.model.get("LABCONTACTID")),this.getlcdetails()},getlcdetails:function(){var e=this.contacts.findWhere({LABCONTACTID:this.ui.lc.val()});e&&(this.ui.gn.val(e.get("GIVENNAME")),this.ui.fn.val(e.get("FAMILYNAME")),this.ui.em.val(e.get("EMAILADDRESS")),this.ui.ph.val(e.get("PHONENUMBER")),this.ui.lab.val(e.get("LABNAME")))}})}.apply(t,n))||(e.exports=i)},1092:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({urlRoot:"/shipment/dewars/transfer",validation:{FACILITYCODE:{pattern:"fcode",required:!1},GIVENNAME:{required:!0,pattern:"wwsdash"},FAMILYNAME:{required:!0,pattern:"wwsdash"},PHONENUMBER:{required:!0},EMAILADDRESS:{required:!0,pattern:"email"},LABNAME:{required:!0,pattern:"wwsdash"},LOCATION:{required:!0,pattern:"wwsdash"},VISIT:{required:!0,pattern:"visit"},LOCALCONTACT:{required:!0,pattern:"wwsdash"},NEXTLOCATION:{required:!0,pattern:"wwsdash"},NEXTVISIT:{required:!0,pattern:"visit"},NEXTLOCALCONTACT:{required:!0,pattern:"wwsdash"},DELIVERYAGENT_SHIPPINGDATE:{pattern:"edate",required:!0}}})}.apply(t,n))||(e.exports=i)},1093:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Request Internal Dewar Transfer</h1>\n\n<form>\n    \n    <div class="form">\n        <ul>\n            \n            <li>\n                <span class="label">Dewar Name</span>\n                <span class="">'+(null==(__t=DEWAR.CODE)?"":_.escape(__t))+'</span>\n            </li>\n\n            <li>\n                <span class="label">Shipment</span>\n                <span class="">'+(null==(__t=DEWAR.SHIPPINGNAME)?"":_.escape(__t))+"</span>\n            </li>\n\n            ",DEWAR.FACILITYCODE&&(__p+='\n            <li>\n                <span class="label">Dewar Code</span>\n                <span class="">'+(null==(__t=DEWAR.FACILITYCODE)?"":_.escape(__t))+"</span>\n            </li>\n            "),__p+='\n\n            <li class="head">Contact Details</li>\n            <li>\n                <label>Contact\n                    <span class="small">The contact the dewar relates to</span>\n                </label>\n                <select name="LABCONTACTID"></select>\n            </li>\n\n            <li>\n                <label>Full Name\n                    <span class="small">The person\'s given &amp; family name</span>\n                </label>\n                <input type="text" name="GIVENNAME" />\n                <input type="text" name="FAMILYNAME" />\n            </li>\n\n            <li>\n                <label>Contact Email\n                    <span class="small">The person\'s email address</span>\n                </label>\n                <input type="email" name="EMAILADDRESS" />\n            </li>\n\n            <li>\n                <label>Phone Number\n                    <span class="small">The person\'s phone number</span>\n                </label>\n                <input type="text" name="PHONENUMBER" />\n            </li>\n            \n            <li>\n                <label>Laboratory Name\n                    <span class="small">The contact\'s laboratory name</span>\n                </label>\n                <input type="text" name="LABNAME" />\n            </li>\n\n\n            <li class="head">Last Visit Details</li>\n            <li>\n                <label>Last Visit\n                    <span class="small">The last visit the dewar was used for</span>\n                </label>\n                <select name="VISIT"></select>\n            </li>\n            \n            <li>\n                <label>Last Local Contact\n                    <span class="small">Beamline local contact</span>\n                </label>\n                <input type="text" name="LOCALCONTACT" />\n            </li>\n\n            <li>\n                <label>Dewar Location\n                    <span class="small">Where the dewar currently is</span>\n                </label>\n                <input type="text" name="LOCATION" />\n            </li>\n\n            <li class="head">Next Visit Details</li>\n            <li>\n                <label>Next Visit\n                    <span class="small">The next visit the dewar is going to be used for</span>\n                </label>\n                <select name="NEXTVISIT"></select>\n            </li>\n            \n            <li>\n                <label>Next Local Contact\n                    <span class="small">Beamline local contact</span>\n                </label>\n                <input type="text" name="NEXTLOCALCONTACT" />\n            </li>\n\n            <li>\n                <label>Next Beamline\n                    <span class="small">Next beamline</span>\n                </label>\n                <input type="text" name="NEXTLOCATION" />\n            </li>\n\n\n            <li>\n                <label>Pickup Date\n                    <span class="small">Date dewar will be ready for transfer</span>\n                </label>\n                <input class="half" type="text" name="DELIVERYAGENT_SHIPPINGDATE" />\n            </li>\n\n\n            <li>\n                <label>Comments\n                    <span class="small">Comment for the shipment</span>\n                </label>\n                <textarea name="COMMENTS"></textarea>\n            </li>\n\n            <button name="submit" value="1" type="submit" class="button submit">Request Dewar Transfer</button>\n            \n            \n        </ul>\n    </div>\n    \n</form>\n\n';return __p}},1094:function(e,t,s){var n,i;n=[s(7),s(16),s(12),s(31),s(254),s(435),s(1095),s(8)],void 0===(i=function(e,t,s,n,i,a,l,o){var r=t.Cell.extend({render:function(){this.$el.empty();var e=this.$el;if(this.model.get("TRACKINGNUMBERTOSYNCHROTRON")&&this.model.get("TRACKINGNUMBERTOSYNCHROTRON").length<=10){e.html('<i class="fa fa-spin fa-cog"></i>');var t=this.model.get("DEWARID"),s=new a(null,{queryParams:{DEWARID:t,prop:this.model.get("PROP")}});s.fetch({success:function(){var n=s.last();n?e.text(n.get("STATE")+": "+n.get("LOCATION")):console.log("DewarOverview: no DHL Tracking info for dewarId: "+t)},error:function(){e.empty()}})}return this}}),c=t.Row.extend({events:{click:"onClick"},onClick:function(){app.cookie(this.model.get("PROP")),app.trigger("shipment:show",this.model.get("SHIPPINGID"))}});return e.LayoutView.extend({className:"content",template:l,regions:{wrap:".wrapper",type:".bl",img:".img"},ui:{fe:"input[name=firstexperiment]"},events:{"change @ui.fe":"updateDate"},templateHelpers:function(){return{can:app.user_can}},updateDate:function(){this.collection.queryParams.firstexperimentdate=this.ui.fe.val()?this.ui.fe.val():null,this.collection.fetch()},initialize:function(e){this.beamlines=new i(null,{ty:app.type}),this.ready=this.beamlines.fetch();var t=[{name:"FIRSTEXPERIMENTST",label:"Start Date",cell:"string",editable:!1},{name:"FIRSTEXPERIMENT",label:"Visit",cell:"string",editable:!1},{name:"BEAMLINENAME",label:"Beamline",cell:"string",editable:!1},{name:"LOCALCONTACT",label:"Local Contact",cell:"string",editable:!1},{name:"SHIPPINGNAME",label:"Shipment",cell:"string",editable:!1},{name:"CODE",label:"Dewar Name",cell:"string",editable:!1},{name:"FACILITYCODE",label:"Dewar Code",cell:"string",editable:!1},{name:"CONTAINERS",label:"Containers",cell:"string",editable:!1},{name:"DELIVERYAGENT_AGENTNAME",label:"Courier",cell:"string",editable:!1},{name:"TRACKINGNUMBERTOSYNCHROTRON",label:"Track # to",cell:"string",editable:!1},{name:"DEWARSTATUS",label:"Status",cell:"string",editable:!1},{name:"STORAGELOCATION",label:"Location",cell:"string",editable:!1},{label:"Tracking",cell:r,editable:!1}];this.table=new s({collection:e.collection,columns:t,tableClass:"dewars",filter:"s",search:e.params.s,loading:!0,backgrid:{row:c,emptyText:"No dewars found"}})},onRender:function(){this.wrap.show(this.table),o.when(this.ready).done(this.showFilter.bind(this)),this.ui.fe.datepicker({dateFormat:"dd-mm-yy"})},showFilter:function(){this.ty=new n({url:!1,collection:this.collection,name:"bl",filters:this.beamlines.map((function(e){return{id:e.get("BEAMLINE"),name:e.get("BEAMLINE")}}))}),this.type.show(this.ty),this.ty2=new n({url:!1,collection:this.collection,name:"requestedimager",filters:[{id:"1",name:"Imager Requested"}]}),this.img.show(this.ty2)},onShow:function(){this.table.focusSearch()}})}.apply(t,n))||(e.exports=i)},1095:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="filter filter-nohide">\n    <ul class="clearfix">\n        <li title="View Dewar Overview" class="current"><a href="/dewars/overview">Dewar Overview</a></li>\n        ',can("view_manifest")&&(__p+='<li title="View Shipment Manifest"><a href="/shipments/manifest">Shipping Manifest</a></li>'),__p+="\n        ",can("view_manifest")&&(__p+='<li title="Dewar Stats"><a href="/shipments/stats">Dewar Stats</a></li>'),__p+='\n    </ul>\n</div>\n\n\n<h1>Dewar Overview</h1>\n<p class="help">This page shows all dewars for all current visits</p>\n<div class="filter bl"></div>\n<div class="filter img"></div>\n<div class="filter">\n\t<ul>\n\t\t<li>First Experiment: <input type="text" name="firstexperiment" /></li>\n\t</ul>\n</div>\n\n<div class="wrapper"></div>\n';return __p}},1096:function(e,t,s){(function(n){var i,a;i=[s(7),s(81),s(12),s(15),s(11),s(1097)],void 0===(a=function(e,t,s,i,a,l){var o=i.ClickableRow.extend({event:"shipment:show",argument:"SHIPPINGID",cookie:!0});return e.LayoutView.extend({className:"content",template:l,regions:{rshps:".shipments"},templateHelpers:function(){return{APIURL:app.apiurl}},events:{"click a.manifest":"loadManifest"},ui:{month:"select[name=month]"},loadManifest:function(e){e.preventDefault();var t="?month="+this.ui.month.val(),s=app.apiurl+"/pdf/manifest"+t;a.sign({url:s,callback:function(e){window.location=s+"&token="+e.token}})},initialize:function(){this.shipments=new t,this.shipments.queryParams.manifest=1,this.shipments.queryParams.all=1,this.shipments.fetch()},onRender:function(){this.ui.month.empty();var e=new Date;n.each([e.getFullYear(),e.getFullYear()-1],(function(e){n.each(n.range(1,13),(function(t){t=(t<10?"0"+t:t)+"-"+e;this.ui.month.append('<option value="'+t+'">'+t+"</option>")}),this)}),this);var t=e.getMonth()+1,a=(t<10?"0"+t:t)+"-"+e.getFullYear();this.ui.month.val(a);var l=[{name:"PROP",label:"Proposal",cell:"string",editable:!1},{name:"SHIPPINGNAME",label:"Shipment",cell:"string",editable:!1},{name:"DELIVERYAGENT_FLIGHTCODETIMESTAMP",label:"Created",cell:"string",editable:!1},{name:"DELIVERYAGENT_SHIPPINGDATE",label:"Shipped",cell:"string",editable:!1},{label:"Account",cell:i.TemplateCell,editable:!1,template:'<% if (TERMSACCEPTED == "1") { %>Facility<% } else { %><%-DELIVERYAGENT_AGENTCODE%><% } %>'},{name:"DELIVERYAGENT_FLIGHTCODE",label:"Flightcode",cell:"string",editable:!1},{name:"DELIVERYAGENT_PRODUCTCODE",label:"Product",cell:"string",editable:!1},{name:"DCOUNT",label:"Pieces",cell:"string",editable:!1},{name:"DELIVERYAGENT_BARCODE",label:"Piece Barcodes",cell:"string",editable:!1},{name:"WEIGHT",label:"Weight",cell:"string",editable:!1},{name:"DELIVERYAGENT_FLIGHTCODEPERSON",label:"Creator",cell:"string",editable:!1},{label:"Sender",cell:i.TemplateCell,editable:!1,template:"<%-GIVENNAME%> <%-FAMILYNAME%> <%-LABNAME%>"},{label:"Origin",cell:i.TemplateCell,editable:!1,template:"<%-CITY%> <%-POSTCODE%> <%-COUNTRY%>"}];app.mobile()&&n.each([2,3,5,6],(function(e){l[e].renderable=!1})),this.rshps.show(new s({collection:this.shipments,columns:l,filter:"s",tableClass:"shipments",backgrid:{row:o,emptyText:"No shipments found"}}))}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1097:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="filter filter-nohide">\n    <ul class="clearfix">\n        <li title="View Dewar Overview"><a href="/dewars/overview">Dewar Overview</a></li>\n        <li title="View Shipment Manifest" class="current"><a href="/shipments/manifest">Shipping Manifest</a></li>\n        <li title="Dewar Stats"><a href="/shipments/stats">Dewar Stats</a></li>\n    </ul>\n</div>\n\n<h1>Shipping Manifest</h1>\n<select name="month"></select><a href="'+(null==(__t=APIURL)?"":_.escape(__t))+'/pdf/manifest" class="button manifest"><i class="fa fa-print"></i> Print Shipping Manifest</a>\n<div class="shipments"></div>\n';return __p}},1098:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(1099),s(98),s(12),s(15),s(11),s(449),s(1100),s(1101),s(23),s(74)],void 0===(l=function(e,t,s,a,l,o,r,c,p){var h=t.extend({comparator:function(e){return-e.get("DEWARS")}});return e.LayoutView.extend({className:"content",template:p,regions:{rruns:".runs",rcts:".countries"},ui:{map:".map",years:".years",data:"input[name=data]",hist:"input[name=hist]"},events:{"change @ui.data":"refresh","change @ui.hist":"refresh"},refresh:function(){this.run.fetch(),this.countries.fetch()},getData:function(){return this.ui.data.is(":checked")?1:""},getHist:function(){return this.ui.hist.is(":checked")?1:""},addSpinnerRun:function(){this.ui.years.addClass("loading")},removeSpinnerRun:function(){this.ui.years.removeClass("loading")},addSpinnerCountry:function(){this.ui.map.addClass("loading")},removeSpinnerCountry:function(){this.ui.map.removeClass("loading")},initialize:function(){console.log(r),this.run=new t(null,{queryParams:{group_by:"year"}}),this.countries=new h(null,{queryParams:{group_by:"country"}}),this.countries.state.pageSize=25,this.listenTo(this.run,"request",this.addSpinnerRun),this.listenTo(this.run,"sync",this.removeSpinnerRun),this.listenTo(this.run,"error",this.removeSpinnerRun),this.listenTo(this.countries,"request",this.addSpinnerCountry),this.listenTo(this.countries,"sync",this.removeSpinnerCountry),this.listenTo(this.countries,"error",this.removeSpinnerCountry),this.run.queryParams.data=this.getData.bind(this),this.countries.queryParams.data=this.getData.bind(this),this.run.queryParams.history=this.getHist.bind(this),this.countries.queryParams.history=this.getHist.bind(this),this.runs=new s,this.listenTo(this.runs,"backgrid:selected",this.selectRun,this),this.ready=this.runs.fetch()},onRender:function(){this.refresh();var e=[{name:"YEAR",label:"Year",cell:"string",editable:!1},{name:"SHIPMENTS",label:"Shipments",cell:"integer",editable:!1},{name:"CTA",label:"Facility Shipping",cell:"integer",editable:!1},{name:"DEWARS",label:"Dewars",cell:"integer",editable:!1},{name:"CONTAINERS",label:"Containers",cell:"integer",editable:!1}];app.mobile()&&n.each([],(function(t){e[t].renderable=!1})),this.rruns.show(new a({collection:this.run,columns:e,filter:"s",tableClass:"runs",loading:!0,backgrid:{emptyText:"No dewar stats found"}}));var t=[{name:"COUNTRY",label:"Country",cell:"string",editable:!1}].concat(e.slice(1));this.rcts.show(new a({collection:this.countries,columns:t,filter:"s",tableClass:"countries",loading:!0,backgrid:{emptyText:"No dewar stats found"}})),this.listenTo(this.countries,"sync",this.plotMap),this.plotMap()},onShow:function(){this.listenTo(this.run,"sync",this.plotYears),this.plotMap()},plotYears:function(){var e=[],t=o.getColors(3),s=[{label:"Dewars",data:[],series:{bars:{show:!0},lines:{show:!1}},color:t[0]},{label:"Shipments",data:[],yaxis:2,color:t[1]},{label:"Facility Shipping",data:[],yaxis:2,color:t[2]}];this.run.fullCollection.each((function(t,n){e.push([this.run.fullCollection.length-n,t.get("YEAR")]),s[0].data.push([this.run.fullCollection.length-n,t.get("DEWARS")]),s[1].data.push([this.run.fullCollection.length-n,t.get("SHIPMENTS")]),s[2].data.push([this.run.fullCollection.length-n,t.get("CTA")])}),this);var n={xaxis:{ticks:e},grid:{borderWidth:0,hoverable:!0},tooltip:!0,yaxes:[{},{position:"right"}]};i.plot(this.ui.years,s,n)},plotMap:function(){var e=[];this.countries.fullCollection.each((function(t){t.get("CODE")&&e.push({code:t.get("CODE"),value:parseInt(t.get("DEWARS"))})}));var t=o.getColors(5),s=[];n.each(n.range(5),(function(e){s.push([.2*e,t[e]])})),r.mapChart({chart:{renderTo:this.ui.map[0],backgroundColor:"rgba(255, 255, 255, 0.0)",map:"custom/world"},title:{text:"Dewar breakdown by Country"},mapNavigation:{enabled:!0,buttonOptions:{verticalAlign:"bottom"}},colorAxis:{min:1,type:"logarithmic",stops:s},series:[{data:e,joinBy:["iso-a2","code"],states:{hover:{color:"#a4edba"}},dataLabels:{enabled:!0,format:"{point.properties.postal}"}}]})}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1099:function(e,t,s){var n,i;n=[s(10)],void 0===(i=function(e){return e.extend({mode:"client",url:"/vstat/dewars",state:{pageSize:15}})}.apply(t,n))||(e.exports=i)},1101:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="filter filter-nohide">\n    <ul class="clearfix">\n        <li title="View Dewar Overview"><a href="/dewars/overview">Dewar Overview</a></li>\n        <li title="View Shipment Manifest"><a href="/shipments/manifest">Shipping Manifest</a></li>\n        <li title="Dewar Stats" class="current"><a href="/shipments/stats">Dewar Stats</a></li>\n    </ul>\n</div>\n\n<div class="filter">\n    <ul>\n        <li><label><input type="checkbox" name="data" value="1" /> With Data</label></li>\n        <li><label><input type="checkbox" name="hist" value="1" /> With Dewar History (>1)</label></li>\n    </ul>\n</div>\n\n<div class="plot_container">\n\t<div id="avg_time" class="large years"></div>\n</div>\n<h1>By Year</h1>\n<div class="runs"></div>\n\n<div class="plot_container">\n\t<div id="avg_time" class="large map"></div>\n</div>\n<h1>By Country</h1>\n<div class="countries"></div>\n';return __p}},1102:function(e,t,s){(function(n,i){var a,l;a=[s(6),s(16),s(7),s(168),s(48),s(169),s(1103),s(12),s(20),s(1104),s(18)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h){var d=e.Model.extend({idAttribute:"SHIPPINGID",urlRoot:"/shipment/terms"}),u=DialogView.extend({template:n.template("<%=TERMS%>"),title:"Terms & Conditions",buttons:{Accept:"accept",Cancel:"closeDialog"},accept:function(){var e=this;this.model.set({ACCEPTED:1}),this.model.save(this.model.changedAttributes(),{patch:!0,success:function(){e.closeDialog()}})}}),m=e.Model.extend({validation:{DECLAREDVALUE:{required:!0,pattern:"number"},DESCRIPTION:{required:!0,pattern:"wwsdash"}}}),_=s.ItemView.extend({tagName:"li",template:n.template('<label><input type="checkbox" /> <% if (FACILITYCODE) { %><%-FACILITYCODE%><% } else { %><%-CODE%><% } %></label>'),events:{"click @ui.sel":"select"},ui:{sel:"input[type=checkbox]"},select:function(e){this.model.set("isSelected",this.ui.sel.is(":checked"))}}),f=s.CollectionView.extend({tagName:"ul",childView:_}),g=t.Cell.extend({render:function(){return this.$el.html('<input type="radio" name="value" value="'+this.model.escape("productcode")+'" />'),this}});return s.LayoutView.extend({className:"content",template:h,regions:{rdew:".DEWARS",qt:".quotes"},ui:{DESCRIPTION:"input[name=DESCRIPTION]",DECLAREDVALUE:"input[name=DECLAREDVALUE]",facc:"a.facc",uacc:"li.uacc",free:".free",weight:".WEIGHT",acc_msg:".acc_msg",submit:"button[name=submit]",quote:"button[name=quote]",qwrap:".qwrap",terms:".terms",termsq:".terms-quote"},events:{"click @ui.facc":"showTerms","click @ui.submit":"createAWB","click @ui.quote":"quoteAWB","change input":"validateField","blur input":"validateField","keyup input":"validateField"},templateHelpers:function(){var e={RETURN:this.getOption("return")};return n.each(this.shipment.attributes,(function(t,s){e[s]=t}),this),e},_lcFields:["PHONENUMBER","EMAILADDRESS","LABNAME","ADDRESS","CITY","POSTCODE","COUNTRY","GIVENNAME","FAMILYNAME"],toggleFacilityCourier:function(){app.options.get("facility_courier_countries").indexOf(this.lc.get("COUNTRY"))>-1||app.options.get("facility_courier_countries_nde").indexOf(this.lc.get("COUNTRY"))>-1?this.terms.get("ACCEPTED")?(this.$el.find(".DELIVERYAGENT_AGENTCODE").hide(),this.ui.acc_msg.text("Paid for by Facility"),this.ui.facc.hide(),this.ui.quote.hide(),this.ui.submit.show(),this.ui.termsq.hide(),this.ui.terms.show()):this.ui.facc.show():this.ui.facc.hide()},updateWeight:function(){var t=new e.Collection(this.dewars.where({isSelected:!0}));this.ui.weight.text(t.reduce((function(e,t){return e+parseFloat(t.get("WEIGHT"))}),0))},initialize:function(t){this.shipment=t.shipment,this.lc=new a({LABCONTACTID:this.shipment.get(this.getOption("return")?"RETURNLABCONTACTID":"SENDINGLABCONTACTID")}),this.listenTo(this.lc,"change:COUNTRY",this.toggleFacilityCourier),this.ready=[],this.ready.push(this.lc.fetch()),this.terms=new d({SHIPPINGID:this.shipment.get("SHIPPINGID")}),this.listenTo(this.terms,"change:ACCEPTED",this.toggleFacilityCourier),this.ready.push(this.terms.fetch()),this.dewars=new l,this.listenTo(this.dewars,"change:isSelected",this.updateWeight),this.dewars.queryParams.sid=this.shipment.get("SHIPPINGID"),this.ready.push(this.dewars.fetch()),this.countries=new o,this.countries.state.pageSize=9999,this.ready.push(this.countries.fetch()),this.quotes=new r,this.quotes.queryParams.sid=this.shipment.get("SHIPPINGID"),this.shipment.validation=JSON.parse(JSON.stringify(this.shipment.__proto__.validation)),this.shipment.validation.DELIVERYAGENT_SHIPPINGDATE.required=!0,this.shipment.validation.PHYSICALLOCATION.required=!0,this.shipment.validation.READYBYTIME.required=!0,this.shipment.validation.CLOSETIME.required=!0,this.lc.validation=JSON.parse(JSON.stringify(this.lc.__proto__.validation)),this.lc.validation.EMAILADDRESS.required=!0,this.awb=new m,this.setupValidation(this.shipment),this.setupValidation(this.lc),e.Validation.unbind(this),e.Validation.bind(this,{model:this.awb,selector:"name",valid:function(e,t){e.valid(e.$el.find('[name="'+t+'"]'))},invalid:function(e,t,s){e.invalid(e.$el.find('[name="'+t+'"]'),s)}})},invalid:function(e,t){"text"==i(e).prop("type")?i(e).addClass("ferror"):i(e).addClass("invalid"),i(e).siblings("span.errormessage").length?i(e).siblings("span.errormessage").text(t):i(e).after('<span class="errormessage ferror">'+t+"</span>")},valid:function(e){"text"==i(e).prop("type")?i(e).removeClass("ferror"):i(e).removeClass("invalid"),i(e).siblings("span.errormessage").remove()},setupValidation:function(t){e.Validation.bind(this,{model:t,selector:"name",valid:function(e,t){"FCODES[]"!=t&&e.valid(e.$el.find("."+t))},invalid:function(e,t,s){"FCODES[]"!=t&&e.invalid(e.$el.find("."+t),s)}})},validateField:function(e){var t=this.$el.find(e.target).attr("name"),s=this.$el.find(e.target).val(),n={};n[t]=s,this.awb.set(n,{silent:!0});var i=this.awb.preValidate(t,s);i?this.invalid(e.target,i):this.valid(e.target)},onRender:function(){this.ui.facc.hide(),this.ui.submit.hide(),this.ui.qwrap.hide(),this.ui.terms.hide(),(app.options.get("facility_courier_countries").length||app.options.get("facility_courier_countries_nde").length)&&this.ui.free.text("[Free For: "+app.options.get("facility_courier_countries").concat(app.options.get("facility_courier_countries_nde")).sort().join(", ")+"]"),this.ui.DESCRIPTION.val(app.options.get("package_description"));var e=new p({model:this.shipment,el:this.$el});e.create("DELIVERYAGENT_AGENTCODE","text"),e.create("DELIVERYAGENT_SHIPPINGDATE","date"),e.create("READYBYTIME","time"),e.create("CLOSETIME","time"),e.create("PHYSICALLOCATION","text"),this.awb.set({DECLAREDVALUE:this.ui.DECLAREDVALUE.val(),DESCRIPTION:this.ui.DESCRIPTION.val()}),this.rdew.show(new f({collection:this.dewars})),this.updateWeight();var t=[{label:"",cell:g,editable:!1},{name:"productname",label:"Product",cell:"string",editable:!1},{name:"deliverydate",label:"Delivery",cell:"string",editable:!1},{name:"deliverytime",label:"By",cell:"string",editable:!1},{name:"cutofftime",label:"Cut Off Time",cell:"string",editable:!1},{name:"bookingtime",label:"Booking Time",cell:"string",editable:!1},{name:"totalprice",label:"Price",cell:"string",editable:!1},{name:"currencycode",label:"",cell:"string",editable:!1}];this.qtable=new c({collection:this.quotes,columns:t,tableClass:"quote",loading:!0,noPageUrl:!0,noSearchUrl:!0,pages:!1,backgrid:{emptyText:"No quotes found"}}),this.qt.show(this.qtable),i.when.apply(i,this.ready).done(this.doOnRender.bind(this))},doOnRender:function(){this.populateLC();var e=new p({model:this.lc,el:this.$el});n.each(this._lcFields,(function(t){"COUNTRY"!=t&&e.create(t,"ADDRESS"==t?"textarea":"text")}),this),e.create("COUNTRY","select",{data:this.countries.kv()})},checkAvailability:function(){"dhl"==this.shipment.get("DELIVERYAGENT_AGENTNAME").toLowerCase()||app.options.get("facility_courier_countries").indexOf(this.lc.get("COUNTRY"))>-1||app.options.get("facility_courier_countries_nde").indexOf(this.lc.get("COUNTRY"))>-1||app.message({title:"Service Not Available",message:"This service is only available for shipments from "+app.options.get("facility_courier_countries").concat(app.options.get("facility_courier_countries_nde")).join(",")+", or for user with DHL accounts. Please either update your labcontact or the shipment courier"})},populateLC:function(){this.checkAvailability(),this.toggleFacilityCourier(),n.each(this._lcFields,(function(e){this.lc.get(e)&&this.$el.find("."+e).text(this.lc.get(e))}),this)},showTerms:function(){var e=new u({model:this.terms});this.listenTo(e,"terms:accepted",this.termsAccepted,this),this.terms.get("ACCEPTED")||app.dialog.show(e)},quoteAWB:function(){var e=this.checkValid();if(e){var t=this;this.ui.quote.prop("disabled",!0),this.quotes.queryParams.DEWARS=e,this.quotes.queryParams.DECLAREDVALUE=this.ui.DECLAREDVALUE.val(),this.quotes.fetch({success:function(){t.ui.submit.show(),t.selectQuote(),t.ui.quote.prop("disabled",!1)},error:function(e,s,n){var a;if(t.ui.quote.prop("disabled",!1),s.responseText)try{a=i.parseJSON(s.responseText)}catch(e){}app.alert({message:a.message})}}),t.ui.qwrap.slideDown()}},selectQuote:function(){this.$el.find("input[type=radio]").eq(0).prop("checked",!0)},checkValid:function(){var t=this.dewars.where({isSelected:!0}),s=new e.Collection(t).pluck("DEWARID");if(!s.length)return app.alert({message:"You must select at least one dewar to ship"}),void this.ui.submit.prop("disabled",!1);var n=!0;return this.lc.isValid(!0)||(n=!1),this.shipment.isValid(!0)||(n=!1),this.awb.isValid(!0)||(n=!1),!!n&&s},createAWB:function(){this.ui.submit.prop("disabled",!0);var t=this.checkValid();if(t){var s=null;if(-1==app.options.get("facility_courier_countries").indexOf(this.lc.get("COUNTRY"))&&-1==app.options.get("facility_courier_countries_nde").indexOf(this.lc.get("COUNTRY"))||!this.terms.get("ACCEPTED")){if(!(s=this.$el.find("input[type=radio]:checked").val()))return app.alert({message:"You must select a quote"}),void this.ui.submit.prop("disabled",!1);var n=this.quotes.findWhere({productcode:s});n&&(this.shipment.set({DELIVERYAGENT_DELIVERYDATE:n.get("deliverydate")}),this.shipment.save(this.shipment.changedAttributes(),{patch:!0}))}this.$el.addClass("loading"),app.alert({message:"Creating Airway Bill and Booking Pickup, Please Wait..."});var a=this;e.ajax({url:app.apiurl+"/shipment/awb/"+this.shipment.get("SHIPPINGID"),method:"POST",data:{DEWARS:t,DECLAREDVALUE:this.ui.DECLAREDVALUE.val(),DESCRIPTION:this.ui.DESCRIPTION.val(),PRODUCTCODE:s},success:function(e){app.alert({message:"Airway Bill Successfully Created"}),setTimeout((function(){app.trigger("shipment:show",a.shipment.get("SHIPPINGID"))}),1e3),a.$el.removeClass("loading")},error:function(e,t,s){var n;if(e.responseText)try{n=i.parseJSON(e.responseText)}catch(e){}app.alert({message:n.message}),a.ui.submit.prop("disabled",!1),a.$el.removeClass("loading")}})}else this.ui.submit.prop("disabled",!1)}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1103:function(e,t,s){var n,i;n=[s(10)],void 0===(i=function(e){return e.extend({mode:"client",url:"/shipment/awb/quote",state:{pageSize:9999}})}.apply(t,n))||(e.exports=i)},1104:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>Create Airway Bill: ",RETURN?__p+="From Facility":__p+="To Facility",__p+='</h1>\n\n<h2>Shipment Details</h2>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span class="SHIPPINGNAME">'+(null==(__t=SHIPPINGNAME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix">\n            <span class="label">Dewars</span>\n            <span class="DEWARS floated"></span>\n        </li>\n\n        <li>\n            <span class="label">Weight</span>\n            <span class="WEIGHT"></span> Kg\n        </li>\n\n        <li>\n            <span class="label">DHL Account Number</span>\n            <span class="DELIVERYAGENT_AGENTCODE">'+(null==(__t=DELIVERYAGENT_AGENTCODE)?"":_.escape(__t))+'</span> <a href="#" class="facc button"><i class="fa fa-envelope"></i> Use Facility Account</a> <span class="acc_msg"></span>\n        </li>\n\n        <li>\n            <span class="label">Declared Value</span>\n            <input type="text" name="DECLAREDVALUE" value="100" /> GBP\n        </li>\n\n        <li>\n            <span class="label">Package Description</span>\n            <input type="text" name="DESCRIPTION" class="full" />\n        </li>        \n    </ul>\n</div>\n\n<h2>Contact Details</h2>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Contact</span>\n            <span class="GIVENNAME"></span> <span class="FAMILYNAME"></span>\n        </li>\n        \n        <li>\n            <span class="label">Contact Phone Number</span>\n            <span class="PHONENUMBER"></span>\n        </li>\n        \n        <li>\n            <span class="label">Contact Email</span>\n            <span class="EMAILADDRESS"></span>\n        </li>\n    </ul>\n</div>\n        \n<h2>Laboratory Details</h2>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Laboratory Name</span>\n            <span class="LABNAME"></span>\n        </li>\n        \n        <li class="clearfix reorder">\n            <div class="ADDRESS text"></div>\n            <span class="label">Laboratory Address <br /><span class="small">(excluding post code)</span></span>\n        </li>\n        \n        <li>\n            <span class="label">Laboratory City</span>\n            <span class="CITY"></span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory Postcode</span>\n            <span class="POSTCODE"></span>\n        </li>\n\n        <li>\n            <span class="label">Laboratory Country</span>\n            <span class="COUNTRY"></span> <span class="free"></span>\n        </li>\n    </ul>\n</div>\n        \n<h2>Pickup Details</h2>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Package Location <br /> \n                <span class="small">Location where shipment can be picked up from</span>\n            </span>\n            <span class="PHYSICALLOCATION">'+(null==(__t=PHYSICALLOCATION)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Shipping Date</span>\n            <span class="DELIVERYAGENT_SHIPPINGDATE">'+(null==(__t=DELIVERYAGENT_SHIPPINGDATE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Ready By <br /> \n                <span class="small">Time shipment will be ready for pickup</span>\n            </span>\n            <span class="READYBYTIME">'+(null==(__t=READYBYTIME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Close Time <br /> \n                <span class="small">Time after which shipment cannot be picked up</span>\n            </span>\n            <span class="CLOSETIME">'+(null==(__t=CLOSETIME)?"":_.escape(__t))+'</span>\n        </li>\n    </ul>\n</div>\n\n<div class="qwrap">\n    <h2>Quotes</h2>\n    <div class="quotes"></div>\n</div>\n\n<div>\n    <h2>Terms &amp; Conditions</h2>\n    <p class="terms justify">\n    I understand that use of DHL’s services is entirely at my own risk and that Diamond makes no representations or warranties of any kind (express or implied) about the reliability or availability of the DHL service. Any reliance that I place on the DHL service is strictly at my own risk. It is my responsibility to ensure that samples arrive at Diamond in advance of any beamtime that Diamond may have awarded me and I hereby indemnify and hold Diamond harmless for any loss or damage arising out of my use of DHL’s services.</p>\n\n    <p class="terms-quote justify">I understand that use of DHL\'s services is entirely at my own risk and that Diamond makes no representations or warranties of any kind (express or implied)about the reliability or availability of the DHL service. Any reliance that I place on the DHL service is strictly at my own risk. It is my responsibility to ensure that I am authorised to use the DHL account that I provide to Diamond and to ensure that the samples arrive at Diamond in advance of any beamtime that Diamond may have awarded me. I hereby indemnify and hold Diamond harmless for any loss or damage arising out of my use of DHL’s services.</p>\n</div>\n\n<div class="form">\n    <button name="quote" value="1" type="submit" class="button submit">Get Quote</button>\n    <button name="submit" value="1" type="submit" class="button submit">Create Airway Bill</button>\n</div>\n';return __p}},1105:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(121),s(48),s(12),s(20),s(1106),s(6),s(18)],void 0===(l=function(e,t,s,a,l,o,r){return e.LayoutView.extend({className:"content",template:o,ui:{submit:"button[name=submit]",dews:".DEWARS"},events:{"click @ui.submit":"rebookPickup"},templateHelpers:function(){var e={RETURN:this.getOption("return")};return n.each(this.shipment.attributes,(function(t,s){e[s]=t}),this),e},initialize:function(e){this.shipment=e.shipment,this.dewars=new s,this.dewars.queryParams.sid=this.shipment.get("SHIPPINGID"),this.ready=[this.dewars.fetch()],this.shipment.validation=JSON.parse(JSON.stringify(this.shipment.__proto__.validation)),this.shipment.validation.DELIVERYAGENT_SHIPPINGDATE.required=!0,this.shipment.validation.PHYSICALLOCATION.required=!0,this.shipment.validation.READYBYTIME.required=!0,this.shipment.validation.CLOSETIME.required=!0,this.setupValidation(this.shipment)},invalid:function(e,t){"text"==i(e).prop("type")?i(e).addClass("ferror"):i(e).addClass("invalid"),i(e).siblings("span.errormessage").length?i(e).siblings("span.errormessage").text(t):i(e).after('<span class="errormessage ferror">'+t+"</span>")},valid:function(e){"text"==i(e).prop("type")?i(e).removeClass("ferror"):i(e).removeClass("invalid"),i(e).siblings("span.errormessage").remove()},setupValidation:function(e){r.Validation.bind(this,{model:e,selector:"name",valid:function(e,t){"FCODES[]"!=t&&e.valid(e.$el.find("."+t))},invalid:function(e,t,s){"FCODES[]"!=t&&e.invalid(e.$el.find("."+t),s)}})},onRender:function(){var e=new l({model:this.shipment,el:this.$el});e.create("DELIVERYAGENT_SHIPPINGDATE","date"),e.create("READYBYTIME","time"),e.create("CLOSETIME","time"),e.create("PHYSICALLOCATION","text"),i.when.apply(i,this.ready).done(this.doOnRender.bind(this))},doOnRender:function(){var e=this.dewars.filter((function(e){return e.get("DELIVERYAGENT_BARCODE")}));this.ui.dews.text(e.map((function(e){return e.get("CODE")})).join(", "))},rebookPickup:function(){if(this.ui.submit.prop("disabled",!0),this.shipment.isValid(!0)){this.$el.addClass("loading"),app.alert({message:"Rebooking Pickup, Please Wait..."});var e=this;r.ajax({url:app.apiurl+"/shipment/pickup/"+this.shipment.get("SHIPPINGID"),method:"POST",success:function(t){app.alert({message:"Pickup Successfully Booked"}),setTimeout((function(){app.trigger("shipment:show",e.shipment.get("SHIPPINGID"))}),1e3),e.$el.removeClass("loading")},error:function(t,s,n){var a;if(t.responseText)try{a=i.parseJSON(t.responseText)}catch(e){}app.alert({message:a.message}),e.ui.submit.prop("disabled",!1),e.$el.removeClass("loading")}})}else this.ui.submit.prop("disabled",!1)}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1106:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h1>Rebook Pickup: ",RETURN?__p+="From Facility":__p+="To Facility",__p+='</h1>\n\n<h2>Shipment Details</h2>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Shipment</span>\n            <span class="SHIPPINGNAME">'+(null==(__t=SHIPPINGNAME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li class="clearfix">\n            <span class="label">Dewars</span>\n            <span class="DEWARS"></span>\n        </li> \n    </ul>\n</div>\n        \n<h2>Pickup Details</h2>\n<div class="form">\n    <ul>\n        <li>\n            <span class="label">Package Location <br /> \n                <span class="small">Location where shipment can be picked up from</span>\n            </span>\n            <span class="PHYSICALLOCATION">'+(null==(__t=PHYSICALLOCATION)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Shipping Date</span>\n            <span class="DELIVERYAGENT_SHIPPINGDATE">'+(null==(__t=DELIVERYAGENT_SHIPPINGDATE)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Ready By <br /> \n                <span class="small">Time shipment will be ready for pickup</span>\n            </span>\n            <span class="READYBYTIME">'+(null==(__t=READYBYTIME)?"":_.escape(__t))+'</span>\n        </li>\n\n        <li>\n            <span class="label">Close Time <br /> \n                <span class="small">Time after which shipment cannot be picked up</span>\n            </span>\n            <span class="CLOSETIME">'+(null==(__t=CLOSETIME)?"":_.escape(__t))+'</span>\n        </li>\n    </ul>\n</div>\n\n\n<div>\n    <h2>Terms &amp; Conditions</h2>\n    <p class="terms justify">\n    I understand that use of DHL’s services is entirely at my own risk and that Diamond makes no representations or warranties of any kind (express or implied) about the reliability or availability of the DHL service. Any reliance that I place on the DHL service is strictly at my own risk. It is my responsibility to ensure that samples arrive at Diamond in advance of any beamtime that Diamond may have awarded me and I hereby indemnify and hold Diamond harmless for any loss or damage arising out of my use of DHL’s services.</p>\n</div>\n\n<div class="form">\n    <button name="submit" value="1" type="submit" class="button submit">Rebook Pickup</button>\n</div>\n';return __p}},1107:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(16),s(450),s(1108),s(40),s(452),s(1110),s(271),s(453),s(272),s(454),s(97),s(12),s(1111),s(15),s(1113),s(1114),s(1115),s(1116),s(1117),s(1118),s(1119)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d,u,m,_,f,g,E,b,v,I,A,T){var C=t.Cell.extend({events:{"click a.add":"addPlan"},addPlan:function(e){e.preventDefault();var t=this.column.get("datacollectionplans"),s=new o({BLSAMPLEID:this.model.get("BLSAMPLEID"),SAMPLE:this.model.get("NAME"),PROTEINID:this.model.get("PROTEINID"),PROTEIN:this.model.get("ACRONYM"),PLANORDER:t.length,ENERGY:76600,MONOBANDWIDTH:.1,PREFERREDBEAMSIZEX:70,PREFERREDBEAMSIZEY:70},{SCANPARAMETERSMODELS:this.column.get("scanmodels"),DETECTORS:this.column.get("dpdetectors")});s.save({},{success:function(){t.add(s)},error:function(){app.alert({message:"Something went wrong creating a data collection plan for that sample"})}})},render:function(){return this.$el.empty(),this.$el.html('<a href="#" class="button add"><i class="fa fa-plus"></i></a>'),this}}),N=t.Cell.extend({events:{"click a.delete":"delete"},delete:function(e){e.preventDefault(),this.model.destroy()},render:function(){return this.$el.empty(),this.$el.html('<a href="#" class="button delete"><i class="fa fa-times"></i></a>'),this}}),w=f.ValidatedTemplateCell.extend({events:n.extend({},f.ValidatedTemplateCell.prototype.events,{"click a.locked":"doUnlock","click a.unlocked":"doLock"}),initialize:function(e){w.__super__.initialize.call(this,e),this.listenTo(this.model,"row:collapse",this.doCollapse),this.listenTo(this.model,"row:expand",this.doExpand)},render:function(){return this.$el.empty(),this.bindModel(),this.doCollapse(),this},doCollapse:function(){this.$el.html(b(this.model.toJSON())),this.$el.find("a.locked").hide(),this.$el.find("p.warnusers").hide()},doExpand:function(){this.$el.find("a.locked").show(),this.$el.find("p.warnusers").show()},doUnlock:function(e){e.preventDefault(),this.$el.html(E(this.model.toJSON()))},doLock:function(e){e.preventDefault(),this.$el.html(b(this.model.toJSON()))}}),S=f.ValidatedTemplateCell.extend({render:function(){return this.$el.empty(),this.$el.html(v(this.model.toJSON())),this.bindModel(),this}}),R=t.Cell.extend({events:{"click a.moveup":"decrementSequence","click a.movedown":"incrementSequence"},incrementSequence:function(e){if(e.preventDefault(),this.model.get("SEQUENCENUMBER")<this.column.get("parameterscollection").length-1){var t=parseInt(this.model.get("SEQUENCENUMBER")),s=this.column.get("parameterscollection").findWhere({SEQUENCENUMBER:(t+1).toString()});this.model.set({SEQUENCENUMBER:(t+1).toString()}),s.set({SEQUENCENUMBER:t.toString()})}},decrementSequence:function(e){if(e.preventDefault(),this.model.get("SEQUENCENUMBER")>0){var t=parseInt(this.model.get("SEQUENCENUMBER")),s=this.column.get("parameterscollection").findWhere({SEQUENCENUMBER:(t-1).toString()});this.model.set({SEQUENCENUMBER:(t-1).toString()}),s.set({SEQUENCENUMBER:t.toString()})}},render:function(){return this.$el.html("<span>"+(parseInt(this.model.get("SEQUENCENUMBER"))+1)+'</span><a href="#" class="button movedown" title="Move later in the sequence"><i class="fa fa-chevron-down"></i></a><a href="#" class="button moveup" title="Move earlier in the sequence"><i class="fa fa-chevron-up"></i></a>'),this}}),O=t.Cell.extend({render:function(){return this.$el.empty(),this.$el.html(I(this.model.toJSON())),this}}),D=t.Cell.extend({template:n.template('<select name="services"></select><a href="#" class="button add"><i class="fa fa-plus"></i></a><div class="axes"></div><div class="axesstatic"></div>'),events:{"click a.add":"addAxis"},initialize:function(e){D.__super__.initialize.apply(this,[e]),this.listenTo(this.model,"row:collapse",this.doCollapse),this.listenTo(this.model,"row:expand",this.doExpand),this.listenTo(this.model.get("SCANPARAMETERSMODELS"),"change:SEQUENCENUMBER",this.saveOrder)},saveOrder:function(){console.log("seq saving order"),this.model.get("SCANPARAMETERSMODELS").each((function(e){var t=e.changedAttributes();Object.keys(t).length&&e.save(t,{patch:!0})}))},addAxis:function(e){e.preventDefault();var t=this.$el.find("select[name=services]").val(),s=this.column.get("scanservices").findWhere({SCANPARAMETERSSERVICEID:t}),n=new c({DATACOLLECTIONPLANID:this.model.get("DIFFRACTIONPLANID"),SCANPARAMETERSSERVICEID:t,SCANPARAMETERSSERVICE:s.get("NAME"),SEQUENCENUMBER:this.model.get("SCANPARAMETERSMODELS").length}),i=this;n.save({},{success:function(){console.log("saved axes",n,i.column.get("scanmodels")),i.column.get("scanmodels").add(n)},error:function(){app.alert({message:"Something went wrong adding an axis to that data collection plan"})}})},render:function(){var e=[{label:"Order",cell:R,editable:!1,parameterscollection:this.model.get("SCANPARAMETERSMODELS")},{label:"Axis",cell:f.TemplateCell,editable:!1,template:"<%-SCANPARAMETERSSERVICE%>"},{label:"Parameters",cell:S,editable:!1},{label:"",cell:N,editable:!1}];this.atable=new m({collection:this.model.get("SCANPARAMETERSMODELS"),columns:e,tableClass:"axes",loading:!1,pages:!1,backgrid:{emptyText:"No axes found"}});var t=[{label:"Order",cell:f.TemplateCell,editable:!1,template:"<%-parseInt(SEQUENCENUMBER)+1%>"},{label:"Axis",cell:f.TemplateCell,editable:!1,template:"<%-SCANPARAMETERSSERVICE%>"},{label:"Parameters",cell:O,editable:!1}];return this.stable=new m({collection:this.model.get("SCANPARAMETERSMODELS"),columns:t,tableClass:"axesstatic",loading:!1,pages:!1,backgrid:{emptyText:"No axes found"}}),this.$el.empty(),this.$el.html(this.template),this.$el.find(".axes").html(this.atable.render().$el),this.$el.find(".axesstatic").html(this.stable.render().$el),this.$el.find("select[name=services]").html(this.column.get("scanservices").opts()),this.doCollapse(),this},doCollapse:function(){this.$el.find("a.add").hide(),this.$el.find("select[name=services]").hide(),this.$el.find(".axes").hide(),this.$el.find(".axesstatic").show()},doExpand:function(){this.$el.find("a.add").show(),this.$el.find("select[name=services]").show(),this.$el.find(".axes").show(),this.$el.find(".axesstatic").hide()}}),y=f.ValidatedTemplateCell.extend({render:function(){return this.$el.empty(),this.$el.html(A(this.model.toJSON())),this.bindModel(),this}}),P=t.Cell.extend({render:function(){return this.$el.empty(),this.$el.html(T(this.model.toJSON())),this}}),x=t.Cell.extend({template:n.template('<select name="detectors"></select><a href="#" class="button add"><i class="fa fa-plus"></i></a><div class="detectors"></div><div class="detectorsstatic"></div>'),events:{"click a.add":"addDetector"},initialize:function(e){x.__super__.initialize.apply(this,[e]),this.listenTo(this.model,"row:collapse",this.doCollapse),this.listenTo(this.model,"row:expand",this.doExpand)},addDetector:function(e){e.preventDefault();var t=this.$el.find("select[name=detectors]").val(),s=this.column.get("detectors").findWhere({DETECTORID:t}),n=new h({DATACOLLECTIONPLANID:this.model.get("DIFFRACTIONPLANID"),DETECTORID:t,DETECTORTYPE:s.get("DETECTORTYPE"),DETECTORMANUFACTURER:s.get("DETECTORMANUFACTURER"),DETECTORMODEL:s.get("DETECTORMODEL")},{BEAMLINESETUPS:this.column.get("beamlinesetups")}),i=this;n.save({},{success:function(){i.column.get("dpdetectors").add(n)},error:function(){app.alert({message:"Something went wrong adding a detector to that data collection plan"})}})},render:function(){var e=[{label:"Detector",cell:f.TemplateCell,editable:!1,template:"<%-DETECTORTYPE%><br /><%-DETECTORMANUFACTURER%><br /><%-DETECTORMODEL%><br />"},{label:"Parameters",cell:y,editable:!1},{label:"",cell:N,editable:!1}];this.dtable=new m({collection:this.model.get("DETECTORS"),columns:e,tableClass:"detectors",loading:!1,pages:!1,backgrid:{emptyText:"No detectors found"}});var t=[{label:"Detector",cell:f.TemplateCell,editable:!1,template:"<%-DETECTORTYPE%><br /><%-DETECTORMANUFACTURER%><br /><%-DETECTORMODEL%><br />"},{label:"Parameters",cell:P,editable:!1}];return this.stable=new m({collection:this.model.get("DETECTORS"),columns:t,tableClass:"detectorsstatic",loading:!1,pages:!1,backgrid:{emptyText:"No detectors found"}}),this.$el.empty(),this.$el.html(this.template),this.$el.find(".detectors").html(this.dtable.render().$el),this.$el.find(".detectorsstatic").html(this.stable.render().$el),this.$el.find("select[name=detectors]").html(this.column.get("detectors").opts()),this.doCollapse(),this},doCollapse:function(){this.$el.find("a.add").hide(),this.$el.find("select[name=detectors]").hide(),this.$el.find(".detectorsstatic").show(),this.$el.find(".detectors").hide()},doExpand:function(){this.$el.find("a.add").show(),this.$el.find("select[name=detectors]").show(),this.$el.find(".detectorsstatic").hide(),this.$el.find(".detectors").show()}}),L=f.TemplateCell.extend({events:{"click a.collapsar":"toggleExpansion"},initialize:function(e){L.__super__.initialize.apply(this,[e]),this.collapsed=!0},toggleExpansion:function(e){e.preventDefault(),this.collapsed?(this.collapsed=!1,this.model.trigger("row:expand"),this.doExpand()):(this.collapsed=!0,this.model.trigger("row:collapse"),this.doCollapse())},doCollapse:function(){this.$el.find("i.expcol").removeClass("fa-chevron-down").addClass("fa-chevron-right")},doExpand:function(){this.$el.find("i.expcol").removeClass("fa-chevron-right").addClass("fa-chevron-down")}});return e.LayoutView.extend({className:"content",template:g,regions:{asmps:".asamples",psmps:".psamples"},initialize:function(e){this.samples=new l,this.samples.queryParams.cid=this.model.get("CONTAINERID"),this.samples.fetch(),this.ready=[],this.detectors=new s,this.detectors.queryParams.BEAMLINENAME=this.model.get("FIRSTEXPERIMENTBEAMLINE"),this.ready.push(this.detectors.fetch()),this.scanservices=new a,this.ready.push(this.scanservices.fetch()),this.scanmodels=new p(null,{state:{pageSize:9999}}),this.scanmodels.queryParams.CONTAINERID=this.model.get("CONTAINERID"),this.scanmodels.fetch(),this.beamlinesetups=new u,this.beamlinesetups.queryParams.BEAMLINENAME=this.model.get("FIRSTEXPERIMENTBEAMLINE"),this.beamlinesetups.queryParams.ACTIVE=1,this.ready.push(this.beamlinesetups.fetch()),this.datacollectionplandetectors=new d(null,{state:{pageSize:9999}}),this.datacollectionplandetectors.queryParams.CONTAINERID=this.model.get("CONTAINERID"),this.datacollectionplandetectors.fetch({BEAMLINESETUPS:this.beamlinesetups}),this.datacollectionplans=new r(null,{state:{pageSize:100}}),this.datacollectionplans.queryParams.CONTAINERID=this.model.get("CONTAINERID"),this.datacollectionplans.fetch({SCANPARAMETERSMODELS:this.scanmodels,DETECTORS:this.datacollectionplandetectors,BEAMLINESETUPS:this.beamlinesetups})},onRender:function(){i.when.apply(i,this.ready).done(this.doOnRender.bind(this))},doOnRender:function(){var e=[{label:"#",cell:f.TemplateCell,editable:!1,template:"<%-LOCATION%>"},{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"CRYSTAL",label:"Instance of",cell:"string",editable:!1},{label:"",cell:C,editable:!1,datacollectionplans:this.datacollectionplans,scanmodels:this.scanmodels,dpdetectors:this.datacollectionplandetectors}];this.table=new m({collection:this.samples,columns:e,tableClass:"asamples",loading:!0,backgrid:{emptyText:"No instances found"}}),this.asmps.show(this.table);e=[{label:"",cell:L,editable:!1,template:'<a class="button collapsar" href="#"><i class="expcol fa fa-chevron-right"></i></a>'},{label:"#",cell:f.TemplateCell,editable:!1,template:"<%-parseInt(PLANORDER)+1%>"},{label:"Instance",cell:f.TemplateCell,editable:!1,template:"<%-SAMPLE%>"},{label:"Axes",cell:D,editable:!1,scanservices:this.scanservices,scanmodels:this.scanmodels},{label:"Detectors",cell:x,editable:!1,detectors:this.detectors,dpdetectors:this.datacollectionplandetectors,beamlinesetups:this.beamlinesetups},{label:"Parameters",cell:w,editable:!1}];this.table2=new _({collection:this.datacollectionplans,columns:e,tableClass:"subsamples",loading:!0,backgrid:{emptyText:"No data collection plans found"}}),this.listenTo(this.datacollectionplans,"order:updated",this.saveOrder),this.psmps.show(this.table2)},saveOrder:function(){console.log("saving order"),this.datacollectionplans.each((function(e){var t=e.changedAttributes();Object.keys(t).length&&e.save(t,{patch:!0})}))}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1108:function(e,t,s){(function(n){var i,a;i=[s(10),s(1109),s(14)],void 0===(a=function(e,t,s){return e.extend(n.extend({},s,{model:t,mode:"client",url:"/exp/parameters/services",state:{pageSize:15},keyAttribute:"NAME",valueAttribute:"SCANPARAMETERSSERVICEID"}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1109:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"SCANPARAMETERSERVICEID",urlRoot:"/exp/parameters/services",validation:{NAME:{required:!0,pattern:"wwsdash"},DESCRIPTION:{required:!0}}})}.apply(t,n))||(e.exports=i)},1110:function(e,t,s){var n,i;n=[s(10),s(452)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:"/exp/plans",comparator:"PLANORDER",state:{pageSize:15},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},1111:function(e,t,s){(function(n){var i,a;i=[s(12),s(16),s(8),s(1112)],void 0===(a=function(e,t,s){var i=t.Row.extend({events:{drop:"drop"},drop:function(e,t){var s=this.model.collection,n=s.comparator;s.remove(this.model),s.each((function(e,s){var i=s;s>=t&&(i+=1);var a={};a[n]=i,e.set(a)}),this);var i={};i[n]=t,this.model.set(i),s.add(this.model,{at:t}),s.sort(),s.trigger("order:updated")}}),a=e.extend({backgrid:{row:i},initialize:function(e){e&&e.backgrid&&(this.options.backgrid=n.extend({},e.backgrid,this.options.backgrid)),a.__super__.initialize.call(this,e)},onRender:function(){a.__super__.onRender.call(this),this.table.$el.find("tbody").sortable({stop:function(e,t){t.item.trigger("drop",t.item.index())}})}});return a}.apply(t,i))||(e.exports=a)}).call(this,s(5))},1113:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Prepare Experiment Plans</h1>\n\n<p class="help">This pages allows you to define experiment plans for instances in a parcel</p>\n\n<div class="clearfix">\n    <div class="left">\n        <div class="form">\n            <ul>\n                <li>\n                    <span class="label">Stage</span>\n                    <span class="NAME">'+(null==(__t=NAME)?"":_.escape(__t))+'</span>\n                </li>\n\n                <li>\n                    <span class="label">Type</span>\n                    <span class="CONTAINERTYPE">'+(null==(__t=CONTAINERTYPE)?"":_.escape(__t))+'</span>\n                </li>\n            </ul>\n        </div>\n    </div>\n    <div class="right">\n        <h2>Available Instances</h2>\n        <div class="asamples"></div>\n    </div>\n</div>\n\n<h2>Instances with Experimental Plans</h2>\n<div class="filter filter-nohide qfilt"></div>\n<div class="psamples"></div>\n';return __p}},1114:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#" class="unlocked button"><i class="fa fa-unlock"></i></a>\n<p class="warnusers">Please consult beamline staff before editing these parameters</p>\n<table>\n    <tr>\n        <td class="renderable">Monochromator Bandwidth</td>\n        <td class="renderable"><input type="text" name="MONOBANDWIDTH" value="'+(null==(__t=MONOBANDWIDTH)?"":_.escape(__t))+'" /> %</td>\n    </tr>\n    <tr>\n        <td class="renderable">Energy</td>\n        <td class="renderable"><input type="text" name="ENERGY" value="'+(null==(__t=ENERGY)?"":_.escape(__t))+'" /> eV</td>\n    </tr>\n    <tr class="">\n        <td class="renderable">Beamsize</td>\n        <td class="renderable"><input type="text" name="PREFERREDBEAMSIZEX" value="'+(null==(__t=PREFERREDBEAMSIZEX)?"":_.escape(__t))+'" /> x <input type="text" name="PREFERREDBEAMSIZEY"  value="'+(null==(__t=PREFERREDBEAMSIZEY)?"":_.escape(__t))+'" /> &micro;m</td>\n    </tr>\n</table>\n';return __p}},1115:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#" class="locked button"><i class="fa fa-lock"></i></a>\n<p class="warnusers">Please consult beamline staff before editing these parameters</p>\n<table>\n\t<tr>\n\t\t<td class="renderable">Monochromator Bandwidth: </td><td class="renderable"><span class="MONOBANDWIDTH">'+(null==(__t=MONOBANDWIDTH)?"":_.escape(__t))+'</span></td><td class="renderable"> %</td>\n\t</tr>\n\t<tr>\n\t\t<td class="renderable">Energy: </td><td class="renderable"><span class="KEVENERGY">'+(null==(__t=KEVENERGY)?"":_.escape(__t))+'</span></td><td class="renderable"> keV</td>\n\t</tr>\n\t<tr>\n\t\t<td class="renderable">Beamsize: </td><td class="renderable"><span class="PREFERREDBEAMSIZEX">'+(null==(__t=PREFERREDBEAMSIZEX)?"":_.escape(__t))+'</span>×<span class="PREFERREDBEAMSIZEY">'+(null==(__t=PREFERREDBEAMSIZEY)?"":_.escape(__t))+'</span></td><td class="renderable"> &micro;m</td>\n\t</tr>\n</table>';return __p}},1116:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table>\n    <tr>\n        <td class="renderable">Start</td>\n        <td class="renderable"><input type="text" name="START" value="'+(null==(__t=START)?"":_.escape(__t))+'" /></td>\n    </tr>\n    <tr>\n        <td class="renderable">Stop</td>\n        <td class="renderable"><input type="text" name="STOP" value="'+(null==(__t=STOP)?"":_.escape(__t))+'" /></td>\n    </tr>\n    <tr>\n        <td class="renderable">Step</td>\n        <td class="renderable"><input type="text" name="STEP" value="'+(null==(__t=STEP)?"":_.escape(__t))+'" /></td>\n    </tr>\n    <tr>\n        <td class="renderable">Array</td>\n        <td class="renderable"><input type="text" name="ARRAY" value="'+(null==(__t=ARRAY)?"":_.escape(__t))+'" /></td>\n    </tr>\n</table>\n';return __p}},1117:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table>\n\t<tr>\n\t\t<td class="renderable">Start : Stop : Step</td>\n\t\t<td class="renderable"><span class="START">'+(null==(__t=START)?"":_.escape(__t))+'</span></td><td class="renderable">:</td>\n\t\t<td class="renderable"><span class="STOP">'+(null==(__t=STOP)?"":_.escape(__t))+'</span></td><td class="renderable">:</td>\n\t\t<td class="renderable"><span class="STEP">'+(null==(__t=STEP)?"":_.escape(__t))+'</span></td>\n\t</tr>\n    <tr>\n\t\t<td class="renderable">Array</td>\n\t\t<td class="renderable"><span class="ARRAY">'+(null==(__t=ARRAY)?"":_.escape(__t))+"</span></td>\n    </tr>\n</table>\n";return __p}},1118:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table>\n    <tr>\n        <td class="renderable">Exposure Time</td>\n        <td class="renderable"><input type="text" name="EXPOSURETIME" value="'+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+'" /> s</td>\n    </tr>\n    <tr>\n        <td class="renderable">Distance</td>\n        <td class="renderable"><input type="text" name="DISTANCE" value="'+(null==(__t=DISTANCE)?"":_.escape(__t))+'" /> mm</td>\n    </tr>\n    <tr class="">\n        <td class="renderable">Roll</td>\n        <td class="renderable"><input type="text" name="ROLL" value="'+(null==(__t=ROLL)?"":_.escape(__t))+'" />\n    </tr>\n</table>\n';return __p}},1119:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<table>\n\t<tr>\n\t\t<td class="renderable">Exposure Time</td>\n\t\t<td class="renderable"><span class="EXPOSURESTIME">'+(null==(__t=EXPOSURETIME)?"":_.escape(__t))+'</span></td><td class="renderable"> s</td>\n\t</tr>\n\t<tr>\n\t\t<td class="renderable">Distance</td>\n\t\t<td class="renderable"><span class="DISTANCE">'+(null==(__t=DISTANCE)?"":_.escape(__t))+'</span></td><td class="renderable"> mm</td>\n\t</tr>\n\t<tr class="">\n\t\t<td class="renderable">Roll</td>\n\t\t<td class="renderable"><span class="ROLL">'+(null==(__t=ROLL)?"":_.escape(__t))+"</span></td><td class=renderable> °</td>\n\t</tr>\n</table>";return __p}},1120:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(83),s(60),s(91),s(12),s(1121)],void 0===(l=function(e,t,s,a,l,o){return e.LayoutView.extend({template:o,className:"content",templateHelpers:function(){var e=app.options.get("valid_components");return{proposal:app.prop,CAN_MIGRATE_PROTEINS:!e}},regions:{rprots:".rproteins",rconts:".rcontacts"},events:{"change @ui.lc":"displayLabContact","click button[name=lc]":"migrateContact","click button[name=protein]":"migrateProtein"},ui:{prop:"input[name=PROPOSAL]",lc:"select[name=LABCONTACT]",olc:"select[name=OLABCONTACT]",prot:"select[name=PROTEIN]",ti:".TITLE",st:".START",cn:".CARDNAME",ln:".LABNAME",ad:".ADDRESS",ncn:".NCARDNAME",nln:".NLABNAME",nad:".NADDRESS"},migrateContact:function(){var e=this.contacts.where({isGridSelected:!0});if(this.ui.prop.val())if(e.length){var t=[];n.each(e,(function(e){var s=e.clone();s.set({LABCONTACTID:null,prop:this.ui.prop.val()}),t.push(s.save())}),this);var s=this;i.when.apply(i,t).done((function(){app.alert({message:"Lab Contact(s) copied to: "+s.ui.prop.val()})}))}else app.alert({message:"You must select at least one contact to copy"});else app.alert({message:"You must select a proposal to migrate to"})},migrateProtein:function(){var e=[],t=this.proteins.where({isGridSelected:!0});if(this.ui.prop.val())if(t.length){n.each(t,(function(t){var s=t.clone();s.set({PROTEINID:null,prop:this.ui.prop.val()}),e.push(s.save())}),this);var s=this;i.when.apply(i,e).done((function(){app.alert({message:"Protein(s) copied to: "+s.ui.prop.val()})}))}else app.alert({message:"You must select at least one protein to copy"});else app.alert({message:"You must select a proposal to migrate to"})},reset:function(){this.ui.prop.val(""),this.ui.lc.html("").val(""),this.displayLabContact(),this.displayProposal()},initialize:function(e){this.proposals=new t,this.ready=this.proposals.fetch(),this.labcontacts=new s([],{state:{pageSize:9999}}),this.contacts=new s,this.listenTo(this.contacts,"backgrid:selected",this.selectModel,this),this.contacts.fetch(),this.proteins=new a,this.listenTo(this.proteins,"backgrid:selected",this.selectModel,this),this.proteins.queryParams.seq=1,this.proteins.fetch()},selectModel:function(e,t){e.set({isGridSelected:t})},updateLabContacts:function(){this.ui.lc.html(this.labcontacts.opts()),this.displayLabContact()},displayLabContact:function(){var e=this.labcontacts.findWhere({LABCONTACTID:this.ui.lc.val()});e?(this.ui.ncn.text(e.get("CARDNAME")),this.ui.nln.text(e.get("LABNAME")),this.ui.nad.text(e.get("ADDRESS"))):(this.ui.ncn.text(""),this.ui.nln.text(""),this.ui.nad.text(""))},displayProposal:function(){var e=this.proposals.findWhere({PROPOSAL:this.ui.prop.val()});e?(this.ui.ti.text(e.get("TITLE")),this.ui.st.text(e.get("ST"))):(this.ui.ti.text(""),this.ui.st.text(""))},getProposals:function(e,t){this.proposals.queryParams.s=e.term;var s=this;this.proposals.fetch().done((function(){t(s.proposals.map((function(e){return{label:e.get("PROPOSAL")+": "+e.get("TITLE"),value:e.get("PROPOSAL")}})))}))},selectProposal:function(e,t){this.labcontacts.queryParams.prop=t.item.value,this.labcontacts.fetch(),this.ui.prop.val(t.item.value),this.displayProposal()},onRender:function(){this.listenTo(this.labcontacts,"sync",this.updateLabContacts),this.updateLabContacts(),this.ui.prop.autocomplete({source:this.getProposals.bind(this),select:this.selectProposal.bind(this)});var e=[{label:"",cell:"select-row",headerCell:"select-all",editable:!1},{name:"NAME",label:"Name",cell:"string",editable:!1},{name:"ACRONYM",label:"Acronym",cell:"string",editable:!1},{name:"MOLECULARMASS",label:"Mass",cell:"string",editable:!1},{name:"HASSEQ",label:"Sequence",cell:"string",editable:!1},{name:"PDBS",label:"PDBs",cell:"string",editable:!1},{name:"SCOUNT",label:"Samples",cell:"string",editable:!1},{name:"DCOUNT",label:"Data Collections",cell:"string",editable:!1}];app.options.get("valid_components")||this.rprots.show(new l({collection:this.proteins,columns:e,tableClass:"proteins",filter:"s",loading:!0,noSearchUrl:!1,backgrid:{emptyText:"No proteins found"}}));e=[{label:"",cell:"select-row",headerCell:"select-all",editable:!1},{name:"CARDNAME",label:"Card Name",cell:"string",editable:!1},{name:"GIVENNAME",label:"First Name",cell:"string",editable:!1},{name:"FAMILYNAME",label:"Surname",cell:"string",editable:!1},{name:"ADDRESS",label:"Address",cell:"string",editable:!1},{name:"CITY",label:"City",cell:"string",editable:!1},{name:"POSTCODE",label:"Postcode",cell:"string",editable:!1},{name:"COUNTRY",label:"Country",cell:"string",editable:!1},{name:"PHONENUMBER",label:"Phone No.",cell:"string",editable:!1},{name:"LABNAME",label:"Laboratory",cell:"string",editable:!1}];this.rconts.show(new l({collection:this.contacts,columns:e,tableClass:"labcontacts",filter:"s",loading:!0,noSearchUrl:!1,backgrid:{emptyText:"No lab contacts found"}}))}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},1121:function(module,exports,__webpack_require__){var _=__webpack_require__(5);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<h1>Proposal Migration</h1>\n<p class="help">Here you can migrate various information from one proposal to a new one</p>\n<p class="help">Registered Dewars can now belong to multiple proposals so there is no need to migrate dewars. Ask your local contact to enable a registered dewar for your proposal</p>\n\n<h2>You are migrating from <span>'+(null==(__t=proposal)?"":__t)+'</span></h2>\n\n<div class="form">\n    <ul>\n\n        <li>\n            <label>New Proposal</label>\n            <input type="text" name="PROPOSAL" />\n        </li>\n\n        <li class="clearfix">\n            <label>Proposal Details</label>\n            <div class="floated">\n            \t<p>Title: <span class="TITLE"></span></p>\n            \t<p>Start: <span class="START"></span></p>\n            </div>\n        </li>\n\n    </ul>\n</div>\n\n<h2>Lab Contacts</h2>\n<div class="rcontacts"></div>\n<div class="form">\n\t<button name="lc" value="1" class="button submit">Copy Lab Contact(s)</button>\n</div>\n\n',CAN_MIGRATE_PROTEINS&&(__p+='\n<h2>Proteins</h2>\n<div class="rproteins"></div>\n<div class="form">\n\t<button name="protein" value="1" class="button submit">Copy Protein(s)</button>\n</div>\n'),__p+="\n";return __p}},171:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){var t=e.Model.extend({idAttribute:"FACILITYCODE",urlRoot:"/shipment/dewars/registry",_fcCache:{},defaults:{new:!1},validation:{FACILITYCODE:{required:!0,fn:"validateFacilityCode"},NEWFACILITYCODE:{required:!1,fn:"validateFacilityCode"},PURCHASEDATE:{required:!1,pattern:"edate"}},validateFacilityCode:function(s,n,i){if(!e.Validation.patterns.fcode.test(s))return e.Validation.messages.fcode;if(this.get("new")){if(!(s in this._fcCache)){var a=this,l=new t({FACILITYCODE:s});l.fetch({data:{all:1},async:!1,success:function(){a._fcCache[s]=l.get("PROP")},failure:function(){a._fcCache[s]=!1}})}if(this._fcCache[s])return"That facility code is already registered to "+this._fcCache[s]}}});return t}.apply(t,n))||(e.exports=i)},172:function(e,t,s){var n,i;n=[s(10),s(1044)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:function(){return"/shipment/dewars/history"+(this.id?"/did/"+this.id:"")},initialize:function(e,t){t&&(this.id=t.id)},state:{pageSize:15},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},256:function(e,t,s){(function(n){var i,a;i=[s(7),s(6),s(71),s(57),s(40),s(257),s(258),s(259),s(261),s(95),s(96),s(425),s(12),s(11),s(124),s(20),s(1010)],void 0===(a=function(e,t,s,i,a,l,o,r,c,p,h,d,u,m,_,f,g){return e.LayoutView.extend({className:"content",template:g,samplesCollection:a,regions:{table:".sample",puck:".puck",hist:".history"},ui:{ext:".extrainfo",auto:".auto",extrastate:".extra-state"},events:{"click @ui.ext":"toggleExtra","click a.queue":"confirmQueueContainer","click a.unqueue":"confirmUnqueueContainer"},toggleExtra:function(e){e.preventDefault(),this.table.currentView.toggleExtra(),this.table.currentView.extraState()?this.ui.extrastate.addClass("fa-minus").removeClass("fa-plus"):this.ui.extrastate.addClass("fa-plus").removeClass("fa-minus")},createSamples:function(){this.samples=new a(null,{state:{pageSize:9999}})},initialize:function(e){var a=this;this.createSamples(),this.samples.queryParams.cid=e.model.get("CONTAINERID"),this._ready=this.samples.fetch({data:{sort_by:"POSITION"}}).done((function(){console.log("samples");var t=n.map(n.range(1,parseInt(a.model.get("CAPACITY"))+1),(function(e){return e.toString()})),s=n.difference(t,a.samples.pluck("LOCATION"));n.each(s,(function(t){a.samples.add(new i({LOCATION:t.toString(),CRYSTALID:-1,PROTEINID:-1,CONTAINERID:e.model.get("CONTAINERID"),new:!0}))}))})),this.proteins=new s,app.options.get("valid_components")&&!app.staff&&(this.proteins.queryParams.external=1),this.proteins.fetch(),this.containerregistry=new r(null,{state:{pageSize:9999}}),this.history=new c,this.history.queryParams.cid=this.model.get("CONTAINERID"),this.history.fetch(),this.processing_pipelines=new d,t.Validation.bind(this)},onRender:function(){var e=new f({model:this.model,el:this.$el});e.create("NAME","text"),e.create("COMMENTS","text"),e.create("EXPERIMENTTYPE","select",{data:{"":"-",robot:"robot",HPLC:"HPLC"}}),e.create("STORAGETEMPERATURE","select",{data:{"-80":"-80",4:"4",25:"25"}}),e.create("BARCODE","text"),this.edit=e;var t=this;this.processing_pipelines.queryParams.pipelinestatus="optional",this.processing_pipelines.queryParams.category="processing",this.processing_pipelines.fetch().done((function(){var s=t.processing_pipelines.kv();s[""]="-",e.create("PROCESSINGPIPELINEID","select",{data:s})}));this.histtable=new u({collection:this.history,columns:[{name:"BLTIMESTAMP",label:"Date",cell:"string",editable:!1},{name:"STATUS",label:"Status",cell:"string",editable:!1},{name:"LOCATION",label:"Location",cell:"string",editable:!1},{name:"BEAMLINENAME",label:"Beamline",cell:"string",editable:!1}],tableClass:"history",loading:!0,pages:!0,backgrid:{emptyText:"No history found"}}),this.hist.show(this.histtable),this.updateAutoCollection()},updateAutoCollection:function(){this.model.get("CONTAINERQUEUEID")?(this.ui.auto.html("This container was queued for auto collection on "+this.model.escape("QUEUEDTIMESTAMP")),this.ui.auto.append(' <a href="#" class="button unqueue"><i class="fa fa-times"></i> Unqueue</a>')):this.ui.auto.html('<a href="#" class="button queue"><i class="fa fa-plus"></i> Queue</a> this container for Auto Collect')},confirmQueueContainer:function(e){e.preventDefault(),m.confirm({title:"Queue Container?",content:"Are you sure you want to queue this container for auto collection?",callback:this.doQueueContainer.bind(this)})},doQueueContainer:function(e){var s=this;t.ajax({url:app.apiurl+"/shipment/containers/queue",data:{CONTAINERID:this.model.get("CONTAINERID")},success:function(e){app.alert({message:"Container Successfully Queued"}),s.model.set({CONTAINERQUEUEID:e.CONTAINERQUEUEID,QUEUEDTIMESTAMP:_.default(new Date,"dd-MM-yyyy HH:mm")}),s.updateAutoCollection(),s.sampletable.toggleAuto(!0)},error:function(e){app.alert({message:"Something went wrong queuing this container"})}})},confirmUnqueueContainer:function(e){e.preventDefault(),m.confirm({title:"Unqueue Container?",content:"Are you sure you want to remove this container from the queue? You will loose your current place",callback:this.doUnqueueContainer.bind(this)})},doUnqueueContainer:function(e){var s=this;t.ajax({url:app.apiurl+"/shipment/containers/queue",data:{CONTAINERID:this.model.get("CONTAINERID"),UNQUEUE:1},success:function(e){app.alert({message:"Container Successfully Unqueued"}),s.model.set("CONTAINERQUEUEID",null),s.updateAutoCollection(),s.sampletable.toggleAuto(!1)},error:function(e){app.alert({message:"Something went wrong unqueuing this container"})}})},onShow:function(){this._ready.done(this.doOnShow.bind(this))},doOnShow:function(){var e=this,t=0==n.reduce(this.samples.pluck("HASDATA"),(function(e,t){return e+t?1:0}),0);"processing"==this.model.get("CONTAINERSTATUS")||!t&&this.model.get("CONTAINERREGISTRYID")||this.containerregistry.fetch().done((function(){var t=e.containerregistry.kv();t[""]="-",e.edit.create("CONTAINERREGISTRYID","select",{data:t})}));var s="PCRStrip"==this.model.get("CONTAINERTYPE")?"non-xtal":"";"PCRStrip"==this.model.get("CONTAINERTYPE")?(this.$el.find(".puck").css("width","50%"),this.platetypes=new p,this.type=this.platetypes.findWhere({name:this.model.get("CONTAINERTYPE")}),this.puck.show(new h({collection:this.samples,type:this.type}))):this.puck.show(new l({collection:this.samples})),this.sampletable=new o({proteins:this.proteins,collection:this.samples,in_use:"processing"===this.model.get("CONTAINERSTATUS"),type:s,auto:!!this.model.get("CONTAINERQUEUEID")}),this.table.show(this.sampletable)}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},257:function(e,t,s){(function(n){var i,a;i=[s(7),s(11),s(148),s(8),s(6),s(18)],void 0===(a=function(e,t,s,i,a){return e.ItemView.extend(n.extend({},s,a.Validation.mixin,{tagName:"canvas",template:!1,collectionEvents:{"sync reset change add delete":"onRender"},centres:[[150,100],[101,136],[120,193],[180,192],[198,135],[150,40],[90,59],[49,105],[40,168],[65,224],[119,256],[181,257],[234,224],[259,167],[251,105],[210,59]],events:{click:"selectPosition",mousemove:"hoverPosition"},initialize:function(e){var t=this;this.hover=null,this.selected=null,this.puck=new Image,this.puck.src=app.appurl+"/assets/images/puck.png",this.puck.onload=function(){t._draw(),console.log("puck loaded")},this.on("sample:selected",this.sampleSelected,this),this.on("sample:hover",this.sampleHover,this)},sampleSelected:function(e){this.selected=e,this._draw()},sampleHover:function(e){this.hover=e,this._draw()},onDomRefresh:function(){this.setup(),this.canvas.width=this.$el.parent().width(),this.canvas.height=this.$el.parent().width(),this.scale=this.canvas.width/300,this._draw()},onRender:function(){console.log("render puck"),this.ctx&&this._draw()},selectPosition:function(e){var s=t.get_xy(e,this.$el);this.selected=this._get_position(s),this.trigger("sample:selected",this.selected);var n=this.collection.findWhere({LOCATION:(this.selected+1).toString()});n&&n.set("isSelected",!0),this._draw()},hoverPosition:function(e){var s=t.get_xy(e,this.$el);this.hover=this._get_position(s),this.trigger("sample:hover",this.hover),this._draw()},_get_position:function(e){var t=null;return n.each(this.centres,(function(s,n){var i=30*this.scale,a=s[0]*this.scale-i,l=s[0]*this.scale+i,o=s[1]*this.scale-i,r=s[1]*this.scale+i;e[0]<l&&e[0]>a&&e[1]<r&&e[1]>o&&(t=n)}),this),t},_draw_positions:function(){n.each(n.range(16),(function(e){var t=this.collection.findWhere({LOCATION:(e+1).toString()});t&&t.get("PROTEINID")>-1&&this.circle(this.centres[e][0]*this.scale,this.centres[e][1]*this.scale,28*this.scale,t.isValid(!0)?"#82d180":"#f26c4f"),e==this.selected&&this.circle(this.centres[e][0]*this.scale,this.centres[e][1]*this.scale,23*this.scale,"grey",!0)}),this),null!==this.hover&&this.circle(this.centres[this.hover][0]*this.scale,this.centres[this.hover][1]*this.scale,23*this.scale,"grey",!0)},_draw:function(){console.log("draw puck"),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._draw_positions(),this.ctx.drawImage(this.puck,0,0,this.canvas.width,this.canvas.height)}}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},258:function(e,t,s){(function(n){var i,a;i=[s(7),s(46),s(91),s(49),s(71),s(238),s(1004),s(1005),s(1006),s(128),s(190),s(191),s(302),s(192),s(193),s(11),s(186),s(8)],void 0===(a=function(e,t,s,i,a,l,o,r,c,p,h,d,u,m,_,f,g,E){var b=i.extend(n.extend({},p,{rowTemplate:r,editTemplate:c,tagName:"tr",events:{"click a.edit":"editSample","click a.cancel":"cancelEditSample","click a.clone":"cloneSample","click a.clear":"clearSample"},ui:{comp:"input[name=COMPONENTID]",comps:"td.components",symbol:"span.SYMBOL"},modelEvents:{"change:isSelected":"setSelected",cloned:"render"},setSelected:function(e){console.log("seleted",this.model.get("isSelected")),this.$el.parent().find("tr").removeClass("selected"),this.$el.addClass("selected")},className:function(){if(this.model.get("isSelected"))return"selected"},editSample:function(e){this.editing=!0,e.preventDefault(),this.template=this.getOption("editTemplate"),this.render(),this.updateProteins()},cancelEditSample:function(e){this.editing=!1,e.preventDefault(),this.template=this.getOption("rowTemplate"),this.render()},setData:function(){var e={};n.each(["CODE","PROTEINID","CRYSTALID","NAME","COMMENTS","SPACEGROUP","VOLUME","ABUNDANCE","PACKINGFRACTION","LOOPTYPE","CENTRINGMETHOD","EXPERIMENTKIND","ENERGY","RADIATIONSENSITIVITY","USERPATH"],(function(t){var s=this.$el.find("[name="+t+"]");s.length&&(e[t]="checkbox"==s.attr("type")?s.is(":checked")?1:null:s.val())}),this),e.COMPONENTIDS=this.model.get("components").pluck("PROTEINID"),e.COMPONENTAMOUNTS=this.model.get("components").pluck("ABUNDANCE"),this.model.set(e),console.log("set data",e)},success:function(e,t,s){var n=this.proteins.findWhere({PROTEINID:this.model.get("PROTEINID")});n&&(this.model.set("ACRONYM",n.get("ACRONYM")),this.model.set("SYMBOL",n.get("CONCENTRATIONTYPE"))),this.model.set("new",!1),this.editing=!1,this.template=this.getOption("rowTemplate"),this.render()},cloneSample:function(e){if(e&&e.preventDefault(),this.model.get("NAME")){var t=this.model,s=this.model.collection.filter((function(e){return parseInt(e.get("LOCATION"))>parseInt(t.get("LOCATION"))&&!e.get("NAME")}));if(s.length){var n=this.model.clone();n.get("components").reset(this.model.get("components").toJSON());s[0];var i=this.model.get("NAME").replace(/\d+$/,""),a=new RegExp(i),l=this.model.collection.filter((function(e){return e.get("NAME").match(a)})),o=[];l.length&&(o=l[l.length-1].get("NAME").match(/\d+$/)||0);var r=o.length>0?o[0].length:0;o=o.length>0?parseInt(o[0]):1,n.set("NAME",i+(o+1).toString().padStart(r,"0")),n.set("LOCATION",s[0].get("LOCATION")),s[0].attributes=n.attributes,s[0].trigger("change").trigger("cloned"),this.triggerMethod("cloned")}}else this.triggerMethod("clone:stop")},clearSample:function(e){e.preventDefault(),this.model.set({PROTEINID:-1,NAME:"",CODE:"",SPACEGROUP:"",COMMENTS:"",ABUNDANCE:"",SYMBOL:"",CELL_A:"",CELL_B:"",CELL_C:"",CELL_ALPHA:"",CELL_BETA:"",CELL_GAMMA:"",REQUIREDRESOLUTION:"",ANOM_NO:"",ANOMALOUSSCATTERER:"",CRYSTALID:-1,PACKINGFRACTION:"",LOOPTYPE:"",DIMENSION1:"",DIMENSION2:"",DIMENSION3:"",SHAPE:"",CENTRINGMETHOD:"",EXPERIMENTKIND:"",ENERGY:"",RADIATIONSENSITIVITY:"",USERPATH:""}),this.model.get("components").reset(),this.render()},initialize:function(e){b.__super__.initialize.apply(this,e),this.template=this.getOption("rowTemplate"),e&&e.proteins?this.proteins=e.proteins:(this.proteins=new a,this.proteins.fetch()),e&&e.gproteins?this.gproteins=e.gproteins:this.gproteins=new a,this.listenTo(this.proteins,"reset add change",this.updateProteins,this);var t="";n.each(["R","SC","AI","DC","AP"],(function(e){this.model.get(e)>0&&(t=e)}),this),this.model.set({STATUS:t})},selectProtein:function(e){this.validateField.apply(this,arguments);var t=this.proteins.findWhere({PROTEINID:this.$el.find("select[name=PROTEINID]").combobox("value")});console.log("selectProtein",arguments,t),t&&(this.model.set("SYMBOL",t.get("CONCENTRATIONTYPE")),this.ui.symbol.text(this.model.get("SYMBOL")?this.model.get("SYMBOL"):""))},onRender:function(){this.$el.find("[name=SPACEGROUP]").html(h.opts()).val(this.model.get("SPACEGROUP")),this.$el.find("[name=ANOMALOUSSCATTERER]").html(d.opts()).val(this.model.get("ANOMALOUSSCATTERER")),this.$el.find("select[name=PROTEINID]").combobox({invalid:this.addProtein.bind(this),change:this.selectProtein.bind(this),select:this.selectProtein.bind(this)}),this.updateProteins(),this.model.get("PROTEINID")>-1&&this.$el.find("select[name=PROTEINID]").combobox("value",this.model.get("PROTEINID")),n.each(["NAME","CODE","COMMENTS","CELL_A","CELL_B","CELL_C","CELL_ALPHA","CELL_BETA","CELL_GAMMA","REQUIREDRESOLUTION","ANOM_NO","VOLUME","PACKINGFRACTION","USERPATH"],(function(e,t){this.model.get(e)&&this.$el.find("input[name="+e+"]").val(this.model.get(e))}),this),this.ui.symbol.text(this.model.get("SYMBOL")?this.model.get("SYMBOL"):""),this.getOption("extra").show&&this.$el.find(".extra").addClass("show"),"non-xtal"==this.getOption("type")?this.$el.find(".non-xtal").addClass("show"):this.$el.find(".xtal").addClass("show"),this.ui.comp.autocomplete({source:this.getGlobalProteins.bind(this),select:this.selectGlobalProtein.bind(this)}),this.getOption("auto").show&&(this.$el.find(".auto").addClass("show"),this.$el.find(".auto-extra").addClass("extra").removeClass("show"),this.getOption("extra").show&&this.$el.find(".auto-extra").addClass("show")),this.$el.find("[name=CENTRINGMETHOD]").html(u.opts()).val(this.model.get("CENTRINGMETHOD")),this.$el.find("[name=EXPERIMENTKIND]").html(m.opts()).val(this.model.get("EXPERIMENTKIND")),this.$el.find("[name=ENERGY]").val(this.model.get("ENERGY")),this.$el.find("[name=RADIATIONSENSITIVITY]").html(_.opts()).val(this.model.get("RADIATIONSENSITIVITY")),this.compview=new l({collection:this.model.get("components"),editable:this.editing||this.model.get("new")}),this.ui.comps.append(this.compview.render().$el)},selectGlobalProtein:function(e,t){e.preventDefault();var s=this.gproteins.findWhere({PROTEINID:t.item.value});if(s){console.log("add comp",s);var n=s.clone(),i=this.model.get("components");n.collection=i,i.add(n)}this.ui.comp.val("")},getGlobalProteins:function(e,t){var s=this;this.gproteins.fetch({data:{term:e.term,global:1},success:function(e){t(s.gproteins.map((function(e){return{label:e.get("ACRONYM"),value:e.get("PROTEINID")}})))}})},addProtein:function(e,t){var s=app.options.get("valid_components");if((s&&app.staff||!s)&&app.proposal&&1==app.proposal.get("ACTIVE")){console.log(e,t);var n=t.replace(/\W/g,""),i=this.proteins.findWhere({ACRONYM:n});i?e.combobox("value",i.get("PROTEINID")).trigger("change"):f.confirm({title:"Add New Protein",content:'Are you sure you want to add a protein called: "'+n+'"',callback:this.doAddProtein.bind(this,n,e)})}else e.combobox("value",-1).trigger("change")},doAddProtein:function(e,s){var n=new t({ACRONYM:e}),i=this;n.save({},{success:function(){i.proteins.add(n),i.updateProteins(),s.combobox("value",n.get("PROTEINID")).trigger("change")},error:function(e,t,s){}})},updateProteins:function(){this.$el.find("select[name=PROTEINID]").html(this.proteins.opts({callback:this.handleSafetyLevel})),this.$el.find("select[name=PROTEINID]").combobox("value",this.model.get("PROTEINID"))},handleSafetyLevel:function(e){return g(e)}})),v=e.CompositeView.extend({tagName:"table",className:"samples reflow",template:o,childView:b,proteins:"",events:{"hover tr td":"hoverRow"},childEvents:{cloned:"updateCloneStatus","clone:stop":"stopClone"},_cloning:!1,_clone_count:0,hoverRow:function(e){},initialize:function(e){this.proteins=e.proteins,this.gproteins=e.gproteins,this.in_use=e.in_use,this.options.childViewOptions={templateHelpers:function(){return{IN_USE:e.in_use}},proteins:this.proteins,gproteins:this.gproteins},e.childTemplate&&(this.options.childViewOptions.rowTemplate=e.childTemplate),e.childEditTemplate&&(this.options.childViewOptions.editTemplate=e.childEditTemplate),this.extra={show:!1},this.auto={show:1==e.auto},this.options.childViewOptions.extra=this.extra,this.options.childViewOptions.auto=this.auto,this.options.childViewOptions.type=this.getOption("type")},onRender:function(){console.log("rendering sample tale"),"non-xtal"==this.getOption("type")?this.$el.find(".non-xtal").addClass("show"):this.$el.find(".xtal").addClass("show"),1==this.getOption("auto")&&this.toggleAuto(!0)},extraState:function(){return this.extra.show},toggleExtra:function(){this.extra.show=!this.extra.show,this.extra.show?this.$el.find(".extra").addClass("show"):this.$el.find(".extra").removeClass("show")},toggleAuto:function(e){this.auto.show=e,e?(this.$el.find(".auto").addClass("show"),this.$el.find(".auto-extra").addClass("extra").removeClass("show")):(this.$el.find(".auto").removeClass("show"),this.$el.find(".auto-extra").removeClass("extra").addClass("show"))},cloneAll:function(){this._cloning=!0,this._clone_count=0,this.continueClone()},stopClone:function(){this._cloning=!1},updateCloneStatus:function(){this._cloning&&(this._clone_count++,this.continueClone())},continueClone:function(){this._clone_count>this.children.length?this._cloning=!1:this.children.findByIndex(this._clone_count).cloneSample()}});return v.GridRow=b,v}.apply(t,i))||(e.exports=a)}).call(this,s(5))},259:function(e,t,s){(function(n){var i,a;i=[s(10),s(260),s(14)],void 0===(a=function(e,t,s){return e.extend(n.extend({},s,{model:t,mode:"server",url:"/shipment/containers/registry",keyAttribute:"BARCODE",valueAttribute:"CONTAINERREGISTRYID",state:{pageSize:15},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},260:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"CONTAINERREGISTRYID",urlRoot:"/shipment/containers/registry",validation:{BARCODE:{required:!0,pattern:"wwdash"}}})}.apply(t,n))||(e.exports=i)},261:function(e,t,s){var n,i;n=[s(10),s(1007)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:"/shipment/containers/history",state:{pageSize:10},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},262:function(e,t,s){(function(n,i){var a,l;a=[s(6),s(11),s(26),s(190),s(20),s(46),s(191),s(238),s(186),s(1013),s(1014)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d){return s.extend({getTemplate:function(){return this.model?this.model.get("new")?h:d:h},storeOnValidate:!0,setupOnConstruct:!1,className:"single",ui:{prot:"select[name=PROTEINID]",name:"input[name=NAME]",com:"input[name=COMMENTS]",sg:"select[name=SPACEGROUP]",cp:"a.clone-plate",cc:"a.clone-col",cr:"a.clone-row",comps:".components",comp:"input[name=COMPONENTID]",abun:"input[name=ABUNDANCE]",sym:"span.SYMBOL",cella:"input[name=CELL_A]",cellb:"input[name=CELL_B]",cellc:"input[name=CELL_C]",cellal:"input[name=CELL_ALPHA]",cellbe:"input[name=CELL_BETA]",cellga:"input[name=CELL_GAMMA]",reqr:"input[name=REQUIREDRESOLUTION]",anom:"input[name=ANOMALOUSSCATTERER]"},events:{"click @ui.cp":"clonePlate","click @ui.cc":"cloneCol","click @ui.cr":"cloneRow","click a.clear-plate":"clearPlate","click a.clear-col":"clearCol","click a.clear-row":"clearRow","click a.clear":"clearSample","click a.extrainfo":"toggleExtra"},toggleExtra:function(e){e&&e.preventDefault(),this.extra=!this.extra,this.extra?this.$el.find(".extra").addClass("show"):this.$el.find(".extra").removeClass("show")},clearPlate:function(e){e&&e.preventDefault(),this.clear(["drop"])},clearCol:function(e){e.preventDefault(),this.clear(["drop","col"])},clearRow:function(e){e.preventDefault(),this.clear(["drop","row"])},clearSample:function(e){e.preventDefault()},clearAll:function(e){this.clear([],!0)},clear:function(e,t){var s=this.getOption("platetypes").findWhere({isSelected:!0}),i=t?this.getOption("samples").at(0):this.getOption("samples").findWhere({isSelected:!0}),a=s.getRowColDrop(i.get("LOCATION"));if(-1!=i.get("PROTEINID")){var l={NAME:"",SPACEGROUP:"",ABUNDANCE:"",SYMBOL:"",COMMENTS:"",REQUIREDRESOLUTION:"",ANOMALOUSSCATTERER:"",CELL_A:"",CELL_B:"",CELL_C:"",CELL_ALPHA:"",CELL_BETA:"",CELL_GAMMA:""};this.getOption("samples").each((function(o,r){if(r>i.get("LOCATION")-1)if(t)o.set(n.extend({},l,{PROTEINID:-2}),{silent:!0}),o.get("components").reset();else{var c=s.getRowColDrop(o.get("LOCATION")),p=!0;n.each(e,(function(e){c[e]!=a[e]&&(p=!1)})),p&&(o.set(n.extend({},l,{PROTEINID:-2}),{silent:!0}),o.get("components").reset())}}),this),i.set(n.extend({},l,{PROTEINID:-1})),i.get("components").reset(),this.render()}},clonePlate:function(e){e.preventDefault(),this.clone(["drop"])},cloneRow:function(e){e.preventDefault(),this.clone(["drop","row"])},cloneCol:function(e){e.preventDefault(),this.clone(["drop","col"])},clone:function(e){var t=this.getOption("platetypes").findWhere({isSelected:!0}),s=this.getOption("samples").findWhere({isSelected:!0}),i=t.getRowColDrop(s.get("LOCATION"));-1!=s.get("PROTEINID")&&(this.getOption("samples").each((function(a,l){if(l>s.get("LOCATION")-1){var o=t.getRowColDrop(a.get("LOCATION")),r=!0;n.each(e,(function(e){o[e]!=i[e]&&(r=!1)})),r&&(a.get("components").reset(s.get("components").toJSON()),a.set({PROTEINID:s.get("PROTEINID"),NAME:this.sampleName(o.pos,s.get("NAME")),SPACEGROUP:s.get("SPACEGROUP"),ABUNDANCE:s.get("ABUNDANCE"),SYMBOL:s.get("SYMBOL")},{silent:!0}))}}),this),s.set({NAME:this.sampleName(i.pos,s.get("NAME"))}))},success:function(e){var t=this.getOption("proteins").findWhere({PROTEINID:this.model.get("PROTEINID")});this.model.set({new:!1,ACRONYM:t.get("ACRONYM")}),this.render()},sampleName:function(e,t){var s=this.getOption("platetypes").findWhere({isSelected:!0}),n=s.getRowColDrop(e);return s.getName(n.pos)+"d"+n.drop+"_"+t},templateHelpers:function(){return{existingContainer:this.getOption("existingContainer")}},createModel:function(){},initialize:function(e){console.log("init single",e),this.ready=[],this.extra=!1,this.gproteins=e.gproteins,this.listenTo(e.proteins,"sync",this.updateProteins,this)},onRender:function(){i.when.apply(i,this.ready).done(this.doRender.bind(this))},selectProtein:function(){this.validateField.apply(this,arguments);var e=this.getOption("proteins").findWhere({PROTEINID:this.$el.find("select[name=PROTEINID]").combobox("value")});console.log("selectProtein",arguments,e),e&&(this.model.set("SYMBOL",e.get("CONCENTRATIONTYPE")),this.ui.sym.text(this.model.get("SYMBOL")?this.model.get("SYMBOL"):""))},doRender:function(){if(this.model){if(this.model.get("new"))this.ui.prot.combobox({invalid:this.addProtein.bind(this),change:this.selectProtein.bind(this),select:this.selectProtein.bind(this)}),this.updateProteins(),this.ui.sg.html(a.opts()).val(this.model.get("SPACEGROUP")),this.ui.name.val(this.model.get("NAME")),this.ui.com.val(this.model.get("COMMENTS")),this.ui.abun.val(this.model.get("ABUNDANCE")),this.ui.sym.text(this.model.get("SYMBOL")?this.model.get("SYMBOL"):""),this.ui.cella.val(this.model.get("CELL_A")),this.ui.cellb.val(this.model.get("CELL_B")),this.ui.cellc.val(this.model.get("CELL_C")),this.ui.cellal.val(this.model.get("CELL_ALPHA")),this.ui.cellbe.val(this.model.get("CELL_BETA")),this.ui.cellga.val(this.model.get("CELL_GAMMA")),this.ui.reqr.val(this.model.get("REQUIREDRESOLUTION")),this.ui.anom.val(this.model.get("ANOMALOUSSCATTERER"));else{var e=new l({model:this.model,el:this.$el}),t=n.map(this.getOption("proteins").kv(),(function(e,t){return{value:e,id:t}}));e.create("PROTEINID","autocomplete",{autocomplete:{source:t}}),e.create("NAME","text"),e.create("COMMENTS","textarea"),e.create("SPACEGROUP","select",{data:a.list}),e.create("REQUIREDRESOLUTION","text"),e.create("ANOMALOUSSCATTERER","select",{data:r.list}),e.create("CELL_A","text"),e.create("CELL_B","text"),e.create("CELL_C","text"),e.create("CELL_ALPHA","text"),e.create("CELL_BETA","text"),e.create("CELL_GAMMA","text"),e.create("ABUNDANCE","text")}this.ui.comp.autocomplete({source:this.getGlobalProteins.bind(this),select:this.selectGlobalProtein.bind(this)}),console.log("render single",this.model),this.compview=new c({showEmpty:!0,CRYSTALID:this.model.get("CRYSTALID"),collection:this.model.get("components"),editable:this.model.get("new"),editinline:this.getOption("existingContainer")}),this.ui.comps.append(this.compview.render().$el),this.extra&&this.$el.find(".extra").addClass("show")}},selectGlobalProtein:function(e,t){e.preventDefault();var s=this.gproteins.findWhere({PROTEINID:t.item.value});if(s){console.log("add comp",s);var n=s.clone(),i=this.model.get("components");n.collection=i,n.set("new",!0),i.add(n)}this.ui.comp.val("")},getGlobalProteins:function(e,t){var s=this;this.gproteins.fetch({data:{term:e.term,global:1},success:function(e){t(s.gproteins.map((function(e){return{label:e.get("ACRONYM"),value:e.get("PROTEINID")}})))}})},addProtein:function(e,s){var n=app.options.get("valid_components");if((n&&app.staff||!n)&&app.proposal&&1==app.proposal.get("ACTIVE")){if(this.getOption("isForImager")){var i=this.getOption("isForImager")();if(console.log("is for imager",i),i)return void e.combobox("value",-1).trigger("change")}var a=s.replace(/\W/g,""),l=this.getOption("proteins").findWhere({ACRONYM:a});l?e.combobox("value",l.get("PROTEINID")).trigger("change"):t.confirm({title:"Add New Protein",content:'Are you sure you want to add a protein called: "'+a+'"',callback:this.doAddProtein.bind(this,a,e)})}else e.combobox("value",-1).trigger("change")},doAddProtein:function(e,t){var s=new o({ACRONYM:e}),n=this;s.save({},{success:function(){n.getOption("proteins").add(s),n.updateProteins(),t.combobox("value",s.get("PROTEINID")).trigger("change")},error:function(e,t,s){}})},updateProteins:function(){this.ui.prot.html(this.getOption("proteins").opts({callback:this.handleSafetyLevel})),this.ui.prot.combobox("value",this.model.get("PROTEINID"))},handleSafetyLevel:function(e){return p(e,{GREEN:"active",YELLOW:"hidden",RED:"hidden"})},setModel:function(t){e.Validation.unbind(this),this.undelegateEvents(),this.model=t,this.delegateEvents(),this.setupValidation(),this.render()}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},268:function(e,t,s){(function(n){var i,a;i=[s(10),s(171),s(14)],void 0===(a=function(e,t,s){return e.extend(n.extend({model:t,mode:"server",url:"/shipment/dewars/registry",state:{pageSize:15},keyAttribute:"FACILITYCODE",valueAttribute:"FACILITYCODE",parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}},s))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},271:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"SCANPARAMETERSMODELID",urlRoot:"/exp/parameters/models",defaults:{SEQUENCENUMBER:null,START:null,STOP:null,STEP:null,ARRAY:null},validation:{DATACOLLECTIONPLANID:{required:!0,pattern:"digits"},SCANPARAMETERSSERVICEID:{required:!0,pattern:"digits"},SEQUENCENUMBER:{required:!0,pattern:"number"},START:{required:function(){return!this.get("ARRAY")},pattern:"number"},STOP:{required:function(){return!this.get("ARRAY")},pattern:"number"},STEP:{required:function(){return!this.get("ARRAY")},pattern:"number"},ARRAY:{required:function(){return!(this.get("START")||this.get("STOP")||this.get("STEP"))},pattern:"array"}}})}.apply(t,n))||(e.exports=i)},272:function(e,t,s){(function(n){var i,a;i=[s(6)],void 0===(a=function(e){return e.Model.extend({idAttribute:"DATACOLLECTIONPLANHASDETECTORID",urlRoot:"/exp/plans/detectors",defaults:{EXPOSURETIME:null,DISTANCE:null,ROLL:null},initialize:function(e,t){t&&t.BEAMLINESETUPS&&(this.beamlinesetups=t.BEAMLINESETUPS,this.listenTo(this.beamlinesetups,"sync reset add remove",this.syncLimits),this.syncLimits())},syncLimits:function(){var e=this.beamlinesetups.findWhere({DETECTORID:this.get("DETECTORID")});e&&(this.validation=JSON.parse(JSON.stringify(this.__proto__.validation)),n.each(this.validation,(function(t,s){var n=e.getRange({field:s});n&&(t.range=n)}),this))},validation:{DETECTORID:{required:!0,pattern:"number"},DATACOLLECTIONPLANID:{required:!0,pattern:"number"},EXPOSURETIME:{required:!1,pattern:"number"},DISTANCE:{required:!1,pattern:"number"},ROLL:{required:!1,pattern:"number"}}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},425:function(e,t,s){(function(n){var i,a;i=[s(10),s(1009),s(14)],void 0===(a=function(e,t,s){return e.extend(n.extend({},s,{model:t,mode:"client",url:"/process/pipelines",state:{pageSize:9999},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data},keyAttribute:"NAME",valueAttribute:"PROCESSINGPIPELINEID"}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},426:function(e,t,s){(function(n,i){var a,l;a=[s(6),s(26),s(155),s(46),s(57),s(40),s(257),s(258),s(1011),s(1012),s(71),s(95),s(96),s(262),s(427),s(1015),s(430),s(265),s(170),s(267),s(432),s(68),s(259),s(425),s(1020),s(1021),s(1022)],void 0===(l=function(e,t,s,a,l,o,r,c,p,h,d,u,m,_,f,g,E,b,v,I,A,T,C,N,w,S,R){e.Syphon.InputReaders.register("checkbox",(function(e){return e.prop("checked")?e.val():null}));var O=l.extend({idAttribute:"LOCATION"});return t.extend({setupOnConstruct:!1,className:"content",template:w,regions:{table:".table",puck:".puck",single:".singlesamp",grp:".group"},defaultPipeline:"xia2/DIALS",templateHelpers:function(){return{SHIPPINGID:this.dewar.get("SHIPPINGID"),SHIPMENT:this.dewar.get("SHIPPINGNAME"),DEWAR:this.dewar.get("CODE")}},ui:{name:"input[name=NAME]",comments:"input[name=COMMENTS]",type:"select[name=CONTAINERTYPE]",pc:".puck_controls",ext:".extrainfo",schedule:"select[name=SCHEDULEID]",screen:"select[name=SCREENID]",pid:"select[name=PERSONID]",imager:"select[name=REQUESTEDIMAGERID]",barcode:"input[name=BARCODE]",registry:"select[name=CONTAINERREGISTRYID]",autoprocessing_options:".autoprocessing_options",autoprocessing_pipeline:"select[name=PIPELINE]",auto:"input[name=AUTOMATED]",extrastate:".extra-state"},events:{"click .pf":"pasteFrom","change .samples input":"cacheContainer","keyup .samples input":"cacheContainer","blur .samples input":"cacheContainer","change .samples select":"cacheContainer","keyup .samples select":"cacheContainer","blur .samples select":"cacheContainer","click a.clonepuck":"clonePuck","click a.clearpuck":"clearPuck","click a.autofill":"autoFill","change @ui.type":"setType","click @ui.ext":"toggleExtra","keypress .ui-combobox input":"excelNavigate","keypress input.sname":"excelNavigate","keypress select.sg":"excelNavigate","keypress input.barcode":"excelNavigate","keypress input.comments":"excelNavigate","click a.view_sch":"viewSchedule","click a.edit_user":"editUser","change @ui.screen":"selectScreen","change @ui.pid":"checkPerson","change @ui.imager":"limitProteins","change @ui.barcode":"checkBarcode","keyup @ui.barcode":"checkBarcode","change @ui.registry":"updateName","click @ui.auto":"updateAutomated","change @ui.autoprocessing_pipeline":"updateProcessing"},updateAutomated:function(e){console.log("State:  "+this.ui.auto.is(":checked")),this.ui.auto.is(":checked")?(this.proteins.queryParams.SAFETYLEVEL="GREEN",this.proteins.fetch()):(delete this.proteins.queryParams.SAFETYLEVEL,this.proteins.fetch()),this.table.currentView&&this.table.currentView.toggleAuto(this.ui.auto.is(":checked"))},updateName:function(e){var t=this.containerregistry.findWhere({CONTAINERREGISTRYID:this.ui.registry.val()});t&&this.ui.name.val(t.get("BARCODE"))},updateProcessing:function(e){var t=this.ui.autoprocessing_pipeline.val();this.model.set("PROCESSINGPIPELINEID",t)},checkBarcode:function(){this.ui.barcode.val()||this.model.set("BARCODECHECK",null);var t=this;e.ajax({url:app.apiurl+"/shipment/containers/barcode/"+this.ui.barcode.val(),success:function(e){t.updateBarcode(e.PROP)},error:function(){t.updateBarcode()}})},updateBarcode:function(e){e?(this.model.set("BARCODECHECK",0),this.$el.find(".message").text("This barcode is already registered to "+e).addClass("ferror")):(this.model.set("BARCODECHECK",1),this.$el.find(".message").text("").removeClass("ferror"))},limitProteins:function(){this.proteins.queryParams.external=this.ui.imager.val()?1:null,this.proteins.fetch(),this.users.queryParams.login=this.ui.imager.val()?1:null,this.users.fetch()},checkPerson:function(){var e=this.users.findWhere({PERSONID:this.ui.pid.val()});console.log("check p",e),e&&(e.get("EMAILADDRESS")?(this.ui.pid.removeClass("invalid"),this.ui.pid.siblings("span.emsg").remove()):(this.ui.pid.addClass("invalid"),this.ui.pid.after('<span class="emsg ferror">Please update your email address by clicking view</span>')))},editUser:function(e){e.preventDefault(),app.trigger("user:show",this.ui.pid.val())},getScreen:function(){return this.ui.screen.val()},selectScreen:function(e){this.screencomponents.fetch(),this.screencomponentgroups.fetch().done(this.assignScreen.bind(this))},assignScreen:function(e){this.samples.each((function(e){var t=this.type.getWell(e.get("LOCATION")),s=this.screencomponentgroups.findWhere({POSITION:(t+1).toString()});s?e.set({SCREENCOMPONENTGROUPID:s.get("SCREENCOMPONENTGROUPID")},{silent:!0}):e.set({SCREENCOMPONENTGROUPID:null},{silent:!0})}),this)},viewSchedule:function(e){e.preventDefault();var t=this.schedules.findWhere({SCHEDULEID:this.ui.schedule.val()});t&&app.dialog.show(new DialogView({title:"View Schedule",className:"content",view:new g({dialog:!0,model:t}),autoSize:!0}))},excelNavigate:function(e){var t="."+e.target.className.replace(" fvalid","").replace(" ferror","").replace(/\s/g,"."),s=n(t),i=e.target,a=s.index(i);if(13==e.which){var l=e.shiftKey?-1:1;a<s.length&&s.eq(a+l).focus(),e.preventDefault()}},toggleExtra:function(e){e.preventDefault(),this.table.currentView&&(this.table.currentView.toggleExtra(),this.table.currentView.extraState()?this.ui.extrastate.addClass("fa-minus").removeClass("fa-plus"):this.ui.extrastate.addClass("fa-plus").removeClass("fa-minus"))},isForImager:function(){return!!this.ui.imager.val()},setType:function(e){this.$el.find("li.auto").hide(),this.ui.autoprocessing_options.hide(),this.type=this.ctypes.findWhere({name:this.ui.type.val()}),this.type.set({isSelected:!0}),this.model.set({CAPACITY:this.type.get("capacity"),CONTAINERTYPE:this.type.get("name")}),"Puck"==this.type.get("name")?(this.buildCollection(),this.puck.$el.css("width",app.mobile()?"100%":"25%"),this.puck.show(new r({collection:this.samples})),this.stable=new c({proteins:this.proteins,gproteins:this.gproteins,collection:this.samples,childTemplate:R,template:S,auto:this.ui.auto.is(":checked")}),this.table.show(this.stable),this.single.empty(),this.grp.empty(),this.ui.pc.show(),this.$el.find("li.pck").show(),this.$el.find("li.plate").hide(),this.$el.find("li.pcr").hide(),this.ui.autoprocessing_options.show()):"PCRStrip"==this.type.get("name")?(this.puck.$el.css("width",app.mobile()?"100%":"50%"),this.puck.show(new m({collection:this.samples,type:this.type,showValid:!0})),this.buildCollection(),this.stable=new c({proteins:this.proteins,gproteins:this.gproteins,collection:this.samples,childTemplate:R,template:S,type:"non-xtal"}),this.table.show(this.stable),this.single.empty(),this.grp.empty(),this.ui.pc.show(),this.$el.find("li.pck").hide(),this.$el.find("li.plate").hide(),this.$el.find("li.pcr").show(),this.ui.registry.val("")):(app.mobile()||this.puck.$el.css("width",app.mobile()?"100%":"50%"),this.puck.show(new m({collection:this.samples,type:this.type,showValid:!0})),this.table.empty(),this.stable.destroy(),this.singlesample=new _({proteins:this.proteins,gproteins:this.gproteins,platetypes:this.ctypes,samples:this.samples,isForImager:this.isForImager.bind(this)}),this.single.show(this.singlesample),this.group=new I({components:this.screencomponents,editable:!1}),this.grp.show(this.group),this.ui.pc.hide(),this.buildCollection(),this.$el.find("li.pck").hide(),this.$el.find("li.pcr").hide(),this.$el.find("li.plate").show(),this.ui.registry.val("")),console.log("samples",this.samples)},autoFill:function(e){e.preventDefault();var t,s=this.getOption("visit")+"-p1";(t=this.proteins.findWhere({ACRONYM:s}))?(this.$el.find("table.samples select[name=PROTEINID]").eq(0).combobox("value",t.get("PROTEINID")).trigger("change"),this.$el.find("table.samples input[name=NAME]").eq(0).val("x1").trigger("change"),this.clonePuck()):(t=new a({ACRONYM:s})).save({},{success:function(){self.proteins.add(t),self.$el.find("table.samples select[name=PROTEINID]").eq(0).combobox("value",t.get("PROTEINID")).trigger("change"),self.$el.find("table.samples input[name=NAME]").eq(0).val("x1").trigger("change"),self.clonePuck()}})},clearPlate:function(e){e&&e.preventDefault(),this.ui.barcode.val(""),this.ui.imager.val(""),this.ui.schedule.val(""),this.ui.screen.val(""),this.singlesample&&this.singlesample.clearAll(),this.screencomponents.reset(),this.screencomponentgroups.reset();var t=this.samples.at(0);t&&t.set({isSelected:!0})},clearPuck:function(e){e&&e.preventDefault(),this.ui.name.val(""),this.ui.registry.val(""),this.ui.comments.val(""),this.$el.find(".clear").each((function(e,t){n(t).trigger("click")}))},clonePuck:function(e){e&&e.preventDefault(),this.stable&&this.stable.cloneAll()},pasteFrom:function(e){e.preventDefault();var t=new h({proteins:this.proteins});this.listenTo(t,"content:parsed",this.insertContent,this),app.dialog.show(t)},insertContent:function(e){this.samples.set(e.samples,{remove:!1}),this.table.currentView.render(),this.ui.name.val(e.title)},cacheContainer:function(){console.log("caching");var e=!1;if(this.samples.each((function(t){t.get("PROTEINID")>-1&&(e=!0)})),console.log("caching",e),e){var t={samples:new o(this.samples.filter((function(e){return e.get("PROTEINID")>-1}))).toJSON(),title:this.ui.name.val(),time:new Date};this.cache.set({data:t}),this.cache.save({},{success:function(){app.alert({message:"Container contents last saved: "+new Date,persist:"saved",className:"message notify",scrollTo:!1})}})}},loadContainerCache:function(){this.cache.get("data")&&(i.each(this.cache.get("data").samples,(function(e){var t=this.samples.findWhere({LOCATION:e.LOCATION});t.get("components").reset(e.components),delete e.components,t.set(e)}),this),this.table.currentView.render(),this.ui.name.val(this.cache.get("data").title),app.alert({message:"Container contents last saved: "+this.cache.get("data").time,persist:"saved",className:"message notify",scrollTo:!1}),console.log("loaded cache",this.cache))},success:function(){var e=this;this.samples.each((function(e){e.set({CONTAINERID:this.model.get("CONTAINERID")},{silent:!0})}),this);var t=new o(this.samples.filter((function(e){return e.get("PROTEINID")>-1||e.get("CRYSTALID")>-1})));t.length?(this.$el.find("form").addClass("loading"),this.ui.submit.prop("disabled",!0),t.save({success:function(){e.finished(),e.ui.submit.prop("disabled",!1),e.$el.find("form").removeClass("loading")},error:function(){e.ui.submit.prop("disabled",!1),e.$el.find("form").removeClass("loading")}})):this.finished()},finished:function(){app.alert({message:"New container &quot;"+this.model.escape("NAME")+'&quot; created, Click <a href="/containers/cid/'+this.model.escape("CONTAINERID")+'">here</a> to view it',persist:"cadd"+this.model.escape("CONTAINERID"),className:"message notify"}),this.clearPuck(),this.clearPlate(),this.model.set({CONTAINERID:null})},error:function(){app.alert({message:"Something went wrong registering this container, please try again"})},createModel:function(){this.model=new s({DEWARID:this.dewar.get("DEWARID"),new:!0})},selectSample:function(){if("Puck"!=this.type.get("name")&&"PCRStrip"!=this.type.get("name")){var e=this.samples.findWhere({isSelected:!0});if(e){this.singlesample.setModel(e),console.log("select sample",e);var t=this.type.getWell(e.get("LOCATION")),s=this.screencomponentgroups.findWhere({POSITION:(t+1).toString()});s?this.group.setModel(s):this.group.setModel(null)}}},initialize:function(e){this.ready=[],this.dewar=e.dewar,this.samples=new o(null,{model:O}),this.listenTo(this.samples,"selected:change",this.selectSample),this.setupValidation(),this.users=new T(null,{state:{pageSize:9999}}),this.users.queryParams.all=1,this.users.queryParams.pid=app.proposal.get("PROPOSALID"),this.listenTo(this.users,"sync",this.updateUsers,this),this.ready.push(this.users.fetch()),this.proteins=new d,app.options.get("valid_components")&&!app.staff&&(this.proteins.queryParams.external=1),this.ready.push(this.proteins.fetch()),this.gproteins=new d,this.cache=new p({name:"container"}),this.ready2=this.cache.fetch(),this.ctypes=new u,app.user_can("disp_cont")||this.ctypes.remove(this.ctypes.findWhere({name:"ReferencePlate"})),this.cacheContainer=i.debounce(this.cacheContainer,3e3);var t=this;this.schedules=new f,this.schedules.fetch().done((function(){t.ui.schedule.html('<option value=""> - </option>'+t.schedules.opts())})),this.screens=new E(null,{state:{pageSize:9999}}),this.screens.fetch().done((function(){t.ui.screen.html('<option value=""> - </option>'+t.screens.opts())})),this.imagers=new A,this.imagers.fetch().done((function(){t.ui.imager.html('<option value=""> - </option>'+t.imagers.opts())})),this.screencomponentgroups=new b(null,{state:{pageSize:9999}}),this.screencomponentgroups.queryParams.scid=this.getScreen.bind(this),this.screencomponents=new v(null,{state:{pageSize:9999}}),this.screencomponents.queryParams.scid=this.getScreen.bind(this),this.checkBarcode=i.debounce(this.checkBarcode.bind(this),200),this.containerregistry=new C(null,{state:{pageSize:9999}}),this.containerregistry.fetch().done((function(){t.ui.registry.html('<option value="!">Please select one</option>'+t.containerregistry.opts({empty:!0}))})),this.processing_pipelines=new N,this.processing_pipelines.queryParams.pipelinestatus="optional",this.processing_pipelines.queryParams.category="processing",this.processing_pipelines.fetch().done((function(){t.ui.autoprocessing_pipeline.html('<option value="!">Please select one</option>'+t.processing_pipelines.opts({empty:!0}));var e=t.processing_pipelines.findWhere({NAME:t.defaultPipeline});e?(t.ui.autoprocessing_pipeline.val(e.get("PROCESSINGPIPELINEID")),t.updateProcessing()):console.log("Default Pipeline "+t.defaultPipeline+" not found, not selecting a priority")}))},buildCollection:function(){var e=[];i.each(i.range(1,this.type.get("capacity")+1),(function(t){e.push(new O({LOCATION:t.toString(),PROTEINID:-1,CRYSTALID:-1,new:!0}))}),this),this.samples.reset(e),this.samples.at(0).set("isSelected",!0)},onShow:function(){this.getOption("visit")?this.$el.find("a.autofill").show():this.$el.find("a.autofill").hide(),n.when.apply(n,this.ready).then(this.doOnShow.bind(this))},doOnShow:function(){console.log("show new puck"),this.ui.type.html(this.ctypes.opts()),this.setType(),this.ready2.done(this.loadContainerCache.bind(this)),this.updateUsers(),this.checkPerson()},updateUsers:function(e){this.ui.pid.html(this.users.opts()).val(app.personid)},failure:function(e,t,s){console.log("failure",e,t)}})}.apply(t,a))||(e.exports=l)}).call(this,s(8),s(5))},433:function(e,t,s){(function(n){var i,a;i=[s(16),s(258),s(27),s(417),s(1025),s(1026),s(1027)],void 0===(a=function(e,t,s,i,a,l,o){var r=t.GridRow.extend({rowTemplate:l,editTemplate:o,events:n.extend({},t.GridRow.prototype.events,{"click a.cont":"showEditContainers"}),showEditContainers:function(e){e.preventDefault(),app.dialog.show(new s({title:"Edit Containers",className:"content",view:new i({dialog:!0,parent:this.model}),autoSize:!0}))},initialize:function(e){r.__super__.initialize.call(this,e),e&&e.crystals&&(this.crystals=e.crystals,this.listenTo(this.crystals,"reset add change",this.updateCrystals,this))},onRender:function(){r.__super__.onRender.call(this),this.$el.find("select[name=CRYSTALID]").combobox({invalid:this.invalidCrystal.bind(this),change:this.selectCrystal.bind(this),select:this.selectCrystal.bind(this)}),this.updateCrystals(),this.model.get("CRYSTALID")>-1&&this.$el.find("select[name=CRYSTALID]").combobox("value",this.model.get("CRYSTALID"))},invalidCrystal:function(e,t){e.combobox("value",-1).trigger("change")},selectCrystal:function(e,t){this.validateField.apply(this,arguments);var s=this.crystals.findWhere({CRYSTALID:this.$el.find("select[name=CRYSTALID]").combobox("value")});s&&this.model.set({CRYSTAL:s.get("NAME"),PROTEINID:s.get("PROTEINID"),THEORETICALDENSITY:s.get("THEORETICALDENSITY")})},editSample:function(e){r.__super__.editSample.call(this,e),this.updateCrystals()},updateCrystals:function(){this.$el.find("select[name=CRYSTALID]").html(this.crystals.opts()),this.$el.find("select[name=CRYSTALID]").combobox("value",this.model.get("CRYSTALID"))}});return t=t.extend({template:a,childView:r,initialize:function(e){t.__super__.initialize.call(this,e),this.options.childViewOptions.crystals=e.crystals}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},434:function(e,t,s){var n,i;n=[s(95)],void 0===(i=function(e){return e.extend({plateTypes:[{name:"Box",well_per_row:5,drop_per_well_x:1,drop_per_well_y:1,drop_height:1,drop_width:1,drop_offset_x:0,drop_offset_y:0,well_drop:-1,capacity:25},{name:"XpdfSampleChanger15",well_per_row:15,drop_per_well_x:1,drop_per_well_y:1,drop_height:1,drop_width:1,drop_offset_x:0,drop_offset_y:0,well_drop:-1,capacity:15},{name:"XpdfSampleChanger7",well_per_row:7,drop_per_well_x:1,drop_per_well_y:1,drop_height:1,drop_width:1,drop_offset_x:0,drop_offset_y:0,well_drop:-1,capacity:7},{name:"XpdfSingleSample",well_per_row:1,drop_per_well_x:1,drop_per_well_y:1,drop_height:1,drop_width:1,drop_offset_x:0,drop_offset_y:0,well_drop:-1,capacity:1},{name:"XpdfGasFlowCell",well_per_row:1,drop_per_well_x:1,drop_per_well_y:1,drop_height:1,drop_width:1,drop_offset_x:0,drop_offset_y:0,well_drop:-1,capacity:1}]})}.apply(t,n))||(e.exports=i)},435:function(e,t,s){var n,i;n=[s(6),s(10)],void 0===(i=function(e,t){e.Model.extend({idAttribute:"EVENTID"});return t.extend({url:"/shipment/dewars/tracking",parseRecords:function(e,t){return this.ORIGIN=e.ORIGIN,this.DESTINATION=e.DESTINATION,e.EVENTS}})}.apply(t,n))||(e.exports=i)},437:function(e,t,s){(function(n,i){var a,l;a=[s(7),s(6),s(1052),s(304),s(131),s(241),s(240),s(147),s(20),s(11),s(29),s(234),s(1054),s(18)],void 0===(l=function(e,t,s,a,l,o,r,p,h,d,u,m,_){var f=e.ItemView.extend({tagName:"li",modelEvents:{change:"render"},events:{click:"setSelected"},setSelected:function(e){console.log("click score"),this.model.set("isSelected",!0)},template:n.template("<%-SCORE%>"),onRender:function(){this.model.get("isSelected")?this.$el.addClass("current"):this.$el.removeClass("current"),console.log("render score",this.model.get("isSelected")),this.$el.css("background-color",this.model.get("COLOUR"))}}),g=e.CollectionView.extend({tagName:"ul",childView:f});return e.LayoutView.extend({template:_,className:"image_large",showBeam:!1,showHeatmap:!0,rankOption:null,regions:{hist:".hist",scb:".scorebybutton"},ui:{canvas:"canvas",score:"select[name=score]",com:".COMMENTS",zoom:"#zoom",zval:"#zval",hist:"a.history",progress:"span.progress",help:".help_pane",hb:"a.help",meas:"a.measure",move:"a.move",pia:"select[name=pia]"},events:{"slidechange @ui.zoom":"onZoomChange","mousedown @ui.canvas":"mouseDownCanvas","mousemove @ui.canvas":"mouseMoveCanvas","mouseup @ui.canvas":"mouseUpCanvas","DOMMouseScroll @ui.canvas":"mouseWheel","mousewheel @ui.canvas":"mouseWheelCanvas","click @ui.canvas":"handleClick","change @ui.score":"updateScore","click @ui.hist":"toggleHistory","click @ui.meas":"toggleMeasure","click @ui.move":"toggleMove","click @ui.hb":"toggleHelp","change @ui.pia":"changeHeatmap"},toggleMeasure:function(e){e.preventDefault(),this.ui.meas.hasClass("button-highlight")?this.ui.meas.removeClass("button-highlight"):this.ui.meas.addClass("button-highlight")},toggleMove:function(e){e.preventDefault(),this.ui.move.hasClass("button-highlight")?this.ui.move.removeClass("button-highlight"):this.ui.move.addClass("button-highlight")},toggleHelp:function(e){e.preventDefault(),this.ui.hb.hasClass("button-highlight")?this.ui.hb.removeClass("button-highlight"):this.ui.hb.addClass("button-highlight"),this.ui.hb.hasClass("button-highlight")?this.ui.help.addClass("enable"):this.ui.help.removeClass("enable")},toggleHistory:function(e){e.preventDefault(),this.ui.hist.hasClass("button-highlight")?(this.hist.$el.fadeOut(),this.ui.hist.removeClass("button-highlight")):(this.hist.$el.fadeIn(),this.history.load(),this.ui.hist.addClass("button-highlight"))},modelEvents:{},handleClick:function(e){var t=d.get_xy(e,this.ui.canvas),s=parseInt(t[0]/this.scalef-this.offsetx/this.scalef),n=parseInt(t[1]/this.scalef-this.offsety/this.scalef);if(console.log("click",e,t,s,n),this.add_object){var i=new a({BLSAMPLEID:this.model.get("BLSAMPLEID"),X:s,Y:n}),l=this;i.save(null,{success:function(){i.set("RID",l.subsamples.length),l.subsamples.add(i),l.draw(),l.plotObjects()},error:function(e,t,s){app.alert({message:"Something went wrong creating that object, please try again: "+t.responseText})}})}},setAddSubsample:function(e){this.add_object=e},setAddSubsampleRegion:function(e){this.add_region=e},remSubsample:function(e){this.draw(),this.plotObjects()},getSample:function(){return this.model.get("BLSAMPLEID")},subsamplesSynced:function(){this.attachments.fetch({success:this.populateHeatmap.bind(this)})},initialize:function(e){this.add_object=!1,this.add_region=!1,this.plotObjects=n.debounce(this.plotObjects,200),this.drawDebounce=n.debounce(this.draw,10),this.scores=new s,this.listenTo(this.scores,"selected:change",this.setScoreButton,this),null!==this.getOption("scores")&&!1===this.getOption("scores")||(this.ready=this.scores.fetch()),this.subsamples=e.subsamples,this.listenTo(this.subsamples,"sync",this.subsamplesSynced,this),this.listenTo(this.subsamples,"change:BOXSIZEX",this.replotObjects,this),this.listenTo(this.subsamples,"change:BOXSIZEY",this.replotObjects,this),this.listenTo(this.subsamples,"change:PREFERREDBEAMSIZEX",this.replotObjects,this),this.listenTo(this.subsamples,"change:PREFERREDBEAMSIZEY",this.replotObjects,this),this.listenTo(this.subsamples,"change:isSelected",this.selectSubSample,this),this.listenTo(this.subsamples,"remove",this.remSubsample,this),this.historyimages=e.historyimages,this.historyimages&&(this.listenTo(this.historyimages,"selected:change",this.hChanged,this),this.history=new o({historyimages:this.historyimages})),this.img=new u,this.img.onload=this.onImageLoaded.bind(this),this.img.onerror=this.onImageError.bind(this),this.img.onprogress=this.onImageProgress.bind(this),this.attachments=new p(null,{state:{pageSize:100}}),this.attachments.queryParams.filetype="pia",this.attachments.queryParams.blsampleid=this.getSample.bind(this),this.rendered=!1,this.scalef=1,this.width=null,this.height=null,this.offsetx=0,this.offsety=0,this.record=!1,this.startx=0,this.starty=0,this.moved=!1,this.first=!1,this.start=[],this.drawingLine=!1,this.hasLine=!1,this.lineStart={},this.lineEnd={},this.drawingRegion=!1,this.isMovingObject=!1,this.movingObject=!1,this.resizeObject=!1},selectSubSample:function(e){this.draw(),this.plotObjects()},hChanged:function(e){console.log("h changed",e),this.setModel(e)},setEmpty:function(){var e=new(r.extend({urlFor:function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}}));this.setModel(e)},setModel:function(e){t.Validation.unbind(this),this.undelegateEvents(),this.model=e,this.low=!1,this.delegateEvents(),t.Validation.bind(this),this.drawLarge(),this.scores.setSelected(e.get("BLSAMPLEIMAGESCOREID"))},setRankStatus:function(e){this.rankOption=e,this.draw(),this.plotObjects()},updateScores:function(){null!==this.getOption("scores")&&!1===this.getOption("scores")||(this.ui.score.html(this.scores.opts()),this.model&&this.ui.score.val(this.model.get("BLSAMPLEIMAGESCOREID")),this.scb.show(new g({collection:this.scores})))},updateScore:function(){var e=this.scores.findWhere({BLSAMPLEIMAGESCOREID:this.ui.score.val()});this.model.set("BLSAMPLEIMAGESCOREID",this.ui.score.val()),this.model.set("SCORECOLOUR",e.get("COLOUR")),this.model.save({BLSAMPLEIMAGESCOREID:this.ui.score.val()},{patch:!0}),this.trigger("image:scored")},setScoreButton:function(){var e=this.scores.findWhere({isSelected:!0});e&&(this.model.set("BLSAMPLEIMAGESCOREID",e.get("BLSAMPLEIMAGESCOREID")),this.model.save({imagescoreid:e.get("BLSAMPLEIMAGESCOREID")},{patch:!0}),this.trigger("image:scored"))},onDomRefresh:function(){this.canvas=this.ui.canvas[0],this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.$el.width(),this.canvas.height=this.canvas.width*(app.mobile()?.75:.85),this.ui.zoom.slider({min:0,max:200,step:5}),this.rendered=!0,this.getOption("showHeatmap")&&(this.heatmap=new m.create({container:this.$el[0],maxOpacity:.4}))},onRender:function(){this.ready&&this.ready.done(this.updateScores.bind(this)),this.historyimages?(this.hist.show(this.history),this.hist.$el.hide()):this.ui.hist.hide(),null!==this.getOption("move")&&0==this.getOption("move")&&this.ui.move.hide(),null!==this.getOption("scores")&&!1===this.getOption("scores")&&this.$el.find(".scoresel").hide(),i(document).unbind("keypress.imviewer").bind("keypress.imviewer",this.keyPress.bind(this))},keyPress:function(e){if(!(i(e.target).is("input")||i(e.target).is("select")||i(e.target).is("textarea"))){if(e.which>47&&e.which<58){var t=e.which-48,s=this.scores.findWhere({SCORE:t.toString()}),n=1;return s?n=s.get("BLSAMPLEIMAGESCOREID"):console.log("ImageViewer Error - could not find score model with (String) key of "+t),void this.ui.score.val(n).trigger("change")}switch(console.log(e.which),e.which){case 63:this.ui.hb.trigger("click");break;case 104:this.ui.hist.trigger("click");break;case 109:this.ui.meas.trigger("click");break;case 111:this.ui.move.trigger("click");break;case 115:this.trigger("space",e);break;case 97:if(this.ui.hist.hasClass("button-highlight")){if(!this.historyimages)return;var a=this.historyimages.indexOf(this.model);(l=this.historyimages.at(a-1)||this.historyimages.last())&&(this.setModel(l),l.set({isSelected:!0}))}else this.trigger("image:prev");break;case 100:if(this.ui.hist.hasClass("button-highlight")){if(!this.historyimages)return;a=this.historyimages.indexOf(this.model);(l=this.historyimages.at(a+1)||this.historyimages.first())&&(this.setModel(l),l.set({isSelected:!0}))}else this.trigger("image:next");break;case 113:if(this.ui.hist.hasClass("button-highlight")){if(!this.historyimages)return;(l=this.historyimages.first())&&(this.setModel(l),l.set({isSelected:!0}))}else this.trigger("image:first");break;case 101:if(this.ui.hist.hasClass("button-highlight")){if(!this.historyimages)return;var l;(l=this.historyimages.last())&&(this.setModel(l),l.set({isSelected:!0}))}else this.trigger("image:last");break;case 122:this.ui.zoom.slider("value",this.ui.zoom.slider("value")-10).trigger("slidechange"),this.clampOffsets(),this.draw(),this.plotObjects();break;case 120:this.ui.zoom.slider("value",100).trigger("slidechange"),this.clampOffsets(),this.draw(),this.plotObjects();break;case 99:this.ui.zoom.slider("value",this.ui.zoom.slider("value")+10).trigger("slidechange"),this.clampOffsets(),this.draw(),this.plotObjects();break;case 118:this.ui.zoom.slider("value",this.ui.zoom.slider("option","min")).trigger("slidechange"),this.clampOffsets(),this.draw(),this.plotObjects()}}},onDestroy:function(){i(document).unbind("keypress.imviewer")},drawLarge:function(e){console.log("image model",this.model,this.model.urlFor("full"),"drop",this.getOption("drop")),this.img.load(this.model.urlFor(app.mobile()?"full":"hd")),this.showProgressBar()},onImageError:function(e){this.low||(this.img.load(this.model.urlFor("full")),this.showProgressBar(),this.low=!0)},onImageProgress:function(e){this.rendered&&this.ui.progress.text(e+"% loaded")},showProgressBar:function(){this.rendered&&(this.ui.progress.text("0% loaded"),this.ui.progress.show())},hideProgressBar:function(){this.rendered&&this.ui.progress.hide()},onImageLoaded:function(e){this.hideProgressBar(),this.width=this.img.width,this.height=this.img.height,this.ui.score.val(this.model.get("BLSAMPLEIMAGESCOREID")),this.ui.com.text(this.model.get("COMMENTS")),new h({model:this.model,el:this.$el}).create("COMMENTS","text"),this.calcZoom(),this.width*this.scalef>this.canvas.width&&(this.offsetx=-(this.width*this.scalef-this.canvas.width)/2),this.height*this.scalef>this.canvas.height&&(this.offsety=-(this.height*this.scalef-this.canvas.height)/2),this.draw(),this.plotObjects()},draw:function(){console.log("draw"),this.ctx.setTransform(this.scalef,0,0,this.scalef,this.offsetx,this.offsety),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.img,0,0,this.width,this.height),this.isMovingObject?this.drawMovingObject():this.drawingRegion?this.drawNewRegion():this.drawLines(),this.getOption("showHeatmap")&&(this.heatmap._renderer.ctx.setTransform(this.scalef,0,0,this.scalef,this.offsetx,this.offsety),this.heatmap._renderer.shadowCtx.setTransform(this.scalef,0,0,this.scalef,this.offsetx,this.offsety),this.heatmap._renderer.ctx.clearRect(0,0,this.width/this.scalef,this.height/this.scalef),this.heatmap._renderer.shadowCtx.clearRect(0,0,this.width/this.scalef,this.height/this.scalef))},resetZoom:function(){this.setZoom(this.ui.zoom.slider("option","min"))},setZoom:function(e){this.ui.zoom.slider("value",e),this.scalef=this.ui.zoom.slider("value")/100,this.clampOffsets()},onZoomChange:function(e){this.scalef=this.ui.zoom.slider("value")/100,this.ui.zval.text((100*this.scalef).toFixed(0)),e&&e.originalEvent&&(this.clampOffsets(),this.draw(),this.plotObjects())},calcZoom:function(){var e=this.ui.canvas.width()<this.ui.canvas.height()?this.ui.canvas.width()/this.width:this.ui.canvas.height()/this.height;this.ui.zoom.slider("option","min",100*e),this.onZoomChange()},clampOffsets:function(){this.offsety>0&&(this.offsety=0),this.offsety<this.ui.canvas.height()-this.scalef*this.height&&(this.offsety=this.ui.canvas.height()-this.scalef*this.height),this.offsetx>0&&(this.offsetx=0),this.offsetx<this.ui.canvas.width()-this.scalef*this.width&&(this.offsetx=this.ui.canvas.width()-this.scalef*this.width)},mouseWheelCanvas:function(e){e.preventDefault();var t=e.originalEvent,s=t.wheelDelta?t.wheelDelta:-t.detail;this.zoom(d.get_xy(t,this.ui.canvas),s)},zoom:function(e,t){var s=this.scalef;this.scalef+=t>0?.1:-.1,this.scalef<this.ui.canvas.width()/this.width&&(this.scalef=this.ui.canvas.width()/this.width),this.scalef<this.ui.canvas.height()/this.height&&(this.scalef=this.ui.canvas.height()/this.height);var n=(i=-this.offsetx+e[0])*(this.scalef/s);this.offsetx-=n-i;var i;n=(i=-this.offsety+e[1])*(this.scalef/s);this.offsety-=n-i,this.clampOffsets(),this.scalef<2&&this.ui.zoom.slider("value",100*this.scalef),this.ui.zval.text((100*this.scalef).toFixed(0)),this.draw(),this.plotObjects()},nearest:function(e){var t=this.subsamples.map((function(t){return t.get("X2")&&t.get("Y2")?e.x>t.get("X")&&e.x<t.get("X2")&&e.y>t.get("Y")&&e.y<t.get("Y2")?0:9999:Math.sqrt(Math.pow(e.x-parseInt(t.get("X")),2)+Math.pow(e.y-parseInt(t.get("Y")),2))})),s=n.min(t);if(console.log(e,s,t),s<30/this.scalef){var i=t.indexOf(s),a=this.subsamples.at(i);return console.log(a),a}},edge:function(e){if(e.obj&&e.obj.get("X2")&&e.obj.get("Y2")){var t=10/this.scalef;if(e.pos.x>e.obj.get("X2")-t&&e.pos.x<e.obj.get("X2"))return!0;if(e.pos.y>e.obj.get("Y2")-t&&e.pos.y<e.obj.get("Y2"))return!0}},mouseDownCanvas:function(e){e.preventDefault(),e.originalEvent.touches&&e.originalEvent.touches.length&&(e=e.originalEvent.touches[0]),this.ui.move.hasClass("button-highlight")?(this.lineStart=this.getScaledXY(e),this.isMovingObject=!0):this.ui.meas.hasClass("button-highlight")?(this.drawingLine=!0,this.lineStart=this.getScaledXY(e)):this.add_region?(this.drawingRegion=!0,this.lineStart=this.getScaledXY(e)):(this.record=!0,this.startx=e.clientX,this.starty=e.clientY)},getScaledXY:function(e){var t=d.get_xy(e,this.ui.canvas),s=parseInt(t[0]/this.scalef-this.offsetx/this.scalef),n=parseInt(t[1]/this.scalef-this.offsety/this.scalef);return console.log(s,n),{x:s,y:n}},mouseMoveCanvas:function(e){if(e.preventDefault(),!(e.originalEvent.touches&&e.originalEvent.touches.length>1)){e.originalEvent.touches&&e.originalEvent.touches.length&&(e=e.originalEvent.touches[0]);d.get_xy(e,this.ui.canvas);if(this.record&&(this.moved=!0,this.offsetx+=e.clientX-this.startx,this.offsety+=e.clientY-this.starty,this.clampOffsets(),this.drawDebounce(),this.startx=e.clientX,this.starty=e.clientY),this.ui.move.hasClass("button-highlight"))if(this.isMovingObject)this.lineEnd=this.getScaledXY(e),this.drawDebounce();else{var t=this.nearest(this.getScaledXY(e)),s=this.edge({obj:t,pos:this.getScaledXY(e)});if(this.resizeObject=!1,s)document.body.style.cursor="se-resize",this.resizeObject=!0;else if(t)t.set({isSelected:!0}),document.body.style.cursor="pointer";else{document.body.style.cursor="default";var n=this.subsamples.findWhere({isSelected:!0});n&&n.set({isSelected:!1})}this.movingObject=t}(this.drawingLine||this.drawingRegion)&&(this.moved=!0,this.lineEnd=this.getScaledXY(e),this.drawDebounce())}},mouseUpCanvas:function(e){if(e.preventDefault(),this.isMovingObject&&(this.isMovingObject=!1,this.lineEnd&&this.movingObject&&(this._calcNewPos({obj:this.movingObject,x2:this.resizeObject}),this.movingObject.save(this.movingObject.changedAttributes(),{patch:!0,success:function(){},error:function(e,t,s){app.alert({message:"Something went wrong moving that object, please try again: "+t.responseText})}}))),this.drawingRegion){if(this.lineStart.x>this.lineEnd.x)var t=this.lineEnd.x,s=this.lineStart.x;else t=this.lineStart.x,s=this.lineEnd.x;if(this.lineStart.y>this.lineEnd.y)var n=this.lineEnd.y,i=this.lineStart.y;else n=this.lineStart.y,i=this.lineEnd.y;this.lineStart={},this.lineEnd={};var l=Math.sqrt(Math.pow(Math.abs(s-t),2)+Math.pow(Math.abs(i-n),2));if(console.log("region lenght",l,void 0!==s,void 0!==t,void 0!==i,void 0!==n),l&&void 0!==s&&void 0!==t&&void 0!==i&&void 0!==n){var o=new a({BLSAMPLEID:this.model.get("BLSAMPLEID"),X:t,Y:n,X2:s,Y2:i}),r=this;o.save(null,{success:function(){o.set("RID",r.subsamples.length),r.subsamples.add(o),r.draw(),r.plotObjects()},error:function(e,t,s){app.alert({message:"Something went wrong creating that object, please try again: "+t.responseText})}})}}!this.moved&&this.lineStart.x&&(this.lineStart={},this.lineEnd={},this.draw(),this.plotObjects()),this.moved&&(this.draw(),this.plotObjects(),this.moved=!1),this.record=!1,this.drawingLine=!1,this.drawingRegion=!1},drawLines:function(){if(this.lineStart&&this.lineEnd){var e=this.scalef>1?1:1/this.scalef;this.ctx.beginPath(),this.ctx.moveTo(this.lineStart.x,this.lineStart.y),this.ctx.lineTo(this.lineEnd.x,this.lineEnd.y),this.ctx.stroke(),this.ctx.closePath();var t=this.model.get("MICRONSPERPIXELX")||3,s=this.model.get("MICRONSPERPIXELY")||3,n=(this.lineEnd.x-this.lineStart.x)/2,i=(this.lineEnd.y-this.lineStart.y)/2,a=Math.sqrt(Math.pow((this.lineEnd.x-this.lineStart.x)*t,2)+Math.pow((this.lineEnd.y-this.lineStart.y)*s,2));this.ctx.font=parseInt(14*e)+"px Arial",this.ctx.fillText(a.toFixed(0)+"μm",this.lineStart.x+n+5,this.lineStart.y+i+5)}},drawNewRegion:function(){this.ctx.beginPath(),this.ctx.save(),this.ctx.setLineDash([5,15]),this.ctx.rect(this.lineStart.x,this.lineStart.y,Math.abs(this.lineEnd.x-this.lineStart.x),Math.abs(this.lineEnd.y-this.lineStart.y)),this.ctx.stroke(),this.ctx.restore(),this.ctx.closePath()},_calcNewPos:function(e){var t=e.obj,s=this.lineEnd.x-this.lineStart.x,n=this.lineEnd.y-this.lineStart.y,i={};e.x2||(i.X=parseInt(t.get("X"))+s,i.Y=parseInt(t.get("Y"))+n),t.get("X2")&&t.get("Y2")&&(i.X2=parseInt(t.get("X2"))+s,i.Y2=parseInt(t.get("Y2"))+n),t.set(i)},drawMovingObject:function(){if(this.movingObject){this._drawObject({o:this.movingObject});var e=this.movingObject.clone();this._calcNewPos({obj:e,x2:this.resizeObject}),this._drawObject({o:e,dashed:!0})}},_drawObject:function(e){if(e.o){var t=this.scalef>1?1:1/this.scalef,s=15*t;this.ctx.lineWidth=this.scalef>1?1:1/this.scalef,e.dashed&&(this.ctx.save(),this.ctx.setLineDash([5,15]));var i=parseInt(e.o.get("X")),a=parseInt(e.o.get("Y"));this.ctx.strokeStyle=e.o.get("isSelected")?"turquoise":"red";var l=!1;if(n.each({GR:"#fdfd96",SC:"#fdfd96",AI:"#ffb347",DC:"#87ceeb",AP:"#77dd77"},(function(t,s){e.o.get(s)>0&&(c=t,l=!0)}),this),l&&(this.ctx.strokeStyle=c),e.o.get("X2")&&e.o.get("Y2")){var o=parseInt(e.o.get("X2")),r=parseInt(e.o.get("Y2"));this.getOption("showBeam")&&this.drawGrid(e.o),this.ctx.beginPath(),this.ctx.rect(i,a,o-i,r-a),this.ctx.stroke(),this.ctx.closePath()}else{if(this.getOption("showBeam")&&this.drawBeam(e.o),this.rankOption){var p=(e.o.get(this.rankOption.value)-this.rankOption.paramdist[0])/(this.rankOption.paramdist[1]-this.rankOption.paramdist[0]);this.rankOption.min&&this.rankOption.paramdist[0]>this.rankOption.min&&(this.rankOption.paramdist[0]=this.rankOption.min),this.rankOption.inverted||(p=1-p),this.ctx.strokeStyle=e.o.get(this.rankOption.value)?d.rainbow(p/4):e.o.get(this.rankOption.check)>0?"yellow":"#dfdfdf"}this.ctx.beginPath(),this.ctx.moveTo(i-s,a),this.ctx.lineTo(i+s,a),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(i,a-s),this.ctx.lineTo(i,a+s),this.ctx.stroke()}e.dashed&&this.ctx.restore(),this.ctx.fillStyle=e.o.get("isSelected")?"turquoise":"red",this.ctx.font=parseInt(14*t)+"px Arial",this.ctx.fillText(parseInt(e.o.get("RID"))+1,i-15*t,a-6*t)}},drawBeam:function(e){if(e.get("PREFERREDBEAMSIZEX")&&e.get("PREFERREDBEAMSIZEY")){var t=this.model.get("MICRONSPERPIXELX")||3,s=this.model.get("MICRONSPERPIXELY")||3;this.ctx.save(),this.ctx.setLineDash([3/this.scalef,3/this.scalef]),this.ctx.strokeStyle="red",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.ellipse(parseInt(e.get("X")),parseInt(e.get("Y")),parseInt(e.get("PREFERREDBEAMSIZEX"))/t/2,parseInt(e.get("PREFERREDBEAMSIZEY"))/s/2,0,0,2*Math.PI),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}},drawGrid:function(e){if(e.get("BOXSIZEX")&&e.get("BOXSIZEY")&&0!=e.get("BOXSIZEX")&&0!=e.get("BOXSIZEY")){var t=this.model.get("MICRONSPERPIXELX")||3,s=this.model.get("MICRONSPERPIXELY")||3,n=parseInt(e.get("BOXSIZEX"))/t,i=parseInt(e.get("BOXSIZEY"))/s;this.ctx.save(),this.ctx.setLineDash([5/this.scalef,5/this.scalef]),this.ctx.strokeStyle="red",this.ctx.lineWidth=1;for(var a=parseInt(e.get("X")),l=parseInt(e.get("Y")),o=parseInt(e.get("X2")),r=parseInt(e.get("Y2")),c=a+n;c<o;c+=n)this.ctx.moveTo(c,e.get("Y")),this.ctx.lineTo(c,e.get("Y2")),this.ctx.stroke();for(c=l+i;c<r;c+=i)this.ctx.moveTo(e.get("X"),c),this.ctx.lineTo(e.get("X2"),c),this.ctx.stroke();this.ctx.restore()}},replotObjects:function(){this.draw(),this.plotObjects()},plotObjects:function(){if(console.log("plot obj",this.subsamples.length,this.subsamples,arguments),this.rankOption){var e=this.subsamples.map((function(e){if(e.get(this.rankOption.value))return e.get(this.rankOption.value)}),this);this.rankOption.paramdist=[n.min(e),n.max(e)]}this.subsamples.each((function(e){this._drawObject({o:e})}),this),this.getOption("showHeatmap")&&this.heatmap.repaint()},changeHeatmap:function(){this.generateHeatmap({callback:this.replotObjects.bind(this)})},populateHeatmap:function(){this.attachments.length?this.ui.pia.show():this.ui.pia.hide();var e=n.unique(this.attachments.pluck("FILENAME")),t=[];n.each(e,(function(e){t.push('<option value="'+e+'">'+e.replace(".json","")+"</option>")})),this.ui.pia.html(t.join("")),this.changeHeatmap()},generateHeatmap:function(e){if(this.getOption("showHeatmap")){this.heatmap.setData({data:[]});var s=[],a=this,l=this.subsamples.filter((function(e){return e.get("X2")})),o=[];n.each(l,(function(e){var n=this.attachments.findWhere({BLSUBSAMPLEID:e.get("BLSUBSAMPLEID"),FILENAME:this.ui.pia.val()});n&&(s.push(t.ajax({url:app.apiurl+"/download/attachment/id/"+n.get("DATACOLLECTIONID")+"/aid/"+n.get("DATACOLLECTIONFILEATTACHMENTID"),dataType:"json"})),o.push(e))}),this),i.when.apply(i,s).done((function(){var t=1==o.length?[arguments]:arguments,s=[{x:10,y:10,value:1,radius:1}];n.each(o,(function(e,n){var i=a.attachments.findWhere({BLSUBSAMPLEID:e.get("BLSUBSAMPLEID")});i&&(s=s.concat(a.parseAttachment(e,i,t[n][0])))}),a);var i=0;n.each(s,(function(e){i=Math.max(e.value,i)}),this),a.heatmap.setData({data:s,max:i}),e&&e.callback&&e.callback()}))}},parseAttachment:function(e,t,s){var i=1e3*t.get("DX_MM")/parseFloat(this.model.get("MICRONSPERPIXELX")),a=1e3*t.get("DY_MM")/parseFloat(this.model.get("MICRONSPERPIXELY")),l=[];return n.each(s,(function(s,n){if("vertical"==t.get("ORIENTATION")){var o=Math.floor(n/t.get("STEPS_Y")),r=n%t.get("STEPS_Y");1==t.get("SNAKED")&&o%2==1&&(r=t.get("STEPS_Y")-1-r);var c=o*i+i/2+parseInt(e.get("X")),p=r*a+a/2+parseInt(e.get("Y"))}else{o=n%t.get("STEPS_X"),r=Math.floor(n/t.get("STEPS_X"));1==t.get("SNAKED")&&r%2==1&&(o=t.get("STEPS_X")-1-o);c=o*i+i/2+parseInt(e.get("X")),p=r*a+a/2+parseInt(e.get("Y"))}l.push({x:parseInt(c),y:parseInt(p),value:s<1?0:s,radius:i<a?1.8*a:1.8*i})}),this),l}})}.apply(t,a))||(e.exports=l)}).call(this,s(5),s(8))},438:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"BLSAMPLEIMAGEID",urlRoot:"/imaging/inspection/images/scores/auto"})}.apply(t,n))||(e.exports=i)},446:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"CONTAINERREGISTRYHASPROPOSALID",urlRoot:"/shipment/containers/registry/proposals",validation:{PROPOSALID:{required:!0,pattern:"number"},CONTAINERREGISTRYID:{required:!0,pattern:"number"}}})}.apply(t,n))||(e.exports=i)},447:function(e,t,s){(function(n){var i,a;i=[s(6),s(72),s(79)],void 0===(a=function(e,t,s){return e.Model.extend(n.extend({},{idAttribute:"DEWARREPORTID",urlRoot:"/shipment/containers/reports",initialize:function(){this.on("change",this.refreshOptions,this),this.refreshOptions()},defaults:{REPORTMD:""},refreshOptions:function(){this.get("REPORT")&&(this.attributes.REPORTMD=t.toHTML(this.get("REPORT")))},validation:{CONTAINERREGISTRYID:{required:!0,pattern:"number"},REPORT:{required:!0},ATTACHMENT:function(e){if(e){var t=e.name.split("."),s=t[t.length-1];if(-1==["jpg","jpeg"].indexOf(s.toLowerCase()))return"Attachment must be a jpeg file"}}}},s))}.apply(t,i))||(e.exports=a)}).call(this,s(5))},448:function(e,t,s){var n,i;n=[s(6)],void 0===(i=function(e){return e.Model.extend({idAttribute:"DEWARREGISTRYHASPROPOSALID",urlRoot:"/shipment/dewars/registry/proposals",validation:{PROPOSALID:{required:!0,pattern:"number"},DEWARREGISTRYID:{required:!0,pattern:"number"},LABCONTACTID:{required:!1,pattern:"number"}}})}.apply(t,n))||(e.exports=i)},452:function(e,t,s){(function(n){var i,a;i=[s(6),s(271),s(453),s(272),s(454)],void 0===(a=function(e,t,s,i,a){return e.Model.extend({idAttribute:"DIFFRACTIONPLANID",urlRoot:"/exp/plans",defaults:{MONOBANDWIDTH:null,ENERGY:null,PREFERREDBEAMSIZEX:null,PREFERREDBEAMSIZEY:null},initialize:function(e,t){this.set("SCANPARAMETERSMODELS",new s),this.set("DETECTORS",new a),t&&t.SCANPARAMETERSMODELS&&(this.models=t.SCANPARAMETERSMODELS,this.listenTo(this.models,"sync reset add remove",this.syncModels),this.syncModels()),t&&t.DETECTORS&&(this.detectors=t.DETECTORS,this.listenTo(this.detectors,"sync reset add remove",this.syncDetectors),this.syncDetectors()),this.listenTo(this,"change:ENERGY",this.updateKevEnergy),this.updateKevEnergy(),t&&t.BEAMLINESETUPS&&(this.beamlinesetups=t.BEAMLINESETUPS,this.listenTo(this.beamlinesetups,"sync reset add remove",this.syncLimits),this.syncLimits())},syncModels:function(){if(this.get("DIFFRACTIONPLANID")){var e=this.models.where({DATACOLLECTIONPLANID:this.get("DIFFRACTIONPLANID")});this.get("SCANPARAMETERSMODELS").reset(e)}},syncDetectors:function(){if(this.get("DIFFRACTIONPLANID")){var e=this.detectors.where({DATACOLLECTIONPLANID:this.get("DIFFRACTIONPLANID")});this.get("DETECTORS").reset(e)}},syncLimits:function(){var e=this.beamlinesetups.findWhere({DETECTORID:this.get("DETECTORID")});e||this.beamlinesetups.length&&(e=this.beamlinesetups.at(0)),e&&(this.validation=JSON.parse(JSON.stringify(this.__proto__.validation)),n.each(this.validation,(function(t,s){var n=e.getRange({field:s});n&&(t.range=n)}),this))},updateKevEnergy:function(){this.set("KEVENERGY",(.001*this.get("ENERGY")).toPrecision(3))},validation:{BLSAMPLEID:{required:!0,pattern:"digits"},EXPERIMENTKIND:{required:!1,pattern:"word"},REQUIREDRESOLUTION:{required:!1,pattern:"number"},PREFERREDBEAMSIZEX:{required:!1,pattern:"digits"},PREFERREDBEAMSIZEY:{required:!1,pattern:"digits"},EXPOSURETIME:{required:!1,pattern:"number"},BOXSIZEX:{required:!1,pattern:"digits"},BOXSIZEY:{required:!1,pattern:"digits"},AXISSTART:{required:!1,pattern:"number"},AXISRANGE:{required:!1,pattern:"number"},NUMBEROFIMAGES:{required:!1,pattern:"number"},TRANSMISSION:{required:!1,pattern:"number"},ENERGY:{required:!1,pattern:"digits"},MONOCHROMATOR:{required:!1,pattern:"word"},MONOBANDWIDTH:{required:!1,pattern:"number"}}})}.apply(t,i))||(e.exports=a)}).call(this,s(5))},453:function(e,t,s){var n,i;n=[s(10),s(271)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:"/exp/parameters/models",state:{pageSize:15},comparator:function(e){return parseInt(e.get("SEQUENCENUMBER"))},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},454:function(e,t,s){var n,i;n=[s(10),s(272)],void 0===(i=function(e,t){return e.extend({model:t,mode:"server",url:"/exp/plans/detectors",state:{pageSize:15},parseState:function(e,t,s,n){return{totalRecords:e.total}},parseRecords:function(e,t){return e.data}})}.apply(t,n))||(e.exports=i)},98:function(e,t,s){(function(n){var i,a;i=[s(10),s(14)],void 0===(a=function(e,t){return e.extend(n.extend({},t,{mode:"client",url:"/vstat/runs",keyAttribute:"RUN",valueAttribute:"RUNID",state:{pageSize:15}}))}.apply(t,i))||(e.exports=a)}).call(this,s(5))}}]);